import{j as e,g as j,b,u as f,h as y,r as d,L as n,t as c}from"./client-CB7jT4PR.js";import{u as N}from"./useSuspenseQuery-BCzDeUkk.js";import{C}from"./company-logo-CUirh31U.js";import{P as v}from"./plus-CE-jRqin.js";import{R as D,T as w,a as S,D as R,C as x,P as T,O as I,b as E,c as O}from"./close-ibM140p9.js";import{R as P}from"./index-DGV-PNAM.js";import"./cn-B3Z9kGEY.js";function Q({children:i,className:t,...r}){return e.jsxs(T,{children:[e.jsx(I,{className:"fixed inset-0 bg-black/40"}),e.jsxs(E,{className:`fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-sm p-4 w-[min(90vw,400px)] ${t}`,...r,children:[i,e.jsx(x,{"aria-label":"Fermer",className:"absolute top-3 end-3 ",children:e.jsx(O,{className:"size-5"})})]})]})}const q=D,z=w,F=S,L=R,$=x,k={pending:"En attente de validation",active:"Approuvée",rejected:"Rejetée"};function A(){return e.jsx("article",{className:"border border-gray-300 p-5 rounded-sm",children:e.jsxs(n,{to:"/compte/entreprises/add",className:"text-sm border px-2 py-1 rounded-sm flex items-center gap-1.5 max-w-fit",children:[e.jsx(v,{className:"size-4"}),"Créer une entreprise"]})})}const H=function(){const t=j.useRouteContext(),r=N(b),{mutate:p,isPending:m}=f({mutationFn:y}),[u,o]=d.useState(!1),[l,h]=d.useState(null);function g(s){s.preventDefault();const a=new FormData(s.target);p({data:a.get("companyId")},{onSuccess:()=>{t.queryClient.invalidateQueries({queryKey:["user","companies"]}),t.queryClient.invalidateQueries({queryKey:["company",l]}),o(!1),c.success("Entreprise supprimée avec succès")},onError:()=>{c.error("Une erreur est survenue lors de la suppression de l'entreprise")}})}return r.data?.length?e.jsxs("div",{className:"container px-4 py-6",children:[e.jsxs("header",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Mes entreprises"}),e.jsx("p",{children:"Gérez vos entreprises et leurs informations."})]}),e.jsx("ul",{className:"flex flex-col gap-2 ",children:r.data?.map(s=>e.jsx("li",{children:e.jsxs("article",{className:"border border-gray-300 p-5 rounded-sm grid gap-4 shadow-2xs",children:[e.jsxs("header",{className:"flex items-baseline gap-2 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{company:s}),e.jsx("h2",{className:"text-lg font-bold leading-1",children:s.name}),e.jsx("p",{className:"text-xs text-orange-300",children:k[s.status]})]}),e.jsx("p",{className:"text-xs text-gray-500 border px-2 py-1 rounded-sm inline-flex gap-2 items-center hover:cursor-pointer ",children:s.siret})]}),e.jsxs("footer",{className:"flex items-center gap-2 justify-between",children:[e.jsx("ul",{className:"flex flex-wrap gap-2",children:s.categories.map(a=>e.jsx("li",{className:"bg-gray-100 px-2 py-1 rounded-sm text-xs flex items-center gap-2",children:a.category_name},a.category_id))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{to:"/entreprises/$name",params:{name:s.name.toLowerCase().replace(/ /g,"-")},search:{id:s.id},className:"text-xs px-2 py-1 rounded-sm border border-blue-400 text-blue-400",children:"Consulter"}),e.jsx(n,{to:"/compte/entreprises/$id/edit",params:{id:s.id},className:"text-xs px-2 py-1 rounded-sm border border-blue-400 text-blue-400",children:"Modifier"}),e.jsxs(q,{open:u&&l===s.id,onOpenChange:o,children:[e.jsx(z,{asChild:!0,children:e.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded-sm border border-red-400 text-red-400 hover:bg-red-400 hover:text-white transition-colors",onClick:()=>h(s.id),children:"Supprimer"})}),e.jsxs(Q,{className:"grid gap-4",children:[e.jsx(F,{className:"text-lg font-bold",children:"Supprimer une entreprise"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(L,{className:"text-sm text-gray-500",children:["Valider la suppression de l'entreprise ",e.jsx("strong",{children:s.name})," ?"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cette action est irréversible. Toutes les données liées à cette entreprise seront perdues."})]}),e.jsxs("div",{className:"grid grid-flow-col gap-2 place-content-end",children:[e.jsx($,{asChild:!0,children:e.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded-sm border border-gray-400 text-gray-400 hover:bg-gray-400 hover:text-white transition-colors",children:"Annuler"})}),e.jsxs("form",{onSubmit:g,children:[e.jsx("input",{type:"hidden",name:"companyId",value:s.id}),e.jsx("button",{type:"submit",className:"text-xs px-2 py-1 rounded-sm border border-red-400 text-red-400 hover:bg-red-400 hover:text-white transition-colors",children:m?"...":"Valider"})]})]})]})]})]})]})]})},s.id))}),r.data.length<3&&e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"my-6 h-px bg-gray-300"}),e.jsx(A,{})]})]}):e.jsx("div",{className:"container px-4 py-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Vous n'avez encore d'entreprise référencée"}),e.jsx(n,{to:"/compte/entreprises/add",className:"text-sm border px-2 py-1 rounded-sm",children:"Créer une entreprise"})]})})};export{H as component};
