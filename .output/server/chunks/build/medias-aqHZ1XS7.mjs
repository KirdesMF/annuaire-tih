import{bk as e,at as a,b8 as l,t as s,aI as r,c as i,j as o,N as t,aL as n,bf as d,M as c}from"../nitro/nitro.mjs";import{l as m}from"./plus-BVAK8_Jr.mjs";import{l as u}from"./label-DH_rTUQU.mjs";import{c as p}from"./use-image-preview-D0S5Wc-4.mjs";import{d as g}from"../_/index2.mjs";import{p as y,a as x,l as v}from"./company.schema-5gxzbh_J.mjs";import{i as b}from"./trash-BEra1ZVi.mjs";import"node:net";import"node:stream";import"node:events";import"node:process";import"node:buffer";import"node:timers";import"node:async_hooks";import"node:url";import"node:stream/web";import"node:crypto";const h=n("app_lib_api_companies_mutations_update-company-medias_ts--updateCompanyMedia_createServerFn_handler","/_server"),f=i({method:"POST"}).validator((e=>{const a=g(e,{files:["logo","gallery"],arrays:["gallery","gallery_public_id"]});return t(y,a)})).handler(h),j=n("app_lib_api_companies_mutations_update-company-medias_ts--updateCompanyLogo_createServerFn_handler","/_server");i({method:"POST"}).validator((e=>{const a=g(e,{files:["logo"]});return t(x,a)})).handler(j);const N=n("app_lib_api_companies_mutations_update-company-medias_ts--updateCompanyGallery_createServerFn_handler","/_server");i({method:"POST"}).validator((e=>{const a=g(e,{files:["gallery"],arrays:["gallery","gallery_public_id"]});return t(v,a)})).handler(N);const w=n("app_lib_api_companies_mutations_delete-company-media_ts--deleteCompanyLogo_createServerFn_handler","/_server");i({method:"POST"}).validator((e=>e)).handler(w);const C=n("app_lib_api_companies_mutations_delete-company-media_ts--deleteCompanyMedia_createServerFn_handler","/_server"),S=i({method:"POST"}).validator((e=>e)).handler(C),we=function(){var i,t,n,x,v,h,j,N,w,C,q,P,U;const F=e.useParams(),z=e.useRouteContext(),K=e.useNavigate(),{data:L}=a(l(F.slug)),{imagePreviews:M,readImage:Q,setImagePreviews:T}=p(),{mutate:k,isPending:B}=s({mutationFn:r(f)}),{mutate:O,isPending:D}=s({mutationFn:r(S)});function _(e,a,l){var s;const r=null==(s=e.target.files)?void 0:s[0];r&&Q({type:a,file:r,index:l})}function I({companyId:e,publicId:a,index:l}){O({data:{companyId:e,publicId:a,type:"gallery",index:l}},{onSuccess:()=>{z.queryClient.invalidateQueries({queryKey:["user","companies"]}),z.queryClient.invalidateQueries({queryKey:["company",F.slug]}),T((e=>({...e,gallery:e.gallery.filter(((e,a)=>a!==l))}))),c.success("Image supprimée avec succès")}})}return o.jsx("div",{className:"container py-6",children:o.jsxs("form",{onSubmit:function(e){e.preventDefault();const a=new FormData(e.target),l=g(a,{files:["logo","gallery"],arrays:["gallery","gallery_public_id"]}),s=d(y,l,{abortPipeEarly:!0});s.success?k({data:a},{onSuccess:()=>{z.queryClient.invalidateQueries({queryKey:["user","companies"]}),z.queryClient.invalidateQueries({queryKey:["company",F.slug]}),c.success("Images mises à jour avec succès"),K({to:"/compte/entreprises"})},onError:e=>{console.error(e),c.error("Une erreur est survenue lors de la mise à jour des images")}}):c.error(o.jsx("div",{children:s.issues.map(((e,a)=>o.jsx("p",{children:e.message},a)))}))},className:"flex flex-col gap-4 items-center",children:[o.jsx("input",{type:"hidden",name:"companyId",value:L.id}),o.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[o.jsxs("fieldset",{className:"border rounded-sm border-gray-300 p-4 w-max",children:[o.jsx("legend",{className:"text-xs font-medium  bg-white px-2",children:"Logo"}),o.jsxs("div",{className:"grid gap-2",children:[o.jsxs(u,{className:"relative flex flex-col gap-1 outline-none group",children:[o.jsx("span",{className:"text-xs font-medium",children:"Logo (max. 3MB)"}),o.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[M.logo||(null==(i=L.logo)?void 0:i.secureUrl)?o.jsx("img",{src:M.logo||(null==(t=L.logo)?void 0:t.secureUrl),alt:"Logo",className:"w-full h-full object-cover"}):o.jsx(m,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),o.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"logo",onChange:e=>_(e,"logo"),accept:"image/*"}),o.jsx("input",{type:"hidden",name:"logo_public_id",value:null==(n=L.logo)?void 0:n.publicId})]})]}),o.jsx("button",{type:"button",className:"text-xs font-medium text-white bg-primary p-2 rounded-sm w-max",onClick:()=>{var e;return function({companyId:e,publicId:a}){O({data:{companyId:e,publicId:a,type:"logo"}},{onSuccess:()=>{z.queryClient.invalidateQueries({queryKey:["user","companies"]}),z.queryClient.invalidateQueries({queryKey:["company",F.slug]}),T((e=>({...e,logo:void 0}))),c.success("Logo supprimé avec succès")}})}({companyId:L.id,publicId:(null==(e=L.logo)?void 0:e.publicId)||""})},children:D?"...":o.jsx(b,{className:"size-5"})})]})]}),o.jsxs("fieldset",{className:"border rounded-sm border-gray-300 p-4",children:[o.jsx("legend",{className:"text-xs font-medium  bg-white px-2",children:"Galerie"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs(u,{className:"relative flex flex-col gap-1 outline-none group",children:[o.jsx("span",{className:"text-xs font-medium",children:"Image 1 (max. 2MB)"}),o.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[M.gallery[0]||(null==(v=null==(x=L.gallery)?void 0:x[0])?void 0:v.secureUrl)?o.jsx("img",{src:M.gallery[0]||(null==(h=L.gallery)?void 0:h[0].secureUrl),alt:"gallery 1",className:"w-full h-full object-cover"}):o.jsx(m,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),o.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery[0]",onChange:e=>_(e,"gallery",0),accept:"image/*"}),o.jsx("input",{type:"hidden",name:"gallery_public_id[0]",value:null==(N=null==(j=L.gallery)?void 0:j[0])?void 0:N.publicId})]})]}),o.jsx("button",{type:"button",className:"text-xs font-medium text-white bg-primary p-2 rounded-sm w-max",onClick:()=>{var e,a;return I({companyId:L.id,publicId:(null==(a=null==(e=L.gallery)?void 0:e[0])?void 0:a.publicId)||"",index:0})},children:D?"...":o.jsx(b,{className:"size-5"})})]}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs(u,{className:"relative flex flex-col gap-1 outline-none group",children:[o.jsx("span",{className:"text-xs font-medium",children:"Image 2 (max. 2MB)"}),o.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[M.gallery[1]||(null==(C=null==(w=L.gallery)?void 0:w[1])?void 0:C.secureUrl)?o.jsx("img",{src:M.gallery[1]||(null==(q=L.gallery)?void 0:q[1].secureUrl),alt:"gallery 2",className:"w-full h-full object-cover"}):o.jsx(m,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),o.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery[1]",onChange:e=>_(e,"gallery",1),accept:"image/*"}),o.jsx("input",{type:"hidden",name:"gallery_public_id[1]",value:null==(U=null==(P=L.gallery)?void 0:P[1])?void 0:U.publicId})]})]}),o.jsx("button",{type:"button",className:"text-xs font-medium text-white bg-primary p-2 rounded-sm w-max",onClick:()=>{var e,a;return I({companyId:L.id,publicId:(null==(a=null==(e=L.gallery)?void 0:e[1])?void 0:a.publicId)||"",index:1})},children:D?"...":o.jsx(b,{className:"size-5"})})]})]})]})]}),o.jsx("button",{type:"submit",className:"text-xs font-medium text-white bg-primary px-4 py-2 rounded-sm w-max",children:B?"En cours...":"Mettre à jour"})]})})};export{we as component};
//# sourceMappingURL=medias-aqHZ1XS7.mjs.map
