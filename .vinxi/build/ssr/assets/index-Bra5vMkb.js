import{jsxs as r,jsx as e,Fragment as b}from"react/jsx-runtime";import{useSuspenseQuery as y,useMutation as N}from"@tanstack/react-query";import{Link as a}from"@tanstack/react-router";import{Dialog as s,Separator as C}from"radix-ui";import{useState as p}from"react";import{toast as m}from"sonner";import{C as v}from"./company-logo-DcDO8tdb.js";import{P as D}from"./plus-BVAK8_Jr.js";import{C as w}from"./close--xrcrNXd.js";import{d as S,u as j,e as I}from"./ssr-B2yzgCJC.js";import"./cn-bhneXptQ.js";import"clsx";import"tailwind-merge";import"better-auth/react";import"better-auth/client/plugins";import"drizzle-orm/pg-core";import"@tanstack/react-query-devtools";import"@tanstack/router-core";import"@tanstack/start-client-core";import"@tanstack/start-server-core";import"valibot";import"drizzle-orm";import"decode-formdata";import"@tanstack/react-router-with-query";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";function T({children:l,className:n,...i}){return r(s.Portal,{children:[e(s.Overlay,{className:"fixed inset-0 bg-black/40"}),r(s.Content,{className:`fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-sm p-4 w-[min(90vw,400px)] ${n}`,...i,children:[l,e(s.Close,{"aria-label":"Fermer",className:"absolute top-3 end-3 ",children:e(w,{className:"size-5"})})]})]})}const R=s.Root,O=s.Trigger,Q=s.Title,q=s.Description,z=s.Close,E={pending:"En attente de validation",active:"Approuvée",rejected:"Rejetée"};function F(){return e("article",{className:"border border-gray-300 p-5 rounded-sm",children:r(a,{to:"/compte/entreprises/add",className:"text-sm border px-2 py-1 rounded-sm flex items-center gap-1.5 max-w-fit",children:[e(D,{className:"size-4"}),"Créer une entreprise"]})})}const ce=function(){const n=S.useRouteContext(),i=y(j),{mutate:u,isPending:x}=N({mutationFn:I}),[h,d]=p(!1),[c,g]=p(null);function f(t){t.preventDefault();const o=new FormData(t.target);u({data:o.get("companyId")},{onSuccess:()=>{n.queryClient.invalidateQueries({queryKey:["user","companies"]}),n.queryClient.invalidateQueries({queryKey:["company",c]}),d(!1),m.success("Entreprise supprimée avec succès")},onError:()=>{m.error("Une erreur est survenue lors de la suppression de l'entreprise")}})}return i.data?.length?r("div",{className:"container px-4 py-6",children:[r("header",{className:"mb-6",children:[e("h1",{className:"text-2xl font-bold",children:"Mes entreprises"}),e("p",{children:"Gérez vos entreprises et leurs informations."})]}),e("ul",{className:"flex flex-col gap-2 ",children:i.data?.map(t=>e("li",{children:r("article",{className:"border border-gray-300 p-5 rounded-sm grid gap-4 shadow-2xs",children:[r("header",{className:"flex items-baseline gap-2 justify-between",children:[r("div",{className:"flex items-center gap-2",children:[e(v,{company:t}),e("h2",{className:"text-lg font-bold leading-1",children:t.name}),e("p",{className:"text-xs text-orange-300",children:E[t.status]})]}),e("p",{className:"text-xs text-gray-500 border px-2 py-1 rounded-sm inline-flex gap-2 items-center hover:cursor-pointer ",children:t.siret})]}),r("footer",{className:"flex items-center gap-2 justify-between",children:[e("ul",{className:"flex flex-wrap gap-2",children:t.categories.map(o=>e("li",{className:"bg-gray-100 px-2 py-1 rounded-sm text-xs flex items-center gap-2",children:o.category_name},o.category_id))}),r("div",{className:"flex gap-2",children:[e(a,{to:"/entreprises/$name",params:{name:t.name.toLowerCase().replace(/ /g,"-")},search:{id:t.id},className:"text-xs px-2 py-1 rounded-sm border border-blue-400 text-blue-400",children:"Consulter"}),e(a,{to:"/compte/entreprises/$id/edit",params:{id:t.id},className:"text-xs px-2 py-1 rounded-sm border border-blue-400 text-blue-400",children:"Modifier"}),r(R,{open:h&&c===t.id,onOpenChange:d,children:[e(O,{asChild:!0,children:e("button",{type:"button",className:"text-xs px-2 py-1 rounded-sm border border-red-400 text-red-400 hover:bg-red-400 hover:text-white transition-colors",onClick:()=>g(t.id),children:"Supprimer"})}),r(T,{className:"grid gap-4",children:[e(Q,{className:"text-lg font-bold",children:"Supprimer une entreprise"}),r("div",{className:"space-y-2",children:[r(q,{className:"text-sm text-gray-500",children:["Valider la suppression de l'entreprise ",e("strong",{children:t.name})," ?"]}),e("p",{className:"text-sm text-gray-500",children:"Cette action est irréversible. Toutes les données liées à cette entreprise seront perdues."})]}),r("div",{className:"grid grid-flow-col gap-2 place-content-end",children:[e(z,{asChild:!0,children:e("button",{type:"button",className:"text-xs px-2 py-1 rounded-sm border border-gray-400 text-gray-400 hover:bg-gray-400 hover:text-white transition-colors",children:"Annuler"})}),r("form",{onSubmit:f,children:[e("input",{type:"hidden",name:"companyId",value:t.id}),e("button",{type:"submit",className:"text-xs px-2 py-1 rounded-sm border border-red-400 text-red-400 hover:bg-red-400 hover:text-white transition-colors",children:x?"...":"Valider"})]})]})]})]})]})]})]})},t.id))}),i.data.length<3&&r(b,{children:[e(C.Root,{className:"my-6 h-px bg-gray-300"}),e(F,{})]})]}):e("div",{className:"container px-4 py-6",children:r("div",{className:"flex flex-col items-center justify-center gap-4",children:[e("h1",{className:"text-2xl font-bold",children:"Vous n'avez encore d'entreprise référencée"}),e(a,{to:"/compte/entreprises/add",className:"text-sm border px-2 py-1 rounded-sm",children:"Créer une entreprise"})]})})};export{ce as component};
