import{jsx as e,jsxs as t,Fragment as h}from"react/jsx-runtime";import{useSuspenseQuery as f,useMutation as b}from"@tanstack/react-query";import{Link as o}from"@tanstack/react-router";import{Separator as y}from"radix-ui";import{useState as d}from"react";import{toast as m}from"sonner";import{C as N}from"./company-logo-B5lxhvXb.js";import{P as C}from"./plus-BVAK8_Jr.js";import{D as v,d as D,a as S,b as w,c as I,e as j}from"./dialog-D12vissF.js";import{d as Q,C as T}from"./constantes-BPJ6_ssB.js";import{B as q,t as M}from"./ssr-Bxxdisao.js";import"./close--xrcrNXd.js";import"@tanstack/start-client-core";import"drizzle-orm/pg-core";import"better-auth/react";import"better-auth/client/plugins";import"zustand";import"@tanstack/router-core";import"@tanstack/start-server-core";import"cmdk";import"clsx";import"tailwind-merge";import"@tanstack/react-query-devtools";import"valibot";import"drizzle-orm";import"nanoid";import"@tanstack/react-router-with-query";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";function O(){return e("article",{className:"border border-gray-300 p-5 rounded-sm",children:t(o,{to:"/compte/entreprises/create",className:"text-sm border px-2 py-1 rounded-sm flex items-center gap-1.5 max-w-fit",children:[e(C,{className:"size-4"}),"Créer une entreprise"]})})}const pe=function(){const i=q.useRouteContext(),a=f(M(i.user.id)),{mutate:p,isPending:c}=b({mutationFn:Q}),[u,n]=d(!1),[l,x]=d(null);function g(r){r.preventDefault();const s=new FormData(r.target);p({data:{companyId:s.get("companyId"),companySlug:s.get("companySlug")}},{onSuccess:()=>{i.queryClient.invalidateQueries({queryKey:["user","companies"]}),i.queryClient.invalidateQueries({queryKey:["company",l]}),n(!1),m.success("Entreprise supprimée avec succès")},onError:()=>{m.error("Une erreur est survenue lors de la suppression de l'entreprise")}})}return a.data?.length?t("div",{className:"container px-4 py-6",children:[t("header",{className:"mb-6",children:[e("h1",{className:"text-2xl font-bold",children:"Mes entreprises"}),e("p",{children:"Gérez vos entreprises et leurs informations."})]}),e("ul",{className:"flex flex-col gap-2 ",children:a.data?.map(r=>e("li",{children:t("article",{className:"border border-gray-300 p-5 rounded-sm grid gap-4 shadow-2xs",children:[t("header",{className:"flex items-baseline gap-2 justify-between",children:[t("div",{className:"flex items-center gap-2",children:[e(N,{name:r.name,url:r.logo?.secureUrl}),e("h2",{className:"text-lg font-bold leading-1",children:r.name}),e("p",{className:"text-xs text-orange-300",children:T[r.status]})]}),e("p",{className:"text-xs text-gray-500 border px-2 py-1 rounded-sm inline-flex gap-2 items-center hover:cursor-pointer ",children:r.siret})]}),t("footer",{className:"flex items-center gap-2 justify-between",children:[e("ul",{className:"flex flex-wrap gap-2",children:r.categories.map(s=>e("li",{className:"bg-gray-100 px-2 py-1 rounded-sm text-xs flex items-center gap-2",children:s.category_name},s.category_id))}),t("div",{className:"flex gap-2",children:[e(o,{to:"/entreprises/$slug",params:{slug:r.slug},className:"text-xs px-2 py-1 rounded-sm border border-blue-400 text-blue-400",children:"Consulter"}),e(o,{to:"/compte/entreprises/$slug/edit/infos",params:{slug:r.slug},className:"text-xs px-2 py-1 rounded-sm border border-blue-400 text-blue-400",children:"Modifier"}),t(v,{open:u&&l===r.id,onOpenChange:n,children:[e(D,{asChild:!0,children:e("button",{type:"button",className:"text-xs px-2 py-1 rounded-sm border border-red-400 text-red-400 hover:bg-red-400 hover:text-white transition-colors",onClick:()=>x(r.id),children:"Supprimer"})}),t(S,{className:"grid gap-4",children:[e(w,{className:"text-lg font-bold",children:"Supprimer une entreprise"}),t("div",{className:"space-y-2",children:[t(I,{className:"text-sm text-gray-500",children:["Valider la suppression de l'entreprise ",e("strong",{children:r.name})," ?"]}),e("p",{className:"text-sm text-gray-500",children:"Cette action est irréversible. Toutes les données liées à cette entreprise seront perdues."})]}),t("div",{className:"grid grid-flow-col gap-2 place-content-end",children:[e(j,{asChild:!0,children:e("button",{type:"button",className:"text-xs px-2 py-1 rounded-sm border border-gray-400 text-gray-400 hover:bg-gray-400 hover:text-white transition-colors",children:"Annuler"})}),t("form",{onSubmit:g,children:[e("input",{type:"hidden",name:"companyId",value:r.id}),e("input",{type:"hidden",name:"companySlug",value:r.slug}),e("button",{type:"submit",className:"text-xs px-2 py-1 rounded-sm border border-red-400 text-red-400 hover:bg-red-400 hover:text-white transition-colors",children:c?"...":"Valider"})]})]})]})]})]})]})]})},r.id))}),a.data.length<3&&t(h,{children:[e(y.Root,{className:"my-6 h-px bg-gray-300"}),e(O,{})]})]}):e("div",{className:"container px-4 py-6",children:t("div",{className:"flex flex-col items-center justify-center gap-4",children:[e("h1",{className:"text-2xl font-bold",children:"Vous n'avez encore d'entreprise référencée"}),e(o,{to:"/compte/entreprises/create",className:"text-sm border px-2 py-1 rounded-sm",children:"Créer une entreprise"})]})})};export{pe as component};
