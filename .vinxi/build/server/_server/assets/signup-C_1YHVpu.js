import{jsxs as o,jsx as r}from"react/jsx-runtime";import{useMutation as d}from"@tanstack/react-query";import{u as g,L as s,I as i}from"./label-BcVNeqdH.js";import*as e from"valibot";import{redirect as c,createFileRoute as f,lazyRouteComponent as h}from"@tanstack/react-router";import{APIError as x}from"better-auth/api";import{Resend as v}from"resend";import{a as N}from"./auth.server-CEln8Kin.js";import{createServerFn as b}from"@tanstack/start-client-core";import{c as y}from"./index-8Htcofqc.js";import"@tanstack/router-core";import"clsx";import"tailwind-merge";import"better-auth";import"better-auth/adapters/drizzle";import"better-auth/plugins";import"drizzle-orm/pg-core";import"better-auth/react-start";import"tiny-invariant";import"drizzle-orm/postgres-js";import"postgres";import"dotenv";const w=()=>Promise.resolve().then(()=>z),L=e.object({email:e.pipe(e.string(),e.nonEmpty("Veuillez entrer votre email"),e.email("Veuillez entrer un email valide")),password:e.pipe(e.string(),e.minLength(8,"Le mot de passe doit contenir au moins 8 caractères"),e.maxLength(100,"Le mot de passe doit contenir au plus 100 caractères")),firstName:e.pipe(e.string(),e.nonEmpty("Veuillez entrer votre prénom"),e.maxLength(100,"Le prénom doit contenir au plus 100 caractères")),lastName:e.pipe(e.string(),e.nonEmpty("Veuillez entrer votre nom"),e.maxLength(100,"Le nom doit contenir au plus 100 caractères"))}),_=y("app_routes_auth_signup_tsx--signupFn_createServerFn_handler","/_server",(t,n)=>u.__executeServer(t,n)),u=b().validator(t=>e.parse(L,t)).handler(_,async({data:t})=>{try{await N.api.signUpEmail({body:{email:t.email,password:t.password,name:`${t.firstName} ${t.lastName}`}})}catch(a){if(a instanceof x)return{status:"error",message:a.message}}const n=new v(process.env.RESEND_API_KEY),{data:m,error:p}=await n.emails.send({from:"Acme <onboarding@resend.dev>",to:"cedgourville@gmail.com",subject:"Bienvenue sur l'application de gestion de projet",react:o("div",{children:[r("h1",{children:"Bienvenue sur l'application de gestion de projet"}),r("p",{children:"Votre compte a été créé avec succès"})]})});throw p&&console.error(p),console.log(m),c({to:"/compte/entreprises"})}),S=f("/_auth/signup")({component:h(w,"component",()=>S.ssr),beforeLoad:async({context:t})=>{if(t.session?.user)throw c({to:"/compte/entreprises"})}});e.object({email:e.pipe(e.string(),e.nonEmpty("Veuillez entrer votre email"),e.email("Veuillez entrer un email valide")),password:e.pipe(e.string(),e.minLength(8,"Le mot de passe doit contenir au moins 8 caractères"),e.maxLength(100,"Le mot de passe doit contenir au plus 100 caractères")),firstName:e.pipe(e.string(),e.nonEmpty("Veuillez entrer votre prénom"),e.maxLength(100,"Le prénom doit contenir au plus 100 caractères")),lastName:e.pipe(e.string(),e.nonEmpty("Veuillez entrer votre nom"),e.maxLength(100,"Le nom doit contenir au plus 100 caractères"))});const E=function(){const{mutate:n,isPending:m}=d({mutationFn:g(u)});function p(a){a.preventDefault();const l=new FormData(a.target);n({data:{email:l.get("email"),password:l.get("password"),firstName:l.get("firstName"),lastName:l.get("lastName")}})}return o("main",{className:"py-12",children:[r("h1",{className:"text-2xl font-bold text-center mb-6",children:"Créer un compte"}),r("div",{className:"max-w-lg mx-auto border border-gray-200 p-6 rounded-sm shadow-sm",children:o("form",{className:"flex flex-col gap-6",onSubmit:p,children:[o("div",{className:"grid gap-4",children:[o(s,{className:"flex flex-col gap-1",children:[r("span",{children:"Nom*"}),r(i,{name:"lastName",type:"text",required:!0})]}),o(s,{className:"flex flex-col gap-1",children:[r("span",{children:"Prénom*"}),r(i,{name:"firstName",type:"text",required:!0})]}),o(s,{className:"flex flex-col gap-1",children:[r("span",{children:"Email*"}),r(i,{name:"email",type:"email",required:!0})]}),o(s,{className:"flex flex-col gap-1",children:[r("span",{children:"Mot de passe*"}),r(i,{name:"password",type:"password",required:!0})]}),o(s,{className:"flex flex-col gap-1",children:[r("span",{children:"Confirmation du mot de passe*"}),r(i,{name:"confirmPassword",type:"password",required:!0})]})]}),r("button",{type:"submit",className:"border border-blue-400 text-blue-400 hover:bg-blue-400 hover:text-white transition-colors p-2 rounded-sm font-medium text-sm",disabled:m,children:m?"Création en cours...":"S'inscrire"})]})})]})},z=Object.freeze(Object.defineProperty({__proto__:null,component:E},Symbol.toStringTag,{value:"Module"}));export{E as component};
