import{jsx as e,jsxs as a}from"react/jsx-runtime";import{useSuspenseQuery as q,useMutation as M}from"@tanstack/react-query";import{I as o}from"./input-DBDjV_JP.js";import{L as t}from"./label-DH_rTUQU.js";import{Command as m}from"cmdk";import{useRef as Q,useState as C}from"react";import{C as A}from"./close--xrcrNXd.js";import{D as k,c as B,n as O,E as _,L as G}from"./ssr-Bxxdisao.js";import{toast as p}from"sonner";import{Popover as u,Separator as d}from"radix-ui";import*as H from"valibot";import{C as T}from"./company.schema-5gxzbh_J.js";import{C as K}from"./chevron-down-CM3ht1vz.js";import{decode as $}from"decode-formdata";import{E as J,P as U,G as W,F as X,I as Y,C as Z}from"./globe-BUymkEPS.js";import{P as g}from"./plus-BVAK8_Jr.js";import{u as ee}from"./use-image-preview-D0S5Wc-4.js";import{c as ae}from"./create-company-BgWo2uPN.js";import"@tanstack/react-router";import"drizzle-orm/pg-core";import"better-auth/react";import"better-auth/client/plugins";import"zustand";import"@tanstack/router-core";import"@tanstack/start-client-core";import"@tanstack/start-server-core";import"clsx";import"tailwind-merge";import"@tanstack/react-query-devtools";import"drizzle-orm";import"nanoid";import"@tanstack/react-router-with-query";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";const Me=function(){const f=k.useRouteContext(),y=k.useNavigate(),{data:N}=q(B),{mutate:z,isPending:b}=M({mutationFn:O(ae)}),w=Q(null),r=_(s=>s.preview),I=_(s=>s.setPreview),[x,v]=C(new Set(r?.categories)),[E,S]=C(0),{imagePreviews:i,readImage:P}=ee();function R(s){v(n=>n.size>=3?(p.error("Vous ne pouvez pas sélectionner plus de 3 catégories"),n):new Set(n).add(s))}function V(s){v(n=>{const l=new Set(n);return l.delete(s),l})}function D(s){S(s.target.value.length)}function h(s,n,l){const c=s.target.files?.[0];c&&P({type:n,file:c,index:l})}function L(){const s=new FormData(w.current),n=$(s,{files:["logo","gallery"],arrays:["categories","gallery"],booleans:["rqth"]}),l=H.safeParse(T,n,{abortPipeEarly:!0});if(!l.success){p.error(e("div",{children:l.issues.map((c,F)=>e("p",{children:c.message},F))}));return}I(l.output),y({to:"/compte/entreprises/create/preview"})}function j(s){s.preventDefault();const n=new FormData(s.target);z({data:n},{onSuccess:()=>{f.queryClient.invalidateQueries({queryKey:["user","companies"]}),p.success("Entreprise créée avec succès"),y({to:"/compte/entreprises"})},onError:l=>{console.error(l),p.error(l.message)}})}return e("div",{className:"container px-4 py-6",children:a("div",{className:"max-w-xl mx-auto",children:[e("h1",{className:"text-2xl font-bold mb-4",children:"Référencez votre entreprise"}),a("form",{className:"flex flex-col gap-3",ref:w,onSubmit:j,children:[e("input",{type:"hidden",name:"user_id",value:f.user.id}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Nom de l'entreprise *"}),e(o,{type:"text",name:"name",placeholder:"Ex: mon entreprise",className:"placeholder:text-xs",defaultValue:r?.name})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Siret *"}),e(o,{type:"text",name:"siret",placeholder:"Ex: 12345678901234",className:"placeholder:text-xs",defaultValue:r?.siret})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Catégories * (max. 3)"}),a(u.Root,{children:[a(u.Trigger,{className:"h-9 cursor-pointer border rounded-sm border-gray-300 px-2 py-1 text-xs flex items-center justify-between gap-2",children:[e("span",{className:"rounded-sm text-xs flex items-center gap-2 text-gray-400",children:"Ajouter une catégorie"}),e(K,{className:"size-5 text-gray-500"})]}),e(u.Portal,{children:e(u.Content,{className:"bg-white w-(--radix-popper-anchor-width)",sideOffset:5,children:a(m,{className:"border rounded-sm border-gray-300",children:[e(m.Input,{placeholder:"Rechercher une catégorie",className:"w-full h-10 px-2 outline-none placeholder:text-sm placeholder:font-light"}),e(m.Separator,{className:"h-px bg-gray-300"}),e(m.List,{className:"max-h-60 overflow-y-auto",children:N.map(s=>e(m.Item,{value:s.name,disabled:x.has(s.id),className:"cursor-pointer py-1.5 px-2 aria-selected:bg-gray-100 text-sm font-light aria-disabled:opacity-20",onSelect:()=>R(s.id),children:s.name},s.id))})]})})})]})]}),x.size?e("ul",{className:"flex flex-wrap gap-2",children:Array.from(x.values()).map((s,n)=>{const l=N.find(c=>c.id===s);return l?a("li",{className:"bg-gray-400 text-white px-2 py-1 rounded-sm text-xs flex items-center gap-2",children:[e("input",{type:"hidden",name:`categories[${n}]`,value:l.id}),e("span",{className:"max-w-[30ch] truncate",children:l.name}),e("button",{type:"button",className:"text-white inline-grid place-items-center cursor-pointer",onClick:()=>V(l.id),children:e(A,{className:"size-3 text-white"})})]},l.id):null})}):null,e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("div",{className:"grid gap-1",children:[a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Description"}),e("textarea",{name:"description",className:"border rounded-sm p-2 border-gray-300 resize-none placeholder:text-xs",rows:4,placeholder:"Entrer une description de mon entreprise...",onChange:D,defaultValue:r?.description})]}),a("span",{className:"text-xs text-gray-500 justify-self-end",children:[E,"/1500"]})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Entrepreneur"}),e(o,{type:"text",name:"business_owner",placeholder:"Ex: Nom Prénom",className:"placeholder:text-xs",defaultValue:r?.business_owner})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Perimètre d'intervention"}),e(o,{type:"text",name:"service_area",placeholder:"Ex: Paris, Lyon, Marseille",className:"placeholder:text-xs",defaultValue:r?.service_area})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Sous-domaine"}),e(o,{type:"text",name:"subdomain",placeholder:"Ex: monentreprise",className:"placeholder:text-xs",defaultValue:r?.subdomain})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Email"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(J,{className:"size-5 text-gray-500"}),e("input",{type:"email",name:"email",placeholder:"Ex: contact@monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:r?.email})]})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Numéro de téléphone"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(U,{className:"size-5 text-gray-500"}),e("input",{type:"tel",name:"phone",placeholder:"Ex: 06 06 06 06 06",className:"placeholder:text-xs outline-none w-full",defaultValue:r?.phone})]})]}),a(t,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Site web"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(W,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"website",placeholder:"Ex: https://www.monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:r?.website})]})]}),e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("fieldset",{className:"flex flex-col gap-4",children:[e("legend",{className:"text-xs font-medium mb-2",children:"Réseaux sociaux"}),a(t,{children:[e("span",{className:"sr-only",children:"Linkedin"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(G,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.linkedin",placeholder:"Ex: https://www.linkedin.com/company/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:r?.social_media.linkedin})]})]}),a(t,{children:[e("span",{className:"sr-only",children:"Facebook"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(X,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.facebook",placeholder:"Ex: https://www.facebook.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:r?.social_media.facebook})]})]}),a(t,{children:[e("span",{className:"sr-only",children:"Instagram"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(Y,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.instagram",placeholder:"Ex: https://www.instagram.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:r?.social_media.instagram})]})]}),a(t,{children:[e("span",{className:"sr-only",children:"Calendly"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(Z,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.calendly",placeholder:"Ex: https://calendly.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:r?.social_media.calendly})]})]})]}),e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("div",{className:"grid gap-8",children:[a("fieldset",{className:"flex gap-4",children:[e("legend",{className:"text-xs font-medium mb-2",children:"Mode de travail"}),a(t,{className:"flex items-center gap-1",children:[e(o,{type:"radio",name:"work_mode",value:"not_specified",defaultChecked:r?.work_mode==="not_specified"||!r?.work_mode,className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Non spécifié"})]}),a(t,{className:"flex items-center gap-1",children:[e(o,{type:"radio",name:"work_mode",value:"remote",defaultChecked:r?.work_mode==="remote",className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"À distance"})]}),a(t,{className:"flex items-center gap-1",children:[e(o,{type:"radio",name:"work_mode",value:"onsite",defaultChecked:r?.work_mode==="onsite",className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Sur site"})]}),a(t,{className:"flex items-center gap-1",children:[e(o,{type:"radio",name:"work_mode",value:"hybrid",defaultChecked:r?.work_mode==="hybrid",className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Hybride"})]})]}),a("fieldset",{className:"flex gap-2",children:[e("legend",{className:"text-xs font-medium mb-2",children:"RQTH"}),a(t,{className:"flex items-center gap-1",children:[e(o,{type:"radio",name:"rqth",value:"true",defaultChecked:r?.rqth,className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Oui"})]}),a(t,{className:"flex items-center gap-1",children:[e(o,{type:"radio",name:"rqth",value:"false",defaultChecked:!r?.rqth,className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Non"})]})]})]}),e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("fieldset",{className:"border rounded-sm border-gray-300 p-4",children:[e("legend",{className:"text-xs font-medium  bg-white px-2",children:"Images"}),a("div",{className:"flex gap-2 justify-center",children:[a(t,{className:"relative flex flex-col gap-1 outline-none group",children:[e("span",{className:"text-xs font-medium",children:"Logo (max. 3MB)"}),a("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[i.logo?e("img",{src:i.logo,alt:"Logo",className:"w-full h-full object-cover"}):e(g,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e("input",{type:"file",className:"absolute inset-0 opacity-0",name:"logo",onChange:s=>h(s,"logo"),accept:"image/*"})]})]}),a(t,{className:"relative flex flex-col gap-1 outline-none group",children:[e("span",{className:"text-xs font-medium",children:"Image 1 (max. 2MB)"}),a("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[i.gallery[0]?e("img",{src:i.gallery[0],alt:"gallery 1",className:"w-full h-full object-cover"}):e(g,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery",onChange:s=>h(s,"gallery",0),accept:"image/*"})]})]}),a(t,{className:"relative flex flex-col gap-1 outline-none group",children:[e("span",{className:"text-xs font-medium",children:"Image 2 (max. 2MB)"}),a("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[i.gallery[1]?e("img",{src:i.gallery[1],alt:"gallery 2",className:"w-full h-full object-cover"}):e(g,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery",onChange:s=>h(s,"gallery",1),accept:"image/*"})]})]})]})]}),e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("div",{className:"flex gap-2 justify-end",children:[e("button",{type:"button",className:"bg-gray-800 text-white px-3 py-2 rounded-sm font-light text-xs disabled:opacity-50",onClick:L,children:"Prévisualiser"}),e("button",{type:"submit",className:"bg-gray-800 text-white px-3 py-2 rounded-sm font-light text-xs",disabled:b,children:b?"Création en cours...":"Créer un compte"})]})]})]})})};export{Me as component};
