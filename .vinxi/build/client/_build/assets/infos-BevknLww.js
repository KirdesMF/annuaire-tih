import{aL as I,aM as O,aN as P,aJ as z,aO as V,aP as M,aQ as L,r as g,aR as D,aS as F,aT as T,aU as H,aV as k,aW as Q,aX as A,aY as B,aK as U,aZ as R,l as K,Y as G,q as W,s as Y,a_ as Z,j as e,ab as J,ac as X,ad as $,ae as ee,af as j,Z as se,t as E}from"./client-0TpWmm9u.js";import{I as x}from"./input-B2F8Q8w2.js";import{L as c}from"./label-CmjesrgN.js";import{C as te}from"./close-BuE9jvDt.js";import{C as ae}from"./chevron-down-DpxYYdqQ.js";import{E as re,P as ne,G as ie,F as le,I as oe,C as ce}from"./globe-nPYG3DDN.js";import{u as de}from"./update-company-infos-DuT_Byf5.js";import{R as C}from"./index-Dt2I4tfU.js";function _(a,s){return a.filter(r=>!s.includes(r))}function ue(a,s,r){const i=a.slice(0);return i[s]=r,i}var me=class extends I{#a;#e;#r;#n;#s;#t;#i;#l;#o=[];constructor(a,s,r){super(),this.#a=a,this.#n=r,this.#r=[],this.#s=[],this.#e=[],this.setQueries(s)}onSubscribe(){this.listeners.size===1&&this.#s.forEach(a=>{a.subscribe(s=>{this.#m(a,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#s.forEach(a=>{a.destroy()})}setQueries(a,s){this.#r=a,this.#n=s,O.batch(()=>{const r=this.#s,i=this.#u(this.#r);this.#o=i,i.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const l=i.map(o=>o.observer),d=l.map(o=>o.getCurrentResult()),t=l.some((o,h)=>o!==r[h]);r.length===l.length&&!t||(this.#s=l,this.#e=d,this.hasListeners()&&(_(r,l).forEach(o=>{o.destroy()}),_(l,r).forEach(o=>{o.subscribe(h=>{this.#m(o,h)})}),this.#x()))})}getCurrentResult(){return this.#e}getQueries(){return this.#s.map(a=>a.getCurrentQuery())}getObservers(){return this.#s}getOptimisticResult(a,s){const r=this.#u(a),i=r.map(l=>l.observer.getOptimisticResult(l.defaultedQueryOptions));return[i,l=>this.#d(l??i,s),()=>this.#c(i,r)]}#c(a,s){return s.map((r,i)=>{const l=a[i];return r.defaultedQueryOptions.notifyOnChangeProps?l:r.observer.trackResult(l,d=>{s.forEach(t=>{t.observer.trackProp(d)})})})}#d(a,s){return s?((!this.#t||this.#e!==this.#l||s!==this.#i)&&(this.#i=s,this.#l=this.#e,this.#t=P(this.#t,s(a))),this.#t):a}#u(a){const s=new Map(this.#s.map(i=>[i.options.queryHash,i])),r=[];return a.forEach(i=>{const l=this.#a.defaultQueryOptions(i),d=s.get(l.queryHash);d?r.push({defaultedQueryOptions:l,observer:d}):r.push({defaultedQueryOptions:l,observer:new z(this.#a,l)})}),r}#m(a,s){const r=this.#s.indexOf(a);r!==-1&&(this.#e=ue(this.#e,r,s),this.#x())}#x(){if(this.hasListeners()){const a=this.#t,s=this.#c(this.#e,this.#o),r=this.#d(s,this.#n?.combine);a!==r&&O.batch(()=>{this.listeners.forEach(i=>{i(this.#e)})})}}};function xe({queries:a,...s},r){const i=V(),l=M(),d=L(),t=g.useMemo(()=>a.map(u=>{const p=i.defaultQueryOptions(u);return p._optimisticResults=l?"isRestoring":"optimistic",p}),[a,i,l]);t.forEach(u=>{D(u),F(u,d)}),T(d);const[o]=g.useState(()=>new me(i,t,s)),[h,y,b]=o.getOptimisticResult(t,s.combine),N=!l&&s.subscribed!==!1;g.useSyncExternalStore(g.useCallback(u=>N?o.subscribe(O.batchCalls(u)):H,[o,N]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),g.useEffect(()=>{o.setQueries(t,s)},[t,s,o]);const w=h.some((u,p)=>k(t[p],u))?h.flatMap((u,p)=>{const n=t[p];if(n){const m=new z(i,n);if(k(n,u))return Q(n,m,d);A(u,l)&&Q(n,m,d)}return[]}):[];if(w.length>0)throw Promise.all(w);const v=h.find((u,p)=>{const n=t[p];return n&&B({result:u,errorResetBoundary:d,throwOnError:n.throwOnError,query:i.getQueryCache().get(n.queryHash),suspense:n.suspense})});if(v?.error)throw v.error;return y(b())}function he(a,s){return xe({...a,queries:a.queries.map(r=>({...r,suspense:!0,throwOnError:U,enabled:!0,placeholderData:void 0}))})}const ve=function(){const s=R.useRouteContext(),r=R.useParams(),i=R.useNavigate(),l=g.useRef(null),[d,t]=he({queries:[K,G(r.slug)]}),{mutate:o,isPending:h}=W({mutationFn:Y(de)}),[y,b]=g.useState(new Set(t.data?.categories.map(n=>n?.id??""))),[N,S]=g.useState(t.data?.description?.length??0);Z(n=>n.setPreview);function w(n){b(m=>m.size>=3?(E.error("Vous ne pouvez pas sélectionner plus de 3 catégories"),m):new Set(m).add(n))}function v(n){b(m=>{const f=new Set(m);return f.delete(n),f})}function u(n){S(n.target.value.length)}function p(n){n.preventDefault();const m=new FormData(n.target);o({data:m},{onSuccess:()=>{s.queryClient.invalidateQueries({queryKey:["user","companies"]}),s.queryClient.invalidateQueries({queryKey:["company",r.slug]}),E.success("Entreprise mise à jour avec succès"),i({to:"/compte/entreprises"})},onError:f=>{E.error(f.message)}})}return e.jsx("div",{className:"container py-6",children:e.jsxs("div",{className:"max-w-xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Référencez votre entreprise"}),e.jsxs("form",{className:"flex flex-col gap-3",ref:l,onSubmit:p,children:[e.jsx("input",{type:"hidden",name:"companyId",value:t.data?.id}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Nom de l'entreprise *"}),e.jsx(x,{type:"text",name:"name",placeholder:"Ex: mon entreprise",className:"placeholder:text-xs",defaultValue:t.data?.name})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Siret *"}),e.jsx(x,{type:"text",name:"siret",placeholder:"Ex: 12345678901234",className:"placeholder:text-xs",defaultValue:t.data?.siret})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Catégories * (max. 3)"}),e.jsxs(J,{children:[e.jsxs(X,{className:"h-9 cursor-pointer border rounded-sm border-gray-300 px-2 py-1 text-xs flex items-center justify-between gap-2",children:[e.jsx("span",{className:"rounded-sm text-xs flex items-center gap-2 text-gray-400",children:"Ajouter une catégorie"}),e.jsx(ae,{className:"size-5 text-gray-500"})]}),e.jsx($,{children:e.jsx(ee,{className:"bg-white w-(--radix-popper-anchor-width)",sideOffset:5,children:e.jsxs(j,{className:"border rounded-sm border-gray-300",children:[e.jsx(j.Input,{placeholder:"Rechercher une catégorie",className:"w-full h-10 px-2 outline-none placeholder:text-sm placeholder:font-light"}),e.jsx(j.Separator,{className:"h-px bg-gray-300"}),e.jsx(j.List,{className:"max-h-60 overflow-y-auto",children:d.data?.map(n=>e.jsx(j.Item,{value:n.name,disabled:y.has(n.id),className:"cursor-pointer py-1.5 px-2 aria-selected:bg-gray-100 text-sm font-light aria-disabled:opacity-20",onSelect:()=>w(n.id),children:n.name},n.id))})]})})})]})]}),y.size?e.jsx("ul",{className:"flex flex-wrap gap-2",children:Array.from(y.values()).map((n,m)=>{const f=d.data?.find(q=>q.id===n);return f?e.jsxs("li",{className:"bg-gray-400 text-white px-2 py-1 rounded-sm text-xs flex items-center gap-2",children:[e.jsx("input",{type:"hidden",name:`categories[${m}]`,value:f.id}),e.jsx("span",{className:"max-w-[30ch] truncate",children:f.name}),e.jsx("button",{type:"button",className:"text-white inline-grid place-items-center cursor-pointer",onClick:()=>v(f.id),children:e.jsx(te,{className:"size-3 text-white"})})]},f.id):null})}):null,e.jsx(C,{className:"h-px bg-gray-300 my-4"}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Description"}),e.jsx("textarea",{name:"description",className:"border rounded-sm p-2 border-gray-300 resize-none placeholder:text-xs",rows:4,placeholder:"Entrer une description de mon entreprise...",onChange:u,defaultValue:t.data?.description??""})]}),e.jsxs("span",{className:"text-xs text-gray-500 justify-self-end",children:[N,"/1500"]})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Entrepreneur"}),e.jsx(x,{type:"text",name:"business_owner",placeholder:"Ex: Nom Prénom",className:"placeholder:text-xs",defaultValue:t.data?.business_owner??""})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Perimètre d'intervention"}),e.jsx(x,{type:"text",name:"service_area",placeholder:"Ex: Paris, Lyon, Marseille",className:"placeholder:text-xs",defaultValue:t.data?.service_area??""})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Sous-domaine"}),e.jsx(x,{type:"text",name:"subdomain",placeholder:"Ex: monentreprise",className:"placeholder:text-xs",defaultValue:t.data?.subdomain??""})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(re,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"email",name:"email",placeholder:"Ex: contact@monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.email??""})]})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Numéro de téléphone"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(ne,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"tel",name:"phone",placeholder:"Ex: 06 06 06 06 06",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.phone??""})]})]}),e.jsxs(c,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Site web"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(ie,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"website",placeholder:"Ex: https://www.monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.website??""})]})]}),e.jsx(C,{className:"h-px bg-gray-300 my-4"}),e.jsxs("fieldset",{className:"flex flex-col gap-4",children:[e.jsx("legend",{className:"text-xs font-medium mb-2",children:"Réseaux sociaux"}),e.jsxs(c,{children:[e.jsx("span",{className:"sr-only",children:"Linkedin"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(se,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.linkedin",placeholder:"Ex: https://www.linkedin.com/company/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.linkedin??""})]})]}),e.jsxs(c,{children:[e.jsx("span",{className:"sr-only",children:"Facebook"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(le,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.facebook",placeholder:"Ex: https://www.facebook.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.facebook??""})]})]}),e.jsxs(c,{children:[e.jsx("span",{className:"sr-only",children:"Instagram"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(oe,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.instagram",placeholder:"Ex: https://www.instagram.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.instagram??""})]})]}),e.jsxs(c,{children:[e.jsx("span",{className:"sr-only",children:"Calendly"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(ce,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.calendly",placeholder:"Ex: https://calendly.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.calendly??""})]})]})]}),e.jsx(C,{className:"h-px bg-gray-300 my-4"}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs("fieldset",{className:"flex gap-4",children:[e.jsx("legend",{className:"text-xs font-medium mb-2",children:"Mode de travail"}),e.jsxs(c,{className:"flex items-center gap-1",children:[e.jsx(x,{type:"radio",name:"work_mode",value:"not_specified",defaultChecked:t.data?.work_mode==="not_specified",className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Non spécifié"})]}),e.jsxs(c,{className:"flex items-center gap-1",children:[e.jsx(x,{type:"radio",name:"work_mode",value:"remote",defaultChecked:t.data?.work_mode==="remote",className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"À distance"})]}),e.jsxs(c,{className:"flex items-center gap-1",children:[e.jsx(x,{type:"radio",name:"work_mode",value:"onsite",defaultChecked:t.data?.work_mode==="onsite",className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Sur site"})]}),e.jsxs(c,{className:"flex items-center gap-1",children:[e.jsx(x,{type:"radio",name:"work_mode",value:"hybrid",defaultChecked:t.data?.work_mode==="hybrid",className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Hybride"})]})]}),e.jsxs("fieldset",{className:"flex gap-2",children:[e.jsx("legend",{className:"text-xs font-medium mb-2",children:"RQTH"}),e.jsxs(c,{className:"flex items-center gap-1",children:[e.jsx(x,{type:"radio",name:"rqth",value:"true",defaultChecked:t.data?.rqth,className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Oui"})]}),e.jsxs(c,{className:"flex items-center gap-1",children:[e.jsx(x,{type:"radio",name:"rqth",value:"false",defaultChecked:!t.data?.rqth,className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Non"})]})]})]}),e.jsx(C,{className:"h-px bg-gray-300 my-4"}),e.jsx("div",{className:"flex gap-2 justify-end",children:e.jsx("button",{type:"submit",className:"bg-gray-800 text-white px-3 py-2 rounded-sm font-light text-xs",disabled:h,children:h?"Mise à jour en cours...":"Mettre à jour"})})]})]})})};export{ve as component};
