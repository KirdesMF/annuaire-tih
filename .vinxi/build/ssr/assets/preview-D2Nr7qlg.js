import{jsxs as s,jsx as e,Fragment as y}from"react/jsx-runtime";import{useSuspenseQuery as N,useMutation as b}from"@tanstack/react-query";import{Link as v}from"@tanstack/react-router";import{Separator as I}from"radix-ui";import{useEffect as w}from"react";import{toast as C}from"sonner";import{C as k}from"./company-logo-B5lxhvXb.js";import{C as _,L as S}from"./link-chain-ChxIEzv5.js";import{E as j,P as z,G as E,C as O,I as L,F as R}from"./globe-BUymkEPS.js";import{H as l,c as q,n as F,L as M}from"./ssr-Bxxdisao.js";import{u as P}from"./use-image-preview-D0S5Wc-4.js";import{u as D}from"./update-company-infos-bKDWJV6w.js";import"drizzle-orm/pg-core";import"better-auth/react";import"better-auth/client/plugins";import"zustand";import"@tanstack/router-core";import"@tanstack/start-client-core";import"@tanstack/start-server-core";import"cmdk";import"clsx";import"tailwind-merge";import"@tanstack/react-query-devtools";import"valibot";import"drizzle-orm";import"nanoid";import"@tanstack/react-router-with-query";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";import"./company.schema-5gxzbh_J.js";import"decode-formdata";const Q={remote:"À distance",hybrid:"Hybride",onsite:"Sur site",not_specified:"Non spécifié"},H={facebook:e(R,{className:"size-5"}),instagram:e(L,{className:"size-5"}),linkedin:e(M,{className:"size-5"}),calendly:e(O,{className:"size-5"})},ve=function(){const{preview:a,queryClient:c}=l.useRouteContext(),m=l.useParams(),g=l.useNavigate(),{data:f}=N(q),{imagePreviews:n,readImage:o}=P(),{mutate:u,isPending:d}=b({mutationFn:F(D)});w(()=>{a.logo&&o({type:"logo",file:a.logo}),a.gallery&&a.gallery.forEach((r,t)=>{o({type:"gallery",file:r,index:t})})},[a.logo,a.gallery,o]);const p={facebook:a.social_media?.facebook,instagram:a.social_media?.instagram,linkedin:a.social_media?.linkedin,calendly:a.social_media?.calendly},x=Object.values(p).every(r=>r==="");function h(){const r=new FormData;for(const[t,i]of Object.entries(a))typeof i=="string"&&r.append(t,i);for(const t of a?.categories??[])r.append("categories",t);if(a.logo&&r.append("logo",a.logo),a.gallery)for(const t of a.gallery)r.append("gallery",t);console.log(Object.fromEntries(r.entries())),u({data:r},{onSuccess:()=>{C.success("Entreprise mise à jour avec succès"),c.invalidateQueries({queryKey:["user","companies"]}),c.invalidateQueries({queryKey:["company",m.slug]}),g({to:"/compte/entreprises"})}})}return s("main",{className:"px-4 py-8 grid gap-4",children:[e(v,{to:"/compte/entreprises/$slug/edit/infos",params:{slug:m.slug},className:"text-sm text-gray-500",children:"Retour"}),s("div",{className:"container flex justify-between gap-4 border border-gray-300 p-6 rounded-sm",children:[s("div",{className:"flex flex-col gap-2",children:[e(k,{url:n.logo,name:a.name??"",size:"lg"}),s("div",{className:"flex items-center gap-2",children:[e("h1",{className:"text-2xl font-bold",children:a.name}),e(_,{children:a.siret})]}),a.categories?.length?e("ul",{className:"flex flex-wrap gap-2",children:a.categories?.map(r=>{const t=f.find(i=>i.id===r);return t?e("li",{className:"bg-gray-400 text-white px-2 py-1 rounded-sm text-xs",children:e("span",{className:"max-w-[30ch] truncate",children:t.name})},t.id):null})}):null]}),e("div",{className:"flex gap-2",children:e("button",{type:"button",className:"bg-gray-100 p-2 rounded-sm cursor-pointer h-min",children:e(S,{className:"size-5"})})})]}),s("div",{className:"container flex gap-2",children:[s("div",{className:"flex-1 flex flex-col justify-center gap-4 border border-gray-300 p-6 rounded-sm",children:[s("div",{className:"flex flex-col gap-2",children:[s("div",{className:"flex items-center gap-2",children:[e(j,{className:"size-5"}),e("p",{className:"text-xs text-gray-500",children:a.email||"Non renseigné"})]}),s("div",{className:"flex items-center gap-2",children:[e(z,{className:"size-5"}),e("p",{className:"text-xs text-gray-500",children:a.phone||"Non renseigné"})]}),s("div",{className:"flex items-center gap-2",children:[e(E,{className:"size-5"}),a.website?e("a",{href:a.website,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-gray-500",children:a.website}):e("span",{className:"text-xs text-gray-500",children:"Non renseigné"})]})]}),x?null:e("ul",{className:"flex gap-2",children:Object.entries(p).map(([r,t])=>e("li",{children:e("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:H[r]})},r))})]}),s("div",{className:"flex-1 border border-gray-300 p-6 rounded-sm flex flex-col gap-2",children:[s("p",{className:"text-sm text-gray-500",children:[e("span",{className:"font-bold",children:"Entrepreneur:"})," ",a.business_owner||"Non renseigné"]}),s("p",{className:"text-sm text-gray-500",children:[e("span",{className:"font-bold",children:"Zone géographique:"})," ",a.service_area||"Non renseigné"]}),s("p",{className:"text-sm text-gray-500",children:[e("span",{className:"font-bold",children:"Mode de travail:"})," ",Q[a.work_mode??"not_specified"]]}),s("p",{className:"text-sm text-gray-500",children:[e("span",{className:"font-bold",children:"RQTH:"})," ",a.rqth?"Oui":"Non"]}),s("p",{className:"text-sm text-gray-500",children:[e("span",{className:"font-bold",children:"Sous domaine:"})," ",a.subdomain||"Non renseigné"]})]})]}),s("div",{className:"container border border-gray-300 p-6 rounded-sm grid gap-4",children:[s("div",{className:"flex flex-col gap-2",children:[e("h2",{className:"text-lg font-bold",children:"Description"}),e("p",{className:"text-sm text-gray-500 text-pretty",children:a.description||"Non renseigné"})]}),n.gallery.length?s(y,{children:[e(I.Root,{className:"h-px bg-gray-300 my-4"}),e("ul",{className:"flex flex-wrap gap-2",children:n.gallery.map((r,t)=>e("li",{children:e("img",{src:r,alt:a.name,className:"size-16 aspect-square rounded-sm"})},t))})]}):null]}),e("div",{className:"container flex justify-end gap-2",children:e("button",{type:"submit",className:"bg-gray-800 text-white px-3 py-2 rounded-sm font-light text-xs",onClick:h,disabled:d,children:d?"Validation en cours...":"Valider"})})]})};export{ve as component};
