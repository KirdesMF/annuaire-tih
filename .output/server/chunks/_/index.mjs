import{bL as e,bM as t,bN as r,bO as s,bP as n,bQ as i,bR as o,bS as a,bT as d,bU as c,bV as u,bW as l,Q as p,bX as h,bY as m,bZ as f,a5 as y,b_ as g,h as w,f as v,a6 as b,b$ as N,c0 as _,c1 as x,e as T,c2 as k,c3 as A}from"../nitro/nitro.mjs";import{Buffer as E}from"node:buffer";const I=(()=>{const C=function(){};return C.prototype=Object.create(null),C})();function createRouter$1(){return{root:{key:""},static:new I}}function splitPath(e){return e.split("/").filter(Boolean)}function getMatchParams(e,t){const r=new I;for(const[s,n]of t){const t=s<0?e.slice(-1*s).join("/"):e[s];if("string"==typeof n)r[n]=t;else{const e=t.match(n);if(e)for(const t in e.groups)r[t]=e.groups[t]}}return r}function addRoute(e,t="",r,s){const n=splitPath(r);let i=e.root,o=0;const a=[];for(let e=0;e<n.length;e++){const t=n[e];if(t.startsWith("**")){i.wildcard||(i.wildcard={key:"**"}),i=i.wildcard,a.push([-e,t.split(":")[1]||"_",2===t.length]);break}if("*"===t||t.includes(":")){i.param||(i.param={key:"*"}),i=i.param;const r="*"===t;a.push([e,r?"_"+o++:_getParamMatcher(t),r]);continue}const r=i.static?.[t];if(r)i=r;else{const e={key:t};i.static||(i.static=new I),i.static[t]=e,i=e}}const d=a.length>0;i.methods||(i.methods=new I),i.methods[t]||(i.methods[t]=[]),i.methods[t].push({data:s||null,paramsMap:d?a:void 0}),d||(e.static[r]=i)}function _getParamMatcher(e){if(!e.includes(":",1))return e.slice(1);const t=e.replace(/:(\w+)/g,((e,t)=>`(?<${t}>\\w+)`));return new RegExp(`^${t}$`)}function findRoute(e,t="",r,s){"/"===r[r.length-1]&&(r=r.slice(0,-1));const n=e.static[r];if(n&&n.methods){const e=n.methods[t]||n.methods[""];if(void 0!==e)return e[0]}const i=splitPath(r),o=_lookupTree(e,e.root,t,i,0)?.[0];if(void 0!==o)return{data:o.data,params:o.paramsMap?getMatchParams(i,o.paramsMap):void 0}}function _lookupTree(e,t,r,s,n){if(n===s.length){if(t.methods){const e=t.methods[r]||t.methods[""];if(e)return e}if(t.param&&t.param.methods){const e=t.param.methods[r]||t.param.methods[""];if(e){const t=e[0].paramsMap;if(t?.[t?.length-1]?.[2])return e}}if(t.wildcard&&t.wildcard.methods){const e=t.wildcard.methods[r]||t.wildcard.methods[""];if(e){const t=e[0].paramsMap;if(t?.[t?.length-1]?.[2])return e}}return}const i=s[n];if(t.static){const o=t.static[i];if(o){const t=_lookupTree(e,o,r,s,n+1);if(t)return t}}if(t.param){const i=_lookupTree(e,t.param,r,s,n+1);if(i)return i}if(t.wildcard&&t.wildcard.methods)return t.wildcard.methods[r]||t.wildcard.methods[""]}function findAllRoutes(e,t="",r,s){"/"===r[r.length-1]&&(r=r.slice(0,-1));const n=splitPath(r);return _findAll(e,e.root,t,n,0).map((e=>({data:e.data,params:e.paramsMap?getMatchParams(n,e.paramsMap):void 0})))}function _findAll(e,t,r,s,n,i=[]){const o=s[n];if(t.wildcard&&t.wildcard.methods){const e=t.wildcard.methods[r]||t.wildcard.methods[""];e&&i.push(...e)}if(t.param&&(_findAll(e,t.param,r,s,n+1,i),n===s.length&&t.param.methods)){const e=t.param.methods[r]||t.param.methods[""];e&&i.push(...e)}const a=t.static?.[o];if(a&&_findAll(e,a,r,s,n+1,i),n===s.length&&t.methods){const e=t.methods[r]||t.methods[""];e&&i.push(...e)}return i}var S={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},O=class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t=void 0,r={},s=("number"==typeof e?e:S[e])){super(t?.message),this.status=e,this.body=t,this.headers=r,this.statusCode=s,this.name="APIError",this.status=e,this.headers=r,this.statusCode=s,this.body=t?{code:t?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0,this.stack=""}};async function getBody(e){const t=e.headers.get("content-type")||"";if(e.body){if(t.includes("application/json"))return await e.json();if(t.includes("application/x-www-form-urlencoded")){const t=await e.formData(),r={};return t.forEach(((e,t)=>{r[t]=e.toString()})),r}if(t.includes("multipart/form-data")){const t=await e.formData(),r={};return t.forEach(((e,t)=>{r[t]=e})),r}if(t.includes("text/plain"))return await e.text();if(t.includes("application/octet-stream"))return await e.arrayBuffer();if(t.includes("application/pdf")||t.includes("image/")||t.includes("video/")){return await e.blob()}return t.includes("application/stream")||e.body instanceof ReadableStream?e.body:await e.text()}}function isAPIError(e){return e instanceof O||"APIError"===e?.name}function tryDecode(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}function toResponse(e,t){if(e instanceof Response)return t?.headers instanceof Headers&&t.headers.forEach(((t,r)=>{e.headers.set(r,t)})),e;if("json"===e?._flag){const t=e.routerResponse;return t instanceof Response?t:toResponse(e.body,{headers:e.headers,status:e.status})}if(isAPIError(e))return toResponse(e.body,{status:e.statusCode,statusText:e.status.toString(),headers:t?.headers||e.headers});let r=e,s=new Headers(t?.headers);return e?"string"==typeof e?(r=e,s.set("Content-Type","text/plain")):e instanceof ArrayBuffer||ArrayBuffer.isView(e)?(r=e,s.set("Content-Type","application/octet-stream")):e instanceof Blob?(r=e,s.set("Content-Type",e.type||"application/octet-stream")):e instanceof FormData?r=e:e instanceof URLSearchParams?(r=e,s.set("Content-Type","application/x-www-form-urlencoded")):e instanceof ReadableStream?(r=e,s.set("Content-Type","application/octet-stream")):function(e){if(void 0===e)return!1;const t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}(e)&&(r=JSON.stringify(e),s.set("Content-Type","application/json")):(null===e&&(r=JSON.stringify(null)),s.set("content-type","application/json")),new Response(r,{...t,headers:s})}function fromError(e,t){for(const t of e)t.message;return{message:`Invalid ${t} parameters`}}var R={name:"HMAC",hash:"SHA-256"},getCryptoKey$1=async t=>{const r="string"==typeof t?(new TextEncoder).encode(t):t;return await e.importKey("raw",r,R,!1,["sign","verify"])},signCookieValue=async(t,r)=>{const s=await(async(t,r)=>{const s=await getCryptoKey$1(r),n=await e.sign(R.name,s,(new TextEncoder).encode(t));return btoa(String.fromCharCode(...new Uint8Array(n)))})(t,r);return t=`${t}.${s}`,t=encodeURIComponent(t)},getCookieKey=(e,t)=>{let r=e;if(t)if("secure"===t)r="__Secure-"+e;else{if("host"!==t)return;r="__Host-"+e}return r};var _serialize=(e,t,r={})=>{let s;if(s="secure"===r?.prefix?`__Secure-${e}=${t}`:"host"===r?.prefix?`__Host-${e}=${t}`:`${e}=${t}`,e.startsWith("__Secure-")&&!r.secure&&(r.secure=!0),e.startsWith("__Host-")&&(r.secure||(r.secure=!0),"/"!==r.path&&(r.path="/"),r.domain&&(r.domain=void 0)),r&&"number"==typeof r.maxAge&&r.maxAge>=0){if(r.maxAge>3456e4)throw new Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");s+=`; Max-Age=${Math.floor(r.maxAge)}`}if(r.domain&&"host"!==r.prefix&&(s+=`; Domain=${r.domain}`),r.path&&(s+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw new Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");s+=`; Expires=${r.expires.toUTCString()}`}return r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite&&(s+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.partitioned&&(r.secure||(r.secure=!0),s+="; Partitioned"),s},createInternalContext=async(t,{options:r,path:s})=>{const n=new Headers,{data:i,error:o}=await async function(e,t={}){let r={body:t.body,query:t.query};if(e.body){const s=await e.body["~standard"].validate(t.body);if(s.issues)return{data:null,error:fromError(s.issues,"body")};r.body=s.value}if(e.query){const s=await e.query["~standard"].validate(t.query);if(s.issues)return{data:null,error:fromError(s.issues,"query")};r.query=s.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required"}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required"}}:{data:r,error:null}}(r,t);if(o)throw new O(400,{message:o.message,code:"VALIDATION_ERROR"});const a="headers"in t?t.headers instanceof Headers?t.headers:new Headers(t.headers):"request"in t&&t.request instanceof Request?t.request.headers:null,d=a?.get("cookie"),c=d?function(e){if("string"!=typeof e)throw new TypeError("argument str must be a string");const t=new Map;let r=0;for(;r<e.length;){const s=e.indexOf("=",r);if(-1===s)break;let n=e.indexOf(";",r);if(-1===n)n=e.length;else if(n<s){r=e.lastIndexOf(";",s-1)+1;continue}const i=e.slice(r,s).trim();if(!t.has(i)){let r=e.slice(s+1,n).trim();34===r.codePointAt(0)&&(r=r.slice(1,-1)),t.set(i,tryDecode(r))}r=n+1}return t}(d):void 0,u={...t,body:i.body,query:i.query,path:t.path||s,context:"context"in t&&t.context?t.context:{},returned:void 0,headers:t?.headers,request:t?.request,params:"params"in t?t.params:void 0,method:t.method,setHeader:(e,t)=>{n.set(e,t)},getHeader:e=>a?a.get(e):null,getCookie:(e,t)=>{const r=getCookieKey(e,t);return r&&c?.get(r)||null},getSignedCookie:async(t,r,s)=>{const n=getCookieKey(t,s);if(!n)return null;const i=c?.get(n);if(!i)return null;const o=i.lastIndexOf(".");if(o<1)return null;const a=i.substring(0,o),d=i.substring(o+1);if(44!==d.length||!d.endsWith("="))return null;const u=await getCryptoKey$1(r),l=await(async(t,r,s)=>{try{const n=atob(t),i=new Uint8Array(n.length);for(let e=0,t=n.length;e<t;e++)i[e]=n.charCodeAt(e);return await e.verify(R,s,i,(new TextEncoder).encode(r))}catch(e){return!1}})(d,a,u);return!!l&&a},setCookie:(e,t,r)=>{const s=((e,t,r)=>(t=encodeURIComponent(t),_serialize(e,t,r)))(e,t,r);return n.append("set-cookie",s),s},setSignedCookie:async(e,t,r,s)=>{const i=await(async(e,t,r,s)=>(t=await signCookieValue(t,r),_serialize(e,t,s)))(e,t,r,s);return n.append("set-cookie",i),i},redirect:e=>(n.set("location",e),new O("FOUND",void 0,n)),error:(e,t,r)=>new O(e,t,r),json:(e,r)=>t.asResponse?{body:r?.body||e,routerResponse:r,_flag:"json"}:e,responseHeaders:n};for(const e of r.use||[]){const t=await e({...u,returnHeaders:!0,asResponse:!1});t.response&&Object.assign(u.context,t.response),t.headers&&t.headers.forEach(((e,t)=>{u.responseHeaders.set(t,e)}))}return u};function createMiddleware(e,t){const internalHandler=async r=>{const s=r,n="function"==typeof e?e:t,i="function"==typeof e?{}:e,o=await createInternalContext(s,{options:i,path:"/"});if(!n)throw new Error("handler must be defined");const a=await n(o),d=o.responseHeaders;return s.returnHeaders?{headers:d,response:a}:a};return internalHandler.options="function"==typeof e?{}:e,internalHandler}createMiddleware.create=e=>function(t,r){if("function"==typeof t)return createMiddleware({use:e?.use},t);if(!r)throw new Error("Middleware handler is required");return createMiddleware({...t,method:"*",use:[...e?.use||[],...t.use||[]]},r)};var D,U,B,createEndpoint2=(e,t,r)=>{const internalHandler=async(...s)=>{const n=s[0]||{},i=await createInternalContext(n,{options:t,path:e}),o=await r(i).catch((async e=>{if(isAPIError(e)){const r=t.onAPIError;if(r&&await r(e),n.asResponse)return e}throw e})),a=i.responseHeaders;return n.asResponse?toResponse(o,{headers:a}):n.returnHeaders?{headers:a,response:o}:o};return internalHandler.options=t,internalHandler.path=e,internalHandler};createEndpoint2.create=e=>(t,r,s)=>createEndpoint2(t,{...r,use:[...r?.use||[],...e?.use||[]]},s),(U=D||(D={})).assertEqual=e=>e,U.assertIs=function(e){},U.assertNever=function(e){throw new Error},U.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},U.getValidEnumValues=e=>{const t=U.objectKeys(e).filter((t=>"number"!=typeof e[e[t]])),r={};for(const s of t)r[s]=e[s];return U.objectValues(r)},U.objectValues=e=>U.objectKeys(e).map((function(t){return e[t]})),U.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},U.find=(e,t)=>{for(const r of e)if(t(r))return r},U.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,U.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},U.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(B||(B={})).mergeShapes=(e,t)=>({...e,...t});var P=D.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType$1=e=>{switch(typeof e){case"undefined":return P.undefined;case"string":return P.string;case"number":return isNaN(e)?P.nan:P.number;case"boolean":return P.boolean;case"function":return P.function;case"bigint":return P.bigint;case"symbol":return P.symbol;case"object":return Array.isArray(e)?P.array:null===e?P.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?P.promise:"undefined"!=typeof Map&&e instanceof Map?P.map:"undefined"!=typeof Set&&e instanceof Set?P.set:"undefined"!=typeof Date&&e instanceof Date?P.date:P.object;default:return P.unknown}},L=D.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),q=class _ZodError extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},r={_errors:[]},processError=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(processError);else if("invalid_return_type"===s.code)processError(s.returnTypeError);else if("invalid_arguments"===s.code)processError(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,n=0;for(;n<s.path.length;){const r=s.path[n];n===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return processError(this),r}static assert(e){if(!(e instanceof _ZodError))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,D.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};q.create=e=>new q(e);var errorMap$1=(e,t)=>{let r;switch(e.code){case L.invalid_type:r=e.received===P.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case L.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,D.jsonStringifyReplacer)}`;break;case L.unrecognized_keys:r=`Unrecognized key(s) in object: ${D.joinValues(e.keys,", ")}`;break;case L.invalid_union:r="Invalid input";break;case L.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${D.joinValues(e.options)}`;break;case L.invalid_enum_value:r=`Invalid enum value. Expected ${D.joinValues(e.options)}, received '${e.received}'`;break;case L.invalid_arguments:r="Invalid function arguments";break;case L.invalid_return_type:r="Invalid function return type";break;case L.invalid_date:r="Invalid date";break;case L.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:D.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case L.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case L.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case L.custom:r="Invalid input";break;case L.invalid_intersection_types:r="Intersection results could not be merged";break;case L.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case L.not_finite:r="Number must be finite";break;default:r=t.defaultError,D.assertNever(e)}return{message:r}},W=errorMap$1;function addIssueToContext$1(e,t){const r=W,s=(e=>{const{data:t,path:r,errorMaps:s,issueData:n}=e,i=[...r,...n.path||[]],o={...n,path:i};if(void 0!==n.message)return{...n,path:i,message:n.message};let a="";const d=s.filter((e=>!!e)).slice().reverse();for(const e of d)a=e(o,{data:t,defaultError:a}).message;return{...n,path:i,message:a}})({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===errorMap$1?void 0:errorMap$1].filter((e=>!!e))});e.common.issues.push(s)}var $,M,z,j,Z=class _ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if("aborted"===s.status)return V;"dirty"===s.status&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t){const t=await e.key,s=await e.value;r.push({key:t,value:s})}return _ParseStatus.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:t,value:n}=s;if("aborted"===t.status)return V;if("aborted"===n.status)return V;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!s.alwaysSet||(r[t.value]=n.value)}return{status:e.value,value:r}}},V=Object.freeze({status:"aborted"}),DIRTY$1=e=>({status:"dirty",value:e}),OK$1=e=>({status:"valid",value:e}),isAborted$1=e=>"aborted"===e.status,isDirty$1=e=>"dirty"===e.status,isValid$1=e=>"valid"===e.status,isAsync$1=e=>"undefined"!=typeof Promise&&e instanceof Promise;function __classPrivateFieldGet$1(e,t,r,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function __classPrivateFieldSet$1(e,t,r,s,n){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,r),r}(M=$||($={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},M.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;var F=class{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},handleResult$1=(e,t)=>{if(isValid$1(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new q(e.common.issues);return this._error=t,this._error}}};function processCreateParams$1(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:s,description:n}=e;if(t&&(r||s))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};return{errorMap:(t,n)=>{var i,o;const{message:a}=e;return"invalid_enum_value"===t.code?{message:null!=a?a:n.defaultError}:void 0===n.data?{message:null!==(i=null!=a?a:s)&&void 0!==i?i:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(o=null!=a?a:r)&&void 0!==o?o:n.defaultError}},description:n}}var Q,J=class{get description(){return this._def.description}_getType(e){return getParsedType$1(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:getParsedType$1(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Z,ctx:{common:e.parent.common,data:e.data,parsedType:getParsedType$1(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(isAsync$1(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType$1(e)},n=this._parseSync({data:e,path:s.path,parent:s});return handleResult$1(s,n)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType$1(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:s});return isValid$1(t)?{value:t.value}:{issues:s.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then((e=>isValid$1(e)?{value:e.value}:{issues:s.common.issues}))}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType$1(e)},s=this._parse({data:e,path:r.path,parent:r}),n=await(isAsync$1(s)?s:Promise.resolve(s));return handleResult$1(r,n)}refine(e,t){const getIssueProperties=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const s=e(t),setError=()=>r.addIssue({code:L.custom,...getIssueProperties(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then((e=>!!e||(setError(),!1))):!!s||(setError(),!1)}))}refinement(e,t){return this._refinement(((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1)))}_refinement(e){return new Be({schema:this,typeName:Me.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Pe.create(this,this._def)}nullable(){return Le.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return xe.create(this)}promise(){return Ue.create(this,this._def)}or(e){return ke.create([this,e],this._def)}and(e){return Ae.create(this,e,this._def)}transform(e){return new Be({...processCreateParams$1(this._def),schema:this,typeName:Me.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new qe({...processCreateParams$1(this._def),innerType:this,defaultValue:t,typeName:Me.ZodDefault})}brand(){return new je({typeName:Me.ZodBranded,type:this,...processCreateParams$1(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new We({...processCreateParams$1(this._def),innerType:this,catchValue:t,typeName:Me.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Ze.create(this,e)}readonly(){return Ve.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},K=/^c[^\s-]{8,}$/i,H=/^[0-9a-z]+$/,G=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Y=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,X=/^[a-z0-9_-]{21}$/i,ee=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,te=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,re=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,se=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ne=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ie=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,oe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ae=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,de=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ce="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",ue=new RegExp(`^${ce}$`);function timeRegexSource$1(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function datetimeRegex$1(e){let t=`${ce}T${timeRegexSource$1(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function isValidIP$2(e,t){return!("v4"!==t&&t||!se.test(e))||!("v6"!==t&&t||!ie.test(e))}function isValidJWT$1(e,t){if(!ee.test(e))return!1;try{const[r]=e.split("."),s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(s));return"object"==typeof n&&null!==n&&(!(!n.typ||!n.alg)&&(!t||n.alg===t))}catch(e){return!1}}function isValidCidr$1(e,t){return!("v4"!==t&&t||!ne.test(e))||!("v6"!==t&&t||!oe.test(e))}var le=class _ZodString extends J{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==P.string){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.string,received:t.parsedType}),V}const t=new Z;let r;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?addIssueToContext$1(r,{code:L.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&addIssueToContext$1(r,{code:L.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)re.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"email",code:L.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)Q||(Q=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Q.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"emoji",code:L.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)Y.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"uuid",code:L.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)X.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"nanoid",code:L.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)K.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"cuid",code:L.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)H.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"cuid2",code:L.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)G.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"ulid",code:L.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"url",code:L.invalid_string,message:s.message}),t.dirty()}else if("regex"===s.kind){s.regex.lastIndex=0;s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"regex",code:L.invalid_string,message:s.message}),t.dirty())}else if("trim"===s.kind)e.data=e.data.trim();else if("includes"===s.kind)e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty());else if("toLowerCase"===s.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===s.kind)e.data=e.data.toUpperCase();else if("startsWith"===s.kind)e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty());else if("endsWith"===s.kind)e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty());else if("datetime"===s.kind){datetimeRegex$1(s).test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.invalid_string,validation:"datetime",message:s.message}),t.dirty())}else if("date"===s.kind){ue.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.invalid_string,validation:"date",message:s.message}),t.dirty())}else if("time"===s.kind){new RegExp(`^${timeRegexSource$1(s)}$`).test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.invalid_string,validation:"time",message:s.message}),t.dirty())}else"duration"===s.kind?te.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"duration",code:L.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?isValidIP$2(e.data,s.version)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"ip",code:L.invalid_string,message:s.message}),t.dirty()):"jwt"===s.kind?isValidJWT$1(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"jwt",code:L.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?isValidCidr$1(e.data,s.version)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"cidr",code:L.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?ae.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"base64",code:L.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?de.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{validation:"base64url",code:L.invalid_string,message:s.message}),t.dirty()):D.assertNever(s);return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:L.invalid_string,...$.errToObj(r)})}_addCheck(e){return new _ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...$.errToObj(e)})}url(e){return this._addCheck({kind:"url",...$.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...$.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...$.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...$.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...$.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...$.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...$.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...$.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...$.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...$.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...$.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...$.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...$.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...$.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...$.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...$.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...$.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...$.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...$.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...$.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...$.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...$.errToObj(t)})}nonempty(e){return this.min(1,$.errToObj(e))}trim(){return new _ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new _ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new _ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};function floatSafeRemainder$1(e,t){const r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,n=r>s?r:s;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}le.create=e=>{var t;return new le({checks:[],typeName:Me.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams$1(e)})};var pe=class _ZodNumber extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==P.number){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.number,received:t.parsedType}),V}let t;const r=new Z;for(const s of this._def.checks)if("int"===s.kind)D.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty());else if("min"===s.kind){(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty())}else if("max"===s.kind){(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty())}else"multipleOf"===s.kind?0!==floatSafeRemainder$1(e.data,s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.not_finite,message:s.message}),r.dirty()):D.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,r,s){return new _ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:$.toString(s)}]})}_addCheck(e){return new _ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:$.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:$.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:$.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:$.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&D.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};pe.create=e=>new pe({checks:[],typeName:Me.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams$1(e)});var he=class _ZodBigInt extends J{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==P.bigint)return this._getInvalidInput(e);let t;const r=new Z;for(const s of this._def.checks)if("min"===s.kind){(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty())}else if("max"===s.kind){(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty())}else"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),addIssueToContext$1(t,{code:L.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):D.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.bigint,received:t.parsedType}),V}gte(e,t){return this.setLimit("min",e,!0,$.toString(t))}gt(e,t){return this.setLimit("min",e,!1,$.toString(t))}lte(e,t){return this.setLimit("max",e,!0,$.toString(t))}lt(e,t){return this.setLimit("max",e,!1,$.toString(t))}setLimit(e,t,r,s){return new _ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:$.toString(s)}]})}_addCheck(e){return new _ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:$.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:$.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:$.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:$.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:$.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};he.create=e=>{var t;return new he({checks:[],typeName:Me.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams$1(e)})};var me=class extends J{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==P.boolean){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.boolean,received:t.parsedType}),V}return OK$1(e.data)}};me.create=e=>new me({typeName:Me.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams$1(e)});var fe=class _ZodDate extends J{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==P.date){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.date,received:t.parsedType}),V}if(isNaN(e.data.getTime())){return addIssueToContext$1(this._getOrReturnCtx(e),{code:L.invalid_date}),V}const t=new Z;let r;for(const s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),t.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext$1(r,{code:L.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),t.dirty()):D.assertNever(s);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new _ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:$.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:$.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}};fe.create=e=>new fe({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Me.ZodDate,...processCreateParams$1(e)});var ye=class extends J{_parse(e){if(this._getType(e)!==P.symbol){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.symbol,received:t.parsedType}),V}return OK$1(e.data)}};ye.create=e=>new ye({typeName:Me.ZodSymbol,...processCreateParams$1(e)});var ge=class extends J{_parse(e){if(this._getType(e)!==P.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.undefined,received:t.parsedType}),V}return OK$1(e.data)}};ge.create=e=>new ge({typeName:Me.ZodUndefined,...processCreateParams$1(e)});var we=class extends J{_parse(e){if(this._getType(e)!==P.null){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.null,received:t.parsedType}),V}return OK$1(e.data)}};we.create=e=>new we({typeName:Me.ZodNull,...processCreateParams$1(e)});var ve=class extends J{constructor(){super(...arguments),this._any=!0}_parse(e){return OK$1(e.data)}};ve.create=e=>new ve({typeName:Me.ZodAny,...processCreateParams$1(e)});var be=class extends J{constructor(){super(...arguments),this._unknown=!0}_parse(e){return OK$1(e.data)}};be.create=e=>new be({typeName:Me.ZodUnknown,...processCreateParams$1(e)});var Ne=class extends J{_parse(e){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.never,received:t.parsedType}),V}};Ne.create=e=>new Ne({typeName:Me.ZodNever,...processCreateParams$1(e)});var _e=class extends J{_parse(e){if(this._getType(e)!==P.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.void,received:t.parsedType}),V}return OK$1(e.data)}};_e.create=e=>new _e({typeName:Me.ZodVoid,...processCreateParams$1(e)});var xe=class _ZodArray extends J{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==P.array)return addIssueToContext$1(t,{code:L.invalid_type,expected:P.array,received:t.parsedType}),V;if(null!==s.exactLength){const e=t.data.length>s.exactLength.value,n=t.data.length<s.exactLength.value;(e||n)&&(addIssueToContext$1(t,{code:e?L.too_big:L.too_small,minimum:n?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(addIssueToContext$1(t,{code:L.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(addIssueToContext$1(t,{code:L.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>s.type._parseAsync(new F(t,e,t.path,r))))).then((e=>Z.mergeArray(r,e)));const n=[...t.data].map(((e,r)=>s.type._parseSync(new F(t,e,t.path,r))));return Z.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new _ZodArray({...this._def,minLength:{value:e,message:$.toString(t)}})}max(e,t){return new _ZodArray({...this._def,maxLength:{value:e,message:$.toString(t)}})}length(e,t){return new _ZodArray({...this._def,exactLength:{value:e,message:$.toString(t)}})}nonempty(e){return this.min(1,e)}};function deepPartialify$1(e){if(e instanceof Te){const t={};for(const r in e.shape){const s=e.shape[r];t[r]=Pe.create(deepPartialify$1(s))}return new Te({...e._def,shape:()=>t})}return e instanceof xe?new xe({...e._def,type:deepPartialify$1(e.element)}):e instanceof Pe?Pe.create(deepPartialify$1(e.unwrap())):e instanceof Le?Le.create(deepPartialify$1(e.unwrap())):e instanceof Ee?Ee.create(e.items.map((e=>deepPartialify$1(e)))):e}xe.create=(e,t)=>new xe({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Me.ZodArray,...processCreateParams$1(t)});var Te=class _ZodObject extends J{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=D.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==P.object){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.object,received:t.parsedType}),V}const{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof Ne&&"strip"===this._def.unknownKeys))for(const e in r.data)n.includes(e)||i.push(e);const o=[];for(const e of n){const t=s[e],n=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new F(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof Ne){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)i.length>0&&(addIssueToContext$1(r,{code:L.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const s=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new F(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of o){const r=await t.key,s=await t.value;e.push({key:r,value:s,alwaysSet:t.alwaysSet})}return e})).then((e=>Z.mergeObjectSync(t,e))):Z.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return $.errToObj,new _ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var s,n,i,o;const a=null!==(i=null===(n=(s=this._def).errorMap)||void 0===n?void 0:n.call(s,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=$.errToObj(e).message)&&void 0!==o?o:a}:{message:a}}}:{}})}strip(){return new _ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new _ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new _ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new _ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Me.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new _ZodObject({...this._def,catchall:e})}pick(e){const t={};return D.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new _ZodObject({...this._def,shape:()=>t})}omit(e){const t={};return D.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new _ZodObject({...this._def,shape:()=>t})}deepPartial(){return deepPartialify$1(this)}partial(e){const t={};return D.objectKeys(this.shape).forEach((r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()})),new _ZodObject({...this._def,shape:()=>t})}required(e){const t={};return D.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof Pe;)e=e._def.innerType;t[r]=e}})),new _ZodObject({...this._def,shape:()=>t})}keyof(){return createZodEnum$1(D.objectKeys(this.shape))}};Te.create=(e,t)=>new Te({shape:()=>e,unknownKeys:"strip",catchall:Ne.create(),typeName:Me.ZodObject,...processCreateParams$1(t)}),Te.strictCreate=(e,t)=>new Te({shape:()=>e,unknownKeys:"strict",catchall:Ne.create(),typeName:Me.ZodObject,...processCreateParams$1(t)}),Te.lazycreate=(e,t)=>new Te({shape:e,unknownKeys:"strip",catchall:Ne.create(),typeName:Me.ZodObject,...processCreateParams$1(t)});var ke=class extends J{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new q(e.ctx.common.issues)));return addIssueToContext$1(t,{code:L.invalid_union,unionErrors:r}),V}));{let e;const s=[];for(const n of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=s.map((e=>new q(e)));return addIssueToContext$1(t,{code:L.invalid_union,unionErrors:n}),V}}get options(){return this._def.options}};function mergeValues$1(e,t){const r=getParsedType$1(e),s=getParsedType$1(t);if(e===t)return{valid:!0,data:e};if(r===P.object&&s===P.object){const r=D.objectKeys(t),s=D.objectKeys(e).filter((e=>-1!==r.indexOf(e))),n={...e,...t};for(const r of s){const s=mergeValues$1(e[r],t[r]);if(!s.valid)return{valid:!1};n[r]=s.data}return{valid:!0,data:n}}if(r===P.array&&s===P.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let s=0;s<e.length;s++){const n=mergeValues$1(e[s],t[s]);if(!n.valid)return{valid:!1};r.push(n.data)}return{valid:!0,data:r}}return r===P.date&&s===P.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}ke.create=(e,t)=>new ke({options:e,typeName:Me.ZodUnion,...processCreateParams$1(t)});var Ae=class extends J{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),handleParsed=(e,s)=>{if(isAborted$1(e)||isAborted$1(s))return V;const n=mergeValues$1(e.value,s.value);return n.valid?((isDirty$1(e)||isDirty$1(s))&&t.dirty(),{status:t.value,value:n.data}):(addIssueToContext$1(r,{code:L.invalid_intersection_types}),V)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>handleParsed(e,t))):handleParsed(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Ae.create=(e,t,r)=>new Ae({left:e,right:t,typeName:Me.ZodIntersection,...processCreateParams$1(r)});var Ee=class _ZodTuple extends J{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==P.array)return addIssueToContext$1(r,{code:L.invalid_type,expected:P.array,received:r.parsedType}),V;if(r.data.length<this._def.items.length)return addIssueToContext$1(r,{code:L.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),V;!this._def.rest&&r.data.length>this._def.items.length&&(addIssueToContext$1(r,{code:L.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map(((e,t)=>{const s=this._def.items[t]||this._def.rest;return s?s._parse(new F(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(s).then((e=>Z.mergeArray(t,e))):Z.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new _ZodTuple({...this._def,rest:e})}};Ee.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ee({items:e,typeName:Me.ZodTuple,rest:null,...processCreateParams$1(t)})};var Ie=class extends J{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==P.map)return addIssueToContext$1(r,{code:L.invalid_type,expected:P.map,received:r.parsedType}),V;const s=this._def.keyType,n=this._def.valueType,i=[...r.data.entries()].map((([e,t],i)=>({key:s._parse(new F(r,e,r.path,[i,"key"])),value:n._parse(new F(r,t,r.path,[i,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of i){const s=await r.key,n=await r.value;if("aborted"===s.status||"aborted"===n.status)return V;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of i){const s=r.key,n=r.value;if("aborted"===s.status||"aborted"===n.status)return V;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}}};Ie.create=(e,t,r)=>new Ie({valueType:t,keyType:e,typeName:Me.ZodMap,...processCreateParams$1(r)});var Se=class _ZodSet extends J{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==P.set)return addIssueToContext$1(r,{code:L.invalid_type,expected:P.set,received:r.parsedType}),V;const s=this._def;null!==s.minSize&&r.data.size<s.minSize.value&&(addIssueToContext$1(r,{code:L.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&r.data.size>s.maxSize.value&&(addIssueToContext$1(r,{code:L.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const n=this._def.valueType;function finalizeSet(e){const r=new Set;for(const s of e){if("aborted"===s.status)return V;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}const i=[...r.data.values()].map(((e,t)=>n._parse(new F(r,e,r.path,t))));return r.common.async?Promise.all(i).then((e=>finalizeSet(e))):finalizeSet(i)}min(e,t){return new _ZodSet({...this._def,minSize:{value:e,message:$.toString(t)}})}max(e,t){return new _ZodSet({...this._def,maxSize:{value:e,message:$.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Se.create=(e,t)=>new Se({valueType:e,minSize:null,maxSize:null,typeName:Me.ZodSet,...processCreateParams$1(t)});var Oe=class extends J{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Oe.create=(e,t)=>new Oe({getter:e,typeName:Me.ZodLazy,...processCreateParams$1(t)});var Ce=class extends J{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{received:t.data,code:L.invalid_literal,expected:this._def.value}),V}return{status:"valid",value:e.data}}get value(){return this._def.value}};function createZodEnum$1(e,t){return new Re({values:e,typeName:Me.ZodEnum,...processCreateParams$1(t)})}Ce.create=(e,t)=>new Ce({value:e,typeName:Me.ZodLiteral,...processCreateParams$1(t)});var Re=class _ZodEnum extends J{constructor(){super(...arguments),z.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext$1(t,{expected:D.joinValues(r),received:t.parsedType,code:L.invalid_type}),V}if(__classPrivateFieldGet$1(this,z)||__classPrivateFieldSet$1(this,z,new Set(this._def.values)),!__classPrivateFieldGet$1(this,z).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext$1(t,{received:t.data,code:L.invalid_enum_value,options:r}),V}return OK$1(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return _ZodEnum.create(e,{...this._def,...t})}exclude(e,t=this._def){return _ZodEnum.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}};z=new WeakMap,Re.create=createZodEnum$1;var De=class extends J{constructor(){super(...arguments),j.set(this,void 0)}_parse(e){const t=D.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==P.string&&r.parsedType!==P.number){const e=D.objectValues(t);return addIssueToContext$1(r,{expected:D.joinValues(e),received:r.parsedType,code:L.invalid_type}),V}if(__classPrivateFieldGet$1(this,j)||__classPrivateFieldSet$1(this,j,new Set(D.getValidEnumValues(this._def.values))),!__classPrivateFieldGet$1(this,j).has(e.data)){const e=D.objectValues(t);return addIssueToContext$1(r,{received:r.data,code:L.invalid_enum_value,options:e}),V}return OK$1(e.data)}get enum(){return this._def.values}};j=new WeakMap,De.create=(e,t)=>new De({values:e,typeName:Me.ZodNativeEnum,...processCreateParams$1(t)});var Ue=class extends J{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==P.promise&&!1===t.common.async)return addIssueToContext$1(t,{code:L.invalid_type,expected:P.promise,received:t.parsedType}),V;const r=t.parsedType===P.promise?t.data:Promise.resolve(t.data);return OK$1(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}};Ue.create=(e,t)=>new Ue({type:e,typeName:Me.ZodPromise,...processCreateParams$1(t)});var Be=class extends J{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Me.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,n={addIssue:e=>{addIssueToContext$1(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===s.type){const e=s.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return V;const s=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===s.status?V:"dirty"===s.status||"dirty"===t.value?DIRTY$1(s.value):s}));{if("aborted"===t.value)return V;const s=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===s.status?V:"dirty"===s.status||"dirty"===t.value?DIRTY$1(s.value):s}}if("refinement"===s.type){const executeRefinement=e=>{const t=s.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?V:("dirty"===e.status&&t.dirty(),executeRefinement(e.value),{status:t.value,value:e.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>"aborted"===e.status?V:("dirty"===e.status&&t.dirty(),executeRefinement(e.value).then((()=>({status:t.value,value:e.value}))))))}if("transform"===s.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!isValid$1(e))return e;const i=s.transform(e.value,n);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>isValid$1(e)?Promise.resolve(s.transform(e.value,n)).then((e=>({status:t.value,value:e}))):e))}D.assertNever(s)}};Be.create=(e,t,r)=>new Be({schema:e,typeName:Me.ZodEffects,effect:t,...processCreateParams$1(r)}),Be.createWithPreprocess=(e,t,r)=>new Be({schema:t,effect:{type:"preprocess",transform:e},typeName:Me.ZodEffects,...processCreateParams$1(r)});var Pe=class extends J{_parse(e){return this._getType(e)===P.undefined?OK$1(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Pe.create=(e,t)=>new Pe({innerType:e,typeName:Me.ZodOptional,...processCreateParams$1(t)});var Le=class extends J{_parse(e){return this._getType(e)===P.null?OK$1(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Le.create=(e,t)=>new Le({innerType:e,typeName:Me.ZodNullable,...processCreateParams$1(t)});var qe=class extends J{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===P.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};qe.create=(e,t)=>new qe({innerType:e,typeName:Me.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...processCreateParams$1(t)});var We=class extends J{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return isAsync$1(s)?s.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new q(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new q(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};We.create=(e,t)=>new We({innerType:e,typeName:Me.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...processCreateParams$1(t)});var $e=class extends J{_parse(e){if(this._getType(e)!==P.nan){const t=this._getOrReturnCtx(e);return addIssueToContext$1(t,{code:L.invalid_type,expected:P.nan,received:t.parsedType}),V}return{status:"valid",value:e.data}}};$e.create=e=>new $e({typeName:Me.ZodNaN,...processCreateParams$1(e)});var Me,ze,je=class extends J{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Ze=class _ZodPipeline extends J{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?V:"dirty"===e.status?(t.dirty(),DIRTY$1(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})()}{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?V:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new _ZodPipeline({in:e,out:t,typeName:Me.ZodPipeline})}},Ve=class extends J{_parse(e){const t=this._def.innerType._parse(e),freeze=e=>(isValid$1(e)&&(e.value=Object.freeze(e.value)),e);return isAsync$1(t)?t.then((e=>freeze(e))):freeze(t)}unwrap(){return this._def.innerType}};Ve.create=(e,t)=>new Ve({innerType:e,typeName:Me.ZodReadonly,...processCreateParams$1(t)}),(ze=Me||(Me={})).ZodString="ZodString",ze.ZodNumber="ZodNumber",ze.ZodNaN="ZodNaN",ze.ZodBigInt="ZodBigInt",ze.ZodBoolean="ZodBoolean",ze.ZodDate="ZodDate",ze.ZodSymbol="ZodSymbol",ze.ZodUndefined="ZodUndefined",ze.ZodNull="ZodNull",ze.ZodAny="ZodAny",ze.ZodUnknown="ZodUnknown",ze.ZodNever="ZodNever",ze.ZodVoid="ZodVoid",ze.ZodArray="ZodArray",ze.ZodObject="ZodObject",ze.ZodUnion="ZodUnion",ze.ZodDiscriminatedUnion="ZodDiscriminatedUnion",ze.ZodIntersection="ZodIntersection",ze.ZodTuple="ZodTuple",ze.ZodRecord="ZodRecord",ze.ZodMap="ZodMap",ze.ZodSet="ZodSet",ze.ZodFunction="ZodFunction",ze.ZodLazy="ZodLazy",ze.ZodLiteral="ZodLiteral",ze.ZodEnum="ZodEnum",ze.ZodEffects="ZodEffects",ze.ZodNativeEnum="ZodNativeEnum",ze.ZodOptional="ZodOptional",ze.ZodNullable="ZodNullable",ze.ZodDefault="ZodDefault",ze.ZodCatch="ZodCatch",ze.ZodPromise="ZodPromise",ze.ZodBranded="ZodBranded",ze.ZodPipeline="ZodPipeline",ze.ZodReadonly="ZodReadonly",Ne.create,xe.create,ke.create,Ae.create,Ee.create,Re.create,Ue.create,Pe.create,Le.create;var Fe={};function getTypeFromZodType(e){switch(e.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function getParameters(e){const t=[];return e.metadata?.openapi?.parameters?(t.push(...e.metadata.openapi.parameters),t):(e.query instanceof Te&&Object.entries(e.query.shape).forEach((([e,r])=>{r instanceof J&&t.push({name:e,in:"query",schema:{type:getTypeFromZodType(r),..."minLength"in r&&r.minLength?{minLength:r.minLength}:{},description:r.description}})})),t)}function getResponse(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}async function generator(e,t){Object.entries(e).forEach((([e,t])=>{const r=t.options;if(!r.metadata?.SERVER_ONLY&&("GET"===r.method&&(Fe[t.path]={get:{tags:["Default",...r.metadata?.openapi?.tags||[]],description:r.metadata?.openapi?.description,operationId:r.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:getParameters(r),responses:getResponse(r.metadata?.openapi?.responses)}}),"POST"===r.method)){const e=function(e){if(e.metadata?.openapi?.requestBody)return e.metadata.openapi.requestBody;if(e.body&&(e.body instanceof Te||e.body instanceof Pe)){const t=e.body.shape;if(!t)return;const r={},s=[];return Object.entries(t).forEach((([e,t])=>{t instanceof J&&(r[e]={type:getTypeFromZodType(t),description:t.description},t instanceof Pe||s.push(e))})),{required:!(e.body instanceof Pe||!e.body),content:{"application/json":{schema:{type:"object",properties:r,required:s}}}}}}(r);Fe[t.path]={post:{tags:["Default",...r.metadata?.openapi?.tags||[]],description:r.metadata?.openapi?.description,operationId:r.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:getParameters(r),...e?{requestBody:e}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:getResponse(r.metadata?.openapi?.responses)}}}}));return{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:t?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:Fe}}var Qe,Je,createRouter=(e,t)=>{if(!t?.openapi?.disabled){const r={path:"/api/reference",...t?.openapi};e.openapi=createEndpoint2(r.path,{method:"GET"},(async t=>{const s=await generator(e);return new Response(((e,t)=>`<!doctype html>\n<html>\n  <head>\n    <title>Scalar API Reference</title>\n    <meta charset="utf-8" />\n    <meta\n      name="viewport"\n      content="width=device-width, initial-scale=1" />\n  </head>\n  <body>\n    <script\n      id="api-reference"\n      type="application/json">\n    ${JSON.stringify(e)}\n    <\/script>\n\t <script>\n      var configuration = {\n\t  \tfavicon: ${t?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(t.logo)}`:void 0} ,\n\t   \ttheme: ${t?.theme||"saturn"},\n        metaData: {\n\t\t\ttitle: ${t?.title||"Open API Reference"},\n\t\t\tdescription: ${t?.description||"Better Call Open API"},\n\t\t}\n      }\n      document.getElementById('api-reference').dataset.configuration =\n        JSON.stringify(configuration)\n    <\/script>\n\t  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"><\/script>\n  </body>\n</html>`)(s,r.scalar),{headers:{"Content-Type":"text/html"}})}))}const r=createRouter$1(),s=createRouter$1();for(const t of Object.values(e)){if(!t.options)continue;if(t.options?.metadata?.SERVER_ONLY)continue;const e=Array.isArray(t.options?.method)?t.options.method:[t.options?.method];for(const s of e)addRoute(r,s,t.path,t)}if(t?.routerMiddleware?.length)for(const{path:e,middleware:r}of t.routerMiddleware)addRoute(s,"*",e,r);return{handler:async e=>{const n=await(t?.onRequest?.(e));if(n instanceof Response)return n;const i=n instanceof Request?n:e,o=await(async e=>{const n=new URL(e.url),i=t?.basePath?n.pathname.split(t.basePath)[1]:n.pathname;if(!i?.length)return t?.onError?.(new Error("NOT_FOUND")),new Response(null,{status:404,statusText:"Not Found"});const o=findRoute(r,e.method,i);if(!o?.data)return new Response(null,{status:404,statusText:"Not Found"});const a=o.data,d={path:i,method:e.method,headers:e.headers,params:o.params?JSON.parse(JSON.stringify(o.params)):{},request:e,body:await getBody(a.options.cloneRequest?e.clone():e),query:Object.fromEntries(n.searchParams),_flag:"router",asResponse:!0,context:t?.routerContext};try{const e=findAllRoutes(s,"*",i);if(e?.length)for(const{data:t,params:r}of e){const e=await t({...d,params:r,asResponse:!1});if(e instanceof Response)return e}return await a(d)}catch(e){return isAPIError(e)?toResponse(e):(console.error("# SERVER_ERROR: ",e),new Response(null,{status:500,statusText:"Internal Server Error"}))}})(i),a=await(t?.onResponse?.(o));return a instanceof Response?a:o},endpoints:e}};!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const r of e)t[r]=r;return t},e.getValidEnumValues=t=>{const r=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),s={};for(const e of r)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(const r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(Qe||(Qe={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(Je||(Je={}));const Ke=Qe.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=e=>{switch(typeof e){case"undefined":return Ke.undefined;case"string":return Ke.string;case"number":return isNaN(e)?Ke.nan:Ke.number;case"boolean":return Ke.boolean;case"function":return Ke.function;case"bigint":return Ke.bigint;case"symbol":return Ke.symbol;case"object":return Array.isArray(e)?Ke.array:null===e?Ke.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Ke.promise:"undefined"!=typeof Map&&e instanceof Map?Ke.map:"undefined"!=typeof Set&&e instanceof Set?Ke.set:"undefined"!=typeof Date&&e instanceof Date?Ke.date:Ke.object;default:return Ke.unknown}},He=Qe.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ZodError extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},r={_errors:[]},processError=e=>{for(const s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(processError);else if("invalid_return_type"===s.code)processError(s.returnTypeError);else if("invalid_arguments"===s.code)processError(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,n=0;for(;n<s.path.length;){const r=s.path[n];n===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return processError(this),r}static assert(e){if(!(e instanceof ZodError))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Qe.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ZodError.create=e=>new ZodError(e);const errorMap=(e,t)=>{let r;switch(e.code){case He.invalid_type:r=e.received===Ke.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case He.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Qe.jsonStringifyReplacer)}`;break;case He.unrecognized_keys:r=`Unrecognized key(s) in object: ${Qe.joinValues(e.keys,", ")}`;break;case He.invalid_union:r="Invalid input";break;case He.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Qe.joinValues(e.options)}`;break;case He.invalid_enum_value:r=`Invalid enum value. Expected ${Qe.joinValues(e.options)}, received '${e.received}'`;break;case He.invalid_arguments:r="Invalid function arguments";break;case He.invalid_return_type:r="Invalid function return type";break;case He.invalid_date:r="Invalid date";break;case He.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Qe.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case He.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case He.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case He.custom:r="Invalid input";break;case He.invalid_intersection_types:r="Intersection results could not be merged";break;case He.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case He.not_finite:r="Number must be finite";break;default:r=t.defaultError,Qe.assertNever(e)}return{message:r}};let Ge=errorMap;function getErrorMap(){return Ge}const makeIssue=e=>{const{data:t,path:r,errorMaps:s,issueData:n}=e,i=[...r,...n.path||[]],o={...n,path:i};if(void 0!==n.message)return{...n,path:i,message:n.message};let a="";const d=s.filter((e=>!!e)).slice().reverse();for(const e of d)a=e(o,{data:t,defaultError:a}).message;return{...n,path:i,message:a}};function addIssueToContext(e,t){const r=getErrorMap(),s=makeIssue({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===errorMap?void 0:errorMap].filter((e=>!!e))});e.common.issues.push(s)}class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if("aborted"===s.status)return Ye;"dirty"===s.status&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const e of t){const t=await e.key,s=await e.value;r.push({key:t,value:s})}return ParseStatus.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:t,value:n}=s;if("aborted"===t.status)return Ye;if("aborted"===n.status)return Ye;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"===t.value||void 0===n.value&&!s.alwaysSet||(r[t.value]=n.value)}return{status:e.value,value:r}}}const Ye=Object.freeze({status:"aborted"}),DIRTY=e=>({status:"dirty",value:e}),OK=e=>({status:"valid",value:e}),isAborted=e=>"aborted"===e.status,isDirty=e=>"dirty"===e.status,isValid=e=>"valid"===e.status,isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise;function __classPrivateFieldGet(e,t,r,s){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function __classPrivateFieldSet(e,t,r,s,n){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,r),r}var Xe,et,tt;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Xe||(Xe={}));class ParseInputLazyPath{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const handleResult=(e,t)=>{if(isValid(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ZodError(e.common.issues);return this._error=t,this._error}}};function processCreateParams(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:s,description:n}=e;if(t&&(r||s))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:n};return{errorMap:(t,n)=>{var i,o;const{message:a}=e;return"invalid_enum_value"===t.code?{message:null!=a?a:n.defaultError}:void 0===n.data?{message:null!==(i=null!=a?a:s)&&void 0!==i?i:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(o=null!=a?a:r)&&void 0!==o?o:n.defaultError}},description:n}}class ZodType{get description(){return this._def.description}_getType(e){return getParsedType(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(isAsync(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},n=this._parseSync({data:e,path:s.path,parent:s});return handleResult(s,n)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:s});return isValid(t)?{value:t.value}:{issues:s.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then((e=>isValid(e)?{value:e.value}:{issues:s.common.issues}))}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},s=this._parse({data:e,path:r.path,parent:r}),n=await(isAsync(s)?s:Promise.resolve(s));return handleResult(r,n)}refine(e,t){const getIssueProperties=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const s=e(t),setError=()=>r.addIssue({code:He.custom,...getIssueProperties(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then((e=>!!e||(setError(),!1))):!!s||(setError(),!1)}))}refinement(e,t){return this._refinement(((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1)))}_refinement(e){return new ZodEffects({schema:this,typeName:Nt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this)}promise(){return ZodPromise.create(this,this._def)}or(e){return ZodUnion.create([this,e],this._def)}and(e){return ZodIntersection.create(this,e,this._def)}transform(e){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:Nt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:t,typeName:Nt.ZodDefault})}brand(){return new ZodBranded({typeName:Nt.ZodBranded,type:this,...processCreateParams(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:t,typeName:Nt.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return ZodPipeline.create(this,e)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const rt=/^c[^\s-]{8,}$/i,st=/^[0-9a-z]+$/,nt=/^[0-9A-HJKMNP-TV-Z]{26}$/i,it=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ot=/^[a-z0-9_-]{21}$/i,at=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,dt=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ct=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let ut;const lt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,pt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ht=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,mt=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ft=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,yt=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gt="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",wt=new RegExp(`^${gt}$`);function timeRegexSource(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function datetimeRegex(e){let t=`${gt}T${timeRegexSource(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function isValidIP$1(e,t){return!("v4"!==t&&t||!lt.test(e))||!("v6"!==t&&t||!ht.test(e))}function isValidJWT(e,t){if(!at.test(e))return!1;try{const[r]=e.split("."),s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(s));return"object"==typeof n&&null!==n&&(!(!n.typ||!n.alg)&&(!t||n.alg===t))}catch(e){return!1}}function isValidCidr(e,t){return!("v4"!==t&&t||!pt.test(e))||!("v6"!==t&&t||!mt.test(e))}class ZodString extends ZodType{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==Ke.string){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.string,received:t.parsedType}),Ye}const t=new ParseStatus;let r;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?addIssueToContext(r,{code:He.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&addIssueToContext(r,{code:He.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)ct.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"email",code:He.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)ut||(ut=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ut.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"emoji",code:He.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)it.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"uuid",code:He.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)ot.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"nanoid",code:He.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)rt.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"cuid",code:He.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)st.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"cuid2",code:He.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)nt.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"ulid",code:He.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(n){r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"url",code:He.invalid_string,message:s.message}),t.dirty()}else if("regex"===s.kind){s.regex.lastIndex=0;s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"regex",code:He.invalid_string,message:s.message}),t.dirty())}else if("trim"===s.kind)e.data=e.data.trim();else if("includes"===s.kind)e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty());else if("toLowerCase"===s.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===s.kind)e.data=e.data.toUpperCase();else if("startsWith"===s.kind)e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty());else if("endsWith"===s.kind)e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty());else if("datetime"===s.kind){datetimeRegex(s).test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.invalid_string,validation:"datetime",message:s.message}),t.dirty())}else if("date"===s.kind){wt.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.invalid_string,validation:"date",message:s.message}),t.dirty())}else if("time"===s.kind){new RegExp(`^${timeRegexSource(s)}$`).test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.invalid_string,validation:"time",message:s.message}),t.dirty())}else"duration"===s.kind?dt.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"duration",code:He.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?isValidIP$1(e.data,s.version)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"ip",code:He.invalid_string,message:s.message}),t.dirty()):"jwt"===s.kind?isValidJWT(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"jwt",code:He.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?isValidCidr(e.data,s.version)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"cidr",code:He.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?ft.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"base64",code:He.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?yt.test(e.data)||(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{validation:"base64url",code:He.invalid_string,message:s.message}),t.dirty()):Qe.assertNever(s);return{status:t.value,value:e.data}}_regex(e,t,r){return this.refinement((t=>e.test(t)),{validation:t,code:He.invalid_string,...Xe.errToObj(r)})}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Xe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Xe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Xe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Xe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Xe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Xe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Xe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Xe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Xe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Xe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Xe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Xe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Xe.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...Xe.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...Xe.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Xe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Xe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Xe.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Xe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Xe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Xe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Xe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Xe.errToObj(t)})}nonempty(e){return this.min(1,Xe.errToObj(e))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function floatSafeRemainder(e,t){const r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,n=r>s?r:s;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}ZodString.create=e=>{var t;return new ZodString({checks:[],typeName:Nt.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==Ke.number){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.number,received:t.parsedType}),Ye}let t;const r=new ParseStatus;for(const s of this._def.checks)if("int"===s.kind)Qe.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty());else if("min"===s.kind){(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty())}else if("max"===s.kind){(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty())}else"multipleOf"===s.kind?0!==floatSafeRemainder(e.data,s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.not_finite,message:s.message}),r.dirty()):Qe.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Xe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Xe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Xe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Xe.toString(t))}setLimit(e,t,r,s){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Xe.toString(s)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Xe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Xe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Xe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Xe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Xe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Xe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Xe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Xe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Xe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&Qe.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ZodNumber.create=e=>new ZodNumber({checks:[],typeName:Nt.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==Ke.bigint)return this._getInvalidInput(e);let t;const r=new ParseStatus;for(const s of this._def.checks)if("min"===s.kind){(s.inclusive?e.data<s.value:e.data<=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty())}else if("max"===s.kind){(s.inclusive?e.data>s.value:e.data>=s.value)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty())}else"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),addIssueToContext(t,{code:He.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):Qe.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.bigint,received:t.parsedType}),Ye}gte(e,t){return this.setLimit("min",e,!0,Xe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Xe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Xe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Xe.toString(t))}setLimit(e,t,r,s){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Xe.toString(s)}]})}_addCheck(e){return new ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Xe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Xe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Xe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Xe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Xe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ZodBigInt.create=e=>{var t;return new ZodBigInt({checks:[],typeName:Nt.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};class ZodBoolean extends ZodType{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==Ke.boolean){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.boolean,received:t.parsedType}),Ye}return OK(e.data)}}ZodBoolean.create=e=>new ZodBoolean({typeName:Nt.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});class ZodDate extends ZodType{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==Ke.date){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.date,received:t.parsedType}),Ye}if(isNaN(e.data.getTime())){return addIssueToContext(this._getOrReturnCtx(e),{code:He.invalid_date}),Ye}const t=new ParseStatus;let r;for(const s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),t.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),addIssueToContext(r,{code:He.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),t.dirty()):Qe.assertNever(s);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Xe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Xe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ZodDate.create=e=>new ZodDate({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:Nt.ZodDate,...processCreateParams(e)});class ZodSymbol extends ZodType{_parse(e){if(this._getType(e)!==Ke.symbol){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.symbol,received:t.parsedType}),Ye}return OK(e.data)}}ZodSymbol.create=e=>new ZodSymbol({typeName:Nt.ZodSymbol,...processCreateParams(e)});class ZodUndefined extends ZodType{_parse(e){if(this._getType(e)!==Ke.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.undefined,received:t.parsedType}),Ye}return OK(e.data)}}ZodUndefined.create=e=>new ZodUndefined({typeName:Nt.ZodUndefined,...processCreateParams(e)});class ZodNull extends ZodType{_parse(e){if(this._getType(e)!==Ke.null){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.null,received:t.parsedType}),Ye}return OK(e.data)}}ZodNull.create=e=>new ZodNull({typeName:Nt.ZodNull,...processCreateParams(e)});class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return OK(e.data)}}ZodAny.create=e=>new ZodAny({typeName:Nt.ZodAny,...processCreateParams(e)});class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return OK(e.data)}}ZodUnknown.create=e=>new ZodUnknown({typeName:Nt.ZodUnknown,...processCreateParams(e)});class ZodNever extends ZodType{_parse(e){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.never,received:t.parsedType}),Ye}}ZodNever.create=e=>new ZodNever({typeName:Nt.ZodNever,...processCreateParams(e)});class ZodVoid extends ZodType{_parse(e){if(this._getType(e)!==Ke.undefined){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.void,received:t.parsedType}),Ye}return OK(e.data)}}ZodVoid.create=e=>new ZodVoid({typeName:Nt.ZodVoid,...processCreateParams(e)});class ZodArray extends ZodType{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==Ke.array)return addIssueToContext(t,{code:He.invalid_type,expected:Ke.array,received:t.parsedType}),Ye;if(null!==s.exactLength){const e=t.data.length>s.exactLength.value,n=t.data.length<s.exactLength.value;(e||n)&&(addIssueToContext(t,{code:e?He.too_big:He.too_small,minimum:n?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(addIssueToContext(t,{code:He.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(addIssueToContext(t,{code:He.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map(((e,r)=>s.type._parseAsync(new ParseInputLazyPath(t,e,t.path,r))))).then((e=>ParseStatus.mergeArray(r,e)));const n=[...t.data].map(((e,r)=>s.type._parseSync(new ParseInputLazyPath(t,e,t.path,r))));return ParseStatus.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:Xe.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:Xe.toString(t)}})}length(e,t){return new ZodArray({...this._def,exactLength:{value:e,message:Xe.toString(t)}})}nonempty(e){return this.min(1,e)}}function deepPartialify(e){if(e instanceof ZodObject){const t={};for(const r in e.shape){const s=e.shape[r];t[r]=ZodOptional.create(deepPartialify(s))}return new ZodObject({...e._def,shape:()=>t})}return e instanceof ZodArray?new ZodArray({...e._def,type:deepPartialify(e.element)}):e instanceof ZodOptional?ZodOptional.create(deepPartialify(e.unwrap())):e instanceof ZodNullable?ZodNullable.create(deepPartialify(e.unwrap())):e instanceof ZodTuple?ZodTuple.create(e.items.map((e=>deepPartialify(e)))):e}ZodArray.create=(e,t)=>new ZodArray({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Nt.ZodArray,...processCreateParams(t)});class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Qe.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Ke.object){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.object,received:t.parsedType}),Ye}const{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(const e in r.data)n.includes(e)||i.push(e);const o=[];for(const e of n){const t=s[e],n=r.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new ParseInputLazyPath(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof ZodNever){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)o.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)i.length>0&&(addIssueToContext(r,{code:He.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const s=r.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new ParseInputLazyPath(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of o){const r=await t.key,s=await t.value;e.push({key:r,value:s,alwaysSet:t.alwaysSet})}return e})).then((e=>ParseStatus.mergeObjectSync(t,e))):ParseStatus.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return Xe.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var s,n,i,o;const a=null!==(i=null===(n=(s=this._def).errorMap)||void 0===n?void 0:n.call(s,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=Xe.errToObj(e).message)&&void 0!==o?o:a}:{message:a}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Nt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){const t={};return Qe.objectKeys(e).forEach((r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])})),new ZodObject({...this._def,shape:()=>t})}omit(e){const t={};return Qe.objectKeys(this.shape).forEach((r=>{e[r]||(t[r]=this.shape[r])})),new ZodObject({...this._def,shape:()=>t})}deepPartial(){return deepPartialify(this)}partial(e){const t={};return Qe.objectKeys(this.shape).forEach((r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()})),new ZodObject({...this._def,shape:()=>t})}required(e){const t={};return Qe.objectKeys(this.shape).forEach((r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof ZodOptional;)e=e._def.innerType;t[r]=e}})),new ZodObject({...this._def,shape:()=>t})}keyof(){return createZodEnum(Qe.objectKeys(this.shape))}}ZodObject.create=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:Nt.ZodObject,...processCreateParams(t)}),ZodObject.strictCreate=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strict",catchall:ZodNever.create(),typeName:Nt.ZodObject,...processCreateParams(t)}),ZodObject.lazycreate=(e,t)=>new ZodObject({shape:e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:Nt.ZodObject,...processCreateParams(t)});class ZodUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map((async e=>{const r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;const r=e.map((e=>new ZodError(e.ctx.common.issues)));return addIssueToContext(t,{code:He.invalid_union,unionErrors:r}),Ye}));{let e;const s=[];for(const n of r){const r={...t,common:{...t.common,issues:[]},parent:null},i=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const n=s.map((e=>new ZodError(e)));return addIssueToContext(t,{code:He.invalid_union,unionErrors:n}),Ye}}get options(){return this._def.options}}ZodUnion.create=(e,t)=>new ZodUnion({options:e,typeName:Nt.ZodUnion,...processCreateParams(t)});const getDiscriminator=e=>e instanceof ZodLazy?getDiscriminator(e.schema):e instanceof ZodEffects?getDiscriminator(e.innerType()):e instanceof ZodLiteral?[e.value]:e instanceof ZodEnum?e.options:e instanceof ZodNativeEnum?Qe.objectValues(e.enum):e instanceof ZodDefault?getDiscriminator(e._def.innerType):e instanceof ZodUndefined?[void 0]:e instanceof ZodNull?[null]:e instanceof ZodOptional?[void 0,...getDiscriminator(e.unwrap())]:e instanceof ZodNullable?[null,...getDiscriminator(e.unwrap())]:e instanceof ZodBranded||e instanceof ZodReadonly?getDiscriminator(e.unwrap()):e instanceof ZodCatch?getDiscriminator(e._def.innerType):[];class ZodDiscriminatedUnion extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ke.object)return addIssueToContext(t,{code:He.invalid_type,expected:Ke.object,received:t.parsedType}),Ye;const r=this.discriminator,s=t.data[r],n=this.optionsMap.get(s);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(addIssueToContext(t,{code:He.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Ye)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const r of t){const t=getDiscriminator(r.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const n of t){if(s.has(n))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);s.set(n,r)}}return new ZodDiscriminatedUnion({typeName:Nt.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...processCreateParams(r)})}}function mergeValues(e,t){const r=getParsedType(e),s=getParsedType(t);if(e===t)return{valid:!0,data:e};if(r===Ke.object&&s===Ke.object){const r=Qe.objectKeys(t),s=Qe.objectKeys(e).filter((e=>-1!==r.indexOf(e))),n={...e,...t};for(const r of s){const s=mergeValues(e[r],t[r]);if(!s.valid)return{valid:!1};n[r]=s.data}return{valid:!0,data:n}}if(r===Ke.array&&s===Ke.array){if(e.length!==t.length)return{valid:!1};const r=[];for(let s=0;s<e.length;s++){const n=mergeValues(e[s],t[s]);if(!n.valid)return{valid:!1};r.push(n.data)}return{valid:!0,data:r}}return r===Ke.date&&s===Ke.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class ZodIntersection extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),handleParsed=(e,s)=>{if(isAborted(e)||isAborted(s))return Ye;const n=mergeValues(e.value,s.value);return n.valid?((isDirty(e)||isDirty(s))&&t.dirty(),{status:t.value,value:n.data}):(addIssueToContext(r,{code:He.invalid_intersection_types}),Ye)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then((([e,t])=>handleParsed(e,t))):handleParsed(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}ZodIntersection.create=(e,t,r)=>new ZodIntersection({left:e,right:t,typeName:Nt.ZodIntersection,...processCreateParams(r)});class ZodTuple extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ke.array)return addIssueToContext(r,{code:He.invalid_type,expected:Ke.array,received:r.parsedType}),Ye;if(r.data.length<this._def.items.length)return addIssueToContext(r,{code:He.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ye;!this._def.rest&&r.data.length>this._def.items.length&&(addIssueToContext(r,{code:He.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const s=[...r.data].map(((e,t)=>{const s=this._def.items[t]||this._def.rest;return s?s._parse(new ParseInputLazyPath(r,e,r.path,t)):null})).filter((e=>!!e));return r.common.async?Promise.all(s).then((e=>ParseStatus.mergeArray(t,e))):ParseStatus.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}}ZodTuple.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:e,typeName:Nt.ZodTuple,rest:null,...processCreateParams(t)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ke.object)return addIssueToContext(r,{code:He.invalid_type,expected:Ke.object,received:r.parsedType}),Ye;const s=[],n=this._def.keyType,i=this._def.valueType;for(const e in r.data)s.push({key:n._parse(new ParseInputLazyPath(r,e,r.path,e)),value:i._parse(new ParseInputLazyPath(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?ParseStatus.mergeObjectAsync(t,s):ParseStatus.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return new ZodRecord(t instanceof ZodType?{keyType:e,valueType:t,typeName:Nt.ZodRecord,...processCreateParams(r)}:{keyType:ZodString.create(),valueType:e,typeName:Nt.ZodRecord,...processCreateParams(t)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ke.map)return addIssueToContext(r,{code:He.invalid_type,expected:Ke.map,received:r.parsedType}),Ye;const s=this._def.keyType,n=this._def.valueType,i=[...r.data.entries()].map((([e,t],i)=>({key:s._parse(new ParseInputLazyPath(r,e,r.path,[i,"key"])),value:n._parse(new ParseInputLazyPath(r,t,r.path,[i,"value"]))})));if(r.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const r of i){const s=await r.key,n=await r.value;if("aborted"===s.status||"aborted"===n.status)return Ye;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const r of i){const s=r.key,n=r.value;if("aborted"===s.status||"aborted"===n.status)return Ye;"dirty"!==s.status&&"dirty"!==n.status||t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}}}ZodMap.create=(e,t,r)=>new ZodMap({valueType:t,keyType:e,typeName:Nt.ZodMap,...processCreateParams(r)});class ZodSet extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ke.set)return addIssueToContext(r,{code:He.invalid_type,expected:Ke.set,received:r.parsedType}),Ye;const s=this._def;null!==s.minSize&&r.data.size<s.minSize.value&&(addIssueToContext(r,{code:He.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&r.data.size>s.maxSize.value&&(addIssueToContext(r,{code:He.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const n=this._def.valueType;function finalizeSet(e){const r=new Set;for(const s of e){if("aborted"===s.status)return Ye;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}const i=[...r.data.values()].map(((e,t)=>n._parse(new ParseInputLazyPath(r,e,r.path,t))));return r.common.async?Promise.all(i).then((e=>finalizeSet(e))):finalizeSet(i)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:Xe.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:Xe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ZodSet.create=(e,t)=>new ZodSet({valueType:e,minSize:null,maxSize:null,typeName:Nt.ZodSet,...processCreateParams(t)});class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ke.function)return addIssueToContext(t,{code:He.invalid_type,expected:Ke.function,received:t.parsedType}),Ye;function makeArgsIssue(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter((e=>!!e)),issueData:{code:He.invalid_arguments,argumentsError:r}})}function makeReturnsIssue(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter((e=>!!e)),issueData:{code:He.invalid_return_type,returnTypeError:r}})}const r={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof ZodPromise){const e=this;return OK((async function(...t){const n=new ZodError([]),i=await e._def.args.parseAsync(t,r).catch((e=>{throw n.addIssue(makeArgsIssue(t,e)),n})),o=await Reflect.apply(s,this,i);return await e._def.returns._def.type.parseAsync(o,r).catch((e=>{throw n.addIssue(makeReturnsIssue(o,e)),n}))}))}{const e=this;return OK((function(...t){const n=e._def.args.safeParse(t,r);if(!n.success)throw new ZodError([makeArgsIssue(t,n.error)]);const i=Reflect.apply(s,this,n.data),o=e._def.returns.safeParse(i,r);if(!o.success)throw new ZodError([makeReturnsIssue(i,o.error)]);return o.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ZodFunction({...this._def,args:ZodTuple.create(e).rest(ZodUnknown.create())})}returns(e){return new ZodFunction({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new ZodFunction({args:e||ZodTuple.create([]).rest(ZodUnknown.create()),returns:t||ZodUnknown.create(),typeName:Nt.ZodFunction,...processCreateParams(r)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ZodLazy.create=(e,t)=>new ZodLazy({getter:e,typeName:Nt.ZodLazy,...processCreateParams(t)});class ZodLiteral extends ZodType{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{received:t.data,code:He.invalid_literal,expected:this._def.value}),Ye}return{status:"valid",value:e.data}}get value(){return this._def.value}}function createZodEnum(e,t){return new ZodEnum({values:e,typeName:Nt.ZodEnum,...processCreateParams(t)})}ZodLiteral.create=(e,t)=>new ZodLiteral({value:e,typeName:Nt.ZodLiteral,...processCreateParams(t)});class ZodEnum extends ZodType{constructor(){super(...arguments),et.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{expected:Qe.joinValues(r),received:t.parsedType,code:He.invalid_type}),Ye}if(__classPrivateFieldGet(this,et)||__classPrivateFieldSet(this,et,new Set(this._def.values)),!__classPrivateFieldGet(this,et).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{received:t.data,code:He.invalid_enum_value,options:r}),Ye}return OK(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ZodEnum.create(e,{...this._def,...t})}exclude(e,t=this._def){return ZodEnum.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}et=new WeakMap,ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{constructor(){super(...arguments),tt.set(this,void 0)}_parse(e){const t=Qe.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Ke.string&&r.parsedType!==Ke.number){const e=Qe.objectValues(t);return addIssueToContext(r,{expected:Qe.joinValues(e),received:r.parsedType,code:He.invalid_type}),Ye}if(__classPrivateFieldGet(this,tt)||__classPrivateFieldSet(this,tt,new Set(Qe.getValidEnumValues(this._def.values))),!__classPrivateFieldGet(this,tt).has(e.data)){const e=Qe.objectValues(t);return addIssueToContext(r,{received:r.data,code:He.invalid_enum_value,options:e}),Ye}return OK(e.data)}get enum(){return this._def.values}}tt=new WeakMap,ZodNativeEnum.create=(e,t)=>new ZodNativeEnum({values:e,typeName:Nt.ZodNativeEnum,...processCreateParams(t)});class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ke.promise&&!1===t.common.async)return addIssueToContext(t,{code:He.invalid_type,expected:Ke.promise,received:t.parsedType}),Ye;const r=t.parsedType===Ke.promise?t.data:Promise.resolve(t.data);return OK(r.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}ZodPromise.create=(e,t)=>new ZodPromise({type:e,typeName:Nt.ZodPromise,...processCreateParams(t)});class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Nt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,n={addIssue:e=>{addIssueToContext(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===s.type){const e=s.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Ye;const s=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===s.status?Ye:"dirty"===s.status||"dirty"===t.value?DIRTY(s.value):s}));{if("aborted"===t.value)return Ye;const s=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===s.status?Ye:"dirty"===s.status||"dirty"===t.value?DIRTY(s.value):s}}if("refinement"===s.type){const executeRefinement=e=>{const t=s.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Ye:("dirty"===e.status&&t.dirty(),executeRefinement(e.value),{status:t.value,value:e.value})}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>"aborted"===e.status?Ye:("dirty"===e.status&&t.dirty(),executeRefinement(e.value).then((()=>({status:t.value,value:e.value}))))))}if("transform"===s.type){if(!1===r.common.async){const e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!isValid(e))return e;const i=s.transform(e.value,n);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then((e=>isValid(e)?Promise.resolve(s.transform(e.value,n)).then((e=>({status:t.value,value:e}))):e))}Qe.assertNever(s)}}ZodEffects.create=(e,t,r)=>new ZodEffects({schema:e,typeName:Nt.ZodEffects,effect:t,...processCreateParams(r)}),ZodEffects.createWithPreprocess=(e,t,r)=>new ZodEffects({schema:t,effect:{type:"preprocess",transform:e},typeName:Nt.ZodEffects,...processCreateParams(r)});class ZodOptional extends ZodType{_parse(e){return this._getType(e)===Ke.undefined?OK(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodOptional.create=(e,t)=>new ZodOptional({innerType:e,typeName:Nt.ZodOptional,...processCreateParams(t)});class ZodNullable extends ZodType{_parse(e){return this._getType(e)===Ke.null?OK(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ZodNullable.create=(e,t)=>new ZodNullable({innerType:e,typeName:Nt.ZodNullable,...processCreateParams(t)});class ZodDefault extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===Ke.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}ZodDefault.create=(e,t)=>new ZodDefault({innerType:e,typeName:Nt.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...processCreateParams(t)});class ZodCatch extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return isAsync(s)?s.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})}))):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(e,t)=>new ZodCatch({innerType:e,typeName:Nt.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...processCreateParams(t)});class ZodNaN extends ZodType{_parse(e){if(this._getType(e)!==Ke.nan){const t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:He.invalid_type,expected:Ke.nan,received:t.parsedType}),Ye}return{status:"valid",value:e.data}}}ZodNaN.create=e=>new ZodNaN({typeName:Nt.ZodNaN,...processCreateParams(e)});const vt=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Ye:"dirty"===e.status?(t.dirty(),DIRTY(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})()}{const e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?Ye:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ZodPipeline({in:e,out:t,typeName:Nt.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(e){const t=this._def.innerType._parse(e),freeze=e=>(isValid(e)&&(e.value=Object.freeze(e.value)),e);return isAsync(t)?t.then((e=>freeze(e))):freeze(t)}unwrap(){return this._def.innerType}}function cleanParams(e,t){const r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function custom(e,t={},r){return e?ZodAny.create().superRefine(((s,n)=>{var i,o;const a=e(s);if(a instanceof Promise)return a.then((e=>{var i,o;if(!e){const e=cleanParams(t,s),a=null===(o=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===o||o;n.addIssue({code:"custom",...e,fatal:a})}}));if(!a){const e=cleanParams(t,s),a=null===(o=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===o||o;n.addIssue({code:"custom",...e,fatal:a})}})):ZodAny.create()}ZodReadonly.create=(e,t)=>new ZodReadonly({innerType:e,typeName:Nt.ZodReadonly,...processCreateParams(t)});const bt={object:ZodObject.lazycreate};var Nt;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(Nt||(Nt={}));const _t=ZodString.create,xt=ZodNumber.create,Tt=ZodNaN.create,kt=ZodBigInt.create,At=ZodBoolean.create,Et=ZodDate.create,It=ZodSymbol.create,St=ZodUndefined.create,Ot=ZodNull.create,Ct=ZodAny.create,Rt=ZodUnknown.create,Dt=ZodNever.create,Ut=ZodVoid.create,Bt=ZodArray.create,Pt=ZodObject.create,Lt=ZodObject.strictCreate,qt=ZodUnion.create,Wt=ZodDiscriminatedUnion.create,$t=ZodIntersection.create,Mt=ZodTuple.create,zt=ZodRecord.create,jt=ZodMap.create,Zt=ZodSet.create,Vt=ZodFunction.create,Ft=ZodLazy.create,Qt=ZodLiteral.create,Jt=ZodEnum.create,Kt=ZodNativeEnum.create,Ht=ZodPromise.create,Gt=ZodEffects.create,Yt=ZodOptional.create,Xt=ZodNullable.create,er=ZodEffects.createWithPreprocess,tr=ZodPipeline.create,rr={string:e=>ZodString.create({...e,coerce:!0}),number:e=>ZodNumber.create({...e,coerce:!0}),boolean:e=>ZodBoolean.create({...e,coerce:!0}),bigint:e=>ZodBigInt.create({...e,coerce:!0}),date:e=>ZodDate.create({...e,coerce:!0})},sr=Ye;var nr=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:function(e){Ge=e},getErrorMap:getErrorMap,makeIssue:makeIssue,EMPTY_PATH:[],addIssueToContext:addIssueToContext,ParseStatus:ParseStatus,INVALID:Ye,DIRTY:DIRTY,OK:OK,isAborted:isAborted,isDirty:isDirty,isValid:isValid,isAsync:isAsync,get util(){return Qe},get objectUtil(){return Je},ZodParsedType:Ke,getParsedType:getParsedType,ZodType:ZodType,datetimeRegex:datetimeRegex,ZodString:ZodString,ZodNumber:ZodNumber,ZodBigInt:ZodBigInt,ZodBoolean:ZodBoolean,ZodDate:ZodDate,ZodSymbol:ZodSymbol,ZodUndefined:ZodUndefined,ZodNull:ZodNull,ZodAny:ZodAny,ZodUnknown:ZodUnknown,ZodNever:ZodNever,ZodVoid:ZodVoid,ZodArray:ZodArray,ZodObject:ZodObject,ZodUnion:ZodUnion,ZodDiscriminatedUnion:ZodDiscriminatedUnion,ZodIntersection:ZodIntersection,ZodTuple:ZodTuple,ZodRecord:ZodRecord,ZodMap:ZodMap,ZodSet:ZodSet,ZodFunction:ZodFunction,ZodLazy:ZodLazy,ZodLiteral:ZodLiteral,ZodEnum:ZodEnum,ZodNativeEnum:ZodNativeEnum,ZodPromise:ZodPromise,ZodEffects:ZodEffects,ZodTransformer:ZodEffects,ZodOptional:ZodOptional,ZodNullable:ZodNullable,ZodDefault:ZodDefault,ZodCatch:ZodCatch,ZodNaN:ZodNaN,BRAND:vt,ZodBranded:ZodBranded,ZodPipeline:ZodPipeline,ZodReadonly:ZodReadonly,custom:custom,Schema:ZodType,ZodSchema:ZodType,late:bt,get ZodFirstPartyTypeKind(){return Nt},coerce:rr,any:Ct,array:Bt,bigint:kt,boolean:At,date:Et,discriminatedUnion:Wt,effect:Gt,enum:Jt,function:Vt,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>custom((t=>t instanceof e),t),intersection:$t,lazy:Ft,literal:Qt,map:jt,nan:Tt,nativeEnum:Kt,never:Dt,null:Ot,nullable:Xt,number:xt,object:Pt,oboolean:()=>At().optional(),onumber:()=>xt().optional(),optional:Yt,ostring:()=>_t().optional(),pipeline:tr,preprocess:er,promise:Ht,record:zt,set:Zt,strictObject:Lt,string:_t,symbol:It,transformer:Gt,tuple:Mt,undefined:St,union:qt,unknown:Rt,void:Ut,NEVER:sr,ZodIssueCode:He,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:ZodError});const getDate=(e,t="ms")=>new Date(Date.now()+("sec"===t?1e3*e:e));function getAlphabet(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function base64Encode(e,t,r){let s="",n=0,i=0;for(const r of e)for(n=n<<8|r,i+=8;i>=6;)i-=6,s+=t[n>>i&63];if(i>0&&(s+=t[n<<6-i&63]),r){const e=(4-s.length%4)%4;s+="=".repeat(e)}return s}function base64Decode(e,t){const r=new Map;for(let e=0;e<t.length;e++)r.set(t[e],e);const s=[];let n=0,i=0;for(const t of e){if("="===t)break;const e=r.get(t);if(void 0===e)throw new Error(`Invalid Base64 character: ${t}`);n=n<<6|e,i+=6,i>=8&&(i-=8,s.push(n>>i&255))}return Uint8Array.from(s)}const ir={encode(e,t={}){const r=getAlphabet(!1);return base64Encode("string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e),r,t.padding??!0)},decode(e){"string"!=typeof e&&(e=(new TextDecoder).decode(e));const t=e.includes("-")||e.includes("_");return base64Decode(e,getAlphabet(t))}},or={encode(e,t={}){const r=getAlphabet(!0);return base64Encode("string"==typeof e?(new TextEncoder).encode(e):new Uint8Array(e),r,t.padding??!0)},decode(e){const t=e.includes("-")||e.includes("_");return base64Decode(e,getAlphabet(t))}},hex_encode=e=>{if("string"==typeof e&&(e=(new TextEncoder).encode(e)),0===e.byteLength)return"";const t=new Uint8Array(e);let r="";for(const e of t)r+=e.toString(16).padStart(2,"0");return r},hex_decode=e=>{if(!e)return"";if("string"==typeof e){if(e.length%2!=0)throw new Error("Invalid hexadecimal string");if(!new RegExp("^[0123456789abcdef]+$").test(e))throw new Error("Invalid hexadecimal string");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.slice(r,r+2),16);return(new TextDecoder).decode(t)}return(new TextDecoder).decode(e)},createHMAC=(t="SHA-256",r="none")=>{const s={importKey:async(r,s)=>e.importKey("raw","string"==typeof r?(new TextEncoder).encode(r):r,{name:"HMAC",hash:{name:t}},!1,[s]),sign:async(t,n)=>{"string"==typeof t&&(t=await s.importKey(t,"sign"));const i=await e.sign("HMAC",t,"string"==typeof n?(new TextEncoder).encode(n):n);return"hex"===r?hex_encode(i):"base64"===r||"base64url"===r||"base64urlnopad"===r?or.encode(i,{padding:"base64urlnopad"!==r}):i},verify:async(t,n,i)=>("string"==typeof t&&(t=await s.importKey(t,"verify")),"hex"===r&&(i=hex_decode(i)),"base64"!==r&&"base64url"!==r&&"base64urlnopad"!==r||(i=await ir.decode(i)),e.verify("HMAC",t,"string"==typeof i?(new TextEncoder).encode(i):i,"string"==typeof n?(new TextEncoder).encode(n):n))};return s};function safeJSONParse(e){try{return JSON.parse(e,(function(e,t){if("string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(t)){const e=new Date(t);if(!isNaN(e.getTime()))return e}return t}))}catch{return null}}const createTime=(e,t)=>{const r={t:`${e}${t}`,value:e,tFormat:t,toMilliseconds:()=>{switch(t){case"ms":return e;case"s":return 1e3*e;case"m":return 1e3*e*60;case"h":return 1e3*e*60*60;case"d":return 1e3*e*60*60*24;case"w":return 1e3*e*60*60*24*7;case"y":return 1e3*e*60*60*24*365}},toSeconds:()=>r.toMilliseconds()/1e3,toMinutes:()=>r.toSeconds()/60,toHours:()=>r.toMinutes()/60,toDays:()=>r.toHours()/24,toWeeks:()=>r.toDays()/7,toYears:()=>r.toDays()/365,getDate:()=>new Date(Date.now()+r.toMilliseconds()),add:e=>{const t="string"==typeof e?parseTime(e).toMilliseconds():e.toMilliseconds();return createTime(r.toMilliseconds()+t,"ms")},subtract:e=>{const t="string"==typeof e?parseTime(e).toMilliseconds():e.toMilliseconds();return createTime(r.toMilliseconds()-t,"ms")},multiply:e=>createTime(r.toMilliseconds()*e,"ms"),divide:e=>createTime(r.toMilliseconds()/e,"ms"),equals:e=>{const t="string"==typeof e?parseTime(e).toMilliseconds():e.toMilliseconds();return r.toMilliseconds()===t},lessThan:e=>{const t="string"==typeof e?parseTime(e).toMilliseconds():e.toMilliseconds();return r.toMilliseconds()<t},greaterThan:e=>{const t="string"==typeof e?parseTime(e).toMilliseconds():e.toMilliseconds();return r.toMilliseconds()>t},format:e=>{const t=r.getDate();return e.replace(/YYYY|MM|DD|HH|mm|ss/g,(e=>{switch(e){case"YYYY":return t.getFullYear().toString();case"MM":return(t.getMonth()+1).toString().padStart(2,"0");case"DD":return t.getDate().toString().padStart(2,"0");case"HH":return t.getHours().toString().padStart(2,"0");case"mm":return t.getMinutes().toString().padStart(2,"0");case"ss":return t.getSeconds().toString().padStart(2,"0");default:return e}}))},fromNow:()=>{const e=r.toMilliseconds();return e<0?r.ago():e<1e3?"in a few seconds":e<6e4?`in ${Math.round(e/1e3)} seconds`:e<36e5?`in ${Math.round(e/6e4)} minutes`:e<864e5?`in ${Math.round(e/36e5)} hours`:e<6048e5?`in ${Math.round(e/864e5)} days`:e<26298e5?`in ${Math.round(e/6048e5)} weeks`:e<315576e5?`in ${Math.round(e/26298e5)} months`:`in ${Math.round(e/315576e5)} years`},ago:()=>{const e=-r.toMilliseconds();return e<0?r.fromNow():e<1e3?"a few seconds ago":e<6e4?`${Math.round(e/1e3)} seconds ago`:e<36e5?`${Math.round(e/6e4)} minutes ago`:e<864e5?`${Math.round(e/36e5)} hours ago`:e<6048e5?`${Math.round(e/864e5)} days ago`:e<26298e5?`${Math.round(e/6048e5)} weeks ago`:e<315576e5?`${Math.round(e/26298e5)} months ago`:`${Math.round(e/315576e5)} years ago`}};return r},parseTime=e=>{const t=e.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!t)throw new Error("Invalid time format");return createTime(parseInt(t[1]),t[2])};function createCookieGetter(e){const s=(void 0!==e.advanced?.useSecureCookies?e.advanced?.useSecureCookies:void 0!==e.baseURL?!!e.baseURL.startsWith("https://"):t)?"__Secure-":"",n=!!e.advanced?.crossSubDomainCookies?.enabled,i=n?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(n&&!i)throw new r("baseURL is required when crossSubdomainCookies are enabled");return function(t,r={}){const o=e.advanced?.cookiePrefix||"better-auth",a=e.advanced?.cookies?.[t]?.name||`${o}.${t}`,d=e.advanced?.cookies?.[t]?.attributes;return{name:`${s}${a}`,attributes:{secure:!!s,sameSite:"lax",path:"/",httpOnly:!0,...n?{domain:i}:{},...e.advanced?.defaultCookieAttributes,...r,...d}}}}async function setCookieCache(e,t){const s=e.context.options.session?.cookieCache?.enabled;if(s){const s={session:Object.entries(t.session).reduce(((t,[r,s])=>{const n=e.context.options.session?.additionalFields?.[r];return n&&!1===n.returned||(t[r]=s),t}),{}),user:t.user},n=or.encode(JSON.stringify({session:s,expiresAt:getDate(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await createHMAC("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...s,expiresAt:getDate(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime()}))}),{padding:!1});if(n.length>4093)throw new r("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,n,e.context.authCookies.sessionData.options)}}async function setSessionCookie(e,t,r,s){const n=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);r=void 0!==r?r:!!n;const i=e.context.authCookies.sessionToken.options,o=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...i,maxAge:o,...s}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await setCookieCache(e,t),e.context.setNewSession(t),e.context.options.secondaryStorage&&await(e.context.secondaryStorage?.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3)))}function deleteSessionCookie(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}const ar=crypto,isCryptoKey=e=>e instanceof CryptoKey,dr=new TextEncoder,cr=new TextDecoder;function concat(...e){const t=e.reduce(((e,{length:t})=>e+t),0),r=new Uint8Array(t);let s=0;for(const t of e)r.set(t,s),s+=t.length;return r}const encode=e=>(e=>{let t=e;"string"==typeof t&&(t=dr.encode(t));const r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))})(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),decode$1=e=>{let t=e;t instanceof Uint8Array&&(t=cr.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return(e=>{const t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r})(t)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class JOSEError extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}JOSEError.code="ERR_JOSE_GENERIC";class JWTClaimValidationFailed extends JOSEError{constructor(e,t,r="unspecified",s="unspecified"){super(e,{cause:{claim:r,reason:s,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=s,this.payload=t}}JWTClaimValidationFailed.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class JWTExpired extends JOSEError{constructor(e,t,r="unspecified",s="unspecified"){super(e,{cause:{claim:r,reason:s,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=s,this.payload=t}}JWTExpired.code="ERR_JWT_EXPIRED";class JOSEAlgNotAllowed extends JOSEError{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}JOSEAlgNotAllowed.code="ERR_JOSE_ALG_NOT_ALLOWED";class JOSENotSupported extends JOSEError{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}JOSENotSupported.code="ERR_JOSE_NOT_SUPPORTED";(class extends JOSEError{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}).code="ERR_JWE_DECRYPTION_FAILED";(class extends JOSEError{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}).code="ERR_JWE_INVALID";class JWSInvalid extends JOSEError{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}JWSInvalid.code="ERR_JWS_INVALID";class JWTInvalid extends JOSEError{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}JWTInvalid.code="ERR_JWT_INVALID";(class extends JOSEError{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}).code="ERR_JWK_INVALID";class JWKSInvalid extends JOSEError{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}JWKSInvalid.code="ERR_JWKS_INVALID";class JWKSNoMatchingKey extends JOSEError{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}JWKSNoMatchingKey.code="ERR_JWKS_NO_MATCHING_KEY";class JWKSMultipleMatchingKeys extends JOSEError{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}JWKSMultipleMatchingKeys.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class JWKSTimeout extends JOSEError{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}JWKSTimeout.code="ERR_JWKS_TIMEOUT";class JWSSignatureVerificationFailed extends JOSEError{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}function unusable(e,t="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function isAlgorithm(e,t){return e.name===t}function getHashLength(e){return parseInt(e.name.slice(4),10)}function checkSigCryptoKey(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!isAlgorithm(e.algorithm,"HMAC"))throw unusable("HMAC");const r=parseInt(t.slice(2),10);if(getHashLength(e.algorithm.hash)!==r)throw unusable(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!isAlgorithm(e.algorithm,"RSASSA-PKCS1-v1_5"))throw unusable("RSASSA-PKCS1-v1_5");const r=parseInt(t.slice(2),10);if(getHashLength(e.algorithm.hash)!==r)throw unusable(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!isAlgorithm(e.algorithm,"RSA-PSS"))throw unusable("RSA-PSS");const r=parseInt(t.slice(2),10);if(getHashLength(e.algorithm.hash)!==r)throw unusable(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw unusable("Ed25519 or Ed448");break;case"Ed25519":if(!isAlgorithm(e.algorithm,"Ed25519"))throw unusable("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!isAlgorithm(e.algorithm,"ECDSA"))throw unusable("ECDSA");const r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw unusable(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}!function(e,t){if(t.length&&!t.some((t=>e.usages.includes(t)))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){const r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw new TypeError(e)}}(e,r)}function message(e,t,...r){if((r=r.filter(Boolean)).length>2){const t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}JWSSignatureVerificationFailed.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";const invalidKeyInput=(e,...t)=>message("Key must be ",e,...t);function withAlg(e,t,...r){return message(`Key for the ${e} algorithm must be `,t,...r)}const isKeyLike=e=>!!isCryptoKey(e)||"KeyObject"===e?.[Symbol.toStringTag],ur=["CryptoKey"],isDisjoint=(...e)=>{const t=e.filter(Boolean);if(0===t.length||1===t.length)return!0;let r;for(const e of t){const t=Object.keys(e);if(r&&0!==r.size)for(const e of t){if(r.has(e))return!1;r.add(e)}else r=new Set(t)}return!0};function isObject$1(e){if("object"!=typeof(t=e)||null===t||"[object Object]"!==Object.prototype.toString.call(e))return!1;var t;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}const checkKeyLength=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){const{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw new TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function isJWK(e){return isObject$1(e)&&"string"==typeof e.kty}const parse=async e=>{if(!e.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new JOSENotSupported('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new JOSENotSupported('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),s=[t,e.ext??!1,e.key_ops??r],n={...e};return delete n.alg,delete n.use,ar.subtle.importKey("jwk",n,...s)},exportKeyValue=e=>decode$1(e);let lr,pr;const isKeyObject=e=>"KeyObject"===e?.[Symbol.toStringTag],importAndCache=async(e,t,r,s,n=!1)=>{let i=e.get(t);if(i?.[s])return i[s];const o=await parse({...r,alg:s});return n&&Object.freeze(t),i?i[s]=o:e.set(t,{[s]:o}),o},normalize_normalizePublicKey=(e,t)=>{if(isKeyObject(e)){let r=e.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?exportKeyValue(r.k):(pr||(pr=new WeakMap),importAndCache(pr,e,r,t))}if(isJWK(e)){if(e.k)return decode$1(e.k);pr||(pr=new WeakMap);return importAndCache(pr,e,e,t,!0)}return e},normalize_normalizePrivateKey=(e,t)=>{if(isKeyObject(e)){let r=e.export({format:"jwk"});return r.k?exportKeyValue(r.k):(lr||(lr=new WeakMap),importAndCache(lr,e,r,t))}if(isJWK(e)){if(e.k)return decode$1(e.k);lr||(lr=new WeakMap);return importAndCache(lr,e,e,t,!0)}return e};async function importJWK(e,t){if(!isObject$1(e))throw new TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw new TypeError('missing "k" (Key Value) Parameter value');return decode$1(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new JOSENotSupported('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return parse({...e,alg:t});default:throw new JOSENotSupported('Unsupported "kty" (Key Type) Parameter value')}}const tag=e=>e?.[Symbol.toStringTag],jwkMatchesOp=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw new TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&!0!==t.key_ops.includes?.(r))throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw new TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},symmetricTypeCheck=(e,t,r,s)=>{if(!(t instanceof Uint8Array)){if(s&&isJWK(t)){if(function(e){return isJWK(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&jwkMatchesOp(e,t,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!isKeyLike(t))throw new TypeError(withAlg(e,t,...ur,"Uint8Array",s?"JSON Web Key":null));if("secret"!==t.type)throw new TypeError(`${tag(t)} instances for symmetric algorithms must be of type "secret"`)}};function checkKeyType(e,t,r,s){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?symmetricTypeCheck(t,r,s,e):((e,t,r,s)=>{if(s&&isJWK(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&jwkMatchesOp(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&jwkMatchesOp(e,t,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!isKeyLike(t))throw new TypeError(withAlg(e,t,...ur,s?"JSON Web Key":null));if("secret"===t.type)throw new TypeError(`${tag(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw new TypeError(`${tag(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw new TypeError(`${tag(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw new TypeError(`${tag(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw new TypeError(`${tag(t)} instances for asymmetric algorithm encryption must be of type "public"`)})(t,r,s,e)}checkKeyType.bind(void 0,!1);const hr=checkKeyType.bind(void 0,!0);function validateCrit(e,t,r,s,n){if(void 0!==n.crit&&void 0===s?.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||void 0===s.crit)return new Set;if(!Array.isArray(s.crit)||0===s.crit.length||s.crit.some((e=>"string"!=typeof e||0===e.length)))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t;for(const t of s.crit){if(!i.has(t))throw new JOSENotSupported(`Extension Header Parameter "${t}" is not recognized`);if(void 0===n[t])throw new e(`Extension Header Parameter "${t}" is missing`);if(i.get(t)&&void 0===s[t])throw new e(`Extension Header Parameter "${t}" MUST be integrity protected`)}return new Set(s.crit)}function subtleDsa(e,t){const r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:t.name};default:throw new JOSENotSupported(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function getCryptoKey(e,t,r){if("sign"===r&&(t=await normalize_normalizePrivateKey(t,e)),"verify"===r&&(t=await normalize_normalizePublicKey(t,e)),isCryptoKey(t))return checkSigCryptoKey(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw new TypeError(invalidKeyInput(t,...ur));return ar.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(invalidKeyInput(t,...ur,"Uint8Array","JSON Web Key"))}async function flattenedVerify(e,t,r){if(!isObject$1(e))throw new JWSInvalid("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new JWSInvalid('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new JWSInvalid("JWS Protected Header incorrect type");if(void 0===e.payload)throw new JWSInvalid("JWS Payload missing");if("string"!=typeof e.signature)throw new JWSInvalid("JWS Signature missing or incorrect type");if(void 0!==e.header&&!isObject$1(e.header))throw new JWSInvalid("JWS Unprotected Header incorrect type");let s={};if(e.protected)try{const t=decode$1(e.protected);s=JSON.parse(cr.decode(t))}catch{throw new JWSInvalid("JWS Protected Header is invalid")}if(!isDisjoint(s,e.header))throw new JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const n={...s,...e.header};let i=!0;if(validateCrit(JWSInvalid,new Map([["b64",!0]]),r?.crit,s,n).has("b64")&&(i=s.b64,"boolean"!=typeof i))throw new JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=n;if("string"!=typeof o||!o)throw new JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');const a=r&&((e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some((e=>"string"!=typeof e))))throw new TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)})("algorithms",r.algorithms);if(a&&!a.has(o))throw new JOSEAlgNotAllowed('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof e.payload)throw new JWSInvalid("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new JWSInvalid("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t?(t=await t(s,e),d=!0,hr(o,t,"verify"),isJWK(t)&&(t=await importJWK(t,o))):hr(o,t,"verify");const c=concat(dr.encode(e.protected??""),dr.encode("."),"string"==typeof e.payload?dr.encode(e.payload):e.payload);let u;try{u=decode$1(e.signature)}catch{throw new JWSInvalid("Failed to base64url decode the signature")}const l=await(async(e,t,r,s)=>{const n=await getCryptoKey(e,t,"verify");checkKeyLength(e,n);const i=subtleDsa(e,n.algorithm);try{return await ar.subtle.verify(i,n,r,s)}catch{return!1}})(o,t,u,c);if(!l)throw new JWSSignatureVerificationFailed;let p;if(i)try{p=decode$1(e.payload)}catch{throw new JWSInvalid("Failed to base64url decode the payload")}else p="string"==typeof e.payload?dr.encode(e.payload):e.payload;const h={payload:p};return void 0!==e.protected&&(h.protectedHeader=s),void 0!==e.header&&(h.unprotectedHeader=e.header),d?{...h,key:t}:h}const epoch=e=>Math.floor(e.getTime()/1e3),mr=86400,fr=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,secs=e=>{const t=fr.exec(e);if(!t||t[4]&&t[1])throw new TypeError("Invalid time period format");const r=parseFloat(t[2]);let s;switch(t[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":s=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":s=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":s=Math.round(3600*r);break;case"day":case"days":case"d":s=Math.round(r*mr);break;case"week":case"weeks":case"w":s=Math.round(604800*r);break;default:s=Math.round(31557600*r)}return"-"===t[1]||"ago"===t[4]?-s:s},normalizeTyp=e=>e.toLowerCase().replace(/^application\//,""),jwtPayload=(e,t,r={})=>{let s;try{s=JSON.parse(cr.decode(t))}catch{}if(!isObject$1(s))throw new JWTInvalid("JWT Claims Set must be a top-level JSON object");const{typ:n}=r;if(n&&("string"!=typeof e.typ||normalizeTyp(e.typ)!==normalizeTyp(n)))throw new JWTClaimValidationFailed('unexpected "typ" JWT header value',s,"typ","check_failed");const{requiredClaims:i=[],issuer:o,subject:a,audience:d,maxTokenAge:c}=r,u=[...i];void 0!==c&&u.push("iat"),void 0!==d&&u.push("aud"),void 0!==a&&u.push("sub"),void 0!==o&&u.push("iss");for(const e of new Set(u.reverse()))if(!(e in s))throw new JWTClaimValidationFailed(`missing required "${e}" claim`,s,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(s.iss))throw new JWTClaimValidationFailed('unexpected "iss" claim value',s,"iss","check_failed");if(a&&s.sub!==a)throw new JWTClaimValidationFailed('unexpected "sub" claim value',s,"sub","check_failed");if(d&&(l=s.aud,p="string"==typeof d?[d]:d,!("string"==typeof l?p.includes(l):Array.isArray(l)&&p.some(Set.prototype.has.bind(new Set(l))))))throw new JWTClaimValidationFailed('unexpected "aud" claim value',s,"aud","check_failed");var l,p;let h;switch(typeof r.clockTolerance){case"string":h=secs(r.clockTolerance);break;case"number":h=r.clockTolerance;break;case"undefined":h=0;break;default:throw new TypeError("Invalid clockTolerance option type")}const{currentDate:m}=r,f=epoch(m||new Date);if((void 0!==s.iat||c)&&"number"!=typeof s.iat)throw new JWTClaimValidationFailed('"iat" claim must be a number',s,"iat","invalid");if(void 0!==s.nbf){if("number"!=typeof s.nbf)throw new JWTClaimValidationFailed('"nbf" claim must be a number',s,"nbf","invalid");if(s.nbf>f+h)throw new JWTClaimValidationFailed('"nbf" claim timestamp check failed',s,"nbf","check_failed")}if(void 0!==s.exp){if("number"!=typeof s.exp)throw new JWTClaimValidationFailed('"exp" claim must be a number',s,"exp","invalid");if(s.exp<=f-h)throw new JWTExpired('"exp" claim timestamp check failed',s,"exp","check_failed")}if(c){const e=f-s.iat;if(e-h>("number"==typeof c?c:secs(c)))throw new JWTExpired('"iat" claim timestamp check failed (too far in the past)',s,"iat","check_failed");if(e<0-h)throw new JWTClaimValidationFailed('"iat" claim timestamp check failed (it should be in the past)',s,"iat","check_failed")}return s};async function jwtVerify(e,t,r){const s=await async function(e,t,r){if(e instanceof Uint8Array&&(e=cr.decode(e)),"string"!=typeof e)throw new JWSInvalid("Compact JWS must be a string or Uint8Array");const{0:s,1:n,2:i,length:o}=e.split(".");if(3!==o)throw new JWSInvalid("Invalid Compact JWS");const a=await flattenedVerify({payload:n,protected:s,signature:i},t,r),d={payload:a.payload,protectedHeader:a.protectedHeader};return"function"==typeof t?{...d,key:a.key}:d}(e,t,r);if(s.protectedHeader.crit?.includes("b64")&&!1===s.protectedHeader.b64)throw new JWTInvalid("JWTs MUST NOT use unencoded payload");const n={payload:jwtPayload(s.protectedHeader,s.payload,r),protectedHeader:s.protectedHeader};return"function"==typeof t?{...n,key:s.key}:n}class FlattenedSign{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){if(!this._protectedHeader&&!this._unprotectedHeader)throw new JWSInvalid("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!isDisjoint(this._protectedHeader,this._unprotectedHeader))throw new JWSInvalid("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const r={...this._protectedHeader,...this._unprotectedHeader};let s=!0;if(validateCrit(JWSInvalid,new Map([["b64",!0]]),t?.crit,this._protectedHeader,r).has("b64")&&(s=this._protectedHeader.b64,"boolean"!=typeof s))throw new JWSInvalid('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:n}=r;if("string"!=typeof n||!n)throw new JWSInvalid('JWS "alg" (Algorithm) Header Parameter missing or invalid');hr(n,e,"sign");let i,o=this._payload;s&&(o=dr.encode(encode(o))),i=this._protectedHeader?dr.encode(encode(JSON.stringify(this._protectedHeader))):dr.encode("");const a=concat(i,dr.encode("."),o),d=await(async(e,t,r)=>{const s=await getCryptoKey(e,t,"sign");checkKeyLength(e,s);const n=await ar.subtle.sign(subtleDsa(e,s.algorithm),s,r);return new Uint8Array(n)})(n,e,a),c={signature:encode(d),payload:""};return s&&(c.payload=cr.decode(o)),this._unprotectedHeader&&(c.header=this._unprotectedHeader),this._protectedHeader&&(c.protected=cr.decode(i)),c}}class CompactSign{constructor(e){this._flattened=new FlattenedSign(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){const r=await this._flattened.sign(e,t);if(void 0===r.payload)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}function validateInput(e,t){if(!Number.isFinite(t))throw new TypeError(`Invalid ${e} input`);return t}class ProduceJWT{constructor(e={}){if(!isObject$1(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:validateInput("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:validateInput("setNotBefore",epoch(e))}:this._payload={...this._payload,nbf:epoch(new Date)+secs(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:validateInput("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:validateInput("setExpirationTime",epoch(e))}:this._payload={...this._payload,exp:epoch(new Date)+secs(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:epoch(new Date)}:e instanceof Date?this._payload={...this._payload,iat:validateInput("setIssuedAt",epoch(e))}:this._payload="string"==typeof e?{...this._payload,iat:validateInput("setIssuedAt",epoch(new Date)+secs(e))}:{...this._payload,iat:validateInput("setIssuedAt",e)},this}}class SignJWT extends ProduceJWT{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){const r=new CompactSign(dr.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new JWTInvalid("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}function isJWKLike(e){return isObject$1(e)}function clone(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class LocalJWKSet{constructor(e){if(this._cached=new WeakMap,!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(isJWKLike)}(e))throw new JWKSInvalid("JSON Web Key Set malformed");this._jwks=clone(e)}async getKey(e,t){const{alg:r,kid:s}={...e,...t?.header},n=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(r),i=this._jwks.keys.filter((e=>{let t=n===e.kty;if(t&&"string"==typeof s&&(t=s===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t})),{0:o,length:a}=i;if(0===a)throw new JWKSNoMatchingKey;if(1!==a){const e=new JWKSMultipleMatchingKeys,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(const e of i)try{yield await importWithAlgCache(t,e,r)}catch{}},e}return importWithAlgCache(this._cached,o,r)}}async function importWithAlgCache(e,t,r){const s=e.get(t)||e.set(t,{}).get(t);if(void 0===s[r]){const e=await importJWK({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new JWKSInvalid("JSON Web Key Set members must be public keys");s[r]=e}return s[r]}function createLocalJWKSet(e){const t=new LocalJWKSet(e),localJWKSet=async(e,r)=>t.getKey(e,r);return Object.defineProperties(localJWKSet,{jwks:{value:()=>clone(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),localJWKSet}let yr;if("undefined"==typeof navigator||!navigator.userAgent?.startsWith?.("Mozilla/5.0 ")){yr=`${"jose"}/${"v5.10.0"}`}const gr=Symbol();class RemoteJWKSet{constructor(e,t){if(!(e instanceof URL))throw new TypeError("url must be an instance of URL");var r,s;this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,void 0!==t?.[gr]&&(this._cache=t?.[gr],r=t?.[gr],s=this._cacheMaxAge,"object"==typeof r&&null!==r&&"uat"in r&&"number"==typeof r.uat&&!(Date.now()-r.uat>=s)&&"jwks"in r&&isObject$1(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,isObject$1)&&(this._jwksTimestamp=this._cache.uat,this._local=createLocalJWKSet(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);const e=new Headers(this._options.headers);yr&&!e.has("User-Agent")&&(e.set("User-Agent",yr),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=(async(e,t,r)=>{let s,n,i=!1;"function"==typeof AbortController&&(s=new AbortController,n=setTimeout((()=>{i=!0,s.abort()}),t));const o=await fetch(e.href,{signal:s?s.signal:void 0,redirect:"manual",headers:r.headers}).catch((e=>{if(i)throw new JWKSTimeout;throw e}));if(void 0!==n&&clearTimeout(n),200!==o.status)throw new JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await o.json()}catch{throw new JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}})(this._url,this._timeoutDuration,this._options).then((e=>{this._local=createLocalJWKSet(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0})).catch((e=>{throw this._pendingFetch=void 0,e}))),await this._pendingFetch}}const wr=decode$1;function decodeJwt(e){if("string"!=typeof e)throw new JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");const{1:t,length:r}=e.split(".");if(5===r)throw new JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(3!==r)throw new JWTInvalid("Invalid JWT");if(!t)throw new JWTInvalid("JWTs must contain a payload");let s,n;try{s=wr(t)}catch{throw new JWTInvalid("Failed to base64url decode the payload")}try{n=JSON.parse(cr.decode(s))}catch{throw new JWTInvalid("Failed to parse the decoded payload as JSON")}if(!isObject$1(n))throw new JWTInvalid("Invalid JWT Claims Set");return n}async function generateCodeChallenge(t){const r=await function(t){return{digest:async r=>{const s=new TextEncoder,n="string"==typeof r?s.encode(r):r;return await e.digest(t,n)}}}("SHA-256").digest(t);return or.encode(new Uint8Array(r),{padding:!1})}function getOAuth2Tokens(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?getDate(e.expires_in,"sec"):void 0,scopes:e?.scope?"string"==typeof e.scope?e.scope.split(" "):e.scope:[],idToken:e.id_token}}async function createAuthorizationURL({id:e,options:t,authorizationEndpoint:r,state:s,codeVerifier:n,scopes:i,claims:o,redirectURI:a,duration:d,prompt:c,accessType:u,responseType:l,display:p,loginHint:h,hd:m,responseMode:f,additionalParams:y,scopeJoiner:g}){const w=new URL(r);if(w.searchParams.set("response_type",l||"code"),w.searchParams.set("client_id",t.clientId),w.searchParams.set("state",s),w.searchParams.set("scope",i.join(g||" ")),w.searchParams.set("redirect_uri",t.redirectURI||a),d&&w.searchParams.set("duration",d),p&&w.searchParams.set("display",p),h&&w.searchParams.set("login_hint",h),c&&w.searchParams.set("prompt",c),m&&w.searchParams.set("hd",m),u&&w.searchParams.set("access_type",u),f&&w.searchParams.set("response_mode",f),n){const e=await generateCodeChallenge(n);w.searchParams.set("code_challenge_method","S256"),w.searchParams.set("code_challenge",e)}if(o){const e=o.reduce(((e,t)=>(e[t]=null,e)),{});w.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...e}}))}return y&&Object.entries(y).forEach((([e,t])=>{w.searchParams.set(e,t)})),w}async function validateAuthorizationCode({code:e,codeVerifier:t,redirectURI:r,options:n,tokenEndpoint:i,authentication:o,deviceId:a}){const d=new URLSearchParams,c={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth"};if(d.set("grant_type","authorization_code"),d.set("code",e),t&&d.set("code_verifier",t),n.clientKey&&d.set("client_key",n.clientKey),a&&d.set("device_id",a),d.set("redirect_uri",n.redirectURI||r),"basic"===o){const e=or.encode(`${n.clientId}:${n.clientSecret}`);c.authorization=`Basic ${e}`}else d.set("client_id",n.clientId),d.set("client_secret",n.clientSecret);const{data:u,error:l}=await s(i,{method:"POST",body:d,headers:c});if(l)throw l;return getOAuth2Tokens(u)}async function refreshAccessToken({refreshToken:e,options:t,tokenEndpoint:r,authentication:n,extraParams:i,grantType:o="refresh_token"}){const a=new URLSearchParams,d={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(a.set("grant_type",o),a.set("refresh_token",e),"basic"===n){const e=or.encode(`${t.clientId}:${t.clientSecret}`);d.authorization=`Basic ${e}`}else a.set("client_id",t.clientId),a.set("client_secret",t.clientSecret);if(i)for(const[e,t]of Object.entries(i))a.set(e,t);const{data:c,error:u}=await s(r,{method:"POST",body:a,headers:d});if(u)throw u;const l={accessToken:c.access_token,refreshToken:c.refresh_token,tokenType:c.token_type,scopes:c.scope?.split(" "),idToken:c.id_token};if(c.expires_in){const e=new Date;l.accessTokenExpiresAt=new Date(e.getTime()+1e3*c.expires_in)}return l}function anumber(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function abytes(e,...t){if(!((r=e)instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name))throw new Error("Uint8Array expected");var r;if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ahash(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");anumber(e.outputLen),anumber(e.blockLen)}function aexists(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function u32(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function createView(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function rotr(e,t){return e<<32-t|e>>>t}function rotl(e,t){return e<<t|e>>>32-t>>>0}const vr=(()=>68===new Uint8Array(new Uint32Array([287454020]).buffer)[0])();function byteSwap32(e){for(let r=0;r<e.length;r++)e[r]=(t=e[r])<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255;var t}const br=48,Nr=57,_r=65,xr=70,Tr=97,kr=102;function asciiToBase16(e){return e>=br&&e<=Nr?e-br:e>=_r&&e<=xr?e-(_r-10):e>=Tr&&e<=kr?e-(Tr-10):void 0}const nextTick=async()=>{};async function asyncLoop(e,t,r){let s=Date.now();for(let n=0;n<e;n++){r(n);const e=Date.now()-s;e>=0&&e<t||(await nextTick(),s+=e)}}function toBytes(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),abytes(e),e}class Hash{clone(){return this._cloneInto()}}function checkOpts(e,t){if(void 0!==t&&"[object Object]"!=={}.toString.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)}function wrapConstructor(e){const hashC=t=>e().update(toBytes(t)).digest(),t=e();return hashC.outputLen=t.outputLen,hashC.blockLen=t.blockLen,hashC.create=()=>e(),hashC}class HMAC extends Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ahash(e);const r=toBytes(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(r.length>s?e.create().update(r).digest():r);for(let e=0;e<n.length;e++)n[e]^=54;this.iHash.update(n),this.oHash=e.create();for(let e=0;e<n.length;e++)n[e]^=106;this.oHash.update(n),n.fill(0)}update(e){return aexists(this),this.iHash.update(e),this}digestInto(e){aexists(this),abytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:n,blockLen:i,outputLen:o}=this;return e.finished=s,e.destroyed=n,e.blockLen=i,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(e,t,r)=>new HMAC(e,t).update(r).digest();function pbkdf2(e,t,r,s){const{c:n,dkLen:i,DK:o,PRF:a,PRFSalt:d}=function(e,t,r,s){ahash(e);const n=checkOpts({dkLen:32,asyncTick:10},s),{c:i,dkLen:o,asyncTick:a}=n;if(anumber(i),anumber(o),anumber(a),i<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const d=toBytes(t),c=toBytes(r),u=new Uint8Array(o),l=hmac.create(e,d),p=l._cloneInto().update(c);return{c:i,dkLen:o,asyncTick:a,DK:u,PRF:l,PRFSalt:p}}(e,t,r,s);let c;const u=new Uint8Array(4),l=createView(u),p=new Uint8Array(a.outputLen);for(let e=1,t=0;t<i;e++,t+=a.outputLen){const r=o.subarray(t,t+a.outputLen);l.setInt32(0,e,!1),(c=d._cloneInto(c)).update(u).digestInto(p),r.set(p.subarray(0,r.length));for(let e=1;e<n;e++){a._cloneInto(c).update(p).digestInto(p);for(let e=0;e<r.length;e++)r[e]^=p[e]}}return function(e,t,r,s,n){return e.destroy(),t.destroy(),s&&s.destroy(),n.fill(0),r}(a,d,o,c,p)}function Maj(e,t,r){return e&t^e&r^t&r}hmac.create=(e,t)=>new HMAC(e,t);class HashMD extends Hash{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView(this.buffer)}update(e){aexists(this);const{view:t,buffer:r,blockLen:s}=this,n=(e=toBytes(e)).length;for(let i=0;i<n;){const o=Math.min(s-this.pos,n-i);if(o!==s)r.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===s&&(this.process(t,0),this.pos=0);else{const t=createView(e);for(;s<=n-i;i+=s)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){aexists(this),function(e,t){abytes(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:n}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>s-i&&(this.process(r,0),i=0);for(let e=i;e<s;e++)t[e]=0;!function(e,t,r,s){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,s);const n=BigInt(32),i=BigInt(4294967295),o=Number(r>>n&i),a=Number(r&i),d=s?4:0,c=s?0:4;e.setUint32(t+d,o,s),e.setUint32(t+c,a,s)}(r,s-8,BigInt(8*this.length),n),this.process(r,0);const o=createView(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const d=a/4,c=this.get();if(d>c.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<d;e++)o.setUint32(4*e,c[e],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:n,destroyed:i,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=i,s%t&&e.buffer.set(r),e}}const Ar=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Er=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ir=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=0|Er[0],this.B=0|Er[1],this.C=0|Er[2],this.D=0|Er[3],this.E=0|Er[4],this.F=0|Er[5],this.G=0|Er[6],this.H=0|Er[7]}get(){const{A:e,B:t,C:r,D:s,E:n,F:i,G:o,H:a}=this;return[e,t,r,s,n,i,o,a]}set(e,t,r,s,n,i,o,a){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|s,this.E=0|n,this.F=0|i,this.G=0|o,this.H=0|a}process(e,t){for(let r=0;r<16;r++,t+=4)Ir[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Ir[e-15],r=Ir[e-2],s=rotr(t,7)^rotr(t,18)^t>>>3,n=rotr(r,17)^rotr(r,19)^r>>>10;Ir[e]=n+Ir[e-7]+s+Ir[e-16]|0}let{A:r,B:s,C:n,D:i,E:o,F:a,G:d,H:c}=this;for(let e=0;e<64;e++){const t=c+(rotr(o,6)^rotr(o,11)^rotr(o,25))+((u=o)&a^~u&d)+Ar[e]+Ir[e]|0,l=(rotr(r,2)^rotr(r,13)^rotr(r,22))+Maj(r,s,n)|0;c=d,d=a,a=o,o=i+t|0,i=n,n=s,s=r,r=t+l|0}var u;r=r+this.A|0,s=s+this.B|0,n=n+this.C|0,i=i+this.D|0,o=o+this.E|0,a=a+this.F|0,d=d+this.G|0,c=c+this.H|0,this.set(r,s,n,i,o,a,d,c)}roundClean(){Ir.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Sr=wrapConstructor((()=>new SHA256));function XorAndSalsa(e,t,r,s,n,i){let o=e[t++]^r[s++],a=e[t++]^r[s++],d=e[t++]^r[s++],c=e[t++]^r[s++],u=e[t++]^r[s++],l=e[t++]^r[s++],p=e[t++]^r[s++],h=e[t++]^r[s++],m=e[t++]^r[s++],f=e[t++]^r[s++],y=e[t++]^r[s++],g=e[t++]^r[s++],w=e[t++]^r[s++],v=e[t++]^r[s++],b=e[t++]^r[s++],N=e[t++]^r[s++],_=o,x=a,T=d,k=c,A=u,E=l,I=p,S=h,O=m,R=f,D=y,U=g,B=w,P=v,L=b,q=N;for(let e=0;e<8;e+=2)A^=rotl(_+B|0,7),O^=rotl(A+_|0,9),B^=rotl(O+A|0,13),_^=rotl(B+O|0,18),R^=rotl(E+x|0,7),P^=rotl(R+E|0,9),x^=rotl(P+R|0,13),E^=rotl(x+P|0,18),L^=rotl(D+I|0,7),T^=rotl(L+D|0,9),I^=rotl(T+L|0,13),D^=rotl(I+T|0,18),k^=rotl(q+U|0,7),S^=rotl(k+q|0,9),U^=rotl(S+k|0,13),q^=rotl(U+S|0,18),x^=rotl(_+k|0,7),T^=rotl(x+_|0,9),k^=rotl(T+x|0,13),_^=rotl(k+T|0,18),I^=rotl(E+A|0,7),S^=rotl(I+E|0,9),A^=rotl(S+I|0,13),E^=rotl(A+S|0,18),U^=rotl(D+R|0,7),O^=rotl(U+D|0,9),R^=rotl(O+U|0,13),D^=rotl(R+O|0,18),B^=rotl(q+L|0,7),P^=rotl(B+q|0,9),L^=rotl(P+B|0,13),q^=rotl(L+P|0,18);n[i++]=o+_|0,n[i++]=a+x|0,n[i++]=d+T|0,n[i++]=c+k|0,n[i++]=u+A|0,n[i++]=l+E|0,n[i++]=p+I|0,n[i++]=h+S|0,n[i++]=m+O|0,n[i++]=f+R|0,n[i++]=y+D|0,n[i++]=g+U|0,n[i++]=w+B|0,n[i++]=v+P|0,n[i++]=b+L|0,n[i++]=N+q|0}function BlockMix(e,t,r,s,n){let i=s+0,o=s+16*n;for(let s=0;s<16;s++)r[o+s]=e[t+16*(2*n-1)+s];for(let s=0;s<n;s++,i+=16,t+=16)XorAndSalsa(r,o,e,t,r,i),s>0&&(o+=16),XorAndSalsa(r,i,e,t+=16,r,o)}async function scryptAsync(e,t,r){const{N:s,r:n,p:i,dkLen:o,blockSize32:a,V:d,B32:c,B:u,tmp:l,blockMixCb:p,asyncTick:h}=function(e,t,r){const s=checkOpts({dkLen:32,asyncTick:10,maxmem:1073742848},r),{N:n,r:i,p:o,dkLen:a,asyncTick:d,maxmem:c,onProgress:u}=s;if(anumber(n),anumber(i),anumber(o),anumber(a),anumber(d),anumber(c),void 0!==u&&"function"!=typeof u)throw new Error("progressCb should be function");const l=128*i,p=l/4;if(n<=1||n&n-1||n>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, and less than 2^32");if(o<0||o>137438953440/l)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(a<0||a>137438953440)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");if(l*(n+o)>c)throw new Error("Scrypt: memused is bigger than maxMem. Expected 128 * r * (N + p) > maxmem of "+c);const h=pbkdf2(Sr,e,t,{c:1,dkLen:l*o}),m=u32(h),f=u32(new Uint8Array(l*n)),y=u32(new Uint8Array(l));let blockMixCb=()=>{};if(u){const e=2*n*o,t=Math.max(Math.floor(e/1e4),1);let r=0;blockMixCb=()=>{r++,!u||r%t&&r!==e||u(r/e)}}return{N:n,r:i,p:o,dkLen:a,blockSize32:p,V:f,B32:m,B:h,tmp:y,blockMixCb:blockMixCb,asyncTick:d}}(e,t,r);vr||byteSwap32(c);for(let e=0;e<i;e++){const t=a*e;for(let e=0;e<a;e++)d[e]=c[t+e];let r=0;await asyncLoop(s-1,h,(()=>{BlockMix(d,r,d,r+=a,n),p()})),BlockMix(d,(s-1)*a,c,t,n),p(),await asyncLoop(s,h,(()=>{const e=c[t+a-16]%s;for(let r=0;r<a;r++)l[r]=c[t+r]^d[e*a+r];BlockMix(l,0,c,t,n),p()}))}return vr||byteSwap32(c),function(e,t,r,s,n){const i=pbkdf2(Sr,e,r,{c:1,dkLen:t});return r.fill(0),s.fill(0),n.fill(0),i}(e,o,u,d,l)}function expandAlphabet(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw new Error(`Unsupported alphabet: ${e}`)}}function createRandomStringGenerator(...e){const t=e.map(expandAlphabet).join("");if(0===t.length)throw new Error("No valid characters provided for random string generation.");const r=t.length;return(e,...s)=>{if(e<=0)throw new Error("Length must be a positive integer.");let i=t,o=r;s.length>0&&(i=s.map(expandAlphabet).join(""),o=i.length);const a=new Uint8Array(e);n(a);let d="";for(let t=0;t<e;t++){d+=i[a[t]%o]}return d}}const Or=createRandomStringGenerator("a-z","0-9","A-Z","-_"),Cr=["info","success","warn","error","debug"];const Rr="[0m",Dr="[1m",Ur="[2m",Br={red:"[31m",green:"[32m",yellow:"[33m",blue:"[34m",magenta:"[35m"},Pr={info:Br.blue,success:Br.green,warn:Br.yellow,error:Br.red,debug:Br.magenta},createLogger=e=>{const t=!0!==e?.disabled,r=e?.level??"error",LogFunc=(s,n,i=[])=>{if(!t||!function(e,t){return Cr.indexOf(t)<=Cr.indexOf(e)}(r,s))return;const o=((e,t)=>{const r=(new Date).toISOString();return`${Ur}${r}${Rr} ${Pr[e]}${e.toUpperCase()}${Rr} ${Dr}[Better Auth]:${Rr} ${t}`})(s,n);e&&"function"==typeof e.log?e.log("success"===s?"info":s,n,...i):"error"===s?console.error(o,...i):"warn"===s?console.warn(o,...i):console.log(o,...i)};return Object.fromEntries(Cr.map((e=>[e,(...[t,...r])=>LogFunc(e,t,r)])))},Lr=createLogger(),getApplePublicKey=async e=>{const{data:t}=await s("https://appleid.apple.com/auth/keys");if(!t?.keys)throw new O("BAD_REQUEST",{message:"Keys not found"});const r=t.keys.find((t=>t.kid===e));if(!r)throw new Error(`JWK with kid ${e} not found`);return await importJWK(r,r.alg)},cleanDoubleSlashes=(e="")=>e.split("://").map((e=>e.replace(/\/{2,}/g,"/"))).join("://"),qr={apple:e=>({id:"apple",name:"Apple",async createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["email","name"];e.scope&&n.push(...e.scope),r&&n.push(...r);return await createAuthorizationURL({id:"apple",options:e,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:n,state:t,redirectURI:s,responseMode:"form_post"})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>validateAuthorizationCode({code:t,codeVerifier:r,redirectURI:s,options:e,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);const s=function(e){let t;if("string"==typeof e){const r=e.split(".");3!==r.length&&5!==r.length||([t]=r)}else if("object"==typeof e&&e){if(!("protected"in e))throw new TypeError("Token does not contain a Protected Header");t=e.protected}try{if("string"!=typeof t||!t)throw new Error;const e=JSON.parse(cr.decode(wr(t)));if(!isObject$1(e))throw new Error;return e}catch{throw new TypeError("Invalid Token or Protected Header formatting")}}(t),{kid:n,alg:i}=s;if(!n||!i)return!1;const o=await getApplePublicKey(n),{payload:a}=await jwtVerify(t,o,{algorithms:[i],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach((e=>{void 0!==a[e]&&(a[e]=Boolean(a[e]))})),(!r||a.nonce===r)&&!!a},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;const r=decodeJwt(t.idToken);if(!r)return null;const s=t.user?`${t.user.name?.firstName} ${t.user.name?.lastName}`:r.name||r.email,n=await(e.mapProfileToUser?.(r));return{user:{id:r.sub,name:s,emailVerified:!1,email:r.email,...n},data:r}},options:e}),discord:e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["identify","email"];return r&&n.push(...r),e.scope&&n.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${n.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||s)}&state=${t}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>validateAuthorizationCode({code:t,redirectURI:r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;if(null===r.avatar){const e="0"===r.discriminator?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5;r.image_url=`https://cdn.discordapp.com/embed/avatars/${e}.png`}else{const e=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${e}`}const i=await(e.mapProfileToUser?.(r));return{user:{id:r.id,name:r.global_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...i},data:r}},options:e}),facebook:e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:s,loginHint:n}){const i=e.disableDefaultScope?[]:["email","public_profile"];return e.scope&&i.push(...e.scope),r&&i.push(...r),await createAuthorizationURL({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:i,state:t,redirectURI:s,loginHint:n,additionalParams:e.configId?{config_id:e.configId}:{}})},validateAuthorizationCode:async({code:t,redirectURI:r})=>validateAuthorizationCode({code:t,redirectURI:r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);if(t.split(".").length)try{const{payload:s}=await jwtVerify(t,function(e,t){const r=new RemoteJWKSet(e,t),remoteJWKSet=async(e,t)=>r.getKey(e,t);return Object.defineProperties(remoteJWKSet,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),remoteJWKSet}(new URL("https://www.facebook.com/.well-known/oauth/openid/jwks")),{algorithms:["RS256"],audience:e.clientId,issuer:"https://www.facebook.com"});return(!r||s.nonce===r)&&!!s}catch(e){return!1}return!0},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken){const r=decodeJwt(t.idToken),s={id:r.sub,name:r.name,email:r.email,picture:{data:{url:r.picture,height:100,width:100,is_silhouette:!1}}},n=await(e.mapProfileToUser?.({...s,email_verified:!0}));return{user:{...s,emailVerified:!0,...n},data:r}}const r=["id","name","email","picture",...e?.fields||[]],{data:n,error:i}=await s("https://graph.facebook.com/me?fields="+r.join(","),{auth:{type:"Bearer",token:t.accessToken}});if(i)return null;const o=await(e.mapProfileToUser?.(n));return{user:{id:n.id,name:n.name,email:n.email,image:n.picture.data.url,emailVerified:n.email_verified,...o},data:n}},options:e}),github:e=>({id:"github",name:"GitHub",createAuthorizationURL({state:t,scopes:r,loginHint:s,redirectURI:n}){const i=e.disableDefaultScope?[]:["read:user","user:email"];return e.scope&&i.push(...e.scope),r&&i.push(...r),createAuthorizationURL({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:i,state:t,redirectURI:n,loginHint:s})},validateAuthorizationCode:async({code:t,redirectURI:r})=>validateAuthorizationCode({code:t,redirectURI:r,options:e,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://github.com/login/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${t.accessToken}`}});if(n)return null;const{data:i}=await s("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});!r.email&&i&&(r.email=(i.find((e=>e.primary))??i[0])?.email);const o=i?.find((e=>e.email===r.email))?.verified??!1,a=await(e.mapProfileToUser?.(r));return{user:{id:r.id.toString(),name:r.name||r.login,email:r.email,image:r.avatar_url,emailVerified:o,...a},data:r}},options:e}),microsoft:e=>{const t=e.tenantId||"common",r=`https://login.microsoftonline.com/${t}/oauth2/v2.0/authorize`,n=`https://login.microsoftonline.com/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(t){const s=e.disableDefaultScope?[]:["openid","profile","email","User.Read"];return e.scope&&s.push(...e.scope),t.scopes&&s.push(...s),createAuthorizationURL({id:"microsoft",options:e,authorizationEndpoint:r,state:t.state,codeVerifier:t.codeVerifier,scopes:s,redirectURI:t.redirectURI,prompt:e.prompt})},validateAuthorizationCode:({code:t,codeVerifier:r,redirectURI:s})=>validateAuthorizationCode({code:t,codeVerifier:r,redirectURI:s,options:e,tokenEndpoint:n}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;const r=decodeJwt(t.idToken),n=e.profilePhotoSize||48;await s(`https://graph.microsoft.com/v1.0/me/photos/${n}x${n}/$value`,{headers:{Authorization:`Bearer ${t.accessToken}`},async onResponse(t){if(!e.disableProfilePhoto&&t.response.ok)try{const e=t.response.clone(),s=await e.arrayBuffer(),n=ir.encode(s);r.picture=`data:image/jpeg;base64, ${n}`}catch(e){Lr.error(e&&"object"==typeof e&&"name"in e?e.name:"",e)}}});const i=await(e.mapProfileToUser?.(r));return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:!0,...i},data:r}},options:e}},google:e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:s,codeVerifier:n,redirectURI:i,loginHint:o,display:a}){if(!e.clientId||!e.clientSecret)throw Lr.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new r("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new r("codeVerifier is required for Google");const d=e.disableDefaultScope?[]:["email","profile","openid"];e.scope&&d.push(...e.scope),s&&d.push(...s);return await createAuthorizationURL({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:d,state:t,codeVerifier:n,redirectURI:i,prompt:e.prompt,accessType:e.accessType,display:a||e.display,loginHint:o,hd:e.hd})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>validateAuthorizationCode({code:t,codeVerifier:r,redirectURI:s,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);const n=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:i}=await s(n);if(!i)return!1;return i.aud===e.clientId&&("https://accounts.google.com"===i.iss||"accounts.google.com"===i.iss)},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;const r=decodeJwt(t.idToken),s=await(e.mapProfileToUser?.(r));return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...s},data:r}},options:e}),spotify:e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:s,redirectURI:n}){const i=e.disableDefaultScope?[]:["user-read-email"];return e.scope&&i.push(...e.scope),r&&i.push(...r),createAuthorizationURL({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:i,state:t,codeVerifier:s,redirectURI:n})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>validateAuthorizationCode({code:t,codeVerifier:r,redirectURI:s,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const i=await(e.mapProfileToUser?.(r));return{user:{id:r.id,name:r.display_name,email:r.email,image:r.images[0]?.url,emailVerified:!1,...i},data:r}},options:e}),twitch:e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["user:read:email","openid"];return e.scope&&n.push(...e.scope),r&&n.push(...r),createAuthorizationURL({id:"twitch",redirectURI:s,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:n,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>validateAuthorizationCode({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const r=t.idToken;if(!r)return Lr.error("No idToken found in token"),null;const s=decodeJwt(r),n=await(e.mapProfileToUser?.(s));return{user:{id:s.sub,name:s.preferred_username,email:s.email,image:s.picture,emailVerified:!1,...n},data:s}},options:e}),twitter:e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){const r=e.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...t.scopes),createAuthorizationURL({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>validateAuthorizationCode({code:t,codeVerifier:r,authentication:"basic",redirectURI:s,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.twitter.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const{data:i,error:o}=await s("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});!o&&i?.data?.confirmed_email&&(r.data.email=i.data.confirmed_email);const a=await(e.mapProfileToUser?.(r));return{user:{id:r.data.id,name:r.data.name,email:r.data.email||r.data.username||null,image:r.data.profile_image_url,emailVerified:r.data.verified||!1,...a},data:r}},options:e}),dropbox:e=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:t,scopes:r,codeVerifier:s,redirectURI:n})=>{const i=e.disableDefaultScope?[]:["account_info.read"];return e.scope&&i.push(...e.scope),r&&i.push(...r),await createAuthorizationURL({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:i,state:t,redirectURI:n,codeVerifier:s})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s})=>await validateAuthorizationCode({code:t,codeVerifier:r,redirectURI:s,options:e,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const i=await(e.mapProfileToUser?.(r));return{user:{id:r.account_id,name:r.name?.display_name,email:r.email,emailVerified:r.email_verified||!1,image:r.profile_photo_url,...i},data:r}},options:e}),kick:e=>({id:"kick",name:"Kick",createAuthorizationURL({state:t,scopes:r,redirectURI:s,codeVerifier:n}){const i=e.disableDefaultScope?[]:["user:read"];return e.scope&&i.push(...e.scope),r&&i.push(...r),createAuthorizationURL({id:"kick",redirectURI:s,options:e,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:i,codeVerifier:n,state:t})},validateAuthorizationCode:async({code:t,redirectURI:r,codeVerifier:s})=>validateAuthorizationCode({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:s}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const i=r.data[0],o=await(e.mapProfileToUser?.(i));return{user:{id:i.user_id,name:i.name,email:i.email,image:i.profile_picture,emailVerified:!0,...o},data:i}},options:e}),linkedin:e=>{const t="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:t,scopes:r,redirectURI:s,loginHint:n})=>{const i=e.disableDefaultScope?[]:["profile","email","openid"];return e.scope&&i.push(...e.scope),r&&i.push(...r),await createAuthorizationURL({id:"linkedin",options:e,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:i,state:t,loginHint:n,redirectURI:s})},validateAuthorizationCode:async({code:r,redirectURI:s})=>await validateAuthorizationCode({code:r,redirectURI:s,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>refreshAccessToken({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;const i=await(e.mapProfileToUser?.(r));return{user:{id:r.sub,name:r.name,email:r.email,emailVerified:r.email_verified||!1,image:r.picture,...i},data:r}},options:e}},gitlab:e=>{const{authorizationEndpoint:t,tokenEndpoint:r,userinfoEndpoint:n}=(e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:cleanDoubleSlashes(`${t}/oauth/authorize`),tokenEndpoint:cleanDoubleSlashes(`${t}/oauth/token`),userinfoEndpoint:cleanDoubleSlashes(`${t}/api/v4/user`)}})(e.issuer),i="gitlab";return{id:i,name:"Gitlab",createAuthorizationURL:async({state:r,scopes:s,codeVerifier:n,loginHint:o,redirectURI:a})=>{const d=e.disableDefaultScope?[]:["read_user"];return e.scope&&d.push(...e.scope),s&&d.push(...s),await createAuthorizationURL({id:i,options:e,authorizationEndpoint:t,scopes:d,state:r,redirectURI:a,codeVerifier:n,loginHint:o})},validateAuthorizationCode:async({code:t,redirectURI:s,codeVerifier:n})=>validateAuthorizationCode({code:t,redirectURI:s,options:e,codeVerifier:n,tokenEndpoint:r}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:i}=await s(n,{headers:{authorization:`Bearer ${t.accessToken}`}});if(i||"active"!==r.state||r.locked)return null;const o=await(e.mapProfileToUser?.(r));return{user:{id:r.id.toString(),name:r.name??r.username,email:r.email,image:r.avatar_url,emailVerified:!0,...o},data:r}},options:e}},tiktok:e=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["user.info.profile"];return e.scope&&n.push(...e.scope),r&&n.push(...r),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${n.join(",")}&response_type=code&client_key=${e.clientKey}&client_secret=${e.clientSecret}&redirect_uri=${encodeURIComponent(e.redirectURI||s)}&state=${t}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>validateAuthorizationCode({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s(`https://open.tiktokapis.com/v2/user/info/?fields=${["open_id","avatar_large_url","display_name","username"].join(",")}`,{headers:{authorization:`Bearer ${t.accessToken}`}});return n?null:{user:{email:r.data.user.email||r.data.user.username,id:r.data.user.open_id,name:r.data.user.display_name||r.data.user.username,image:r.data.user.avatar_large_url,emailVerified:!!r.data.user.email},data:r}},options:e}),reddit:e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["identity"];return e.scope&&n.push(...e.scope),r&&n.push(...r),createAuthorizationURL({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:n,state:t,redirectURI:s,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{const n=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),i={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${ir.encode(`${e.clientId}:${e.clientSecret}`)}`},{data:o,error:a}=await s("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:i,body:n.toString()});if(a)throw a;return getOAuth2Tokens(o)},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(n)return null;const i=await(e.mapProfileToUser?.(r));return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:r.icon_img?.split("?")[0],...i},data:r}},options:e}),roblox:e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:r,redirectURI:s}){const n=e.disableDefaultScope?[]:["openid","profile"];return e.scope&&n.push(...e.scope),r&&n.push(...r),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${n.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||s)}&state=${t}&prompt=${e.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>validateAuthorizationCode({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);const{data:r,error:n}=await s("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;const i=await(e.mapProfileToUser?.(r));return{user:{id:r.sub,name:r.nickname||r.preferred_username||"",image:r.picture,email:r.preferred_username||null,emailVerified:!0,...i},data:{...r}}},options:e}),vk:e=>({id:"vk",name:"VK",async createAuthorizationURL({state:t,scopes:r,codeVerifier:s,redirectURI:n}){const i=e.disableDefaultScope?[]:["email","phone"];e.scope&&i.push(...e.scope),r&&i.push(...r);return createAuthorizationURL({id:"vk",options:e,authorizationEndpoint:"https://id.vk.com/authorize",scopes:i,state:t,redirectURI:n,codeVerifier:s})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:s,deviceId:n})=>validateAuthorizationCode({code:t,codeVerifier:r,redirectURI:e.redirectURI||s,options:e,deviceId:n,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>refreshAccessToken({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;const r=new URLSearchParams({access_token:t.accessToken,client_id:e.clientId}).toString(),{data:n,error:i}=await s("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});if(i)return null;if(!n.user.email)return null;const o=await(e.mapProfileToUser?.(n));return{user:{id:n.user.user_id,first_name:n.user.first_name,last_name:n.user.last_name,email:n.user.email,image:n.user.avatar,emailVerified:!!n.user.email,birthday:n.user.birthday,sex:n.user.sex,...o},data:n}},options:e}),zoom:e=>{const t={pkce:!0,...e};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:e,redirectURI:r,codeVerifier:s})=>{const n=new URLSearchParams({response_type:"code",redirect_uri:t.redirectURI?t.redirectURI:r,client_id:t.clientId,state:e});if(t.pkce){const e=await generateCodeChallenge(s);n.set("code_challenge_method","S256"),n.set("code_challenge",e)}const i=new URL("https://zoom.us/oauth/authorize");return i.search=n.toString(),i},validateAuthorizationCode:async({code:e,redirectURI:r,codeVerifier:s})=>validateAuthorizationCode({code:e,redirectURI:t.redirectURI||r,codeVerifier:s,options:t,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(e){if(t.getUserInfo)return t.getUserInfo(e);const{data:r,error:n}=await s("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${e.accessToken}`}});if(n)return null;const i=await(t.mapProfileToUser?.(r));return{user:{id:r.id,name:r.display_name,image:r.pic_url,email:r.email,emailVerified:Boolean(r.verified),...i},data:{...r}}}}}},Wr=Object.keys(qr),$r=nr.enum(Wr,{description:"OAuth2 provider to use"});async function generateState(e,t){const r=e.body?.callbackURL||e.context.options.baseURL;if(!r)throw new O("BAD_REQUEST",{message:"callbackURL is required"});const s=Or(128),n=Or(32),i=JSON.stringify({callbackURL:r,codeVerifier:s,errorURL:e.body?.errorCallbackURL,newUserURL:e.body?.newUserCallbackURL,link:t,expiresAt:Date.now()+6e5,requestSignUp:e.body?.requestSignUp}),o=new Date;o.setMinutes(o.getMinutes()+10);const a=await e.context.internalAdapter.createVerificationValue({value:i,identifier:n,expiresAt:o});if(!a)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new O("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:a.identifier,codeVerifier:s}}const generateId=e=>createRandomStringGenerator("a-z","A-Z","0-9")(e||32);function parseOutputData(e,t){const r=t.fields,s={};for(const t in e){const n=r[t];n?!1!==n.returned&&(s[t]=e[t]):s[t]=e[t]}return s}function getAllFields(e,t){let r={..."user"===t?e.user?.additionalFields:{},..."session"===t?e.session?.additionalFields:{}};for(const s of e.plugins||[])s.schema&&s.schema[t]&&(r={...r,...s.schema[t].fields});return r}function parseUserOutput(e,t){return parseOutputData(t,{fields:getAllFields(e,"user")})}function parseSessionOutput(e,t){return parseOutputData(t,{fields:getAllFields(e,"session")})}function parseUserInput(e,t,r){return function(e,t){const r=t.action||"create",s=t.fields,n={};for(const t in s)if(t in e){if(!1===s[t].input){if(s[t].defaultValue){n[t]=s[t].defaultValue;continue}continue}if(s[t].validator?.input&&void 0!==e[t]){n[t]=s[t].validator.input.parse(e[t]);continue}if(s[t].transform?.input&&void 0!==e[t]){n[t]=s[t].transform?.input(e[t]);continue}n[t]=e[t]}else if(s[t].defaultValue&&"create"===r)n[t]=s[t].defaultValue;else if(s[t].required&&"create"===r)throw new O("BAD_REQUEST",{message:`${t} is required`});return n}(t||{},{fields:getAllFields(e,"user"),action:r})}function mergeSchema(e,t){if(!t)return e;for(const r in t){const s=t[r]?.modelName;s&&(e[r].modelName=s);for(const s in e[r].fields){const n=t[r]?.fields?.[s];n&&(e[r].fields[s].fieldName=n)}}return e}nr.object({id:nr.string(),providerId:nr.string(),accountId:nr.string(),userId:nr.coerce.string(),accessToken:nr.string().nullish(),refreshToken:nr.string().nullish(),idToken:nr.string().nullish(),accessTokenExpiresAt:nr.date().nullish(),refreshTokenExpiresAt:nr.date().nullish(),scope:nr.string().nullish(),password:nr.string().nullish(),createdAt:nr.date().default((()=>new Date)),updatedAt:nr.date().default((()=>new Date))}),nr.object({id:nr.string(),email:nr.string().transform((e=>e.toLowerCase())),emailVerified:nr.boolean().default(!1),name:nr.string(),image:nr.string().nullish(),createdAt:nr.date().default((()=>new Date)),updatedAt:nr.date().default((()=>new Date))}),nr.object({id:nr.string(),userId:nr.coerce.string(),expiresAt:nr.date(),createdAt:nr.date().default((()=>new Date)),updatedAt:nr.date().default((()=>new Date)),token:nr.string(),ipAddress:nr.string().nullish(),userAgent:nr.string().nullish()}),nr.object({id:nr.string(),value:nr.string(),createdAt:nr.date().default((()=>new Date)),updatedAt:nr.date().default((()=>new Date)),expiresAt:nr.date(),identifier:nr.string()});const Mr=new Map,zr=new TextEncoder,binary_decode=(e,t="utf-8")=>{Mr.has(t)||Mr.set(t,new TextDecoder(t));return Mr.get(t).decode(e)},jr=(zr.encode,createMiddleware((async()=>({})))),Zr=createMiddleware.create({use:[jr,createMiddleware((async()=>({})))]}),Vr=createEndpoint2.create({use:[jr]});function escapeRegExpChar(e){return"-"===e||"^"===e||"$"===e||"+"===e||"."===e||"("===e||")"===e||"|"===e||"["===e||"]"===e||"{"===e||"}"===e||"*"===e||"?"===e||"\\"===e?`\\${e}`:e}function transform(e,t=!0){if(Array.isArray(e)){return`(?:${e.map((e=>`^${transform(e,t)}$`)).join("|")})`}let r="",s="",n=".";!0===t?(r="/",s="[/\\\\]",n="[^/\\\\]"):t&&(r=t,s=function(e){let t="";for(let r=0;r<e.length;r++)t+=escapeRegExpChar(e[r]);return t}(r),s.length>1?(s=`(?:${s})`,n=`((?!${s}).)`):n=`[^${s}]`);let i=t?`${s}+?`:"",o=t?`${s}*?`:"",a=t?e.split(r):[e],d="";for(let e=0;e<a.length;e++){let r=a[e],s=a[e+1],c="";if(r||!(e>0))if(t&&(c=e===a.length-1?o:"**"!==s?i:""),t&&"**"===r)c&&(d+=0===e?"":c,d+=`(?:${n}*?${c})*?`);else{for(let e=0;e<r.length;e++){let t=r[e];"\\"===t?e<r.length-1&&(d+=escapeRegExpChar(r[e+1]),e++):d+="?"===t?n:"*"===t?`${n}*?`:escapeRegExpChar(t)}d+=c}}return d}function isMatch(e,t){if("string"!=typeof t)throw new TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function wildcardMatch(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if("string"!=typeof t&&"boolean"!=typeof t||(t={separator:t}),2===arguments.length&&void 0!==t&&("object"!=typeof t||null===t||Array.isArray(t)))throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if("\\"===(t=t||{}).separator)throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let r=transform(e,t.separator),s=new RegExp(`^${r}$`,t.flags),n=isMatch.bind(null,s);return n.options=t,n.pattern=e,n.regexp=s,n}const Fr=Zr((async e=>{if("POST"!==e.request?.method||!e.request)return;const{body:t,query:r,context:s}=e,n=e.headers?.get("origin")||e.headers?.get("referer")||"",i=t?.callbackURL||r?.callbackURL,c=t?.redirectTo,u=t?.errorCallbackURL,l=t?.newUserCallbackURL,p=Array.isArray(s.options.trustedOrigins)?s.trustedOrigins:[...s.trustedOrigins,...await(s.options.trustedOrigins?.(e.request))||[]],h=e.headers?.has("cookie"),validateURL=(t,r)=>{if(!t)return;const s=p.some((e=>((e,t)=>{if(e.startsWith("/"))return!1;if(t.includes("*"))return wildcardMatch(t)(o(e));const r=a(e);return"http:"!==r&&"https:"!==r&&r?e.startsWith(t):t===d(e)})(t,e)||t?.startsWith("/")&&"origin"!==r&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/]*(?:\?[\w\-.\+/=&%]*)?$/.test(t)));if(!s)throw e.context.logger.error(`Invalid ${r}: ${t}`),e.context.logger.info(`If it's a valid URL, please add ${t} to trustedOrigins in your auth config\n`,`Current list of trustedOrigins: ${p}`),new O("FORBIDDEN",{message:`Invalid ${r}`})};h&&!e.context.options.advanced?.disableCSRFCheck&&validateURL(n,"origin"),i&&validateURL(i,"callbackURL"),c&&validateURL(c,"redirectURL"),u&&validateURL(u,"errorCallbackURL"),l&&validateURL(l,"newUserCallbackURL")})),originCheck=e=>Zr((async t=>{if(!t.request)return;const{context:r}=t,s=e(t),n=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await(r.options.trustedOrigins?.(t.request))||[]],validateURL=(e,r)=>{if(!e)return;const s=n.some((t=>((e,t)=>!e.startsWith("/")&&(t.includes("*")?wildcardMatch(t)(o(e)):e.startsWith(t)))(e,t)||e?.startsWith("/")&&"origin"!==r&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/]*(?:\?[\w\-.\+/=&%]*)?$/.test(e)));if(!s)throw t.context.logger.error(`Invalid ${r}: ${e}`),t.context.logger.info(`If it's a valid URL, please add ${e} to trustedOrigins in your auth config\n`,`Current list of trustedOrigins: ${n}`),new O("FORBIDDEN",{message:`Invalid ${r}`})},i=Array.isArray(s)?s:[s];for(const e of i)validateURL(e,"callbackURL")})),Qr={isAction:!1},Jr={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found"},getSession=()=>Vr("/get-session",{method:"GET",query:nr.optional(nr.object({disableCookieCache:nr.optional(nr.boolean({description:"Disable cookie cache and fetch session from database"}).or(nr.string().transform((e=>"true"===e)))).optional(),disableRefresh:nr.boolean({description:"Disable session refresh. Useful for checking session status, without updating the session"}).or(nr.string().transform((e=>"true"===e))).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},(async e=>{try{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)return null;const r=e.getCookie(e.context.authCookies.sessionData.name),s=r?safeJSONParse(binary_decode(ir.decode(r))):null;if(s){if(!await createHMAC("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...s.session,expiresAt:s.expiresAt}),s.signature)){const t=e.context.authCookies.sessionData.name;e.setCookie(t,"",{maxAge:0})}}const n=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(s?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){const t=s.session;if(!(s.expiresAt<Date.now()||t.session.expiresAt<new Date))return e.json(t);{const t=e.context.authCookies.sessionData.name;e.setCookie(t,"",{maxAge:0})}}const i=await e.context.internalAdapter.findSession(t);if(e.context.session=i,!i||i.session.expiresAt<new Date)return deleteSessionCookie(e),i&&await e.context.internalAdapter.deleteSession(i.session.token),e.json(null);if(n||e.query?.disableRefresh)return e.json(i);const o=e.context.sessionConfig.expiresIn,a=e.context.sessionConfig.updateAge,d=i.session.expiresAt.valueOf()-1e3*o+1e3*a;if(d<=Date.now()&&(!e.query?.disableRefresh||!e.context.options.session?.disableSessionRefresh)){const t=await e.context.internalAdapter.updateSession(i.session.token,{expiresAt:getDate(e.context.sessionConfig.expiresIn,"sec")});if(!t)return deleteSessionCookie(e),e.json(null,{status:401});const r=(t.expiresAt.valueOf()-Date.now())/1e3;return await setSessionCookie(e,{session:t,user:i.user},!1,{maxAge:r}),e.json({session:t,user:i.user})}return await setCookieCache(e,i),e.json(i)}catch(t){throw e.context.logger.error("INTERNAL_SERVER_ERROR",t),new O("INTERNAL_SERVER_ERROR",{message:Jr.FAILED_TO_GET_SESSION})}})),getSessionFromCtx=async(e,t)=>{if(e.context.session)return e.context.session;const r=await getSession()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,query:{...t,...e.query}}).catch((e=>null));return e.context.session=r,r},Kr=Zr((async e=>{const t=await getSessionFromCtx(e);if(!t?.session)throw new O("UNAUTHORIZED");return{session:t}}));Zr((async e=>{const t=await getSessionFromCtx(e);if(!t?.session&&(e.request||e.headers))throw new O("UNAUTHORIZED");return{session:t}}));const Hr=Zr((async e=>{const t=await getSessionFromCtx(e);if(!t?.session)throw new O("UNAUTHORIZED");if(0===e.context.sessionConfig.freshAge)return{session:t};const r=e.context.sessionConfig.freshAge,s=t.session.updatedAt?.valueOf()||t.session.createdAt.valueOf();if(!(Date.now()-s<1e3*r))throw new O("FORBIDDEN",{message:"Session is not fresh"});return{session:t}})),Gr=Vr("/revoke-session",{method:"POST",body:nr.object({token:nr.string({description:"The token to revoke"})}),use:[Kr],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},(async e=>{const t=e.body.token,r=await e.context.internalAdapter.findSession(t);if(!r)throw new O("BAD_REQUEST",{message:"Session not found"});if(r.session.userId!==e.context.session.user.id)throw new O("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(t)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new O("INTERNAL_SERVER_ERROR")}return e.json({status:!0})})),Yr=Vr("/revoke-sessions",{method:"POST",use:[Kr],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},(async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new O("INTERNAL_SERVER_ERROR")}return e.json({status:!0})})),Xr=Vr("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[Kr],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},(async e=>{const t=e.context.session;if(!t.user)throw new O("UNAUTHORIZED");const r=(await e.context.internalAdapter.listSessions(t.user.id)).filter((e=>e.expiresAt>new Date)).filter((t=>t.token!==e.context.session.session.token));return await Promise.all(r.map((t=>e.context.internalAdapter.deleteSession(t.token)))),e.json({status:!0})}));async function createEmailVerificationToken(e,t,r,s=3600){const n=await async function(e,t,r=3600){return await new SignJWT(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+r).sign((new TextEncoder).encode(t))}({email:t.toLowerCase(),updateTo:r},e,s);return n}const es=Vr("/send-verification-email",{method:"POST",body:nr.object({email:nr.string({description:"The email to send the verification email to"}).email(),callbackURL:nr.string({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},(async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new O("BAD_REQUEST",{message:"Verification email isn't enabled"});const{email:t}=e.body,r=await e.context.internalAdapter.findUserByEmail(t);if(!r)throw new O("BAD_REQUEST",{message:Jr.USER_NOT_FOUND});return await async function(e,t){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new O("BAD_REQUEST",{message:"Verification email isn't enabled"});const r=await createEmailVerificationToken(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:s,token:r},e.request)}(e,r.user),e.json({status:!0})})),ts=Vr("/verify-email",{method:"GET",query:nr.object({token:nr.string({description:"The token to verify the email"}),callbackURL:nr.string({description:"The URL to redirect to after email verification"}).optional()}),use:[originCheck((e=>e.query.callbackURL))],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"},required:["user","status"]}}}}}}}}},(async e=>{function redirectOnError(t){if(e.query.callbackURL){if(e.query.callbackURL.includes("?"))throw e.redirect(`${e.query.callbackURL}&error=${t}`);throw e.redirect(`${e.query.callbackURL}?error=${t}`)}throw new O("UNAUTHORIZED",{message:t})}const{token:t}=e.query;let r;try{r=await jwtVerify(t,(new TextEncoder).encode(e.context.secret),{algorithms:["HS256"]})}catch(e){return redirectOnError(e instanceof JWTExpired?"token_expired":"invalid_token")}const s=nr.object({email:nr.string().email(),updateTo:nr.string().optional()}).parse(r.payload),n=await e.context.internalAdapter.findUserByEmail(s.email);if(!n)return redirectOnError("user_not_found");if(s.updateTo){const t=await getSessionFromCtx(e);if(!t){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return redirectOnError("unauthorized")}if(t.user.email!==s.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return redirectOnError("unauthorized")}const r=await e.context.internalAdapter.updateUserByEmail(s.email,{email:s.updateTo,emailVerified:!1},e),n=await createEmailVerificationToken(e.context.secret,s.updateTo);if(await(e.context.options.emailVerification?.sendVerificationEmail?.({user:r,url:`${e.context.baseURL}/verify-email?token=${n}&callbackURL=${e.query.callbackURL||"/"}`,token:n},e.request)),await setSessionCookie(e,{session:t.session,user:{...t.user,email:s.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:r.id,email:r.email,name:r.name,image:r.image,emailVerified:r.emailVerified,createdAt:r.createdAt,updatedAt:r.updatedAt}})}if(await(e.context.options.emailVerification?.onEmailVerification?.(n.user,e.request)),await e.context.internalAdapter.updateUserByEmail(s.email,{emailVerified:!0},e),e.context.options.emailVerification?.autoSignInAfterVerification){const t=await getSessionFromCtx(e);if(t&&t.user.email===s.email)await setSessionCookie(e,{session:t.session,user:{...t.user,emailVerified:!0}});else{const t=await e.context.internalAdapter.createSession(n.user.id,e.headers);if(!t)throw new O("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await setSessionCookie(e,{session:t,user:{...n.user,emailVerified:!0}})}}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})}));async function handleOAuthUserInfo(e,{userInfo:t,account:r,callbackURL:s,disableSignUp:n,overrideUserInfo:o}){const a=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),r.accountId,r.providerId).catch((t=>{throw Lr.error("Better auth was unable to query your database.\nError: ",t),e.redirect(`${e.context.baseURL}/error?error=internal_server_error`)}));let d=a?.user,c=!d;if(a){const s=a.accounts.find((e=>e.providerId===r.providerId));if(s){const t=Object.fromEntries(Object.entries({accessToken:r.accessToken,idToken:r.idToken,refreshToken:r.refreshToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope}).filter((([e,t])=>void 0!==t)));Object.keys(t).length>0&&await e.context.internalAdapter.updateAccount(s.id,t,e)}else{const s=e.context.options.account?.accountLinking?.trustedProviders,n=s?.includes(r.providerId);if(!n&&!t.emailVerified||!1===e.context.options.account?.accountLinking?.enabled)return i&&Lr.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:r.providerId,accountId:t.id.toString(),userId:a.user.id,accessToken:r.accessToken,idToken:r.idToken,refreshToken:r.refreshToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope},e)}catch(e){return Lr.error("Unable to link account",e),{error:"unable to link account",data:null}}}o&&await e.context.internalAdapter.updateUser(a.user.id,{...t,email:t.email.toLowerCase(),emailVerified:t.email.toLocaleLowerCase()===a.user.email&&a.user.emailVerified||t.emailVerified})}else{if(n)return{error:"signup disabled",data:null,isRegister:!1};try{const{id:n,...i}=t;if(d=await e.context.internalAdapter.createOAuthUser({...i,email:t.email.toLowerCase()},{accessToken:r.accessToken,idToken:r.idToken,refreshToken:r.refreshToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope,providerId:r.providerId,accountId:t.id.toString()},e).then((e=>e?.user)),!t.emailVerified&&d&&e.context.options.emailVerification?.sendOnSignUp){const t=await createEmailVerificationToken(e.context.secret,d.email,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${s}`;await(e.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:r,token:t},e.request))}}catch(e){return Lr.error(e),e instanceof O?{error:e.message,data:null,isRegister:!1}:{error:"unable to create user",data:null,isRegister:!1}}}if(!d)return{error:"unable to create user",data:null,isRegister:!1};const u=await e.context.internalAdapter.createSession(d.id,e.headers);return u?{data:{session:u,user:d},error:null,isRegister:c}:{error:"unable to create session",data:null,isRegister:!1}}const rs=Vr("/sign-in/social",{method:"POST",body:nr.object({callbackURL:nr.string({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:nr.string().optional(),errorCallbackURL:nr.string({description:"Callback URL to redirect to if an error happens"}).optional(),provider:$r,disableRedirect:nr.boolean({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:nr.optional(nr.object({token:nr.string({description:"ID token from the provider"}),nonce:nr.string({description:"Nonce used to generate the token"}).optional(),accessToken:nr.string({description:"Access token from the provider"}).optional(),refreshToken:nr.string({description:"Refresh token from the provider"}).optional(),expiresAt:nr.number({description:"Expiry date of the token"}).optional()}),{description:"ID token from the provider to sign in the user with id token"}),scopes:nr.array(nr.string(),{description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:nr.boolean({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:nr.string({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}}},(async e=>{const t=e.context.socialProviders.find((t=>t.id===e.body.provider));if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new O("NOT_FOUND",{message:Jr.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new O("NOT_FOUND",{message:Jr.ID_TOKEN_NOT_SUPPORTED});const{token:r,nonce:s}=e.body.idToken;if(!await t.verifyIdToken(r,s))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new O("UNAUTHORIZED",{message:Jr.INVALID_TOKEN});const n=await t.getUserInfo({idToken:r,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!n||!n?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new O("UNAUTHORIZED",{message:Jr.FAILED_TO_GET_USER_INFO});const i=await(t.options?.mapProfileToUser?.(n.user)),o={...n.user,...i};if(!o.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new O("UNAUTHORIZED",{message:Jr.USER_EMAIL_NOT_FOUND});const a=await handleOAuthUserInfo(e,{userInfo:{...o,email:o.email,id:o.id,name:o.name||"",image:o.image,emailVerified:o.emailVerified||!1},account:{providerId:t.id,accountId:n.user.id,accessToken:e.body.idToken.accessToken},disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(a.error)throw new O("UNAUTHORIZED",{message:a.error});return await setSessionCookie(e,a.data),e.json({redirect:!1,token:a.data.session.token,url:void 0,user:{id:a.data.user.id,email:a.data.user.email,name:a.data.user.name,image:a.data.user.image,emailVerified:a.data.user.emailVerified,createdAt:a.data.user.createdAt,updatedAt:a.data.user.updatedAt}})}const{codeVerifier:r,state:s}=await generateState(e),n=await t.createAuthorizationURL({state:s,codeVerifier:r,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:n.toString(),redirect:!e.body.disableRedirect})})),ss=Vr("/sign-in/email",{method:"POST",body:nr.object({email:nr.string({description:"Email of the user"}),password:nr.string({description:"Password of the user"}),callbackURL:nr.string({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:nr.boolean({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},(async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new O("BAD_REQUEST",{message:"Email and password is not enabled"});const{email:t,password:r}=e.body;if(!nr.string().email().safeParse(t).success)throw new O("BAD_REQUEST",{message:Jr.INVALID_EMAIL});const s=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!s)throw await e.context.password.hash(r),e.context.logger.error("User not found",{email:t}),new O("UNAUTHORIZED",{message:Jr.INVALID_EMAIL_OR_PASSWORD});const n=s.accounts.find((e=>"credential"===e.providerId));if(!n)throw e.context.logger.error("Credential account not found",{email:t}),new O("UNAUTHORIZED",{message:Jr.INVALID_EMAIL_OR_PASSWORD});const i=n?.password;if(!i)throw e.context.logger.error("Password not found",{email:t}),new O("UNAUTHORIZED",{message:Jr.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:i,password:r}))throw e.context.logger.error("Invalid password"),new O("UNAUTHORIZED",{message:Jr.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!s.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new O("FORBIDDEN",{message:Jr.EMAIL_NOT_VERIFIED});const t=await createEmailVerificationToken(e.context.secret,s.user.email,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${e.body.callbackURL||"/"}`;throw await e.context.options.emailVerification.sendVerificationEmail({user:s.user,url:r,token:t},e.request),new O("FORBIDDEN",{message:Jr.EMAIL_NOT_VERIFIED})}const o=await e.context.internalAdapter.createSession(s.user.id,e.headers,!1===e.body.rememberMe);if(!o)throw e.context.logger.error("Failed to create session"),new O("UNAUTHORIZED",{message:Jr.FAILED_TO_CREATE_SESSION});return await setSessionCookie(e,{session:o,user:s.user},!1===e.body.rememberMe),e.json({redirect:!!e.body.callbackURL,token:o.token,url:e.body.callbackURL,user:{id:s.user.id,email:s.user.email,name:s.user.name,image:s.user.image,emailVerified:s.user.emailVerified,createdAt:s.user.createdAt,updatedAt:s.user.updatedAt}})})),ns=nr.object({code:nr.string().optional(),error:nr.string().optional(),device_id:nr.string().optional(),error_description:nr.string().optional(),state:nr.string().optional(),user:nr.string().optional()}),is=Vr("/callback/:id",{method:["GET","POST"],body:ns.optional(),query:ns.optional(),metadata:Qr},(async e=>{let t;const r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;try{if("GET"===e.method)t=ns.parse(e.query);else{if("POST"!==e.method)throw new Error("Unsupported method");t=ns.parse(e.body)}}catch(t){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",t),e.redirect(`${r}?error=invalid_callback_request`)}const{code:s,error:n,state:i,error_description:o,device_id:a}=t;if(n)throw e.redirect(`${r}?error=${n}&error_description=${o}`);if(!i)throw e.context.logger.error("State not found",n),e.redirect(`${r}?error=state_not_found`);const{codeVerifier:d,callbackURL:c,link:u,errorURL:l,newUserURL:p,requestSignUp:h}=await async function(e){const t=e.query.state||e.body.state,r=await e.context.internalAdapter.findVerificationValue(t);if(!r)throw e.context.logger.error("State Mismatch. Verification not found",{state:t}),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);const s=nr.object({callbackURL:nr.string(),codeVerifier:nr.string(),errorURL:nr.string().optional(),newUserURL:nr.string().optional(),expiresAt:nr.number(),link:nr.object({email:nr.string(),userId:nr.coerce.string()}).optional(),requestSignUp:nr.boolean().optional()}).parse(JSON.parse(r.value));if(s.errorURL||(s.errorURL=`${e.context.baseURL}/error`),s.expiresAt<Date.now())throw await e.context.internalAdapter.deleteVerificationValue(r.id),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);return await e.context.internalAdapter.deleteVerificationValue(r.id),s}(e);function redirectOnError(t){let s=l||r;throw s=s.includes("?")?`${s}&error=${t}`:`${s}?error=${t}`,e.redirect(s)}if(!s)throw e.context.logger.error("Code not found"),redirectOnError("no_code");const m=e.context.socialProviders.find((t=>t.id===e.params.id));if(!m)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),redirectOnError("oauth_provider_not_found");let f;try{f=await m.validateAuthorizationCode({code:s,codeVerifier:d,deviceId:a,redirectURI:`${e.context.baseURL}/callback/${m.id}`})}catch(t){throw e.context.logger.error("",t),redirectOnError("invalid_code")}const y=await m.getUserInfo({...f,user:e.body?.user?safeJSONParse(e.body.user):void 0}).then((e=>e?.user));if(!y)return e.context.logger.error("Unable to get user info"),redirectOnError("unable_to_get_user_info");if(!y.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),redirectOnError("email_not_found");if(!c)throw e.context.logger.error("No callback URL found"),redirectOnError("no_callback_url");if(u){const t=await e.context.internalAdapter.findAccount(y.id);if(t){if(t.userId.toString()!==u.userId.toString())return redirectOnError("account_already_linked_to_different_user");const r=Object.fromEntries(Object.entries({accessToken:f.accessToken,idToken:f.idToken,refreshToken:f.refreshToken,accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")}).filter((([e,t])=>void 0!==t)));await e.context.internalAdapter.updateAccount(t.id,r)}else{if(!await e.context.internalAdapter.createAccount({userId:u.userId,providerId:m.id,accountId:y.id,...f,scope:f.scopes?.join(",")},e))return redirectOnError("unable_to_link_account")}let r;try{r=c.toString()}catch{r=c}throw e.redirect(r)}const g=await handleOAuthUserInfo(e,{userInfo:{...y,email:y.email,name:y.name||y.email},account:{providerId:m.id,accountId:y.id,...f,scope:f.scopes?.join(",")},callbackURL:c,disableSignUp:m.disableImplicitSignUp&&!h||m.options?.disableSignUp});if(g.error)return e.context.logger.error(g.error.split(" ").join("_")),redirectOnError(g.error.split(" ").join("_"));const{session:w,user:v}=g.data;let b;await setSessionCookie(e,{session:w,user:v});try{b=(g.isRegister&&p||c).toString()}catch{b=g.isRegister&&p||c}throw e.redirect(b)})),os=Vr("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},(async e=>{const t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)throw deleteSessionCookie(e),new O("BAD_REQUEST",{message:Jr.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(t),deleteSessionCookie(e),e.json({success:!0})}));function redirectError(e,t,r){const s=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return r&&Object.entries(r).forEach((([e,t])=>s.searchParams.set(e,t))),s.href}const as=Vr("/forget-password",{method:"POST",body:nr.object({email:nr.string({description:"The email address of the user to send a password reset email to"}).email(),redirectTo:nr.string({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},(async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new O("BAD_REQUEST",{message:"Reset password isn't enabled"});const{email:t,redirectTo:r}=e.body,s=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!s)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0});const n=getDate(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),i=generateId(24);await e.context.internalAdapter.createVerificationValue({value:s.user.id,identifier:`reset-password:${i}`,expiresAt:n});const o=`${e.context.baseURL}/reset-password/${i}?callbackURL=${r}`;return await e.context.options.emailAndPassword.sendResetPassword({user:s.user,url:o,token:i},e.request),e.json({status:!0})})),ds=Vr("/reset-password/:token",{method:"GET",query:nr.object({callbackURL:nr.string({description:"The URL to redirect the user to reset their password"})}),use:[originCheck((e=>e.query.callbackURL))],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},(async e=>{const{token:t}=e.params,{callbackURL:r}=e.query;if(!t||!r)throw e.redirect(redirectError(e.context,r,{error:"INVALID_TOKEN"}));const s=await e.context.internalAdapter.findVerificationValue(`reset-password:${t}`);if(!s||s.expiresAt<new Date)throw e.redirect(redirectError(e.context,r,{error:"INVALID_TOKEN"}));throw e.redirect(function(e,t,r){const s=new URL(t,e.baseURL);return r&&Object.entries(r).forEach((([e,t])=>s.searchParams.set(e,t))),s.href}(e.context,r,{token:t}))})),cs=Vr("/reset-password",{method:"POST",query:nr.object({token:nr.string().optional()}).optional(),body:nr.object({newPassword:nr.string({description:"The new password to set"}),token:nr.string({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},(async e=>{const t=e.body.token||e.query?.token;if(!t)throw new O("BAD_REQUEST",{message:Jr.INVALID_TOKEN});const{newPassword:r}=e.body,s=e.context.password?.config.minPasswordLength,n=e.context.password?.config.maxPasswordLength;if(r.length<s)throw new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_SHORT});if(r.length>n)throw new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_LONG});const i=`reset-password:${t}`,o=await e.context.internalAdapter.findVerificationValue(i);if(!o||o.expiresAt<new Date)throw new O("BAD_REQUEST",{message:Jr.INVALID_TOKEN});const a=o.value,d=await e.context.password.hash(r);return(await e.context.internalAdapter.findAccounts(a)).find((e=>"credential"===e.providerId))?(await e.context.internalAdapter.updatePassword(a,d,e),await e.context.internalAdapter.deleteVerificationValue(o.id),e.json({status:!0})):(await e.context.internalAdapter.createAccount({userId:a,providerId:"credential",password:d,accountId:a},e),await e.context.internalAdapter.deleteVerificationValue(o.id),e.json({status:!0}))})),us=Vr("/change-password",{method:"POST",body:nr.object({newPassword:nr.string({description:"The new password to set"}),currentPassword:nr.string({description:"The current password"}),revokeOtherSessions:nr.boolean({description:"Revoke all other sessions"}).optional()}),use:[Kr],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},(async e=>{const{newPassword:t,currentPassword:r,revokeOtherSessions:s}=e.body,n=e.context.session,i=e.context.password.config.minPasswordLength;if(t.length<i)throw e.context.logger.error("Password is too short"),new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_SHORT});const o=e.context.password.config.maxPasswordLength;if(t.length>o)throw e.context.logger.error("Password is too long"),new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_LONG});const a=(await e.context.internalAdapter.findAccounts(n.user.id)).find((e=>"credential"===e.providerId&&e.password));if(!a||!a.password)throw new O("BAD_REQUEST",{message:Jr.CREDENTIAL_ACCOUNT_NOT_FOUND});const d=await e.context.password.hash(t);if(!await e.context.password.verify({hash:a.password,password:r}))throw new O("BAD_REQUEST",{message:Jr.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(a.id,{password:d});let c=null;if(s){await e.context.internalAdapter.deleteSessions(n.user.id);const t=await e.context.internalAdapter.createSession(n.user.id,e.headers);if(!t)throw new O("INTERNAL_SERVER_ERROR",{message:Jr.FAILED_TO_GET_SESSION});await setSessionCookie(e,{session:t,user:n.user}),c=t.token}return e.json({token:c,user:{id:n.user.id,email:n.user.email,name:n.user.name,image:n.user.image,emailVerified:n.user.emailVerified,createdAt:n.user.createdAt,updatedAt:n.user.updatedAt}})})),ls=Vr("/set-password",{method:"POST",body:nr.object({newPassword:nr.string()}),metadata:{SERVER_ONLY:!0},use:[Kr]},(async e=>{const{newPassword:t}=e.body,r=e.context.session,s=e.context.password.config.minPasswordLength;if(t.length<s)throw e.context.logger.error("Password is too short"),new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_SHORT});const n=e.context.password.config.maxPasswordLength;if(t.length>n)throw e.context.logger.error("Password is too long"),new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_LONG});const i=(await e.context.internalAdapter.findAccounts(r.user.id)).find((e=>"credential"===e.providerId&&e.password)),o=await e.context.password.hash(t);if(!i)return await e.context.internalAdapter.linkAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:o},e),e.json({status:!0});throw new O("BAD_REQUEST",{message:"user already has a password"})})),ps=Vr("/delete-user",{method:"POST",use:[Kr],body:nr.object({callbackURL:nr.string().optional(),password:nr.string().optional(),token:nr.string().optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},(async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options",{session:e.context.session}),new O("NOT_FOUND");const t=e.context.session;if(e.body.password){const r=(await e.context.internalAdapter.findAccounts(t.user.id)).find((e=>"credential"===e.providerId&&e.password));if(!r||!r.password)throw new O("BAD_REQUEST",{message:Jr.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:r.password,password:e.body.password}))throw new O("BAD_REQUEST",{message:Jr.INVALID_PASSWORD})}else if(e.context.options.session?.freshAge){const r=t.session.createdAt.getTime(),s=e.context.options.session.freshAge;if(Date.now()-r>s)throw new O("BAD_REQUEST",{message:Jr.SESSION_EXPIRED})}if(e.body.token)return await hs({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){const r=Or(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${r}`,expiresAt:new Date(Date.now()+1e3*(e.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))});const s=`${e.context.baseURL}/delete-user/callback?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:s,token:r},e.request),e.json({success:!0,message:"Verification email sent"})}const r=e.context.options.user.deleteUser?.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),deleteSessionCookie(e);const s=e.context.options.user.deleteUser?.afterDelete;return s&&await s(t.user,e.request),e.json({success:!0,message:"User deleted"})})),hs=Vr("/delete-user/callback",{method:"GET",query:nr.object({token:nr.string(),callbackURL:nr.string().optional()}),use:[originCheck((e=>e.query.callbackURL))],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},(async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new O("NOT_FOUND");const t=await getSessionFromCtx(e);if(!t)throw new O("NOT_FOUND",{message:Jr.FAILED_TO_GET_USER_INFO});const r=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!r||r.expiresAt<new Date)throw new O("NOT_FOUND",{message:Jr.INVALID_TOKEN});if(r.value!==t.user.id)throw new O("NOT_FOUND",{message:Jr.INVALID_TOKEN});const s=e.context.options.user.deleteUser?.beforeDelete;s&&await s(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(r.id),deleteSessionCookie(e);const n=e.context.options.user.deleteUser?.afterDelete;if(n&&await n(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})})),ms=Vr("/change-email",{method:"POST",body:nr.object({newEmail:nr.string({description:"The new email to set"}).email(),callbackURL:nr.string({description:"The URL to redirect to after email verification"}).optional()}),use:[Kr],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}}}}}},(async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new O("BAD_REQUEST",{message:"Change email is disabled"});const t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new O("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new O("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==e.context.session.user.emailVerified){if(await e.context.internalAdapter.findUserByEmail(t))throw new O("UNPROCESSABLE_ENTITY",{message:Jr.USER_ALREADY_EXISTS});if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t},e),await setSessionCookie(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),e.context.options.emailVerification?.sendVerificationEmail){const r=await createEmailVerificationToken(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:s,token:r},e.request)}return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new O("BAD_REQUEST",{message:"Verification email isn't enabled"});const r=await createEmailVerificationToken(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:t,url:s,token:r},e.request),e.json({status:!0})}));const fs=Vr("/error",{method:"GET",metadata:{...Qr,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},(async e=>{const t=new URL(e.request?.url||"").searchParams.get("error")||"Unknown";return new Response(((e="Unknown")=>{return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Authentication Error</title>\n    <style>\n        :root {\n            --bg-color: #f8f9fa;\n            --text-color: #212529;\n            --accent-color: #000000;\n            --error-color: #dc3545;\n            --border-color: #e9ecef;\n        }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            background-color: var(--bg-color);\n            color: var(--text-color);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            line-height: 1.5;\n        }\n        .error-container {\n            background-color: #ffffff;\n            border-radius: 12px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);\n            padding: 2.5rem;\n            text-align: center;\n            max-width: 90%;\n            width: 400px;\n        }\n        h1 {\n            color: var(--error-color);\n            font-size: 1.75rem;\n            margin-bottom: 1rem;\n            font-weight: 600;\n        }\n        p {\n            margin-bottom: 1.5rem;\n            color: #495057;\n        }\n        .btn {\n            background-color: var(--accent-color);\n            color: #ffffff;\n            text-decoration: none;\n            padding: 0.75rem 1.5rem;\n            border-radius: 6px;\n            transition: all 0.3s ease;\n            display: inline-block;\n            font-weight: 500;\n            border: 2px solid var(--accent-color);\n        }\n        .btn:hover {\n            background-color: #131721;\n        }\n        .error-code {\n            font-size: 0.875rem;\n            color: #6c757d;\n            margin-top: 1.5rem;\n            padding-top: 1.5rem;\n            border-top: 1px solid var(--border-color);\n        }\n        .icon {\n            font-size: 3rem;\n            margin-bottom: 1rem;\n        }\n    </style>\n</head>\n<body>\n    <div class="error-container">\n        <div class="icon">⚠️</div>\n        <h1>Better Auth Error</h1>\n        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>\n        <a href="/" id="returnLink" class="btn">Return to Application</a>\n        <div class="error-code">Error Code: <span id="errorCode">${t=e,t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>\n    </div>\n</body>\n</html>`;var t})(t),{headers:{"Content-Type":"text/html"}})})),ys=Vr("/ok",{method:"GET",metadata:{...Qr,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},(async e=>e.json({ok:!0}))),gs=Vr("/list-accounts",{method:"GET",use:[Kr],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","provider","createdAt","updatedAt","accountId","scopes"]}}}}}}}},(async e=>{const t=e.context.session,r=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(r.map((e=>({id:e.id,provider:e.providerId,createdAt:e.createdAt,updatedAt:e.updatedAt,accountId:e.accountId,scopes:e.scope?.split(",")||[]}))))})),ws=Vr("/link-social",{method:"POST",requireHeaders:!0,body:nr.object({callbackURL:nr.string({description:"The URL to redirect to after the user has signed in"}).optional(),provider:nr.enum(Wr,{description:"The OAuth2 provider to use"}),scopes:nr.array(nr.string(),{description:"Additional scopes to request from the provider"}).optional()}),use:[Kr],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"}},required:["url","redirect"]}}}}}}}},(async e=>{const t=e.context.session,r=e.context.socialProviders.find((t=>t.id===e.body.provider));if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new O("NOT_FOUND",{message:Jr.PROVIDER_NOT_FOUND});const s=await generateState(e,{userId:t.user.id,email:t.user.email}),n=await r.createAuthorizationURL({state:s.state,codeVerifier:s.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`,scopes:e.body.scopes});return e.json({url:n.toString(),redirect:!0})})),vs=Vr("/unlink-account",{method:"POST",body:nr.object({providerId:nr.string(),accountId:nr.string().optional()}),use:[Hr],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},(async e=>{const{providerId:t,accountId:r}=e.body,s=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(1===s.length&&!e.context.options.account?.accountLinking?.allowUnlinkingAll)throw new O("BAD_REQUEST",{message:Jr.FAILED_TO_UNLINK_LAST_ACCOUNT});const n=s.find((e=>r?e.accountId===r&&e.providerId===t:e.providerId===t));if(!n)throw new O("BAD_REQUEST",{message:Jr.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(n.id),e.json({status:!0})})),bs=Vr("/refresh-token",{method:"POST",body:nr.object({providerId:nr.string({description:"The provider ID for the OAuth provider"}),accountId:nr.string({description:"The account ID associated with the refresh token"}).optional(),userId:nr.string({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},(async e=>{const{providerId:t,accountId:r,userId:s}=e.body,n=e.request,i=await getSessionFromCtx(e);if(n&&!i)throw e.error("UNAUTHORIZED");let o=i?.user?.id||s;if(!o)throw new O("BAD_REQUEST",{message:"Either userId or session is required"});const a=(await e.context.internalAdapter.findAccounts(o)).find((e=>r?e.id===r&&e.providerId===t:e.providerId===t));if(!a)throw new O("BAD_REQUEST",{message:"Account not found"});const d=e.context.socialProviders.find((e=>e.id===t));if(!d)throw new O("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!d.refreshAccessToken)throw new O("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{const t=await d.refreshAccessToken(a.refreshToken);return await e.context.internalAdapter.updateAccount(a.id,{accessToken:t.accessToken,accessTokenExpiresAt:t.accessTokenExpiresAt,refreshToken:t.refreshToken,refreshTokenExpiresAt:t.refreshTokenExpiresAt}),e.json(t)}catch(e){throw new O("BAD_REQUEST",{message:"Failed to refresh access token",cause:e})}}));function getIp(e,t){if(t.advanced?.ipAddress?.disableIpTracking)return null;if(c)return"127.0.0.1";const r="headers"in e?e.headers:e,s=t.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"];for(const e of s){const t="get"in r?r.get(e):r[e];if("string"==typeof t){const e=t.split(",")[0].trim();if(isValidIP(e))return e}}return null}function isValidIP(e){if(/^(\d{1,3}\.){3}\d{1,3}$/.test(e)){return e.split(".").map(Number).every((e=>e>=0&&e<=255))}return/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(e)}const Ns=new Map;function getRateLimitStorage(e){if(e.options.rateLimit?.customStorage)return e.options.rateLimit.customStorage;if("secondary-storage"===e.rateLimit.storage)return{get:async t=>{const r=await(e.options.secondaryStorage?.get(t));return r?JSON.parse(r):void 0},set:async(t,r)=>{await(e.options.secondaryStorage?.set?.(t,JSON.stringify(r)))}};return"memory"===e.rateLimit.storage?{get:async e=>Ns.get(e),async set(e,t,r){Ns.set(e,t)}}:function(e){const t=e.options.rateLimit?.modelName||"rateLimit",r=e.adapter;return{get:async e=>{const s=(await r.findMany({model:t,where:[{field:"key",value:e}]}))[0];return"bigint"==typeof s?.lastRequest&&(s.lastRequest=Number(s.lastRequest)),s},set:async(t,s,n)=>{try{n?await r.updateMany({model:"rateLimit",where:[{field:"key",value:t}],update:{count:s.count,lastRequest:s.lastRequest}}):await r.create({model:"rateLimit",data:{key:t,count:s.count,lastRequest:s.lastRequest}})}catch(t){e.logger.error("Error setting rate limit",t)}}}}(e,e.rateLimit.modelName)}async function onRequestRateLimit(e,t){if(!t.rateLimit.enabled)return;const r=new URL(e.url).pathname.replace(t.options.basePath||"/api/auth","");let s=t.rateLimit.window,n=t.rateLimit.max;const i=getIp(e,t.options);if(!i)return;const o=i+r,a=function(){const e=[{pathMatcher:e=>e.startsWith("/sign-in")||e.startsWith("/sign-up")||e.startsWith("/change-password")||e.startsWith("/change-email"),window:10,max:3}];return e}(),d=a.find((e=>e.pathMatcher(r)));d&&(s=d.window,n=d.max);for(const e of t.options.plugins||[])if(e.rateLimit){const t=e.rateLimit.find((e=>e.pathMatcher(r)));if(t){s=t.window,n=t.max;break}}if(t.rateLimit.customRules){const i=Object.keys(t.rateLimit.customRules).find((e=>{if(e.includes("*")){return wildcardMatch(e)(r)}return e===r}));if(i){const r=t.rateLimit.customRules[i],o="function"==typeof r?await r(e):r;o&&(s=o.window,n=o.max)}}const c=getRateLimitStorage(t),u=await c.get(o),l=Date.now();if(u){const e=l-u.lastRequest;if(function(e,t,r){const s=1e3*t;return Date.now()-r.lastRequest<s&&r.count>=e}(n,s,u)){const e=function(e,t){const r=Date.now(),s=1e3*t;return Math.ceil((e+s-r)/1e3)}(u.lastRequest,s);return function(e){return new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":e.toString()}})}(e)}e>1e3*s?await c.set(o,{...u,count:1,lastRequest:l},!0):await c.set(o,{...u,count:u.count+1,lastRequest:l},!0)}else await c.set(o,{key:o,count:1,lastRequest:l})}async function runBeforeHooks(e,t){let r={};for(const s of t)if(s.matcher(e)){const t=await s.handler({...e,returnHeaders:!1});if(t&&"object"==typeof t){if("context"in t&&"object"==typeof t.context){const{headers:e,...s}=t.context;e instanceof Headers&&(r.headers?e.forEach(((e,t)=>{r.headers?.set(t,e)})):r.headers=e),r=u(s,r);continue}return t}}return{context:r}}async function runAfterHooks(e,t){for(const r of t)if(r.matcher(e)){const t=await r.handler(e).catch((e=>{if(e instanceof O)return{response:e,headers:e.headers?new Headers(e.headers):null};throw e}));t.headers&&t.headers.forEach(((t,r)=>{e.context.responseHeaders?"set-cookie"===r.toLowerCase()?e.context.responseHeaders.append(r,t):e.context.responseHeaders.set(r,t):e.context.responseHeaders=new Headers({[r]:t})})),t.response&&(e.context.returned=t.response)}return{response:e.context.returned,headers:e.context.responseHeaders}}function getHooks(e){const t=e.options.plugins||[],r=[],s=[];e.options.hooks?.before&&r.push({matcher:()=>!0,handler:e.options.hooks.before}),e.options.hooks?.after&&s.push({matcher:()=>!0,handler:e.options.hooks.after});const n=t.map((e=>{if(e.hooks?.before)return e.hooks.before})).filter((e=>void 0!==e)).flat(),i=t.map((e=>{if(e.hooks?.after)return e.hooks.after})).filter((e=>void 0!==e)).flat();return n.length&&r.push(...n),i.length&&s.push(...i),{beforeHooks:r,afterHooks:s}}function getEndpoints(e,t){const r=t.plugins?.reduce(((e,t)=>({...e,...t.endpoints})),{}),s=t.plugins?.map((t=>t.middlewares?.map((t=>{const middleware=async r=>t.middleware({...r,context:{...e,...r.context}});return middleware.options=t.middleware.options,{path:t.path,middleware:middleware}})))).filter((e=>void 0!==e)).flat()||[],n={signInSocial:rs,callbackOAuth:is,getSession:getSession(),signOut:os,signUpEmail:Vr("/sign-up/email",{method:"POST",body:nr.record(nr.string(),nr.any()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},(async e=>{if(!e.context.options.emailAndPassword?.enabled||e.context.options.emailAndPassword?.disableSignUp)throw new O("BAD_REQUEST",{message:"Email and password sign up is not enabled"});const t=e.body,{name:r,email:s,password:n,image:o,callbackURL:a,...d}=t;if(!nr.string().email().safeParse(s).success)throw new O("BAD_REQUEST",{message:Jr.INVALID_EMAIL});const c=e.context.password.config.minPasswordLength;if(n.length<c)throw e.context.logger.error("Password is too short"),new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_SHORT});const u=e.context.password.config.maxPasswordLength;if(n.length>u)throw e.context.logger.error("Password is too long"),new O("BAD_REQUEST",{message:Jr.PASSWORD_TOO_LONG});const l=await e.context.internalAdapter.findUserByEmail(s);if(l?.user)throw e.context.logger.info(`Sign-up attempt for existing email: ${s}`),new O("UNPROCESSABLE_ENTITY",{message:Jr.USER_ALREADY_EXISTS});const p=parseUserInput(e.context.options,d),h=await e.context.password.hash(n);let m;try{if(m=await e.context.internalAdapter.createUser({email:s.toLowerCase(),name:r,image:o,...p,emailVerified:!1},e),!m)throw new O("BAD_REQUEST",{message:Jr.FAILED_TO_CREATE_USER})}catch(t){if(i&&e.context.logger.error("Failed to create user",t),t instanceof O)throw t;throw new O("UNPROCESSABLE_ENTITY",{message:Jr.FAILED_TO_CREATE_USER,details:t})}if(!m)throw new O("UNPROCESSABLE_ENTITY",{message:Jr.FAILED_TO_CREATE_USER});if(await e.context.internalAdapter.linkAccount({userId:m.id,providerId:"credential",accountId:m.id,password:h},e),e.context.options.emailVerification?.sendOnSignUp||e.context.options.emailAndPassword.requireEmailVerification){const r=await createEmailVerificationToken(e.context.secret,m.email,void 0,e.context.options.emailVerification?.expiresIn),s=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${t.callbackURL||"/"}`;await(e.context.options.emailVerification?.sendVerificationEmail?.({user:m,url:s,token:r},e.request))}if(!1===e.context.options.emailAndPassword.autoSignIn||e.context.options.emailAndPassword.requireEmailVerification)return e.json({token:null,user:{id:m.id,email:m.email,name:m.name,image:m.image,emailVerified:m.emailVerified,createdAt:m.createdAt,updatedAt:m.updatedAt}});const f=await e.context.internalAdapter.createSession(m.id,e.headers);if(!f)throw new O("BAD_REQUEST",{message:Jr.FAILED_TO_CREATE_SESSION});return await setSessionCookie(e,{session:f,user:m}),e.json({token:f.token,user:{id:m.id,email:m.email,name:m.name,image:m.image,emailVerified:m.emailVerified,createdAt:m.createdAt,updatedAt:m.updatedAt}})})),signInEmail:ss,forgetPassword:as,resetPassword:cs,verifyEmail:ts,sendVerificationEmail:es,changeEmail:ms,changePassword:us,setPassword:ls,updateUser:Vr("/update-user",{method:"POST",body:nr.record(nr.string(),nr.any()),use:[Kr],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},(async e=>{const t=e.body;if(t.email)throw new O("BAD_REQUEST",{message:Jr.EMAIL_CAN_NOT_BE_UPDATED});const{name:r,image:s,...n}=t,i=e.context.session;if(void 0===s&&void 0===r&&0===Object.keys(n).length)return e.json({status:!0});const o=parseUserInput(e.context.options,n,"update"),a=await e.context.internalAdapter.updateUser(i.user.id,{name:r,image:s,...o},e);return await setSessionCookie(e,{session:i.session,user:a}),e.json({status:!0})})),deleteUser:ps,forgetPasswordCallback:ds,listSessions:Vr("/list-sessions",{method:"GET",use:[Kr],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},(async e=>{try{const t=(await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter((e=>e.expiresAt>new Date));return e.json(t)}catch(t){throw e.context.logger.error(t),e.error("INTERNAL_SERVER_ERROR")}})),revokeSession:Gr,revokeSessions:Yr,revokeOtherSessions:Xr,linkSocialAccount:ws,listUserAccounts:gs,deleteUserCallback:hs,unlinkAccount:vs,refreshToken:bs},o=function(e,t){const r={};for(const[s,n]of Object.entries(e))r[s]=async e=>{const r=await t;let s={...e,context:{...r,returned:void 0,responseHeaders:void 0,session:null},path:n.path,headers:e?.headers?new Headers(e?.headers):void 0};const{beforeHooks:i,afterHooks:o}=getHooks(r),a=await runBeforeHooks(s,i);if("context"in a&&a.context&&"object"==typeof a.context){const{headers:e,...t}=a.context;e&&e.forEach(((e,t)=>{s.headers.set(t,e)})),s=u(t,s)}else if(a)return a;s.asResponse=!1,s.returnHeaders=!0;const d=await n(s).catch((e=>{if(e instanceof O)return{response:e,headers:e.headers?new Headers(e.headers):null};throw e}));s.context.returned=d.response,s.context.responseHeaders=d.headers;const c=await runAfterHooks(s,o);if(c.response&&(d.response=c.response),d.response instanceof O&&!e?.asResponse)throw d.response;return e?.asResponse?toResponse(d.response,{headers:d.headers}):e?.returnHeaders?{headers:d.headers,response:d.response}:d.response},r[s].path=n.path,r[s].options=n.options;return r}({...n,...r,ok:ys,error:fs},e);return{api:o,middlewares:s}}const _s=16384,xs=16,Ts=1,ks=64;async function generateKey(e,t){return await scryptAsync(e.normalize("NFKC"),t,{N:_s,p:Ts,r:xs,dkLen:ks,maxmem:128*_s*xs*2})}const hashPassword=async e=>{const t=hex_encode(n(new Uint8Array(16))),r=await generateKey(e,t);return`${t}:${hex_encode(r)}`},verifyPassword=async({hash:e,password:t})=>{const[r,s]=e.split(":");return function(e,t){const r=new Uint8Array(e),s=new Uint8Array(t);if(r.length!==s.length)return!1;let n=0;for(let e=0;e<r.length;e++)n|=r[e]^s[e];return 0===n}(await generateKey(t,r),function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){const r=asciiToBase16(e.charCodeAt(n)),i=asciiToBase16(e.charCodeAt(n+1));if(void 0===r||void 0===i){const t=e[n]+e[n+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+n)}s[t]=16*r+i}return s}(s))},getAuthTables=e=>{const t=e.plugins?.reduce(((e,t)=>{const r=t.schema;if(!r)return e;for(const[t,s]of Object.entries(r))e[t]={fields:{...e[t]?.fields,...s.fields},modelName:s.modelName||t};return e}),{}),r="database"===e.rateLimit?.storage,s={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:n,session:i,account:o,...a}=t||{},d={session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...i?.fields,...e.session?.additionalFields},order:2}};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...n?.fields,...e.user?.additionalFields},order:1},...!e.secondaryStorage||e.session?.storeSessionInDatabase?d:{},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...o?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...a,...r?s:{}}};function isUndefined(e){return void 0===e||void 0===e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isBoolean(e){return"boolean"==typeof e}function isNull(e){return null===e}function isDate(e){return e instanceof Date}function isBigInt(e){return"bigint"==typeof e}function isFunction(e){return"function"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function freeze(e){return Object.freeze(e)}function asArray(e){return isReadonlyArray(e)?e:[e]}function isReadonlyArray(e){return Array.isArray(e)}function noop(e){return e}const As=freeze({is:e=>"AlterTableNode"===e.kind,create:e=>freeze({kind:"AlterTableNode",table:e}),cloneWithTableProps:(e,t)=>freeze({...e,...t}),cloneWithColumnAlteration:(e,t)=>freeze({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})}),Es=freeze({is:e=>"IdentifierNode"===e.kind,create:e=>freeze({kind:"IdentifierNode",name:e})}),Is=freeze({is:e=>"CreateIndexNode"===e.kind,create:e=>freeze({kind:"CreateIndexNode",name:Es.create(e)}),cloneWith:(e,t)=>freeze({...e,...t}),cloneWithColumns:(e,t)=>freeze({...e,columns:[...e.columns||[],...t]})}),Ss=freeze({is:e=>"CreateSchemaNode"===e.kind,create:(e,t)=>freeze({kind:"CreateSchemaNode",schema:Es.create(e),...t}),cloneWith:(e,t)=>freeze({...e,...t})}),Os=["preserve rows","delete rows","drop"],Cs=freeze({is:e=>"CreateTableNode"===e.kind,create:e=>freeze({kind:"CreateTableNode",table:e,columns:freeze([])}),cloneWithColumn:(e,t)=>freeze({...e,columns:freeze([...e.columns,t])}),cloneWithConstraint:(e,t)=>freeze({...e,constraints:e.constraints?freeze([...e.constraints,t]):freeze([t])}),cloneWithFrontModifier:(e,t)=>freeze({...e,frontModifiers:e.frontModifiers?freeze([...e.frontModifiers,t]):freeze([t])}),cloneWithEndModifier:(e,t)=>freeze({...e,endModifiers:e.endModifiers?freeze([...e.endModifiers,t]):freeze([t])}),cloneWith:(e,t)=>freeze({...e,...t})}),Rs=freeze({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>freeze({kind:"SchemableIdentifierNode",identifier:Es.create(e)}),createWithSchema:(e,t)=>freeze({kind:"SchemableIdentifierNode",schema:Es.create(e),identifier:Es.create(t)})}),Ds=freeze({is:e=>"DropIndexNode"===e.kind,create:(e,t)=>freeze({kind:"DropIndexNode",name:Rs.create(e),...t}),cloneWith:(e,t)=>freeze({...e,...t})}),Us=freeze({is:e=>"DropSchemaNode"===e.kind,create:(e,t)=>freeze({kind:"DropSchemaNode",schema:Es.create(e),...t}),cloneWith:(e,t)=>freeze({...e,...t})}),Bs=freeze({is:e=>"DropTableNode"===e.kind,create:(e,t)=>freeze({kind:"DropTableNode",table:e,...t}),cloneWith:(e,t)=>freeze({...e,...t})}),Ps=freeze({is:e=>"AliasNode"===e.kind,create:(e,t)=>freeze({kind:"AliasNode",node:e,alias:t})}),Ls=freeze({is:e=>"TableNode"===e.kind,create:e=>freeze({kind:"TableNode",table:Rs.create(e)}),createWithSchema:(e,t)=>freeze({kind:"TableNode",table:Rs.createWithSchema(e,t)})});function isOperationNodeSource(e){return isObject(e)&&isFunction(e.toOperationNode)}const qs=freeze({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>freeze({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>freeze({kind:"SelectModifierNode",rawModifier:e})}),Ws=freeze({is:e=>"AndNode"===e.kind,create:(e,t)=>freeze({kind:"AndNode",left:e,right:t})}),$s=freeze({is:e=>"OrNode"===e.kind,create:(e,t)=>freeze({kind:"OrNode",left:e,right:t})}),Ms=freeze({is:e=>"OnNode"===e.kind,create:e=>freeze({kind:"OnNode",on:e}),cloneWithOperation:(e,t,r)=>freeze({...e,on:"And"===t?Ws.create(e.on,r):$s.create(e.on,r)})}),zs=freeze({is:e=>"JoinNode"===e.kind,create:(e,t)=>freeze({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,r)=>freeze({kind:"JoinNode",joinType:e,table:t,on:Ms.create(r)}),cloneWithOn:(e,t)=>freeze({...e,on:e.on?Ms.cloneWithOperation(e.on,"And",t):Ms.create(t)})}),js=freeze({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,r)=>freeze({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})}),Zs=["->","->>"],Vs=["not","-","exists","not exists"],Fs=[...["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||"],...Zs,...Vs,"between","between symmetric"],Qs=freeze({is:e=>"OperatorNode"===e.kind,create:e=>freeze({kind:"OperatorNode",operator:e})});function isJSONOperator(e){return isString(e)&&Zs.includes(e)}const Js=freeze({is:e=>"ColumnNode"===e.kind,create:e=>freeze({kind:"ColumnNode",column:Es.create(e)})}),Ks=freeze({is:e=>"SelectAllNode"===e.kind,create:()=>freeze({kind:"SelectAllNode"})}),Hs=freeze({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>freeze({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>freeze({kind:"ReferenceNode",table:e,column:Ks.create()})});class DynamicReferenceBuilder{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return parseSimpleReferenceExpression(this.#e)}}function isDynamicReferenceBuilder(e){return isObject(e)&&isOperationNodeSource(e)&&isString(e.dynamicReference)}const Gs=freeze({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>freeze({kind:"OrderByItemNode",orderBy:e,direction:t})}),Ys=freeze({is:e=>"RawNode"===e.kind,create:(e,t)=>freeze({kind:"RawNode",sqlFragments:freeze(e),parameters:freeze(t)}),createWithSql:e=>Ys.create([e],[]),createWithChild:e=>Ys.create(["",""],[e]),createWithChildren:e=>Ys.create(new Array(e.length+1).fill(""),e)});function isOrderByDirection(e){return"asc"===e||"desc"===e}function parseOrderBy(e){if(2===e.length)return[parseOrderByItem(e[0],e[1])];if(1===e.length){const[t]=e;return Array.isArray(t)?t.map((e=>parseOrderByItem(e))):[parseOrderByItem(t)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function parseOrderByItem(e,t){const r=function(e){if(isExpressionOrFactory(e))return parseExpression(e);if(isDynamicReferenceBuilder(e))return e.toOperationNode();const[t,r]=e.split(" ");if(r){if(!isOrderByDirection(r))throw new Error(`Invalid order by direction: ${r}`);return Gs.create(parseStringReference(t),parseOrderByDirectionExpression(r))}return parseStringReference(e)}(e);if(Gs.is(r)){if(t)throw new Error("Cannot specify direction twice!");return r}return Gs.create(r,parseOrderByDirectionExpression(t))}function parseOrderByDirectionExpression(e){if(e)return"asc"===e||"desc"===e?Ys.createWithSql(e):e.toOperationNode()}const Xs=freeze({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>freeze({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>freeze({...e,traversal:t})}),en=freeze({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>freeze({kind:"JSONOperatorChainNode",operator:e,values:freeze([])}),cloneWithValue:(e,t)=>freeze({...e,values:freeze([...e.values,t])})}),tn=freeze({is:e=>"JSONPathNode"===e.kind,create:e=>freeze({kind:"JSONPathNode",inOperator:e,pathLegs:freeze([])}),cloneWithLeg:(e,t)=>freeze({...e,pathLegs:freeze([...e.pathLegs,t])})});function parseSimpleReferenceExpression(e){return isString(e)?parseStringReference(e):e.toOperationNode()}function parseReferenceExpressionOrList(e){return isReadonlyArray(e)?e.map((e=>parseReferenceExpression(e))):[parseReferenceExpression(e)]}function parseReferenceExpression(e){return isExpressionOrFactory(e)?parseExpression(e):parseSimpleReferenceExpression(e)}function parseStringReference(e){if(!e.includes("."))return Hs.create(Js.create(e));const t=e.split(".").map(trim$2);if(3===t.length)return function(e){const[t,r,s]=e;return Hs.create(Js.create(s),Ls.createWithSchema(t,r))}(t);if(2===t.length)return function(e){const[t,r]=e;return Hs.create(Js.create(r),Ls.create(t))}(t);throw new Error(`invalid column reference ${e}`)}function parseColumnName(e){return Js.create(e)}function parseOrderedColumnName(e){if(e.includes(" ")){const[t,r]=e.split(" ").map(trim$2);if(!isOrderByDirection(r))throw new Error(`invalid order direction "${r}" next to "${t}"`);return parseOrderBy([t,r])[0]}return parseColumnName(e)}function trim$2(e){return e.trim()}const rn=freeze({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>freeze({kind:"PrimitiveValueListNode",values:freeze([...e])})}),sn=freeze({is:e=>"ValueListNode"===e.kind,create:e=>freeze({kind:"ValueListNode",values:freeze(e)})}),nn=freeze({is:e=>"ValueNode"===e.kind,create:e=>freeze({kind:"ValueNode",value:e}),createImmediate:e=>freeze({kind:"ValueNode",value:e,immediate:!0})});function parseValueExpressionOrList(e){return isReadonlyArray(e)?function(e){if(e.some(isExpressionOrFactory))return sn.create(e.map((e=>parseValueExpression(e))));return rn.create(e)}(e):parseValueExpression(e)}function parseValueExpression(e){return isExpressionOrFactory(e)?parseExpression(e):nn.create(e)}function isSafeImmediateValue(e){return isNumber(e)||isBoolean(e)||isNull(e)}function parseSafeImmediateValue(e){if(!isSafeImmediateValue(e))throw new Error(`unsafe immediate value ${JSON.stringify(e)}`);return nn.createImmediate(e)}const on=freeze({is:e=>"ParensNode"===e.kind,create:e=>freeze({kind:"ParensNode",node:e})});function parseValueBinaryOperationOrExpression(e){if(3===e.length)return parseValueBinaryOperation(e[0],e[1],e[2]);if(1===e.length)return parseValueExpression(e[0]);throw new Error(`invalid arguments: ${JSON.stringify(e)}`)}function parseValueBinaryOperation(e,t,r){return function(e){return"is"===e||"is not"===e}(t)&&needsIsOperator(r)?js.create(parseReferenceExpression(e),parseOperator(t),nn.createImmediate(r)):js.create(parseReferenceExpression(e),parseOperator(t),parseValueExpressionOrList(r))}function parseReferentialBinaryOperation(e,t,r){return js.create(parseReferenceExpression(e),parseOperator(t),parseReferenceExpression(r))}function parseFilterObject(e,t){return parseFilterList(Object.entries(e).filter((([,e])=>!isUndefined(e))).map((([e,t])=>parseValueBinaryOperation(e,needsIsOperator(t)?"is":"=",t))),t)}function parseFilterList(e,t,r=!0){const s="and"===t?Ws.create:$s.create;if(0===e.length)return js.create(nn.createImmediate(1),Qs.create("="),nn.createImmediate("and"===t?1:0));let n=toOperationNode(e[0]);for(let t=1;t<e.length;++t)n=s(n,toOperationNode(e[t]));return e.length>1&&r?on.create(n):n}function needsIsOperator(e){return isNull(e)||isBoolean(e)}function parseOperator(e){if(isString(e)&&Fs.includes(e))return Qs.create(e);if(isOperationNodeSource(e))return e.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(e)}`)}function toOperationNode(e){return isOperationNodeSource(e)?e.toOperationNode():e}const an=freeze({is:e=>"OrderByNode"===e.kind,create:e=>freeze({kind:"OrderByNode",items:freeze([...e])}),cloneWithItems:(e,t)=>freeze({...e,items:freeze([...e.items,...t])})}),dn=freeze({is:e=>"PartitionByNode"===e.kind,create:e=>freeze({kind:"PartitionByNode",items:freeze(e)}),cloneWithItems:(e,t)=>freeze({...e,items:freeze([...e.items,...t])})}),cn=freeze({is:e=>"OverNode"===e.kind,create:()=>freeze({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>freeze({...e,orderBy:e.orderBy?an.cloneWithItems(e.orderBy,t):an.create(t)}),cloneWithPartitionByItems:(e,t)=>freeze({...e,partitionBy:e.partitionBy?dn.cloneWithItems(e.partitionBy,t):dn.create(t)})}),un=freeze({is:e=>"FromNode"===e.kind,create:e=>freeze({kind:"FromNode",froms:freeze(e)}),cloneWithFroms:(e,t)=>freeze({...e,froms:freeze([...e.froms,...t])})}),ln=freeze({is:e=>"GroupByNode"===e.kind,create:e=>freeze({kind:"GroupByNode",items:freeze(e)}),cloneWithItems:(e,t)=>freeze({...e,items:freeze([...e.items,...t])})}),pn=freeze({is:e=>"HavingNode"===e.kind,create:e=>freeze({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,r)=>freeze({...e,having:"And"===t?Ws.create(e.having,r):$s.create(e.having,r)})}),hn=freeze({is:e=>"SelectQueryNode"===e.kind,create:e=>freeze({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,t)=>freeze({kind:"SelectQueryNode",from:un.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>freeze({...e,selections:e.selections?freeze([...e.selections,...t]):freeze(t)}),cloneWithDistinctOn:(e,t)=>freeze({...e,distinctOn:e.distinctOn?freeze([...e.distinctOn,...t]):freeze(t)}),cloneWithFrontModifier:(e,t)=>freeze({...e,frontModifiers:e.frontModifiers?freeze([...e.frontModifiers,t]):freeze([t])}),cloneWithOrderByItems:(e,t)=>freeze({...e,orderBy:e.orderBy?an.cloneWithItems(e.orderBy,t):an.create(t)}),cloneWithGroupByItems:(e,t)=>freeze({...e,groupBy:e.groupBy?ln.cloneWithItems(e.groupBy,t):ln.create(t)}),cloneWithLimit:(e,t)=>freeze({...e,limit:t}),cloneWithOffset:(e,t)=>freeze({...e,offset:t}),cloneWithFetch:(e,t)=>freeze({...e,fetch:t}),cloneWithHaving:(e,t)=>freeze({...e,having:e.having?pn.cloneWithOperation(e.having,"And",t):pn.create(t)}),cloneWithSetOperations:(e,t)=>freeze({...e,setOperations:e.setOperations?freeze([...e.setOperations,...t]):freeze([...t])}),cloneWithoutSelections:e=>freeze({...e,selections:[]}),cloneWithoutLimit:e=>freeze({...e,limit:void 0}),cloneWithoutOffset:e=>freeze({...e,offset:void 0}),cloneWithoutOrderBy:e=>freeze({...e,orderBy:void 0}),cloneWithoutGroupBy:e=>freeze({...e,groupBy:void 0})});function preventAwait(e,t){Object.defineProperties(e.prototype,{then:{enumerable:!1,value:()=>{throw new Error(t)}}})}class JoinBuilder{#t;constructor(e){this.#t=freeze(e)}on(...e){return new JoinBuilder({...this.#t,joinNode:zs.cloneWithOn(this.#t.joinNode,parseValueBinaryOperationOrExpression(e))})}onRef(e,t,r){return new JoinBuilder({...this.#t,joinNode:zs.cloneWithOn(this.#t.joinNode,parseReferentialBinaryOperation(e,t,r))})}onTrue(){return new JoinBuilder({...this.#t,joinNode:zs.cloneWithOn(this.#t.joinNode,Ys.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#t.joinNode}}preventAwait(JoinBuilder,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const mn=freeze({is:e=>"PartitionByItemNode"===e.kind,create:e=>freeze({kind:"PartitionByItemNode",partitionBy:e})});function parsePartitionBy(e){return parseReferenceExpressionOrList(e).map(mn.create)}class OverBuilder{#t;constructor(e){this.#t=freeze(e)}orderBy(e,t){return new OverBuilder({overNode:cn.cloneWithOrderByItems(this.#t.overNode,parseOrderBy([e,t]))})}partitionBy(e){return new OverBuilder({overNode:cn.cloneWithPartitionByItems(this.#t.overNode,parsePartitionBy(e))})}$call(e){return e(this)}toOperationNode(){return this.#t.overNode}}preventAwait(OverBuilder,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const yn=freeze({is:e=>"SelectionNode"===e.kind,create:e=>freeze({kind:"SelectionNode",selection:e}),createSelectAll:()=>freeze({kind:"SelectionNode",selection:Ks.create()}),createSelectAllFromTable:e=>freeze({kind:"SelectionNode",selection:Hs.createSelectAll(e)})});function parseSelectArg(e){return isFunction(e)?parseSelectArg(e(expressionBuilder())):isReadonlyArray(e)?e.map((e=>parseSelectExpression(e))):[parseSelectExpression(e)]}function parseSelectExpression(e){return isString(e)?yn.create(function(e){const t=" as ";if(e.includes(t)){const[r,s]=e.split(t).map(trim$2);return Ps.create(parseStringReference(r),Es.create(s))}return parseStringReference(e)}(e)):isDynamicReferenceBuilder(e)?yn.create(e.toOperationNode()):yn.create(parseAliasedExpression(e))}function parseSelectAll(e){return e?Array.isArray(e)?e.map(parseSelectAllArg):[parseSelectAllArg(e)]:[yn.createSelectAll()]}function parseSelectAllArg(e){if(isString(e))return yn.createSelectAllFromTable(parseTable(e));throw new Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}const gn=freeze({is:e=>"ValuesNode"===e.kind,create:e=>freeze({kind:"ValuesNode",values:freeze(e)})}),wn=freeze({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>freeze({kind:"DefaultInsertValueNode"})});function parseInsertExpression(e){const t=isFunction(e)?e(expressionBuilder()):e;return function(e){const t=function(e){const t=new Map;for(const r of e){const e=Object.keys(r);for(const s of e)t.has(s)||void 0===r[s]||t.set(s,t.size)}return t}(e);return[freeze([...t.keys()].map(Js.create)),gn.create(e.map((e=>function(e,t){const r=Object.keys(e),s=Array.from({length:t.size});let n=!1,i=r.length;for(const o of r){const r=t.get(o);if(isUndefined(r)){i--;continue}const a=e[o];(isUndefined(a)||isExpressionOrFactory(a))&&(n=!0),s[r]=a}const o=i<t.size;if(o||n){const e=wn.create();return sn.create(s.map((t=>isUndefined(t)?e:parseValueExpression(t))))}return rn.create(s)}(e,t))))]}(isReadonlyArray(t)?t:freeze([t]))}const vn=freeze({is:e=>"InsertQueryNode"===e.kind,create:(e,t,r)=>freeze({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r}),createWithoutInto:()=>freeze({kind:"InsertQueryNode"}),cloneWith:(e,t)=>freeze({...e,...t})}),bn=freeze({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>freeze({kind:"UpdateQueryNode",table:e,...t&&{with:t}}),createWithoutTable:()=>freeze({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>freeze({...e,from:e.from?un.cloneWithFroms(e.from,t):un.create(t)}),cloneWithUpdates:(e,t)=>freeze({...e,updates:e.updates?freeze([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>freeze({...e,limit:t})}),Nn=freeze({is:e=>"UsingNode"===e.kind,create:e=>freeze({kind:"UsingNode",tables:freeze(e)}),cloneWithTables:(e,t)=>freeze({...e,tables:freeze([...e.tables,...t])})}),_n=freeze({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>freeze({kind:"DeleteQueryNode",from:un.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>freeze({...e,orderBy:e.orderBy?an.cloneWithItems(e.orderBy,t):an.create(t)}),cloneWithoutOrderBy:e=>freeze({...e,orderBy:void 0}),cloneWithLimit:(e,t)=>freeze({...e,limit:t}),cloneWithoutLimit:e=>freeze({...e,limit:void 0}),cloneWithUsing:(e,t)=>freeze({...e,using:void 0!==e.using?Nn.cloneWithTables(e.using,t):Nn.create(t)})}),xn=freeze({is:e=>"WhereNode"===e.kind,create:e=>freeze({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,r)=>freeze({...e,where:"And"===t?Ws.create(e.where,r):$s.create(e.where,r)})}),Tn=freeze({is:e=>"ReturningNode"===e.kind,create:e=>freeze({kind:"ReturningNode",selections:freeze(e)}),cloneWithSelections:(e,t)=>freeze({...e,selections:e.selections?freeze([...e.selections,...t]):freeze(t)})}),kn=freeze({is:e=>"ExplainNode"===e.kind,create:(e,t)=>freeze({kind:"ExplainNode",format:e,options:t})}),An=freeze({is:e=>"WhenNode"===e.kind,create:e=>freeze({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>freeze({...e,result:t})}),En=freeze({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>freeze({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>freeze({...e,using:t}),cloneWithWhen:(e,t)=>freeze({...e,whens:e.whens?freeze([...e.whens,t]):freeze([t])}),cloneWithThen:(e,t)=>freeze({...e,whens:e.whens?freeze([...e.whens.slice(0,-1),An.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}),In=freeze({is:e=>"OutputNode"===e.kind,create:e=>freeze({kind:"OutputNode",selections:freeze(e)}),cloneWithSelections:(e,t)=>freeze({...e,selections:e.selections?freeze([...e.selections,...t]):freeze(t)})}),Sn=freeze({is:e=>hn.is(e)||vn.is(e)||bn.is(e)||_n.is(e)||En.is(e),cloneWithEndModifier:(e,t)=>freeze({...e,endModifiers:e.endModifiers?freeze([...e.endModifiers,t]):freeze([t])}),cloneWithWhere:(e,t)=>freeze({...e,where:e.where?xn.cloneWithOperation(e.where,"And",t):xn.create(t)}),cloneWithJoin:(e,t)=>freeze({...e,joins:e.joins?freeze([...e.joins,t]):freeze([t])}),cloneWithReturning:(e,t)=>freeze({...e,returning:e.returning?Tn.cloneWithSelections(e.returning,t):Tn.create(t)}),cloneWithoutReturning:e=>freeze({...e,returning:void 0}),cloneWithoutWhere:e=>freeze({...e,where:void 0}),cloneWithExplain:(e,t,r)=>freeze({...e,explain:kn.create(t,r?.toOperationNode())}),cloneWithTop:(e,t)=>freeze({...e,top:t}),cloneWithOutput:(e,t)=>freeze({...e,output:e.output?In.cloneWithSelections(e.output,t):In.create(t)})}),On=freeze({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>freeze({kind:"ColumnUpdateNode",column:e,value:t})});function parseUpdate(...e){return 2===e.length?[On.create(parseReferenceExpression(e[0]),parseValueExpression(e[1]))]:parseUpdateObjectExpression(e[0])}function parseUpdateObjectExpression(e){const t=isFunction(e)?e(expressionBuilder()):e;return Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>On.create(Js.create(e),parseValueExpression(t))))}const Cn=freeze({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>freeze({kind:"OnDuplicateKeyNode",updates:e})});class InsertResult{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}class NoResultError extends Error{node;constructor(e){super("no result"),this.node=e}}function isNoResultErrorConstructor(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}const Rn=freeze({is:e=>"OnConflictNode"===e.kind,create:()=>freeze({kind:"OnConflictNode"}),cloneWith:(e,t)=>freeze({...e,...t}),cloneWithIndexWhere:(e,t)=>freeze({...e,indexWhere:e.indexWhere?xn.cloneWithOperation(e.indexWhere,"And",t):xn.create(t)}),cloneWithIndexOrWhere:(e,t)=>freeze({...e,indexWhere:e.indexWhere?xn.cloneWithOperation(e.indexWhere,"Or",t):xn.create(t)}),cloneWithUpdateWhere:(e,t)=>freeze({...e,updateWhere:e.updateWhere?xn.cloneWithOperation(e.updateWhere,"And",t):xn.create(t)}),cloneWithUpdateOrWhere:(e,t)=>freeze({...e,updateWhere:e.updateWhere?xn.cloneWithOperation(e.updateWhere,"Or",t):xn.create(t)}),cloneWithoutIndexWhere:e=>freeze({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>freeze({...e,updateWhere:void 0})});class OnConflictBuilder{#t;constructor(e){this.#t=freeze(e)}column(e){const t=Js.create(e);return new OnConflictBuilder({...this.#t,onConflictNode:Rn.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?freeze([...this.#t.onConflictNode.columns,t]):freeze([t])})})}columns(e){const t=e.map(Js.create);return new OnConflictBuilder({...this.#t,onConflictNode:Rn.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?freeze([...this.#t.onConflictNode.columns,...t]):freeze(t)})})}constraint(e){return new OnConflictBuilder({...this.#t,onConflictNode:Rn.cloneWith(this.#t.onConflictNode,{constraint:Es.create(e)})})}expression(e){return new OnConflictBuilder({...this.#t,onConflictNode:Rn.cloneWith(this.#t.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new OnConflictBuilder({...this.#t,onConflictNode:Rn.cloneWithIndexWhere(this.#t.onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,r){return new OnConflictBuilder({...this.#t,onConflictNode:Rn.cloneWithIndexWhere(this.#t.onConflictNode,parseReferentialBinaryOperation(e,t,r))})}clearWhere(){return new OnConflictBuilder({...this.#t,onConflictNode:Rn.cloneWithoutIndexWhere(this.#t.onConflictNode)})}doNothing(){return new OnConflictDoNothingBuilder({...this.#t,onConflictNode:Rn.cloneWith(this.#t.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new OnConflictUpdateBuilder({...this.#t,onConflictNode:Rn.cloneWith(this.#t.onConflictNode,{updates:parseUpdateObjectExpression(e)})})}$call(e){return e(this)}}preventAwait(OnConflictBuilder,"don't await OnConflictBuilder instances.");class OnConflictDoNothingBuilder{#t;constructor(e){this.#t=freeze(e)}toOperationNode(){return this.#t.onConflictNode}}preventAwait(OnConflictDoNothingBuilder,"don't await OnConflictDoNothingBuilder instances.");class OnConflictUpdateBuilder{#t;constructor(e){this.#t=freeze(e)}where(...e){return new OnConflictUpdateBuilder({...this.#t,onConflictNode:Rn.cloneWithUpdateWhere(this.#t.onConflictNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,r){return new OnConflictUpdateBuilder({...this.#t,onConflictNode:Rn.cloneWithUpdateWhere(this.#t.onConflictNode,parseReferentialBinaryOperation(e,t,r))})}clearWhere(){return new OnConflictUpdateBuilder({...this.#t,onConflictNode:Rn.cloneWithoutUpdateWhere(this.#t.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#t.onConflictNode}}preventAwait(OnConflictUpdateBuilder,"don't await OnConflictUpdateBuilder instances.");const Dn=freeze({is:e=>"TopNode"===e.kind,create:(e,t)=>freeze({kind:"TopNode",expression:e,modifiers:t})});function parseTop(e,t){if(!isNumber(e)&&!isBigInt(e))throw new Error(`Invalid top expression: ${e}`);if(!isUndefined(t)&&!function(e){return"percent"===e||"with ties"===e||"percent with ties"===e}(t))throw new Error(`Invalid top modifiers: ${t}`);return Dn.create(e,t)}class InsertQueryBuilder{#t;constructor(e){this.#t=freeze(e)}values(e){const[t,r]=parseInsertExpression(e);return new InsertQueryBuilder({...this.#t,queryNode:vn.cloneWith(this.#t.queryNode,{columns:t,values:r})})}columns(e){return new InsertQueryBuilder({...this.#t,queryNode:vn.cloneWith(this.#t.queryNode,{columns:freeze(e.map(Js.create))})})}expression(e){return new InsertQueryBuilder({...this.#t,queryNode:vn.cloneWith(this.#t.queryNode,{values:parseExpression(e)})})}defaultValues(){return new InsertQueryBuilder({...this.#t,queryNode:vn.cloneWith(this.#t.queryNode,{defaultValues:!0})})}modifyEnd(e){return new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}ignore(){return new InsertQueryBuilder({...this.#t,queryNode:vn.cloneWith(this.#t.queryNode,{ignore:!0})})}top(e,t){return new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithTop(this.#t.queryNode,parseTop(e,t))})}onConflict(e){return new InsertQueryBuilder({...this.#t,queryNode:vn.cloneWith(this.#t.queryNode,{onConflict:e(new OnConflictBuilder({onConflictNode:Rn.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new InsertQueryBuilder({...this.#t,queryNode:vn.cloneWith(this.#t.queryNode,{onDuplicateKey:Cn.create(parseUpdateObjectExpression(e))})})}returning(e){return new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithReturning(this.#t.queryNode,parseSelectArg(e))})}returningAll(){return new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithReturning(this.#t.queryNode,parseSelectAll())})}output(e){return new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectArg(e))})}outputAll(e){return new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectAll(e))})}clearReturning(){return new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new InsertQueryBuilder({...this.#t})}$castTo(){return new InsertQueryBuilder(this.#t)}$narrowType(){return new InsertQueryBuilder(this.#t)}$assertType(){return new InsertQueryBuilder(this.#t)}withPlugin(e){return new InsertQueryBuilder({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?t.rows:[new InsertResult(t.insertId,t.numAffectedRows??t.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new InsertQueryBuilder({...this.#t,queryNode:Sn.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}preventAwait(InsertQueryBuilder,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class DeleteResult{numDeletedRows;constructor(e){this.numDeletedRows=e}}const Un=freeze({is:e=>"LimitNode"===e.kind,create:e=>freeze({kind:"LimitNode",limit:e})});class DeleteQueryBuilder{#t;constructor(e){this.#t=freeze(e)}where(...e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithWhere(this.#t.queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,r){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithWhere(this.#t.queryNode,parseReferentialBinaryOperation(e,t,r))})}clearWhere(){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithTop(this.#t.queryNode,parseTop(e,t))})}using(e){return new DeleteQueryBuilder({...this.#t,queryNode:_n.cloneWithUsing(this.#t.queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("FullJoin",e))})}returning(e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithReturning(this.#t.queryNode,parseSelectArg(e))})}returningAll(e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithReturning(this.#t.queryNode,parseSelectAll(e))})}output(e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectArg(e))})}outputAll(e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectAll(e))})}clearReturning(){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithoutReturning(this.#t.queryNode)})}clearLimit(){return new DeleteQueryBuilder({...this.#t,queryNode:_n.cloneWithoutLimit(this.#t.queryNode)})}clearOrderBy(){return new DeleteQueryBuilder({...this.#t,queryNode:_n.cloneWithoutOrderBy(this.#t.queryNode)})}orderBy(e,t){return new DeleteQueryBuilder({...this.#t,queryNode:_n.cloneWithOrderByItems(this.#t.queryNode,parseOrderBy([e,t]))})}limit(e){return new DeleteQueryBuilder({...this.#t,queryNode:_n.cloneWithLimit(this.#t.queryNode,Un.create(parseValueExpression(e)))})}modifyEnd(e){return new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}$call(e){return e(this)}$if(e,t){return e?t(this):new DeleteQueryBuilder({...this.#t})}$castTo(){return new DeleteQueryBuilder(this.#t)}$narrowType(){return new DeleteQueryBuilder(this.#t)}$assertType(){return new DeleteQueryBuilder(this.#t)}withPlugin(e){return new DeleteQueryBuilder({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?t.rows:[new DeleteResult(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new DeleteQueryBuilder({...this.#t,queryNode:Sn.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}preventAwait(DeleteQueryBuilder,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class UpdateResult{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}class UpdateQueryBuilder{#t;constructor(e){this.#t=freeze(e)}where(...e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithWhere(this.#t.queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,r){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithWhere(this.#t.queryNode,parseReferentialBinaryOperation(e,t,r))})}clearWhere(){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithTop(this.#t.queryNode,parseTop(e,t))})}from(e){return new UpdateQueryBuilder({...this.#t,queryNode:bn.cloneWithFromItems(this.#t.queryNode,parseTableExpressionOrList(e))})}innerJoin(...e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("FullJoin",e))})}limit(e){return new UpdateQueryBuilder({...this.#t,queryNode:bn.cloneWithLimit(this.#t.queryNode,Un.create(parseValueExpression(e)))})}set(...e){return new UpdateQueryBuilder({...this.#t,queryNode:bn.cloneWithUpdates(this.#t.queryNode,parseUpdate(...e))})}returning(e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithReturning(this.#t.queryNode,parseSelectArg(e))})}returningAll(e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithReturning(this.#t.queryNode,parseSelectAll(e))})}output(e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectArg(e))})}outputAll(e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectAll(e))})}modifyEnd(e){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}clearReturning(){return new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new UpdateQueryBuilder({...this.#t})}$castTo(){return new UpdateQueryBuilder(this.#t)}$narrowType(){return new UpdateQueryBuilder(this.#t)}$assertType(){return new UpdateQueryBuilder(this.#t)}withPlugin(e){return new UpdateQueryBuilder({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,s=e.query;return s.returning&&r.supportsReturning||s.output&&r.supportsOutput?t.rows:[new UpdateResult(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new UpdateQueryBuilder({...this.#t,queryNode:Sn.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}preventAwait(UpdateQueryBuilder,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const Bn=freeze({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>freeze({kind:"CommonTableExpressionNameNode",table:Ls.create(e),columns:t?freeze(t.map(Js.create)):void 0})}),Pn=freeze({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>freeze({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>freeze({...e,...t})});class CTEBuilder{#t;constructor(e){this.#t=freeze(e)}materialized(){return new CTEBuilder({...this.#t,node:Pn.cloneWith(this.#t.node,{materialized:!0})})}notMaterialized(){return new CTEBuilder({...this.#t,node:Pn.cloneWith(this.#t.node,{materialized:!1})})}toOperationNode(){return this.#t.node}}function parseCommonTableExpression(e,t){const r=t(new QueryCreator({executor:Zn})).toOperationNode();return isFunction(e)?e(function(e){return t=>new CTEBuilder({node:Pn.create(parseCommonTableExpressionName(t),e)})}(r)).toOperationNode():Pn.create(parseCommonTableExpressionName(e),r)}function parseCommonTableExpressionName(e){if(e.includes("(")){const t=e.split(/[\(\)]/),r=t[0],s=t[1].split(",").map((e=>e.trim()));return Bn.create(r,s)}return Bn.create(e)}preventAwait(CTEBuilder,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");const Ln=freeze({is:e=>"WithNode"===e.kind,create:(e,t)=>freeze({kind:"WithNode",expressions:freeze([e]),...t}),cloneWithExpression:(e,t)=>freeze({...e,expressions:freeze([...e.expressions,t])})}),qn=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function randomString(e){let t="";for(let r=0;r<e;++r)t+=qn[~~(Math.random()*qn.length)];return t}function createQueryId(){return new LazyQueryId}class LazyQueryId{#r;get queryId(){return void 0===this.#r&&(this.#r=randomString(8)),this.#r}}class OperationNodeTransformer{nodeStack=[];#s=freeze({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);const t=this.transformNodeImpl(e);return this.nodeStack.pop(),freeze(t)}transformNodeImpl(e){return this.#s[e.kind](e)}transformNodeList(e){return e?freeze(e.map((e=>this.transformNode(e)))):e}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:freeze([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),endModifiers:this.transformNodeList(e.endModifiers),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,orderBy:this.transformNode(e.orderBy),filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformMergeQuery(e){return{kind:"MergeQueryNode",into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top),endModifiers:this.transformNodeList(e.endModifiers),output:this.transformNode(e.output)}}transformMatched(e){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformCast(e){return{kind:"CastNode",expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)}}transformFetch(e){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount),modifier:e.modifier}}transformTop(e){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e){return{kind:"OutputNode",selections:this.transformNodeList(e.selections)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}const Wn=freeze({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),$n={json_agg:!0,to_json:!0};class WithSchemaTransformer extends OperationNodeTransformer{#n;#i=new Set;#o=new Set;constructor(e){super(),this.#n=e}transformNodeImpl(e){if(!this.#a(e))return super.transformNodeImpl(e);const t=this.#d(e);for(const e of t)this.#o.add(e);const r=this.#c(e);for(const e of r)this.#i.add(e);const s=super.transformNodeImpl(e);for(const e of r)this.#i.delete(e);for(const e of t)this.#o.delete(e);return s}transformSchemableIdentifier(e){const t=super.transformSchemableIdentifier(e);return t.schema||!this.#i.has(e.identifier.name)?t:{...t,schema:Es.create(this.#n)}}transformReferences(e){const t=super.transformReferences(e);return t.table.table.schema?t:{...t,table:Ls.createWithSchema(this.#n,t.table.table.identifier.name)}}transformAggregateFunction(e){return{...super.transformAggregateFunction({...e,aggregated:[]}),aggregated:this.#u(e,"aggregated")}}transformFunction(e){return{...super.transformFunction({...e,arguments:[]}),arguments:this.#u(e,"arguments")}}#u(e,t){return $n[e.func]?e[t].map((e=>!Ls.is(e)||e.table.schema?this.transformNode(e):{...e,table:this.transformIdentifier(e.table.identifier)})):this.transformNodeList(e[t])}#a(e){return e.kind in Wn}#c(e){const t=new Set;if("name"in e&&e.name&&Rs.is(e.name)&&this.#l(e.name,t),"from"in e&&e.from)for(const r of e.from.froms)this.#p(r,t);if("into"in e&&e.into&&this.#p(e.into,t),"table"in e&&e.table&&this.#p(e.table,t),"joins"in e&&e.joins)for(const r of e.joins)this.#p(r.table,t);return"using"in e&&e.using&&this.#p(e.using,t),t}#d(e){const t=new Set;return"with"in e&&e.with&&this.#h(e.with,t),t}#p(e,t){const r=Ls.is(e)?e:Ps.is(e)&&Ls.is(e.node)?e.node:null;r&&this.#l(r.table,t)}#l(e,t){const r=e.identifier.name;this.#i.has(r)||this.#o.has(r)||t.add(r)}#h(e,t){for(const r of e.expressions){const e=r.name.table.table.identifier.name;this.#o.has(e)||t.add(e)}}}class WithSchemaPlugin{#m;constructor(e){this.#m=new WithSchemaTransformer(e)}transformQuery(e){return this.#m.transformNode(e.node)}async transformResult(e){return e.result}}const Mn=freeze({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>freeze({kind:"MatchedNode",not:e,bySource:t})});function parseMergeWhen(e,t,r){return An.create(parseFilterList([Mn.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&r?parseReferentialBinaryOperation(t[0],t[1],t[2]):parseValueBinaryOperationOrExpression(t)]:[]],"and",!1))}function parseMergeThen(e){return isString(e)?Ys.create([e],[]):isOperationNodeSource(e)?e.toOperationNode():e}class Deferred{#f;#y;#g;constructor(){this.#f=new Promise(((e,t)=>{this.#g=t,this.#y=e}))}get promise(){return this.#f}resolve=e=>{this.#y&&this.#y(e)};reject=e=>{this.#g&&this.#g(e)}}const zn=new Set;const jn=freeze([]);class QueryExecutorBase{#w;constructor(e=jn){this.#w=e}get plugins(){return this.#w}transformQuery(e,t){for(const r of this.#w){const s=r.transformQuery({node:e,queryId:t});if(s.kind!==e.kind)throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${s.kind}`].join(" "));e=s}return e}async executeQuery(e,t){return await this.provideConnection((async r=>{const s=await r.executeQuery(e),n=await this.#v(s,t);return function(e,t){const{numAffectedRows:r}=e;if(void 0===r&&void 0===e.numUpdatedOrDeletedRows||void 0!==r&&void 0!==t.numAffectedRows)return;!function(e){zn.has(e)||(zn.add(e),console.log(e))}("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}(s,n),n}))}async*stream(e,t,r){const s=new Deferred,n=new Deferred;this.provideConnection((async e=>(s.resolve(e),await n.promise))).catch((e=>s.reject(e)));const i=await s.promise;try{for await(const s of i.streamQuery(e,t))yield await this.#v(s,r)}finally{n.resolve()}}async#v(e,t){for(const r of this.#w)e=await r.transformResult({result:e,queryId:t});return e}}class NoopQueryExecutor extends QueryExecutorBase{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new NoopQueryExecutor([...this.plugins,e])}withPlugins(e){return new NoopQueryExecutor([...this.plugins,...e])}withPluginAtFront(e){return new NoopQueryExecutor([e,...this.plugins])}withoutPlugins(){return new NoopQueryExecutor([])}}const Zn=new NoopQueryExecutor;class MergeResult{numChangedRows;constructor(e){this.numChangedRows=e}}class MergeQueryBuilder{#t;constructor(e){this.#t=freeze(e)}modifyEnd(e){return new MergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new MergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithTop(this.#t.queryNode,parseTop(e,t))})}using(...e){return new WheneableMergeQueryBuilder({...this.#t,queryNode:En.cloneWithUsing(this.#t.queryNode,parseJoin("Using",e))})}output(e){return new MergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectArg(e))})}outputAll(e){return new MergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectAll(e))})}}preventAwait(MergeQueryBuilder,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class WheneableMergeQueryBuilder{#t;constructor(e){this.#t=freeze(e)}modifyEnd(e){return new WheneableMergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,e.toOperationNode())})}top(e,t){return new WheneableMergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithTop(this.#t.queryNode,parseTop(e,t))})}whenMatched(){return this.#b([])}whenMatchedAnd(...e){return this.#b(e)}whenMatchedAndRef(e,t,r){return this.#b([e,t,r],!0)}#b(e,t){return new MatchedThenableMergeQueryBuilder({...this.#t,queryNode:En.cloneWithWhen(this.#t.queryNode,parseMergeWhen({isMatched:!0},e,t))})}whenNotMatched(){return this.#N([])}whenNotMatchedAnd(...e){return this.#N(e)}whenNotMatchedAndRef(e,t,r){return this.#N([e,t,r],!0)}whenNotMatchedBySource(){return this.#N([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#N(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,r){return this.#N([e,t,r],!0,!0)}output(e){return new WheneableMergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectArg(e))})}outputAll(e){return new WheneableMergeQueryBuilder({...this.#t,queryNode:Sn.cloneWithOutput(this.#t.queryNode,parseSelectAll(e))})}#N(e,t=!1,r=!1){const s={...this.#t,queryNode:En.cloneWithWhen(this.#t.queryNode,parseMergeWhen({isMatched:!1,bySource:r},e,t))};return new(r?MatchedThenableMergeQueryBuilder:NotMatchedThenableMergeQueryBuilder)(s)}$call(e){return e(this)}$if(e,t){return e?t(this):new WheneableMergeQueryBuilder({...this.#t})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId);return e.query.output&&this.#t.executor.adapter.supportsOutput?t.rows:[new MergeResult(t.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}}preventAwait(WheneableMergeQueryBuilder,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");class MatchedThenableMergeQueryBuilder{#t;constructor(e){this.#t=freeze(e)}thenDelete(){return new WheneableMergeQueryBuilder({...this.#t,queryNode:En.cloneWithThen(this.#t.queryNode,parseMergeThen("delete"))})}thenDoNothing(){return new WheneableMergeQueryBuilder({...this.#t,queryNode:En.cloneWithThen(this.#t.queryNode,parseMergeThen("do nothing"))})}thenUpdate(e){return new WheneableMergeQueryBuilder({...this.#t,queryNode:En.cloneWithThen(this.#t.queryNode,parseMergeThen(e(new UpdateQueryBuilder({queryId:this.#t.queryId,executor:Zn,queryNode:bn.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate((t=>t.set(...e)))}}preventAwait(MatchedThenableMergeQueryBuilder,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class NotMatchedThenableMergeQueryBuilder{#t;constructor(e){this.#t=freeze(e)}thenDoNothing(){return new WheneableMergeQueryBuilder({...this.#t,queryNode:En.cloneWithThen(this.#t.queryNode,parseMergeThen("do nothing"))})}thenInsertValues(e){const[t,r]=parseInsertExpression(e);return new WheneableMergeQueryBuilder({...this.#t,queryNode:En.cloneWithThen(this.#t.queryNode,parseMergeThen(vn.cloneWith(vn.createWithoutInto(),{columns:t,values:r})))})}}preventAwait(NotMatchedThenableMergeQueryBuilder,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class QueryCreator{#t;constructor(e){this.#t=freeze(e)}selectFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:this.#t.executor,queryNode:hn.createFrom(parseTableExpressionOrList(e),this.#t.withNode)})}selectNoFrom(e){return createSelectQueryBuilder({queryId:createQueryId(),executor:this.#t.executor,queryNode:hn.cloneWithSelections(hn.create(this.#t.withNode),parseSelectArg(e))})}insertInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:this.#t.executor,queryNode:vn.create(parseTable(e),this.#t.withNode)})}replaceInto(e){return new InsertQueryBuilder({queryId:createQueryId(),executor:this.#t.executor,queryNode:vn.create(parseTable(e),this.#t.withNode,!0)})}deleteFrom(e){return new DeleteQueryBuilder({queryId:createQueryId(),executor:this.#t.executor,queryNode:_n.create(parseTableExpressionOrList(e),this.#t.withNode)})}updateTable(e){return new UpdateQueryBuilder({queryId:createQueryId(),executor:this.#t.executor,queryNode:bn.create(parseTableExpression(e),this.#t.withNode)})}mergeInto(e){return new MergeQueryBuilder({queryId:createQueryId(),executor:this.#t.executor,queryNode:En.create(parseAliasedTable(e),this.#t.withNode)})}with(e,t){const r=parseCommonTableExpression(e,t);return new QueryCreator({...this.#t,withNode:this.#t.withNode?Ln.cloneWithExpression(this.#t.withNode,r):Ln.create(r)})}withRecursive(e,t){const r=parseCommonTableExpression(e,t);return new QueryCreator({...this.#t,withNode:this.#t.withNode?Ln.cloneWithExpression(this.#t.withNode,r):Ln.create(r,{recursive:!0})})}withPlugin(e){return new QueryCreator({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new QueryCreator({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new QueryCreator({...this.#t,executor:this.#t.executor.withPluginAtFront(new WithSchemaPlugin(e))})}}function parseJoin(e,t){if(3===t.length)return function(e,t,r,s){return zs.createWithOn(e,parseTableExpression(t),parseReferentialBinaryOperation(r,"=",s))}(e,t[0],t[1],t[2]);if(2===t.length)return function(e,t,r){return r(function(e,t){return new JoinBuilder({joinNode:zs.create(e,parseTableExpression(t))})}(e,t)).toOperationNode()}(e,t[0],t[1]);throw new Error("not implemented")}const Vn=freeze({is:e=>"OffsetNode"===e.kind,create:e=>freeze({kind:"OffsetNode",offset:e})}),Fn=freeze({is:e=>"GroupByItemNode"===e.kind,create:e=>freeze({kind:"GroupByItemNode",groupBy:e})});function parseGroupBy(e){return parseReferenceExpressionOrList(e=isFunction(e)?e(expressionBuilder()):e).map(Fn.create)}const Qn=freeze({is:e=>"SetOperationNode"===e.kind,create:(e,t,r)=>freeze({kind:"SetOperationNode",operator:e,expression:t,all:r})});function parseSetOperations(e,t,r){return isFunction(t)&&(t=t(createExpressionBuilder())),isReadonlyArray(t)||(t=[t]),t.map((t=>Qn.create(e,parseExpression(t),r)))}class ExpressionWrapper{#_;constructor(e){this.#_=e}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new OrWrapper($s.create(this.#_,parseValueBinaryOperationOrExpression(e)))}and(...e){return new AndWrapper(Ws.create(this.#_,parseValueBinaryOperationOrExpression(e)))}$castTo(){return new ExpressionWrapper(this.#_)}$notNull(){return new ExpressionWrapper(this.#_)}toOperationNode(){return this.#_}}class AliasedExpressionWrapper{#x;#T;constructor(e,t){this.#x=e,this.#T=t}get expression(){return this.#x}get alias(){return this.#T}toOperationNode(){return Ps.create(this.#x.toOperationNode(),isOperationNodeSource(this.#T)?this.#T.toOperationNode():Es.create(this.#T))}}class OrWrapper{#_;constructor(e){this.#_=e}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}or(...e){return new OrWrapper($s.create(this.#_,parseValueBinaryOperationOrExpression(e)))}$castTo(){return new OrWrapper(this.#_)}toOperationNode(){return on.create(this.#_)}}class AndWrapper{#_;constructor(e){this.#_=e}get expressionType(){}as(e){return new AliasedExpressionWrapper(this,e)}and(...e){return new AndWrapper(Ws.create(this.#_,parseValueBinaryOperationOrExpression(e)))}$castTo(){return new AndWrapper(this.#_)}toOperationNode(){return on.create(this.#_)}}const Jn={is:e=>"FetchNode"===e.kind,create:(e,t)=>({kind:"FetchNode",rowCount:nn.create(e),modifier:t})};function parseFetch(e,t){if(!isNumber(e)&&!isBigInt(e))throw new Error(`Invalid fetch row count: ${e}`);if("only"!==(r=t)&&"with ties"!==r)throw new Error(`Invalid fetch modifier: ${t}`);var r;return Jn.create(e,t)}class SelectQueryBuilderImpl{#t;constructor(e){this.#t=freeze(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithWhere(this.#t.queryNode,parseValueBinaryOperationOrExpression(e))})}whereRef(e,t,r){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithWhere(this.#t.queryNode,parseReferentialBinaryOperation(e,t,r))})}having(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithHaving(this.#t.queryNode,parseValueBinaryOperationOrExpression(e))})}havingRef(e,t,r){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithHaving(this.#t.queryNode,parseReferentialBinaryOperation(e,t,r))})}select(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSelections(this.#t.queryNode,parseSelectArg(e))})}distinctOn(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithDistinctOn(this.#t.queryNode,parseReferenceExpressionOrList(e))})}modifyFront(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithFrontModifier(this.#t.queryNode,qs.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,qs.createWithExpression(e.toOperationNode()))})}distinct(){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithFrontModifier(this.#t.queryNode,qs.create("Distinct"))})}forUpdate(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,qs.create("ForUpdate",e?asArray(e).map(parseTable):void 0))})}forShare(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,qs.create("ForShare",e?asArray(e).map(parseTable):void 0))})}forKeyShare(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,qs.create("ForKeyShare",e?asArray(e).map(parseTable):void 0))})}forNoKeyUpdate(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,qs.create("ForNoKeyUpdate",e?asArray(e).map(parseTable):void 0))})}skipLocked(){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,qs.create("SkipLocked"))})}noWait(){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithEndModifier(this.#t.queryNode,qs.create("NoWait"))})}selectAll(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSelections(this.#t.queryNode,parseSelectAll(e))})}innerJoin(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("InnerJoin",e))})}leftJoin(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("LeftJoin",e))})}rightJoin(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("RightJoin",e))})}fullJoin(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("FullJoin",e))})}innerJoinLateral(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("LateralInnerJoin",e))})}leftJoinLateral(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithJoin(this.#t.queryNode,parseJoin("LateralLeftJoin",e))})}orderBy(...e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithOrderByItems(this.#t.queryNode,parseOrderBy(e))})}groupBy(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithGroupByItems(this.#t.queryNode,parseGroupBy(e))})}limit(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithLimit(this.#t.queryNode,Un.create(parseValueExpression(e)))})}offset(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithOffset(this.#t.queryNode,Vn.create(parseValueExpression(e)))})}fetch(e,t="only"){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithFetch(this.#t.queryNode,parseFetch(e,t))})}top(e,t){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithTop(this.#t.queryNode,parseTop(e,t))})}union(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSetOperations(this.#t.queryNode,parseSetOperations("union",e,!1))})}unionAll(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSetOperations(this.#t.queryNode,parseSetOperations("union",e,!0))})}intersect(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSetOperations(this.#t.queryNode,parseSetOperations("intersect",e,!1))})}intersectAll(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSetOperations(this.#t.queryNode,parseSetOperations("intersect",e,!0))})}except(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSetOperations(this.#t.queryNode,parseSetOperations("except",e,!1))})}exceptAll(e){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithSetOperations(this.#t.queryNode,parseSetOperations("except",e,!0))})}as(e){return new AliasedSelectQueryBuilderImpl(this,e)}clearSelect(){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithoutSelections(this.#t.queryNode)})}clearWhere(){return new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithoutWhere(this.#t.queryNode)})}clearLimit(){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithoutLimit(this.#t.queryNode)})}clearOffset(){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithoutOffset(this.#t.queryNode)})}clearOrderBy(){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithoutOrderBy(this.#t.queryNode)})}clearGroupBy(){return new SelectQueryBuilderImpl({...this.#t,queryNode:hn.cloneWithoutGroupBy(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new SelectQueryBuilderImpl({...this.#t})}$castTo(){return new SelectQueryBuilderImpl(this.#t)}$narrowType(){return new SelectQueryBuilderImpl(this.#t)}$assertType(){return new SelectQueryBuilderImpl(this.#t)}$asTuple(){return new ExpressionWrapper(this.toOperationNode())}withPlugin(e){return new SelectQueryBuilderImpl({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile();return(await this.#t.executor.executeQuery(e,this.#t.queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw isNoResultErrorConstructor(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new SelectQueryBuilderImpl({...this.#t,queryNode:Sn.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}function createSelectQueryBuilder(e){return new SelectQueryBuilderImpl(e)}preventAwait(SelectQueryBuilderImpl,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class AliasedSelectQueryBuilderImpl{#k;#T;constructor(e,t){this.#k=e,this.#T=t}get expression(){return this.#k}get alias(){return this.#T}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Ps.create(this.#k.toOperationNode(),Es.create(this.#T))}}preventAwait(AliasedSelectQueryBuilderImpl,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const Kn=freeze({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>freeze({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>freeze({...e,distinct:!0}),cloneWithOrderBy:(e,t)=>freeze({...e,orderBy:e.orderBy?an.cloneWithItems(e.orderBy,t):an.create(t)}),cloneWithFilter:(e,t)=>freeze({...e,filter:e.filter?xn.cloneWithOperation(e.filter,"And",t):xn.create(t)}),cloneWithOrFilter:(e,t)=>freeze({...e,filter:e.filter?xn.cloneWithOperation(e.filter,"Or",t):xn.create(t)}),cloneWithOver:(e,t)=>freeze({...e,over:t})}),Hn=freeze({is:e=>"FunctionNode"===e.kind,create:(e,t)=>freeze({kind:"FunctionNode",func:e,arguments:t})});class AggregateFunctionBuilder{#t;constructor(e){this.#t=freeze(e)}get expressionType(){}as(e){return new AliasedAggregateFunctionBuilder(this,e)}distinct(){return new AggregateFunctionBuilder({...this.#t,aggregateFunctionNode:Kn.cloneWithDistinct(this.#t.aggregateFunctionNode)})}orderBy(e,t){return new AggregateFunctionBuilder({...this.#t,aggregateFunctionNode:Kn.cloneWithOrderBy(this.#t.aggregateFunctionNode,parseOrderBy([e,t]))})}filterWhere(...e){return new AggregateFunctionBuilder({...this.#t,aggregateFunctionNode:Kn.cloneWithFilter(this.#t.aggregateFunctionNode,parseValueBinaryOperationOrExpression(e))})}filterWhereRef(e,t,r){return new AggregateFunctionBuilder({...this.#t,aggregateFunctionNode:Kn.cloneWithFilter(this.#t.aggregateFunctionNode,parseReferentialBinaryOperation(e,t,r))})}over(e){const t=new OverBuilder({overNode:cn.create()});return new AggregateFunctionBuilder({...this.#t,aggregateFunctionNode:Kn.cloneWithOver(this.#t.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new AggregateFunctionBuilder(this.#t)}$notNull(){return new AggregateFunctionBuilder(this.#t)}toOperationNode(){return this.#t.aggregateFunctionNode}}preventAwait(AggregateFunctionBuilder,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class AliasedAggregateFunctionBuilder{#A;#T;constructor(e,t){this.#A=e,this.#T=t}get expression(){return this.#A}get alias(){return this.#T}toOperationNode(){return Ps.create(this.#A.toOperationNode(),Es.create(this.#T))}}function createFunctionModule(){const fn=(e,t)=>new ExpressionWrapper(Hn.create(e,parseReferenceExpressionOrList(t??[]))),agg=(e,t)=>new AggregateFunctionBuilder({aggregateFunctionNode:Kn.create(e,t?parseReferenceExpressionOrList(t):void 0)});return Object.assign(fn,{agg:agg,avg:e=>agg("avg",[e]),coalesce:(...e)=>fn("coalesce",e),count:e=>agg("count",[e]),countAll:e=>new AggregateFunctionBuilder({aggregateFunctionNode:Kn.create("count",parseSelectAll(e))}),max:e=>agg("max",[e]),min:e=>agg("min",[e]),sum:e=>agg("sum",[e]),any:e=>fn("any",[e]),jsonAgg:e=>new AggregateFunctionBuilder({aggregateFunctionNode:Kn.create("json_agg",[isString(e)?parseTable(e):e.toOperationNode()])}),toJson:e=>new ExpressionWrapper(Hn.create("to_json",[isString(e)?parseTable(e):e.toOperationNode()]))})}const Gn=freeze({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>freeze({kind:"UnaryOperationNode",operator:e,operand:t})});const Yn=freeze({is:e=>"CaseNode"===e.kind,create:e=>freeze({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>freeze({...e,when:freeze(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>freeze({...e,when:e.when?freeze([...e.when.slice(0,-1),An.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>freeze({...e,...t})});class CaseBuilder{#t;constructor(e){this.#t=freeze(e)}when(...e){return new CaseThenBuilder({...this.#t,node:Yn.cloneWithWhen(this.#t.node,An.create(parseValueBinaryOperationOrExpression(e)))})}}class CaseThenBuilder{#t;constructor(e){this.#t=freeze(e)}then(e){return new CaseWhenBuilder({...this.#t,node:Yn.cloneWithThen(this.#t.node,isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e))})}}class CaseWhenBuilder{#t;constructor(e){this.#t=freeze(e)}when(...e){return new CaseThenBuilder({...this.#t,node:Yn.cloneWithWhen(this.#t.node,An.create(parseValueBinaryOperationOrExpression(e)))})}else(e){return new CaseEndBuilder({...this.#t,node:Yn.cloneWith(this.#t.node,{else:isSafeImmediateValue(e)?parseSafeImmediateValue(e):parseValueExpression(e)})})}end(){return new ExpressionWrapper(Yn.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(Yn.cloneWith(this.#t.node,{isStatement:!0}))}}class CaseEndBuilder{#t;constructor(e){this.#t=freeze(e)}end(){return new ExpressionWrapper(Yn.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new ExpressionWrapper(Yn.cloneWith(this.#t.node,{isStatement:!0}))}}const Xn=freeze({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>freeze({kind:"JSONPathLegNode",type:e,value:t})});class JSONPathBuilder{#_;constructor(e){this.#_=e}at(e){return this.#E("ArrayLocation",e)}key(e){return this.#E("Member",e)}#E(e,t){return Xs.is(this.#_)?new TraversedJSONPathBuilder(Xs.cloneWithTraversal(this.#_,tn.is(this.#_.traversal)?tn.cloneWithLeg(this.#_.traversal,Xn.create(e,t)):en.cloneWithValue(this.#_.traversal,nn.createImmediate(t)))):new TraversedJSONPathBuilder(tn.cloneWithLeg(this.#_,Xn.create(e,t)))}}class TraversedJSONPathBuilder extends JSONPathBuilder{#_;constructor(e){super(e),this.#_=e}get expressionType(){}as(e){return new AliasedJSONPathBuilder(this,e)}$castTo(){return new TraversedJSONPathBuilder(this.#_)}$notNull(){return new TraversedJSONPathBuilder(this.#_)}toOperationNode(){return this.#_}}class AliasedJSONPathBuilder{#I;#T;constructor(e,t){this.#I=e,this.#T=t}get expression(){return this.#I}get alias(){return this.#T}toOperationNode(){return Ps.create(this.#I.toOperationNode(),isOperationNodeSource(this.#T)?this.#T.toOperationNode():Es.create(this.#T))}}const ei=freeze({is:e=>"TupleNode"===e.kind,create:e=>freeze({kind:"TupleNode",values:freeze(e)})}),ti=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],ri=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],si=freeze({is:e=>"DataTypeNode"===e.kind,create:e=>freeze({kind:"DataTypeNode",dataType:e})});function parseDataTypeExpression(e){if(isOperationNodeSource(e))return e.toOperationNode();if(function(e){return!!ti.includes(e)||!!ri.some((t=>t.test(e)))}(e))return si.create(e);throw new Error(`invalid column data type ${JSON.stringify(e)}`)}const ni=freeze({is:e=>"CastNode"===e.kind,create:(e,t)=>freeze({kind:"CastNode",expression:e,dataType:t})});function createExpressionBuilder(e=Zn){function unary(e,t){return new ExpressionWrapper((r=e,s=t,Gn.create(Qs.create(r),parseReferenceExpression(s))));var r,s}const t=Object.assign((function(e,t,r){return new ExpressionWrapper(parseValueBinaryOperation(e,t,r))}),{fn:void 0,eb:void 0,selectFrom:t=>createSelectQueryBuilder({queryId:createQueryId(),executor:e,queryNode:hn.createFrom(parseTableExpressionOrList(t))}),case:e=>new CaseBuilder({node:Yn.create(isUndefined(e)?void 0:parseReferenceExpression(e))}),ref:(e,t)=>isUndefined(t)?new ExpressionWrapper(parseStringReference(e)):new JSONPathBuilder(function(e,t){const r=parseStringReference(e);if(isJSONOperator(t))return Xs.create(r,en.create(Qs.create(t)));const s=t.slice(0,-1);if(isJSONOperator(s))return Xs.create(r,tn.create(Qs.create(s)));throw new Error(`Invalid JSON operator: ${t}`)}(e,t)),jsonPath:()=>new JSONPathBuilder(tn.create()),table:e=>new ExpressionWrapper(parseTable(e)),val:e=>new ExpressionWrapper(parseValueExpression(e)),refTuple:(...e)=>new ExpressionWrapper(ei.create(e.map(parseReferenceExpression))),tuple:(...e)=>new ExpressionWrapper(ei.create(e.map(parseValueExpression))),lit:e=>new ExpressionWrapper(parseSafeImmediateValue(e)),unary:unary,not:e=>unary("not",e),exists:e=>unary("exists",e),neg:e=>unary("-",e),between:(e,t,r)=>new ExpressionWrapper(js.create(parseReferenceExpression(e),Qs.create("between"),Ws.create(parseValueExpression(t),parseValueExpression(r)))),betweenSymmetric:(e,t,r)=>new ExpressionWrapper(js.create(parseReferenceExpression(e),Qs.create("between symmetric"),Ws.create(parseValueExpression(t),parseValueExpression(r)))),and:e=>isReadonlyArray(e)?new ExpressionWrapper(parseFilterList(e,"and")):new ExpressionWrapper(parseFilterObject(e,"and")),or:e=>isReadonlyArray(e)?new ExpressionWrapper(parseFilterList(e,"or")):new ExpressionWrapper(parseFilterObject(e,"or")),parens(...e){const t=parseValueBinaryOperationOrExpression(e);return on.is(t)?new ExpressionWrapper(t):new ExpressionWrapper(on.create(t))},cast:(e,t)=>new ExpressionWrapper(ni.create(parseReferenceExpression(e),parseDataTypeExpression(t))),withSchema:t=>createExpressionBuilder(e.withPluginAtFront(new WithSchemaPlugin(t)))});return t.fn=createFunctionModule(),t.eb=t,t}function expressionBuilder(e){return createExpressionBuilder()}function parseExpression(e){if(isOperationNodeSource(e))return e.toOperationNode();if(isFunction(e))return e(expressionBuilder()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(e)}`)}function parseAliasedExpression(e){if(isOperationNodeSource(e))return e.toOperationNode();if(isFunction(e))return e(expressionBuilder()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function isExpressionOrFactory(e){return function(e){return isObject(e)&&"expressionType"in e&&isOperationNodeSource(e)}(e)||function(e){return isObject(e)&&"expression"in e&&isString(e.alias)&&isOperationNodeSource(e)}(e)||isFunction(e)}function parseTableExpressionOrList(e){return isReadonlyArray(e)?e.map((e=>parseTableExpression(e))):[parseTableExpression(e)]}function parseTableExpression(e){return isString(e)?parseAliasedTable(e):parseAliasedExpression(e)}function parseAliasedTable(e){const t=" as ";if(e.includes(t)){const[r,s]=e.split(t).map(trim$1);return Ps.create(parseTable(r),Es.create(s))}return parseTable(e)}function parseTable(e){if(e.includes(".")){const[t,r]=e.split(".").map(trim$1);return Ls.createWithSchema(t,r)}return Ls.create(e)}function trim$1(e){return e.trim()}const ii=freeze({is:e=>"AddColumnNode"===e.kind,create:e=>freeze({kind:"AddColumnNode",column:e})}),oi=freeze({is:e=>"ColumnDefinitionNode"===e.kind,create:(e,t)=>freeze({kind:"ColumnDefinitionNode",column:Js.create(e),dataType:t}),cloneWithFrontModifier:(e,t)=>freeze({...e,frontModifiers:e.frontModifiers?freeze([...e.frontModifiers,t]):[t]}),cloneWithEndModifier:(e,t)=>freeze({...e,endModifiers:e.endModifiers?freeze([...e.endModifiers,t]):[t]}),cloneWith:(e,t)=>freeze({...e,...t})}),ai=freeze({is:e=>"DropColumnNode"===e.kind,create:e=>freeze({kind:"DropColumnNode",column:Js.create(e)})}),di=freeze({is:e=>"RenameColumnNode"===e.kind,create:(e,t)=>freeze({kind:"RenameColumnNode",column:Js.create(e),renameTo:Js.create(t)})}),ci=freeze({is:e=>"CheckConstraintNode"===e.kind,create:(e,t)=>freeze({kind:"CheckConstraintNode",expression:e,name:t?Es.create(t):void 0})}),ui=["no action","restrict","cascade","set null","set default"],li=freeze({is:e=>"ReferencesNode"===e.kind,create:(e,t)=>freeze({kind:"ReferencesNode",table:e,columns:freeze([...t])}),cloneWithOnDelete:(e,t)=>freeze({...e,onDelete:t}),cloneWithOnUpdate:(e,t)=>freeze({...e,onUpdate:t})});function parseDefaultValueExpression(e){return isOperationNodeSource(e)?e.toOperationNode():nn.createImmediate(e)}const pi=freeze({is:e=>"GeneratedNode"===e.kind,create:e=>freeze({kind:"GeneratedNode",...e}),createWithExpression:e=>freeze({kind:"GeneratedNode",always:!0,expression:e}),cloneWith:(e,t)=>freeze({...e,...t})}),hi=freeze({is:e=>"DefaultValueNode"===e.kind,create:e=>freeze({kind:"DefaultValueNode",defaultValue:e})});function parseOnModifyForeignAction(e){if(ui.includes(e))return e;throw new Error(`invalid OnModifyForeignAction ${e}`)}class ColumnDefinitionBuilder{#_;constructor(e){this.#_=e}autoIncrement(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{autoIncrement:!0}))}identity(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{identity:!0}))}primaryKey(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{primaryKey:!0}))}references(e){const t=parseStringReference(e);if(!t.table||Ks.is(t.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{references:li.create(t.table,[t.column])}))}onDelete(e){if(!this.#_.references)throw new Error("on delete constraint can only be added for foreign keys");return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{references:li.cloneWithOnDelete(this.#_.references,parseOnModifyForeignAction(e))}))}onUpdate(e){if(!this.#_.references)throw new Error("on update constraint can only be added for foreign keys");return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{references:li.cloneWithOnUpdate(this.#_.references,parseOnModifyForeignAction(e))}))}unique(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{unique:!0}))}notNull(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{notNull:!0}))}unsigned(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{unsigned:!0}))}defaultTo(e){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{defaultTo:hi.create(parseDefaultValueExpression(e))}))}check(e){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{check:ci.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{generated:pi.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{generated:pi.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{generated:pi.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#_.generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{generated:pi.cloneWith(this.#_.generated,{stored:!0})}))}modifyFront(e){return new ColumnDefinitionBuilder(oi.cloneWithFrontModifier(this.#_,e.toOperationNode()))}nullsNotDistinct(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{nullsNotDistinct:!0}))}ifNotExists(){return new ColumnDefinitionBuilder(oi.cloneWith(this.#_,{ifNotExists:!0}))}modifyEnd(e){return new ColumnDefinitionBuilder(oi.cloneWithEndModifier(this.#_,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#_}}preventAwait(ColumnDefinitionBuilder,"don't await ColumnDefinitionBuilder instances directly.");const mi=freeze({is:e=>"ModifyColumnNode"===e.kind,create:e=>freeze({kind:"ModifyColumnNode",column:e})}),fi=freeze({is:e=>"ForeignKeyConstraintNode"===e.kind,create:(e,t,r,s)=>freeze({kind:"ForeignKeyConstraintNode",columns:e,references:li.create(t,r),name:s?Es.create(s):void 0}),cloneWith:(e,t)=>freeze({...e,...t})});class ForeignKeyConstraintBuilder{#_;constructor(e){this.#_=e}onDelete(e){return new ForeignKeyConstraintBuilder(fi.cloneWith(this.#_,{onDelete:parseOnModifyForeignAction(e)}))}onUpdate(e){return new ForeignKeyConstraintBuilder(fi.cloneWith(this.#_,{onUpdate:parseOnModifyForeignAction(e)}))}$call(e){return e(this)}toOperationNode(){return this.#_}}preventAwait(ForeignKeyConstraintBuilder,"don't await ForeignKeyConstraintBuilder instances directly.");const yi=freeze({is:e=>"AddConstraintNode"===e.kind,create:e=>freeze({kind:"AddConstraintNode",constraint:e})}),gi=freeze({is:e=>"UniqueConstraintNode"===e.kind,create:(e,t,r)=>freeze({kind:"UniqueConstraintNode",columns:freeze(e.map(Js.create)),name:t?Es.create(t):void 0,nullsNotDistinct:r}),cloneWith:(e,t)=>freeze({...e,...t})}),wi=freeze({is:e=>"DropConstraintNode"===e.kind,create:e=>freeze({kind:"DropConstraintNode",constraintName:Es.create(e)}),cloneWith:(e,t)=>freeze({...e,...t})}),vi=freeze({is:e=>"AlterColumnNode"===e.kind,create:(e,t,r)=>freeze({kind:"AlterColumnNode",column:Js.create(e),[t]:r})});class AlterColumnBuilder{#S;constructor(e){this.#S=e}setDataType(e){return new AlteredColumnBuilder(vi.create(this.#S,"dataType",parseDataTypeExpression(e)))}setDefault(e){return new AlteredColumnBuilder(vi.create(this.#S,"setDefault",parseDefaultValueExpression(e)))}dropDefault(){return new AlteredColumnBuilder(vi.create(this.#S,"dropDefault",!0))}setNotNull(){return new AlteredColumnBuilder(vi.create(this.#S,"setNotNull",!0))}dropNotNull(){return new AlteredColumnBuilder(vi.create(this.#S,"dropNotNull",!0))}$call(e){return e(this)}}preventAwait(AlterColumnBuilder,"don't await AlterColumnBuilder instances");class AlteredColumnBuilder{#O;constructor(e){this.#O=e}toOperationNode(){return this.#O}}preventAwait(AlteredColumnBuilder,"don't await AlteredColumnBuilder instances");class AlterTableExecutor{#t;constructor(e){this.#t=freeze(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(AlterTableExecutor,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");class AlterTableAddForeignKeyConstraintBuilder{#t;constructor(e){this.#t=freeze(e)}onDelete(e){return new AlterTableAddForeignKeyConstraintBuilder({...this.#t,constraintBuilder:this.#t.constraintBuilder.onDelete(e)})}onUpdate(e){return new AlterTableAddForeignKeyConstraintBuilder({...this.#t,constraintBuilder:this.#t.constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(As.cloneWithTableProps(this.#t.node,{addConstraint:yi.create(this.#t.constraintBuilder.toOperationNode())}),this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(AlterTableAddForeignKeyConstraintBuilder,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");class AlterTableDropConstraintBuilder{#t;constructor(e){this.#t=freeze(e)}ifExists(){return new AlterTableDropConstraintBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{dropConstraint:wi.cloneWith(this.#t.node.dropConstraint,{ifExists:!0})})})}cascade(){return new AlterTableDropConstraintBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{dropConstraint:wi.cloneWith(this.#t.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new AlterTableDropConstraintBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{dropConstraint:wi.cloneWith(this.#t.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(AlterTableDropConstraintBuilder,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const bi=freeze({is:e=>"PrimaryKeyConstraintNode"===e.kind,create:(e,t)=>freeze({kind:"PrimaryKeyConstraintNode",columns:freeze(e.map(Js.create)),name:t?Es.create(t):void 0})}),Ni=freeze({is:e=>"AddIndexNode"===e.kind,create:e=>freeze({kind:"AddIndexNode",name:Es.create(e)}),cloneWith:(e,t)=>freeze({...e,...t}),cloneWithColumns:(e,t)=>freeze({...e,columns:[...e.columns||[],...t]})});class AlterTableAddIndexBuilder{#t;constructor(e){this.#t=freeze(e)}unique(){return new AlterTableAddIndexBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addIndex:Ni.cloneWith(this.#t.node.addIndex,{unique:!0})})})}column(e){return new AlterTableAddIndexBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addIndex:Ni.cloneWithColumns(this.#t.node.addIndex,[parseOrderedColumnName(e)])})})}columns(e){return new AlterTableAddIndexBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addIndex:Ni.cloneWithColumns(this.#t.node.addIndex,e.map(parseOrderedColumnName))})})}expression(e){return new AlterTableAddIndexBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addIndex:Ni.cloneWithColumns(this.#t.node.addIndex,[e.toOperationNode()])})})}using(e){return new AlterTableAddIndexBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addIndex:Ni.cloneWith(this.#t.node.addIndex,{using:Ys.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(AlterTableAddIndexBuilder,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");class UniqueConstraintNodeBuilder{#_;constructor(e){this.#_=e}toOperationNode(){return this.#_}nullsNotDistinct(){return new UniqueConstraintNodeBuilder(gi.cloneWith(this.#_,{nullsNotDistinct:!0}))}}preventAwait(UniqueConstraintNodeBuilder,"don't await UniqueConstraintNodeBuilder instances directly.");class AlterTableBuilder{#t;constructor(e){this.#t=freeze(e)}renameTo(e){return new AlterTableExecutor({...this.#t,node:As.cloneWithTableProps(this.#t.node,{renameTo:parseTable(e)})})}setSchema(e){return new AlterTableExecutor({...this.#t,node:As.cloneWithTableProps(this.#t.node,{setSchema:Es.create(e)})})}alterColumn(e,t){const r=t(new AlterColumnBuilder(e));return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,ai.create(e))})}renameColumn(e,t){return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,di.create(e,t))})}addColumn(e,t,r=noop){const s=r(new ColumnDefinitionBuilder(oi.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,ii.create(s.toOperationNode()))})}modifyColumn(e,t,r=noop){const s=r(new ColumnDefinitionBuilder(oi.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,mi.create(s.toOperationNode()))})}addUniqueConstraint(e,t,r=noop){const s=r(new UniqueConstraintNodeBuilder(gi.create(t,e)));return new AlterTableExecutor({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addConstraint:yi.create(s.toOperationNode())})})}addCheckConstraint(e,t){return new AlterTableExecutor({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addConstraint:yi.create(ci.create(t.toOperationNode(),e))})})}addForeignKeyConstraint(e,t,r,s){return new AlterTableAddForeignKeyConstraintBuilder({...this.#t,constraintBuilder:new ForeignKeyConstraintBuilder(fi.create(t.map(Js.create),parseTable(r),s.map(Js.create),e))})}addPrimaryKeyConstraint(e,t){return new AlterTableExecutor({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addConstraint:yi.create(bi.create(t,e))})})}dropConstraint(e){return new AlterTableDropConstraintBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{dropConstraint:wi.create(e)})})}addIndex(e){return new AlterTableAddIndexBuilder({...this.#t,node:As.cloneWithTableProps(this.#t.node,{addIndex:Ni.create(e)})})}dropIndex(e){return new AlterTableExecutor({...this.#t,node:As.cloneWithTableProps(this.#t.node,{dropIndex:Ds.create(e)})})}$call(e){return e(this)}}preventAwait(AlterTableBuilder,"don't await AlterTableBuilder instances");class AlterTableColumnAlteringBuilder{#t;constructor(e){this.#t=freeze(e)}alterColumn(e,t){const r=t(new AlterColumnBuilder(e));return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,r.toOperationNode())})}dropColumn(e){return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,ai.create(e))})}renameColumn(e,t){return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,di.create(e,t))})}addColumn(e,t,r=noop){const s=r(new ColumnDefinitionBuilder(oi.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,ii.create(s.toOperationNode()))})}modifyColumn(e,t,r=noop){const s=r(new ColumnDefinitionBuilder(oi.create(e,parseDataTypeExpression(t))));return new AlterTableColumnAlteringBuilder({...this.#t,node:As.cloneWithColumnAlteration(this.#t.node,mi.create(s.toOperationNode()))})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(AlterTableColumnAlteringBuilder,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class ImmediateValueTransformer extends OperationNodeTransformer{transformValue(e){return{...super.transformValue(e),immediate:!0}}}class CreateIndexBuilder{#t;constructor(e){this.#t=freeze(e)}ifNotExists(){return new CreateIndexBuilder({...this.#t,node:Is.cloneWith(this.#t.node,{ifNotExists:!0})})}unique(){return new CreateIndexBuilder({...this.#t,node:Is.cloneWith(this.#t.node,{unique:!0})})}nullsNotDistinct(){return new CreateIndexBuilder({...this.#t,node:Is.cloneWith(this.#t.node,{nullsNotDistinct:!0})})}on(e){return new CreateIndexBuilder({...this.#t,node:Is.cloneWith(this.#t.node,{table:parseTable(e)})})}column(e){return new CreateIndexBuilder({...this.#t,node:Is.cloneWithColumns(this.#t.node,[parseOrderedColumnName(e)])})}columns(e){return new CreateIndexBuilder({...this.#t,node:Is.cloneWithColumns(this.#t.node,e.map(parseOrderedColumnName))})}expression(e){return new CreateIndexBuilder({...this.#t,node:Is.cloneWithColumns(this.#t.node,[e.toOperationNode()])})}using(e){return new CreateIndexBuilder({...this.#t,node:Is.cloneWith(this.#t.node,{using:Ys.createWithSql(e)})})}where(...e){const t=new ImmediateValueTransformer;return new CreateIndexBuilder({...this.#t,node:Sn.cloneWithWhere(this.#t.node,t.transformNode(parseValueBinaryOperationOrExpression(e)))})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(CreateIndexBuilder,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");class CreateSchemaBuilder{#t;constructor(e){this.#t=freeze(e)}ifNotExists(){return new CreateSchemaBuilder({...this.#t,node:Ss.cloneWith(this.#t.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}function parseOnCommitAction(e){if(Os.includes(e))return e;throw new Error(`invalid OnCommitAction ${e}`)}preventAwait(CreateSchemaBuilder,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");class CreateTableBuilder{#t;constructor(e){this.#t=freeze(e)}temporary(){return new CreateTableBuilder({...this.#t,node:Cs.cloneWith(this.#t.node,{temporary:!0})})}onCommit(e){return new CreateTableBuilder({...this.#t,node:Cs.cloneWith(this.#t.node,{onCommit:parseOnCommitAction(e)})})}ifNotExists(){return new CreateTableBuilder({...this.#t,node:Cs.cloneWith(this.#t.node,{ifNotExists:!0})})}addColumn(e,t,r=noop){const s=r(new ColumnDefinitionBuilder(oi.create(e,parseDataTypeExpression(t))));return new CreateTableBuilder({...this.#t,node:Cs.cloneWithColumn(this.#t.node,s.toOperationNode())})}addPrimaryKeyConstraint(e,t){return new CreateTableBuilder({...this.#t,node:Cs.cloneWithConstraint(this.#t.node,bi.create(t,e))})}addUniqueConstraint(e,t,r=noop){const s=r(new UniqueConstraintNodeBuilder(gi.create(t,e)));return new CreateTableBuilder({...this.#t,node:Cs.cloneWithConstraint(this.#t.node,s.toOperationNode())})}addCheckConstraint(e,t){return new CreateTableBuilder({...this.#t,node:Cs.cloneWithConstraint(this.#t.node,ci.create(t.toOperationNode(),e))})}addForeignKeyConstraint(e,t,r,s,n=noop){const i=n(new ForeignKeyConstraintBuilder(fi.create(t.map(Js.create),parseTable(r),s.map(Js.create),e)));return new CreateTableBuilder({...this.#t,node:Cs.cloneWithConstraint(this.#t.node,i.toOperationNode())})}modifyFront(e){return new CreateTableBuilder({...this.#t,node:Cs.cloneWithFrontModifier(this.#t.node,e.toOperationNode())})}modifyEnd(e){return new CreateTableBuilder({...this.#t,node:Cs.cloneWithEndModifier(this.#t.node,e.toOperationNode())})}as(e){return new CreateTableBuilder({...this.#t,node:Cs.cloneWith(this.#t.node,{selectQuery:parseExpression(e)})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(CreateTableBuilder,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");class DropIndexBuilder{#t;constructor(e){this.#t=freeze(e)}on(e){return new DropIndexBuilder({...this.#t,node:Ds.cloneWith(this.#t.node,{table:parseTable(e)})})}ifExists(){return new DropIndexBuilder({...this.#t,node:Ds.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new DropIndexBuilder({...this.#t,node:Ds.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(DropIndexBuilder,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");class DropSchemaBuilder{#t;constructor(e){this.#t=freeze(e)}ifExists(){return new DropSchemaBuilder({...this.#t,node:Us.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new DropSchemaBuilder({...this.#t,node:Us.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(DropSchemaBuilder,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");class DropTableBuilder{#t;constructor(e){this.#t=freeze(e)}ifExists(){return new DropTableBuilder({...this.#t,node:Bs.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new DropTableBuilder({...this.#t,node:Bs.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(DropTableBuilder,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const _i=freeze({is:e=>"CreateViewNode"===e.kind,create:e=>freeze({kind:"CreateViewNode",name:Rs.create(e)}),cloneWith:(e,t)=>freeze({...e,...t})});class ImmediateValuePlugin{#m=new ImmediateValueTransformer;transformQuery(e){return this.#m.transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}class CreateViewBuilder{#t;constructor(e){this.#t=freeze(e)}temporary(){return new CreateViewBuilder({...this.#t,node:_i.cloneWith(this.#t.node,{temporary:!0})})}materialized(){return new CreateViewBuilder({...this.#t,node:_i.cloneWith(this.#t.node,{materialized:!0})})}ifNotExists(){return new CreateViewBuilder({...this.#t,node:_i.cloneWith(this.#t.node,{ifNotExists:!0})})}orReplace(){return new CreateViewBuilder({...this.#t,node:_i.cloneWith(this.#t.node,{orReplace:!0})})}columns(e){return new CreateViewBuilder({...this.#t,node:_i.cloneWith(this.#t.node,{columns:e.map(parseColumnName)})})}as(e){const t=e.withPlugin(new ImmediateValuePlugin).toOperationNode();return new CreateViewBuilder({...this.#t,node:_i.cloneWith(this.#t.node,{as:t})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(CreateViewBuilder,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const xi=freeze({is:e=>"DropViewNode"===e.kind,create:e=>freeze({kind:"DropViewNode",name:Rs.create(e)}),cloneWith:(e,t)=>freeze({...e,...t})});class DropViewBuilder{#t;constructor(e){this.#t=freeze(e)}materialized(){return new DropViewBuilder({...this.#t,node:xi.cloneWith(this.#t.node,{materialized:!0})})}ifExists(){return new DropViewBuilder({...this.#t,node:xi.cloneWith(this.#t.node,{ifExists:!0})})}cascade(){return new DropViewBuilder({...this.#t,node:xi.cloneWith(this.#t.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(DropViewBuilder,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Ti=freeze({is:e=>"CreateTypeNode"===e.kind,create:e=>freeze({kind:"CreateTypeNode",name:e}),cloneWithEnum:(e,t)=>freeze({...e,enum:sn.create(t.map((e=>nn.createImmediate(e))))})});class CreateTypeBuilder{#t;constructor(e){this.#t=freeze(e)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}asEnum(e){return new CreateTypeBuilder({...this.#t,node:Ti.cloneWithEnum(this.#t.node,e)})}$call(e){return e(this)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}preventAwait(CreateTypeBuilder,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const ki=freeze({is:e=>"DropTypeNode"===e.kind,create:e=>freeze({kind:"DropTypeNode",name:e}),cloneWith:(e,t)=>freeze({...e,...t})});class DropTypeBuilder{#t;constructor(e){this.#t=freeze(e)}ifExists(){return new DropTypeBuilder({...this.#t,node:ki.cloneWith(this.#t.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#t.executor.transformQuery(this.#t.node,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){await this.#t.executor.executeQuery(this.compile(),this.#t.queryId)}}function parseSchemableIdentifier(e){if(e.includes(".")){const t=e.split(".").map(trim);if(2===t.length)return Rs.createWithSchema(t[0],t[1]);throw new Error(`invalid schemable identifier ${e}`)}return Rs.create(e)}function trim(e){return e.trim()}preventAwait(DropTypeBuilder,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");class SchemaModule{#C;constructor(e){this.#C=e}createTable(e){return new CreateTableBuilder({queryId:createQueryId(),executor:this.#C,node:Cs.create(parseTable(e))})}dropTable(e){return new DropTableBuilder({queryId:createQueryId(),executor:this.#C,node:Bs.create(parseTable(e))})}createIndex(e){return new CreateIndexBuilder({queryId:createQueryId(),executor:this.#C,node:Is.create(e)})}dropIndex(e){return new DropIndexBuilder({queryId:createQueryId(),executor:this.#C,node:Ds.create(e)})}createSchema(e){return new CreateSchemaBuilder({queryId:createQueryId(),executor:this.#C,node:Ss.create(e)})}dropSchema(e){return new DropSchemaBuilder({queryId:createQueryId(),executor:this.#C,node:Us.create(e)})}alterTable(e){return new AlterTableBuilder({queryId:createQueryId(),executor:this.#C,node:As.create(parseTable(e))})}createView(e){return new CreateViewBuilder({queryId:createQueryId(),executor:this.#C,node:_i.create(e)})}dropView(e){return new DropViewBuilder({queryId:createQueryId(),executor:this.#C,node:xi.create(e)})}createType(e){return new CreateTypeBuilder({queryId:createQueryId(),executor:this.#C,node:Ti.create(parseSchemableIdentifier(e))})}dropType(e){return new DropTypeBuilder({queryId:createQueryId(),executor:this.#C,node:ki.create(parseSchemableIdentifier(e))})}withPlugin(e){return new SchemaModule(this.#C.withPlugin(e))}withoutPlugins(){return new SchemaModule(this.#C.withoutPlugins())}withSchema(e){return new SchemaModule(this.#C.withPluginAtFront(new WithSchemaPlugin(e)))}}class DynamicModule{ref(e){return new DynamicReferenceBuilder(e)}}class DefaultConnectionProvider{#R;constructor(e){this.#R=e}async provideConnection(e){const t=await this.#R.acquireConnection();try{return await e(t)}finally{await this.#R.releaseConnection(t)}}}class DefaultQueryExecutor extends QueryExecutorBase{#D;#U;#B;constructor(e,t,r,s=[]){super(s),this.#D=e,this.#U=t,this.#B=r}get adapter(){return this.#U}compileQuery(e){return this.#D.compileQuery(e)}provideConnection(e){return this.#B.provideConnection(e)}withPlugins(e){return new DefaultQueryExecutor(this.#D,this.#U,this.#B,[...this.plugins,...e])}withPlugin(e){return new DefaultQueryExecutor(this.#D,this.#U,this.#B,[...this.plugins,e])}withPluginAtFront(e){return new DefaultQueryExecutor(this.#D,this.#U,this.#B,[e,...this.plugins])}withConnectionProvider(e){return new DefaultQueryExecutor(this.#D,this.#U,e,[...this.plugins])}withoutPlugins(){return new DefaultQueryExecutor(this.#D,this.#U,this.#B,[])}}const Ai=globalThis.performance?.timeOrigin??Date.now(),Ei=globalThis.performance?.now?globalThis.performance.now.bind(globalThis.performance):()=>Date.now()-Ai,Ii=["event","mark","measure","resource"];class _PerformanceEntry{__unenv__=!0;detail;entryType="event";name;startTime;constructor(e,t){this.name=e,this.startTime=t?.startTime||Ei(),this.detail=t?.detail}get duration(){return Ei()-this.startTime}toJSON(){return{name:this.name,entryType:this.entryType,startTime:this.startTime,duration:this.duration,detail:this.detail}}}class _PerformanceMark extends _PerformanceEntry{entryType="mark"}class _PerformanceMeasure extends _PerformanceEntry{entryType="measure"}class _Performance{__unenv__=!0;timeOrigin=Ai;eventCounts=new Map;_entries=[];_resourceTimingBufferSize=0;navigation=void 0;timing=void 0;onresourcetimingbufferfull=null;now(){return this.timeOrigin===Ai?Ei():Date.now()-this.timeOrigin}clearMarks(e){this._entries=e?this._entries.filter((t=>t.name!==e)):this._entries.filter((e=>"mark"!==e.entryType))}clearMeasures(e){this._entries=e?this._entries.filter((t=>t.name!==e)):this._entries.filter((e=>"measure"!==e.entryType))}clearResourceTimings(){this._entries=this._entries.filter((e=>"resource"!==e.entryType||"navigation"!==e.entryType))}getEntries(){return this._entries}getEntriesByName(e,t){return this._entries.filter((r=>r.name===e&&(!t||r.entryType===t)))}getEntriesByType(e){return this._entries.filter((t=>t.entryType===e))}mark(e,t){const r=new _PerformanceMark(e,t);return this._entries.push(r),r}measure(e,t,r){let s,n;"string"==typeof t?(s=this.getEntriesByName(t,"mark")[0]?.startTime,n=this.getEntriesByName(r,"mark")[0]?.startTime):(s=Number.parseFloat(t?.start)||this.now(),n=Number.parseFloat(t?.end)||this.now());const i=new _PerformanceMeasure(e,{startTime:s,detail:{start:s,end:n}});return this._entries.push(i),i}setResourceTimingBufferSize(e){this._resourceTimingBufferSize=e}toJSON(){return this}addEventListener(e,t,r){throw l("Performance.addEventListener")}removeEventListener(e,t,r){throw l("Performance.removeEventListener")}dispatchEvent(e){throw l("Performance.dispatchEvent")}}const Si=globalThis.PerformanceEntry||_PerformanceEntry,Oi=globalThis.PerformanceMark||_PerformanceMark,Ci=globalThis.PerformanceMeasure||_PerformanceMeasure,Ri=globalThis.PerformanceResourceTiming||class extends _PerformanceEntry{entryType="resource";serverTiming=[];connectEnd=0;connectStart=0;decodedBodySize=0;domainLookupEnd=0;domainLookupStart=0;encodedBodySize=0;fetchStart=0;initiatorType="";name="";nextHopProtocol="";redirectEnd=0;redirectStart=0;requestStart=0;responseEnd=0;responseStart=0;secureConnectionStart=0;startTime=0;transferSize=0;workerStart=0;responseStatus=0},Di=globalThis.PerformanceObserver||class{__unenv__=!0;static supportedEntryTypes=Ii;_callback=null;constructor(e){this._callback=e}takeRecords(){return[]}disconnect(){throw l("PerformanceObserver.disconnect")}observe(e){throw l("PerformanceObserver.observe")}},Ui=globalThis.Performance||_Performance,Bi=globalThis.PerformanceObserverEntryList||class{__unenv__=!0;getEntries(){return[]}getEntriesByName(e,t){return[]}getEntriesByType(e){return[]}},Pi=globalThis.performance&&"addEventListener"in globalThis.performance?globalThis.performance:new _Performance;globalThis.performance||=Pi,globalThis.Performance||=Ui,globalThis.PerformanceEntry||=Si,globalThis.PerformanceMark||=Oi,globalThis.PerformanceMeasure||=Ci,globalThis.PerformanceObserver||=Di,globalThis.PerformanceObserverEntryList||=Bi,globalThis.PerformanceResourceTiming||=Ri;const Li=globalThis.performance;function performanceNow(){return void 0!==Li&&isFunction(Li.now)?Li.now():Date.now()}class RuntimeDriver{#R;#P;#L;#q;#W;#$=new WeakSet;constructor(e,t){this.#q=!1,this.#R=e,this.#P=t}async init(){if(this.#W)throw new Error("driver has already been destroyed");this.#L||(this.#L=this.#R.init().then((()=>{this.#q=!0})).catch((e=>(this.#L=void 0,Promise.reject(e))))),await this.#L}async acquireConnection(){if(this.#W)throw new Error("driver has already been destroyed");this.#q||await this.init();const e=await this.#R.acquireConnection();return this.#$.has(e)||(this.#M()&&this.#z(e),this.#$.add(e)),e}async releaseConnection(e){await this.#R.releaseConnection(e)}beginTransaction(e,t){return this.#R.beginTransaction(e,t)}commitTransaction(e){return this.#R.commitTransaction(e)}rollbackTransaction(e){return this.#R.rollbackTransaction(e)}async destroy(){this.#L&&(await this.#L,this.#W||(this.#W=this.#R.destroy().catch((e=>(this.#W=void 0,Promise.reject(e))))),await this.#W)}#M(){return this.#P.isLevelEnabled("query")||this.#P.isLevelEnabled("error")}#z(e){const t=e.executeQuery;e.executeQuery=async r=>{let s;const n=performanceNow();try{return await t.call(e,r)}catch(e){throw s=e,await this.#j(e,r,n),e}finally{s||await this.#Z(r,n)}}}async#j(e,t,r){await this.#P.error((()=>({level:"error",error:e,query:t,queryDurationMillis:this.#V(r)})))}async#Z(e,t){await this.#P.query((()=>({level:"query",query:e,queryDurationMillis:this.#V(t)})))}#V(e){return performanceNow()-e}}const ignoreError=()=>{};class SingleConnectionProvider{#F;#Q;constructor(e){this.#F=e}async provideConnection(e){for(;this.#Q;)await this.#Q.catch(ignoreError);return this.#Q=this.#J(e).finally((()=>{this.#Q=void 0})),this.#Q}async#J(e){return await e(this.#F)}}const qi=["read uncommitted","read committed","repeatable read","serializable","snapshot"];freeze(["query","error"]);class Log{#K;#H;constructor(e){isFunction(e)?(this.#H=e,this.#K=freeze({query:!0,error:!0})):(this.#H=defaultLogger,this.#K=freeze({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#K[e]}async query(e){this.#K.query&&await this.#H(e())}async error(e){this.#K.error&&await this.#H(e())}}function defaultLogger(e){"query"===e.level?(console.log(`kysely:query: ${e.query.sql}`),console.log(`kysely:query: duration: ${e.queryDurationMillis.toFixed(1)}ms`)):"error"===e.level&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}class Kysely extends QueryCreator{#t;constructor(e){let t,r;if(isObject(s=e)&&isObject(s.config)&&isObject(s.driver)&&isObject(s.executor)&&isObject(s.dialect))t={executor:e.executor},r={...e};else{const s=e.dialect,n=s.createDriver(),i=s.createQueryCompiler(),o=s.createAdapter(),a=new Log(e.log??[]),d=new RuntimeDriver(n,a),c=new DefaultConnectionProvider(d),u=new DefaultQueryExecutor(i,o,c,e.plugins??[]);t={executor:u},r={config:e,executor:u,dialect:s,driver:d}}var s;super(t),this.#t=freeze(r)}get schema(){return new SchemaModule(this.#t.executor)}get dynamic(){return new DynamicModule}get introspection(){return this.#t.dialect.createIntrospector(this.withoutPlugins())}case(e){return new CaseBuilder({node:Yn.create(isUndefined(e)?void 0:parseExpression(e))})}get fn(){return createFunctionModule()}transaction(){return new TransactionBuilder({...this.#t})}connection(){return new ConnectionBuilder({...this.#t})}withPlugin(e){return new Kysely({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new Kysely({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new Kysely({...this.#t,executor:this.#t.executor.withPluginAtFront(new WithSchemaPlugin(e))})}withTables(){return new Kysely({...this.#t})}async destroy(){await this.#t.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#t.executor}executeQuery(e,t=createQueryId()){const r=isObject(s=e)&&isFunction(s.compile)?e.compile():e;var s;return this.getExecutor().executeQuery(r,t)}}class Transaction extends Kysely{#t;constructor(e){super(e),this.#t=e}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new Transaction({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new Transaction({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new Transaction({...this.#t,executor:this.#t.executor.withPluginAtFront(new WithSchemaPlugin(e))})}withTables(){return new Transaction({...this.#t})}}class ConnectionBuilder{#t;constructor(e){this.#t=freeze(e)}async execute(e){return this.#t.executor.provideConnection((async t=>{const r=this.#t.executor.withConnectionProvider(new SingleConnectionProvider(t)),s=new Kysely({...this.#t,executor:r});return await e(s)}))}}preventAwait(ConnectionBuilder,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");class TransactionBuilder{#t;constructor(e){this.#t=freeze(e)}setIsolationLevel(e){return new TransactionBuilder({...this.#t,isolationLevel:e})}async execute(e){const{isolationLevel:t,...r}=this.#t,s={isolationLevel:t};return function(e){if(e.isolationLevel&&!qi.includes(e.isolationLevel))throw new Error(`invalid transaction isolation level ${e.isolationLevel}`)}(s),this.#t.executor.provideConnection((async t=>{const n=this.#t.executor.withConnectionProvider(new SingleConnectionProvider(t)),i=new Transaction({...r,executor:n});try{await this.#t.driver.beginTransaction(t,s);const r=await e(i);return await this.#t.driver.commitTransaction(t),r}catch(e){throw await this.#t.driver.rollbackTransaction(t),e}}))}}preventAwait(TransactionBuilder,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");class RawBuilderImpl{#t;constructor(e){this.#t=freeze(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new AliasedRawBuilderImpl(this,e)}$castTo(){return new RawBuilderImpl({...this.#t})}$notNull(){return new RawBuilderImpl(this.#t)}withPlugin(e){return new RawBuilderImpl({...this.#t,plugins:void 0!==this.#t.plugins?freeze([...this.#t.plugins,e]):freeze([e])})}toOperationNode(){return this.#G(this.#Y())}compile(e){return this.#X(this.#Y(e))}async execute(e){const t=this.#Y(e);return t.executeQuery(this.#X(t),this.#t.queryId)}#Y(e){const t=void 0!==e?e.getExecutor():Zn;return void 0!==this.#t.plugins?t.withPlugins(this.#t.plugins):t}#G(e){return e.transformQuery(this.#t.rawNode,this.#t.queryId)}#X(e){return e.compileQuery(this.#G(e),this.#t.queryId)}}function createRawBuilder(e){return new RawBuilderImpl(e)}preventAwait(RawBuilderImpl,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class AliasedRawBuilderImpl{#ee;#T;constructor(e,t){this.#ee=e,this.#T=t}get expression(){return this.#ee}get alias(){return this.#T}get rawBuilder(){return this.#ee}toOperationNode(){return Ps.create(this.#ee.toOperationNode(),isOperationNodeSource(this.#T)?this.#T.toOperationNode():Es.create(this.#T))}}preventAwait(AliasedRawBuilderImpl,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const Wi=Object.assign(((e,...t)=>createRawBuilder({queryId:createQueryId(),rawNode:Ys.create(e,t?.map(parseParameter)??[])})),{ref:e=>createRawBuilder({queryId:createQueryId(),rawNode:Ys.createWithChild(parseStringReference(e))}),val:e=>createRawBuilder({queryId:createQueryId(),rawNode:Ys.createWithChild(parseValueExpression(e))}),value(e){return this.val(e)},table:e=>createRawBuilder({queryId:createQueryId(),rawNode:Ys.createWithChild(parseTable(e))}),id(...e){const t=new Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",createRawBuilder({queryId:createQueryId(),rawNode:Ys.create(t,e.map(Es.create))})},lit:e=>createRawBuilder({queryId:createQueryId(),rawNode:Ys.createWithChild(nn.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>createRawBuilder({queryId:createQueryId(),rawNode:Ys.createWithSql(e)}),join(e,t=Wi`, `){const r=new Array(2*e.length-1),s=t.toOperationNode();for(let t=0;t<e.length;++t)r[2*t]=parseParameter(e[t]),t!==e.length-1&&(r[2*t+1]=s);return createRawBuilder({queryId:createQueryId(),rawNode:Ys.createWithChildren(r)})}});function parseParameter(e){return isOperationNodeSource(e)?e.toOperationNode():parseValueExpression(e)}class OperationNodeVisitor{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#te=freeze({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#te[e.kind](e),this.nodeStack.pop()}}class DefaultQueryCompiler extends OperationNodeVisitor{#re="";#se=[];get numParameters(){return this.#se.length}compileQuery(e){return this.#re="",this.#se=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),freeze({query:e,sql:this.getSql(),parameters:[...this.#se]})}getSql(){return this.#re}visitSelectQuery(e){const t=!(void 0===this.parentNode||on.is(this.parentNode)||vn.is(this.parentNode)||Cs.is(this.parentNode)||_i.is(this.parentNode)||Qn.is(this.parentNode));void 0===this.parentNode&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("select"),e.distinctOn&&(this.append(" "),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.top&&(this.append(" "),this.visitNode(e.top)),e.selections&&(this.append(" "),this.compileList(e.selections)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.groupBy&&(this.append(" "),this.visitNode(e.groupBy)),e.having&&(this.append(" "),this.visitNode(e.having)),e.setOperations&&(this.append(" "),this.compileList(e.setOperations," ")),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.offset&&(this.append(" "),this.visitNode(e.offset)),e.fetch&&(this.append(" "),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...e.endModifiers])," ")),t&&this.append(")")}visitFrom(e){this.append("from "),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append("distinct on ("),this.compileList(e),this.append(")")}compileList(e,t=", "){const r=e.length-1;for(let s=0;s<=r;s++)this.visitNode(e[s]),s<r&&this.append(t)}visitWhere(e){this.append("where "),this.visitNode(e.where)}visitHaving(e){this.append("having "),this.visitNode(e.having)}visitInsertQuery(e){const t=this.nodeStack.find(Sn.is),r=t!==e;!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!En.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append(e.replace?"replace":"insert"),e.ignore&&this.append(" ignore"),e.top&&(this.append(" "),this.visitNode(e.top)),e.into&&(this.append(" into "),this.visitNode(e.into)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.output&&(this.append(" "),this.visitNode(e.output)),e.values&&(this.append(" "),this.visitNode(e.values)),e.defaultValues&&(this.append(" "),this.append("default values")),e.onConflict&&(this.append(" "),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(" "),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!En.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitValues(e){this.append("values "),this.compileList(e.values)}visitDeleteQuery(e){const t=this.nodeStack.find(Sn.is)!==e;!t&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("delete "),e.top&&(this.visitNode(e.top),this.append(" ")),this.visitNode(e.from),e.output&&(this.append(" "),this.visitNode(e.output)),e.using&&(this.append(" "),this.visitNode(e.using)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),t&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitReturning(e){this.append("returning "),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(" as "),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(".")),this.visitNode(e.column)}visitSelectAll(e){this.append("*")}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!isString(e.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(" and "),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(" or "),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append("("),this.compileList(e.values),this.append(")")}visitTuple(e){this.append("("),this.compileList(e.values),this.append(")")}visitPrimitiveValueList(e){this.append("(");const{values:t}=e;for(let e=0;e<t.length;++e)this.appendValue(t[e]),e!==t.length-1&&this.append(", ");this.append(")")}visitParens(e){this.append("("),this.visitNode(e.node),this.append(")")}visitJoin(e){this.append(zi[e.joinType]),this.append(" "),this.visitNode(e.table),e.on&&(this.append(" "),this.visitNode(e.on))}visitOn(e){this.append("on "),this.visitNode(e.on)}visitRaw(e){const{sqlFragments:t,parameters:r}=e;for(let e=0;e<t.length;++e)this.append(t[e]),r.length>e&&this.visitNode(r[e])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(".")),this.visitNode(e.identifier)}visitCreateTable(e){this.append("create "),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers," "),this.append(" ")),e.temporary&&this.append("temporary "),this.append("table "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.table),e.selectQuery?(this.append(" as "),this.visitNode(e.selectQuery)):(this.append(" ("),this.compileList([...e.columns,...e.constraints??[]]),this.append(")"),e.onCommit&&(this.append(" on commit "),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," ")))}visitColumnDefinition(e){e.ifNotExists&&this.append("if not exists "),this.visitNode(e.column),this.append(" "),this.visitNode(e.dataType),e.unsigned&&this.append(" unsigned"),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.generated&&(this.append(" "),this.visitNode(e.generated)),e.identity&&this.append(" identity"),e.defaultTo&&(this.append(" "),this.visitNode(e.defaultTo)),e.notNull&&this.append(" not null"),e.unique&&this.append(" unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.primaryKey&&this.append(" primary key"),e.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),e.references&&(this.append(" "),this.visitNode(e.references)),e.check&&(this.append(" "),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(e){this.append("references "),this.visitNode(e.table),this.append(" ("),this.compileList(e.columns),this.append(")"),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitDropTable(e){this.append("drop table "),e.ifExists&&this.append("if exists "),this.visitNode(e.table),e.cascade&&this.append(" cascade")}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append("order by "),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.direction&&(this.append(" "),this.visitNode(e.direction))}visitGroupBy(e){this.append("group by "),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){const t=this.nodeStack.find(Sn.is),r=t!==e;!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!En.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("update "),e.top&&(this.visitNode(e.top),this.append(" ")),e.table&&(this.visitNode(e.table),this.append(" ")),this.append("set "),e.updates&&this.compileList(e.updates),e.output&&(this.append(" "),this.visitNode(e.output)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!En.is(t)&&this.append(")"),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitColumnUpdate(e){this.visitNode(e.column),this.append(" = "),this.visitNode(e.value)}visitLimit(e){this.append("limit "),this.visitNode(e.limit)}visitOffset(e){this.append("offset "),this.visitNode(e.offset)}visitOnConflict(e){this.append("on conflict"),e.columns?(this.append(" ("),this.compileList(e.columns),this.append(")")):e.constraint?(this.append(" on constraint "),this.visitNode(e.constraint)):e.indexExpression&&(this.append(" ("),this.visitNode(e.indexExpression),this.append(")")),e.indexWhere&&(this.append(" "),this.visitNode(e.indexWhere)),!0===e.doNothing?this.append(" do nothing"):e.updates&&(this.append(" do update set "),this.compileList(e.updates),e.updateWhere&&(this.append(" "),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append("on duplicate key update "),this.compileList(e.updates)}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.using&&(this.append(" using "),this.visitNode(e.using)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.where&&(this.append(" "),this.visitNode(e.where))}visitDropIndex(e){this.append("drop index "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.cascade&&this.append(" cascade")}visitCreateSchema(e){this.append("create schema "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.schema)}visitDropSchema(e){this.append("drop schema "),e.ifExists&&this.append("if exists "),this.visitNode(e.schema),e.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("primary key ("),this.compileList(e.columns),this.append(")")}visitUniqueConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(e.columns),this.append(")")}visitCheckConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("check ("),this.visitNode(e.expression),this.append(")")}visitForeignKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("foreign key ("),this.compileList(e.columns),this.append(") "),this.visitNode(e.references),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitList(e){this.compileList(e.items)}visitWith(e){this.append("with "),e.recursive&&this.append("recursive "),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(" as "),isBoolean(e.materialized)&&(e.materialized||this.append("not "),this.append("materialized ")),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append("("),this.compileList(e.columns),this.append(")"))}visitAlterTable(e){this.append("alter table "),this.visitNode(e.table),this.append(" "),e.renameTo&&(this.append("rename to "),this.visitNode(e.renameTo)),e.setSchema&&(this.append("set schema "),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append("add column "),this.visitNode(e.column)}visitRenameColumn(e){this.append("rename column "),this.visitNode(e.column),this.append(" to "),this.visitNode(e.renameTo)}visitDropColumn(e){this.append("drop column "),this.visitNode(e.column)}visitAlterColumn(e){this.append("alter column "),this.visitNode(e.column),this.append(" "),e.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append("using "),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append("set default "),this.visitNode(e.setDefault)),e.dropDefault&&this.append("drop default"),e.setNotNull&&this.append("set not null"),e.dropNotNull&&this.append("drop not null")}visitModifyColumn(e){this.append("modify column "),this.visitNode(e.column)}visitAddConstraint(e){this.append("add "),this.visitNode(e.constraint)}visitDropConstraint(e){this.append("drop constraint "),e.ifExists&&this.append("if exists "),this.visitNode(e.constraintName),"cascade"===e.modifier?this.append(" cascade"):"restrict"===e.modifier&&this.append(" restrict")}visitSetOperation(e){this.append(e.operator),this.append(" "),e.all&&this.append("all "),this.visitNode(e.expression)}visitCreateView(e){this.append("create "),e.orReplace&&this.append("or replace "),e.materialized&&this.append("materialized "),e.temporary&&this.append("temporary "),this.append("view "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),this.append(" "),e.columns&&(this.append("("),this.compileList(e.columns),this.append(") ")),e.as&&(this.append("as "),this.visitNode(e.as))}visitDropView(e){this.append("drop "),e.materialized&&this.append("materialized "),this.append("view "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.cascade&&this.append(" cascade")}visitGenerated(e){this.append("generated "),e.always&&this.append("always "),e.byDefault&&this.append("by default "),this.append("as "),e.identity&&this.append("identity"),e.expression&&(this.append("("),this.visitNode(e.expression),this.append(")")),e.stored&&this.append(" stored")}visitDefaultValue(e){this.append("default "),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append($i[e.modifier]),e.of&&(this.append(" of "),this.compileList(e.of,", "))}visitCreateType(e){this.append("create type "),this.visitNode(e.name),e.enum&&(this.append(" as enum "),this.visitNode(e.enum))}visitDropType(e){this.append("drop type "),e.ifExists&&this.append("if exists "),this.visitNode(e.name)}visitExplain(e){this.append("explain"),(e.options||e.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append("default")}visitAggregateFunction(e){this.append(e.func),this.append("("),e.distinct&&this.append("distinct "),this.compileList(e.aggregated),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),this.append(")"),e.filter&&(this.append(" filter("),this.visitNode(e.filter),this.append(")")),e.over&&(this.append(" "),this.visitNode(e.over))}visitOver(e){this.append("over("),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(" ")),e.orderBy&&this.visitNode(e.orderBy),this.append(")")}visitPartitionBy(e){this.append("partition by "),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(" "),this.visitNode(e.operator),this.append(" "),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(" "),this.visitNode(e.operand)}isMinusOperator(e){return Qs.is(e)&&"-"===e.operator}visitUsing(e){this.append("using "),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append("("),this.compileList(e.arguments),this.append(")")}visitCase(e){this.append("case"),e.value&&(this.append(" "),this.visitNode(e.value)),e.when&&(this.append(" "),this.compileList(e.when," ")),e.else&&(this.append(" else "),this.visitNode(e.else)),this.append(" end"),e.isStatement&&this.append(" case")}visitWhen(e){this.append("when "),this.visitNode(e.condition),e.result&&(this.append(" then "),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){e.inOperator&&this.visitNode(e.inOperator),this.append("'$");for(const t of e.pathLegs)this.visitNode(t);this.append("'")}visitJSONPathLeg(e){const t="ArrayLocation"===e.type;this.append(t?"[":"."),this.append(String(e.value)),t&&this.append("]")}visitJSONOperatorChain(e){for(let t=0,r=e.values.length;t<r;t++)t===r-1?this.visitNode(e.operator):this.append("->"),this.visitNode(e.values[t])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(" ")),this.append("merge "),e.top&&(this.visitNode(e.top),this.append(" ")),this.append("into "),this.visitNode(e.into),e.using&&(this.append(" "),this.visitNode(e.using)),e.whens&&(this.append(" "),this.compileList(e.whens," ")),e.output&&(this.append(" "),this.visitNode(e.output)),e.endModifiers?.length&&(this.append(" "),this.compileList(e.endModifiers," "))}visitMatched(e){e.not&&this.append("not "),this.append("matched"),e.bySource&&this.append(" by source")}visitAddIndex(e){this.append("add "),e.unique&&this.append("unique "),this.append("index "),this.visitNode(e.name),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.using&&(this.append(" using "),this.visitNode(e.using))}visitCast(e){this.append("cast("),this.visitNode(e.expression),this.append(" as "),this.visitNode(e.dataType),this.append(")")}visitFetch(e){this.append("fetch next "),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append("output "),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}append(e){this.#re+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(e){const t=this.getLeftIdentifierWrapper(),r=this.getRightIdentifierWrapper();let s="";for(const n of e)s+=n,n===t?s+=t:n===r&&(s+=r);return s}addParameter(e){this.#se.push(e)}appendImmediateValue(e){if(isString(e))this.append(`'${e}'`);else if(isNumber(e)||isBoolean(e))this.append(e.toString());else if(isNull(e))this.append("null");else if(isDate(e))this.appendImmediateValue(e.toISOString());else{if(!isBigInt(e))throw new Error(`invalid immediate value ${e}`);this.appendImmediateValue(e.toString())}}sortSelectModifiers(e){return e.sort(((e,t)=>e.modifier&&t.modifier?Mi[e.modifier]-Mi[t.modifier]:1)),freeze(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}}const $i=freeze({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),Mi=freeze({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),zi=freeze({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",Using:"using"}),ji=freeze({raw:(e,t=[])=>freeze({sql:e,query:Ys.createWithSql(e),parameters:freeze(t)})});class DialectAdapterBase{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class SqliteDriver{#ne;#ie=new ConnectionMutex;#oe;#F;constructor(e){this.#ne=freeze({...e})}async init(){this.#oe=isFunction(this.#ne.database)?await this.#ne.database():this.#ne.database,this.#F=new SqliteConnection(this.#oe),this.#ne.onCreateConnection&&await this.#ne.onCreateConnection(this.#F)}async acquireConnection(){return await this.#ie.lock(),this.#F}async beginTransaction(e){await e.executeQuery(ji.raw("begin"))}async commitTransaction(e){await e.executeQuery(ji.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(ji.raw("rollback"))}async releaseConnection(){this.#ie.unlock()}async destroy(){this.#oe?.close()}}class SqliteConnection{#oe;constructor(e){this.#oe=e}executeQuery(e){const{sql:t,parameters:r}=e,s=this.#oe.prepare(t);if(s.reader)return Promise.resolve({rows:s.all(r)});{const{changes:e,lastInsertRowid:t}=s.run(r),n=null!=e?BigInt(e):void 0;return Promise.resolve({numUpdatedOrDeletedRows:n,numAffectedRows:n,insertId:null!=t?BigInt(t):void 0,rows:[]})}}async*streamQuery(e,t){const{sql:r,parameters:s,query:n}=e,i=this.#oe.prepare(r);if(!hn.is(n))throw new Error("Sqlite driver only supports streaming of select queries");{const e=i.iterate(s);for(const t of e)yield{rows:[t]}}}}class ConnectionMutex{#f;#y;async lock(){for(;this.#f;)await this.#f;this.#f=new Promise((e=>{this.#y=e}))}unlock(){const e=this.#y;this.#f=void 0,this.#y=void 0,e?.()}}const Zi=/"/g;class SqliteQueryCompiler extends DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(Zi,'""')}visitDefaultInsertValue(e){this.append("null")}}const Vi="kysely_migration",Fi="kysely_migration_lock";freeze({__noMigrations__:!0});class SqliteIntrospector{#oe;constructor(e){this.#oe=e}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){return await this.#ae(e)}async getMetadata(e){return{tables:await this.getTables(e)}}#de(e,t){let r=e.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return t.withInternalKyselyTables||(r=r.where("name","!=",Vi).where("name","!=",Fi)),r}async#ae(e){const t=await this.#de(this.#oe,e).execute(),r=await this.#oe.with("table_list",(t=>this.#de(t,e))).selectFrom(["table_list as tl",Wi`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy(["tl.name","p.cid"]).execute(),s={};for(const e of r)s[e.table]??=[],s[e.table].push(e);return t.map((({name:e,sql:t,type:r})=>{let n=t?.split(/[\(\),]/)?.find((e=>e.toLowerCase().includes("autoincrement")))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,"");const i=s[e]??[];if(!n){const e=i.filter((e=>e.pk>0));1===e.length&&"integer"===e[0].type.toLowerCase()&&(n=e[0].name)}return{name:e,isView:"view"===r,columns:i.map((e=>({name:e.name,dataType:e.type,isNullable:!e.notnull,isAutoIncrementing:e.name===n,hasDefaultValue:null!=e.dflt_value,comment:void 0})))}}))}}class SqliteAdapter extends DialectAdapterBase{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}class SqliteDialect{#ne;constructor(e){this.#ne=freeze({...e})}createDriver(){return new SqliteDriver(this.#ne)}createQueryCompiler(){return new SqliteQueryCompiler}createAdapter(){return new SqliteAdapter}createIntrospector(e){return new SqliteIntrospector(e)}}const Qi=/"/g;class PostgresQueryCompiler extends DefaultQueryCompiler{sanitizeIdentifier(e){return e.replace(Qi,'""')}}class PostgresIntrospector{#oe;constructor(e){this.#oe=e}async getSchemas(){return(await this.#oe.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map((e=>({name:e.nspname})))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#oe.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",Wi`col_description(a.attrelid, a.attnum)`.as("column_description"),this.#oe.selectFrom("pg_class").select(Wi`true`.as("auto_incrementing")).whereRef("relnamespace","=","c.relnamespace").where("relkind","=","S").where("relname","=",Wi`c.relname || '_' || a.attname || '_seq'`).as("auto_incrementing")]).where((e=>e.or([e("c.relkind","=","r"),e("c.relkind","=","v"),e("c.relkind","=","p")]))).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();e.withInternalKyselyTables||(t=t.where("c.relname","!=",Vi).where("c.relname","!=",Fi));const r=await t.execute();return this.#ce(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#ce(e){return e.reduce(((e,t)=>{let r=e.find((e=>e.name===t.table&&e.schema===t.schema));return r||(r=freeze({name:t.table,isView:"v"===t.table_type,schema:t.schema,columns:[]}),e.push(r)),r.columns.push(freeze({name:t.column,dataType:t.type,dataTypeSchema:t.type_schema,isNullable:!t.not_null,isAutoIncrementing:!!t.auto_incrementing,hasDefaultValue:t.has_default,comment:t.column_description??void 0})),e}),[])}}const Ji=BigInt("3853314791062309107");class PostgresAdapter extends DialectAdapterBase{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e,t){await Wi`select pg_advisory_xact_lock(${Wi.lit(Ji)})`.execute(e)}async releaseMigrationLock(e,t){}}function extendStackTrace(e,t){if(isObject(r=e)&&isString(r.stack)&&t.stack){const r=t.stack.split("\n").slice(1).join("\n");return e.stack+=`\n${r}`,e}var r;return e}const Ki=Symbol();class MysqlDriver{#ne;#$=new WeakMap;#ue;constructor(e){this.#ne=freeze({...e})}async init(){this.#ue=isFunction(this.#ne.pool)?await this.#ne.pool():this.#ne.pool}async acquireConnection(){const e=await this.#le();let t=this.#$.get(e);return t||(t=new MysqlConnection(e),this.#$.set(e,t),this.#ne?.onCreateConnection&&await this.#ne.onCreateConnection(t)),this.#ne?.onReserveConnection&&await this.#ne.onReserveConnection(t),t}async#le(){return new Promise(((e,t)=>{this.#ue.getConnection((async(r,s)=>{r?t(r):e(s)}))}))}async beginTransaction(e,t){t.isolationLevel&&await e.executeQuery(ji.raw(`set transaction isolation level ${t.isolationLevel}`)),await e.executeQuery(ji.raw("begin"))}async commitTransaction(e){await e.executeQuery(ji.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(ji.raw("rollback"))}async releaseConnection(e){e[Ki]()}async destroy(){return new Promise(((e,t)=>{this.#ue.end((r=>{r?t(r):e()}))}))}}class MysqlConnection{#pe;constructor(e){this.#pe=e}async executeQuery(e){try{const r=await this.#he(e);if(isObject(t=r)&&"insertId"in t&&"affectedRows"in t){const{insertId:e,affectedRows:t,changedRows:s}=r,n=null!=t?BigInt(t):void 0,i=null!=s?BigInt(s):void 0;return{insertId:null!=e&&"0"!==e.toString()?BigInt(e):void 0,numUpdatedOrDeletedRows:n,numAffectedRows:n,numChangedRows:i,rows:[]}}return Array.isArray(r)?{rows:r}:{rows:[]}}catch(e){throw extendStackTrace(e,new Error)}var t}#he(e){return new Promise(((t,r)=>{this.#pe.query(e.sql,e.parameters,((e,s)=>{e?r(e):t(s)}))}))}async*streamQuery(e,t){const r=this.#pe.query(e.sql,e.parameters).stream({objectMode:!0});try{for await(const e of r)yield{rows:[e]}}catch(e){if(e&&"object"==typeof e&&"code"in e&&"ERR_STREAM_PREMATURE_CLOSE"===e.code)return;throw e}}[Ki](){this.#pe.release()}}const Hi=/`/g;class MysqlQueryCompiler extends DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(e){return e.replace(Hi,"``")}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.using&&(this.append(" using "),this.visitNode(e.using)),e.table&&(this.append(" on "),this.visitNode(e.table)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.where&&(this.append(" "),this.visitNode(e.where))}}class MysqlIntrospector{#oe;constructor(e){this.#oe=e}async getSchemas(){return(await this.#oe.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map((e=>({name:e.SCHEMA_NAME})))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#oe.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",(e=>e.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME"))).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",Wi`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();e.withInternalKyselyTables||(t=t.where("columns.TABLE_NAME","!=",Vi).where("columns.TABLE_NAME","!=",Fi));const r=await t.execute();return this.#ce(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#ce(e){return e.reduce(((e,t)=>{let r=e.find((e=>e.name===t.TABLE_NAME));return r||(r=freeze({name:t.TABLE_NAME,isView:"VIEW"===t.TABLE_TYPE,schema:t.TABLE_SCHEMA,columns:[]}),e.push(r)),r.columns.push(freeze({name:t.COLUMN_NAME,dataType:t.DATA_TYPE,isNullable:"YES"===t.IS_NULLABLE,isAutoIncrementing:t.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==t.COLUMN_DEFAULT,comment:""===t.COLUMN_COMMENT?void 0:t.COLUMN_COMMENT})),e}),[])}}const Gi="ea586330-2c93-47c8-908d-981d9d270f9d";class MysqlAdapter extends DialectAdapterBase{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(e,t){await Wi`select get_lock(${Wi.lit(Gi)}, ${Wi.lit(3600)})`.execute(e)}async releaseMigrationLock(e,t){await Wi`select release_lock(${Wi.lit(Gi)})`.execute(e)}}class MysqlDialect{#ne;constructor(e){this.#ne=e}createDriver(){return new MysqlDriver(this.#ne)}createQueryCompiler(){return new MysqlQueryCompiler}createAdapter(){return new MysqlAdapter}createIntrospector(e){return new MysqlIntrospector(e)}}const Yi=Symbol();class PostgresDriver{#ne;#$=new WeakMap;#ue;constructor(e){this.#ne=freeze({...e})}async init(){this.#ue=isFunction(this.#ne.pool)?await this.#ne.pool():this.#ne.pool}async acquireConnection(){const e=await this.#ue.connect();let t=this.#$.get(e);return t||(t=new PostgresConnection(e,{cursor:this.#ne.cursor??null}),this.#$.set(e,t),this.#ne.onCreateConnection&&await this.#ne.onCreateConnection(t)),this.#ne.onReserveConnection&&await this.#ne.onReserveConnection(t),t}async beginTransaction(e,t){t.isolationLevel?await e.executeQuery(ji.raw(`start transaction isolation level ${t.isolationLevel}`)):await e.executeQuery(ji.raw("begin"))}async commitTransaction(e){await e.executeQuery(ji.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(ji.raw("rollback"))}async releaseConnection(e){e[Yi]()}async destroy(){if(this.#ue){const e=this.#ue;this.#ue=void 0,await e.end()}}}class PostgresConnection{#me;#fe;constructor(e,t){this.#me=e,this.#fe=t}async executeQuery(e){try{const t=await this.#me.query(e.sql,[...e.parameters]);if("INSERT"===t.command||"UPDATE"===t.command||"DELETE"===t.command||"MERGE"===t.command){const e=BigInt(t.rowCount);return{numUpdatedOrDeletedRows:e,numAffectedRows:e,rows:t.rows??[]}}return{rows:t.rows??[]}}catch(e){throw extendStackTrace(e,new Error)}}async*streamQuery(e,t){if(!this.#fe.cursor)throw new Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(t)||t<=0)throw new Error("chunkSize must be a positive integer");const r=this.#me.query(new this.#fe.cursor(e.sql,e.parameters.slice()));try{for(;;){const e=await r.read(t);if(0===e.length)break;yield{rows:e}}}finally{await r.close()}}[Yi](){this.#me.release()}}class PostgresDialect{#ne;constructor(e){this.#ne=e}createDriver(){return new PostgresDriver(this.#ne)}createQueryCompiler(){return new PostgresQueryCompiler}createAdapter(){return new PostgresAdapter}createIntrospector(e){return new PostgresIntrospector(e)}}class MssqlAdapter extends DialectAdapterBase{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(e){await Wi`exec sp_getapplock @DbPrincipal = ${Wi.lit("dbo")}, @Resource = ${Wi.lit(Vi)}, @LockMode = ${Wi.lit("Exclusive")}`.execute(e)}async releaseMigrationLock(){}}const Xi=Symbol(),eo=Symbol();class MssqlDriver{#ne;#ue;constructor(e){this.#ne=freeze({...e});const{tarn:t,tedious:r}=this.#ne,{validateConnections:s,...n}=t.options;this.#ue=new t.Pool({...n,create:async()=>{const e=await r.connectionFactory();return await new MssqlConnection(e,r).connect()},destroy:async e=>{await e[eo]()},validate:!1===s?void 0:e=>e.validate()})}async init(){}async acquireConnection(){return await this.#ue.acquire().promise}async beginTransaction(e,t){await e.beginTransaction(t)}async commitTransaction(e){await e.commitTransaction()}async rollbackTransaction(e){await e.rollbackTransaction()}async releaseConnection(e){await e[Xi](),this.#ue.release(e)}async destroy(){await this.#ue.destroy()}}class MssqlConnection{#F;#ye;constructor(e,t){this.#F=e,this.#ye=t,this.#F.on("error",console.error),this.#F.once("end",(()=>{this.#F.off("error",console.error)}))}async beginTransaction(e){const{isolationLevel:t}=e;await new Promise(((e,r)=>this.#F.beginTransaction((t=>{t?r(t):e(void 0)}),t?randomString(8):void 0,t?this.#ge(t):void 0)))}async commitTransaction(){await new Promise(((e,t)=>this.#F.commitTransaction((r=>{r?t(r):e(void 0)}))))}async connect(){return await new Promise(((e,t)=>{this.#F.connect((r=>{r?(console.error(r),t(r)):e(void 0)}))})),this}async executeQuery(e){try{const t=new Deferred,r=new MssqlRequest({compiledQuery:e,tedious:this.#ye,onDone:t});this.#F.execSql(r.request);const{rowCount:s,rows:n}=await t.promise;return{numAffectedRows:void 0!==s?BigInt(s):void 0,rows:n}}catch(e){throw extendStackTrace(e,new Error)}}async rollbackTransaction(){await new Promise(((e,t)=>this.#F.rollbackTransaction((r=>{r?t(r):e(void 0)}))))}async*streamQuery(e,t){if(!Number.isInteger(t)||t<=0)throw new Error("chunkSize must be a positive integer");const r=new MssqlRequest({compiledQuery:e,streamChunkSize:t,tedious:this.#ye});this.#F.execSql(r.request);try{for(;;){const e=await r.readChunk();if(0===e.length)break;if(yield{rows:e},e.length<t)break}}finally{await this.#we(r)}}async validate(){try{const e=new Deferred,t=new MssqlRequest({compiledQuery:ji.raw("select 1"),onDone:e,tedious:this.#ye});return this.#F.execSql(t.request),await e.promise,!0}catch{return!1}}#ge(e){const{ISOLATION_LEVEL:t}=this.#ye,r={"read committed":t.READ_COMMITTED,"read uncommitted":t.READ_UNCOMMITTED,"repeatable read":t.REPEATABLE_READ,serializable:t.SERIALIZABLE,snapshot:t.SNAPSHOT}[e];if(void 0===r)throw new Error(`Unknown isolation level: ${e}`);return r}#we(e){return new Promise((t=>{e.request.once("requestCompleted",t);this.#F.cancel()||(e.request.off("requestCompleted",t),t(void 0))}))}async[Xi](){!1!==this.#ye.resetConnectionOnRelease&&await new Promise(((e,t)=>{this.#F.reset((r=>{r?t(r):e(void 0)}))}))}[eo](){return new Promise((e=>{this.#F.once("end",(()=>{e(void 0)})),this.#F.close()}))}}class MssqlRequest{#ve;#be;#Ne;#_e;#ye;#xe;#Te;constructor(e){const{compiledQuery:t,onDone:r,streamChunkSize:s,tedious:n}=e;if(this.#be=[],this.#Ne=s,this.#_e={},this.#ye=n,r){const e="onDone";this.#_e[e]=(t,s)=>{"chunkReady"!==t&&(delete this.#_e[e],"error"===t?r.reject(s):r.resolve({rowCount:this.#Te,rows:this.#be}))}}this.#ve=new this.#ye.Request(t.sql,((e,t)=>{e?Object.values(this.#_e).forEach((t=>t("error",e instanceof AggregateError?e.errors:e))):this.#Te=t})),this.#ke(t.parameters),this.#Ae()}get request(){return this.#ve}readChunk(){const e=this.readChunk.name;return new Promise(((t,r)=>{this.#_e[e]=(s,n)=>{delete this.#_e[e],"error"===s?r(n):t(this.#be.splice(0,this.#Ne))},this.#ve.resume()}))}#ke(e){for(let t=0;t<e.length;t++){const r=e[t];this.#ve.addParameter(String(t+1),this.#Ee(r),r)}}#Ae(){const e=this.#Ne?()=>{this.#Ne<=this.#be.length&&(this.#ve.pause(),Object.values(this.#_e).forEach((e=>e("chunkReady"))))}:()=>{},rowListener=t=>{const r={};for(const e of t)r[e.metadata.colName]=e.value;this.#be.push(r),e()};this.#ve.on("row",rowListener),this.#ve.once("requestCompleted",(()=>{Object.values(this.#_e).forEach((e=>e("completed"))),this.#ve.off("row",rowListener)}))}#Ee(e){return isNull(e)||isUndefined(e)||isString(e)?this.#ye.TYPES.NVarChar:isBigInt(e)||isNumber(e)&&e%1==0?e<-2147483648||e>2147483647?this.#ye.TYPES.BigInt:this.#ye.TYPES.Int:isNumber(e)?this.#ye.TYPES.Float:isBoolean(e)?this.#ye.TYPES.Bit:isDate(e)?this.#ye.TYPES.DateTime:(t=e,void 0!==E&&E.isBuffer(t)?this.#ye.TYPES.VarBinary:this.#ye.TYPES.NVarChar);var t}}class MssqlIntrospector{#oe;constructor(e){this.#oe=e}async getSchemas(){return await this.#oe.selectFrom("sys.schemas").select("name").execute()}async getTables(e={withInternalKyselyTables:!1}){const t=await this.#oe.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",(e=>e.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description"))).$if(!e.withInternalKyselyTables,(e=>e.where("tables.name","!=",Vi).where("tables.name","!=",Fi))).select(["tables.name as table_name",e=>e.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#oe.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",(e=>e.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description"))).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),r={};for(const e of t){const t=`${e.table_schema_name}.${e.table_name}`;(r[t]=r[t]||freeze({columns:[],isView:"V "===e.table_type,name:e.table_name,schema:e.table_schema_name??void 0})).columns.push(freeze({dataType:e.type_name,dataTypeSchema:e.type_schema_name??void 0,hasDefaultValue:e.column_default_object_id>0||"NOT_APPLICABLE"!==e.column_generated_always_type||e.column_is_identity||e.column_is_computed||e.column_is_rowguidcol,isAutoIncrementing:e.column_is_identity,isNullable:e.column_is_nullable&&e.type_is_nullable,name:e.column_name,comment:e.column_comment??void 0}))}return Object.values(r)}async getMetadata(e){return{tables:await this.getTables(e)}}}class MssqlQueryCompiler extends DefaultQueryCompiler{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(e){super.visitOffset(e),this.append(" rows")}compileColumnAlterations(e){const t={};for(const r of e)t[r.kind]||(t[r.kind]=[]),t[r.kind].push(r);let r=!0;t.AddColumnNode&&(this.append("add "),this.compileList(t.AddColumnNode),r=!1),t.AlterColumnNode&&(r||this.append(", "),this.compileList(t.AlterColumnNode)),t.DropColumnNode&&(r||this.append(", "),this.append("drop column "),this.compileList(t.DropColumnNode)),t.ModifyColumnNode&&(r||this.append(", "),this.compileList(t.ModifyColumnNode)),t.RenameColumnNode&&(r||this.append(", "),this.compileList(t.RenameColumnNode))}visitAddColumn(e){this.visitNode(e.column)}visitDropColumn(e){this.visitNode(e.column)}visitMergeQuery(e){super.visitMergeQuery(e),this.append(";")}announcesNewColumnDataType(){return!1}}class MssqlDialect{#ne;constructor(e){this.#ne=e}createDriver(){return new MssqlDriver(this.#ne)}createQueryCompiler(){return new MssqlQueryCompiler}createAdapter(){return new MssqlAdapter}createIntrospector(e){return new MssqlIntrospector(e)}}function withApplyDefault(e,t,r){return"update"===r?e:null==e&&t.defaultValue?"function"==typeof t.defaultValue?t.defaultValue():t.defaultValue:e}let to=[],ro=-1;const so="[0m",no="[1m",io="[2m",oo={yellow:"[33m",magenta:"[35m"},ao={black:"[40m"},createAdapter=({adapter:e,config:t})=>r=>{const s={...t,supportsBooleans:t.supportsBooleans??!0,supportsDates:t.supportsDates??!0,supportsJSON:t.supportsJSON??!1,adapterName:t.adapterName??t.adapterId,supportsNumericIds:t.supportsNumericIds??!0};if(!0===r.advanced?.database?.useNumberId&&!1===s.supportsNumericIds)throw new Error(`[${s.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);const n=getAuthTables(r),getDefaultFieldName=({field:e,model:t})=>{if("id"===e)return e;const r=getDefaultModelName(t);let s=n[r]?.fields[e];if(s||(s=Object.values(n[r]?.fields).find((t=>t.fieldName===e))),!s)throw debugLog(`Field ${e} not found in model ${r}`),debugLog("Schema:",n),new Error(`Field ${e} not found in model ${r}`);return e},getDefaultModelName=e=>{if(s.usePlural&&"s"===e.charAt(e.length-1)){let t=e.slice(0,-1),r=n[t]?t:void 0;if(r||(r=Object.entries(n).find((([e,r])=>r.modelName===t))?.[0]),r)return r}let t=n[e]?e:void 0;if(t||(t=Object.entries(n).find((([t,r])=>r.modelName===e))?.[0]),!t)throw debugLog(`Model "${e}" not found in schema`),debugLog("Schema:",n),new Error(`Model "${e}" not found in schema`);return t},getModelName=e=>n[e].modelName!==e?n[e].modelName:s.usePlural?`${e}s`:e;function getFieldName({model:e,field:t}){const r=getDefaultModelName(e),s=getDefaultFieldName({model:r,field:t});return n[r]?.fields[s]?.fieldName||s}const debugLog=(...e)=>{if(!0===s.debugLogs||"object"==typeof s.debugLogs){if("object"==typeof s.debugLogs&&"isRunningAdapterTests"in s.debugLogs)return void(s.debugLogs.isRunningAdapterTests&&(e.shift(),to.push(e)));if("object"==typeof s.debugLogs&&s.debugLogs.logCondition&&!s.debugLogs.logCondition?.())return;if("object"==typeof e[0]&&"method"in e[0]){const t=e.shift().method;if("object"==typeof s.debugLogs){if("create"===t&&!s.debugLogs.create)return;if("update"===t&&!s.debugLogs.update)return;if("updateMany"===t&&!s.debugLogs.updateMany)return;if("findOne"===t&&!s.debugLogs.findOne)return;if("findMany"===t&&!s.debugLogs.findMany)return;if("delete"===t&&!s.debugLogs.delete)return;if("deleteMany"===t&&!s.debugLogs.deleteMany)return;if("count"===t&&!s.debugLogs.count)return}Lr.info(`[${s.adapterName}]`,...e)}else Lr.info(`[${s.adapterName}]`,...e)}},idField=({customModelName:e})=>{const t=!s.disableIdGeneration&&!r.advanced?.database?.useNumberId,n=getDefaultModelName(e??"id");return{type:r.advanced?.database?.useNumberId?"number":"string",required:!!t,...t?{defaultValue(){if(s.disableIdGeneration)return;const e=r.advanced?.database?.useNumberId;let t=r.advanced?.database?.generateId;return r.advanced?.generateId&&(Lr.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),t=r.advanced?.generateId),!1===t||e?void 0:t?t({model:n}):s.customIdGenerator?s.customIdGenerator({model:n}):generateId()}}:{}}},getFieldAttributes=({model:e,field:t})=>{const r=getDefaultModelName(e),s=getDefaultFieldName({field:t,model:e}),i=n[r].fields;return i.id=idField({customModelName:r}),i[s]},i=e({options:r,schema:n,debugLog:debugLog,getFieldName:getFieldName,getModelName:getModelName,getDefaultModelName:getDefaultModelName,getDefaultFieldName:getDefaultFieldName,getFieldAttributes:getFieldAttributes}),transformInput=async(e,t,i)=>{const o={},a=n[t].fields,d=s.mapKeysTransformInput??{};s.disableIdGeneration||r.advanced?.database?.useNumberId||(a.id=idField({customModelName:t}));for(const c in a){const u=e[c],l=a[c];let p=d[c]||a[c].fieldName||c;if(void 0===u&&(!l.defaultValue&&!l.transform?.input||"update"===i))continue;let h=withApplyDefault(u,l,i);l.transform?.input&&(h=await l.transform.input(h)),"id"===l.references?.field&&r.advanced?.database?.useNumberId?h=Array.isArray(h)?h.map(Number):Number(h):!1===s.supportsJSON&&"object"==typeof h&&"json"===l.type?h=JSON.stringify(h):!1===s.supportsDates&&h instanceof Date&&"date"===l.type?h=h.toISOString():!1===s.supportsBooleans&&"boolean"==typeof h&&(h=h?1:0),s.customTransformInput&&(h=s.customTransformInput({data:h,action:i,field:p,fieldAttributes:l,model:t,schema:n,options:r})),o[p]=h}return o},transformOutput=async(e,t,i=[])=>{if(!e)return null;const o=s.mapKeysTransformOutput??{},a={},d=n[t].fields,c=Object.entries(o).find((([e,t])=>"id"===t))?.[0];d[c??"id"]={type:r.advanced?.database?.useNumberId?"number":"string"};for(const c in d){if(i.length&&!i.includes(c))continue;const u=d[c];if(u){const d=u.fieldName||c;let l=e[Object.entries(o).find((([e,t])=>t===d))?.[0]||d];u.transform?.output&&(l=await u.transform.output(l));let p=o[c]||c;"id"===d||"id"===u.references?.field?void 0!==l&&(l=String(l)):!1===s.supportsJSON&&"string"==typeof l&&"json"===u.type?l=safeJSONParse(l):!1===s.supportsDates&&"string"==typeof l&&"date"===u.type?l=new Date(l):!1===s.supportsBooleans&&"number"==typeof l&&"boolean"===u.type&&(l=1===l),s.customTransformOutput&&(l=s.customTransformOutput({data:l,field:p,fieldAttributes:u,select:i,model:t,schema:n,options:r})),a[p]=l}}return a},transformWhereClause=({model:e,where:t})=>{if(t)return t.map((t=>{const{field:s,value:n,operator:i="eq",connector:o="AND"}=t;if("in"===i&&!Array.isArray(n))throw new Error("Value must be an array");const a=getDefaultModelName(e),d=getDefaultFieldName({field:s,model:e}),c=getFieldName({field:d,model:a}),u=getFieldAttributes({field:d,model:a});return"id"!==d&&"id"!==u.references?.field||!r.advanced?.database?.useNumberId?{operator:i,connector:o,field:c,value:n}:Array.isArray(n)?{operator:i,connector:o,field:c,value:n.map(Number)}:{operator:i,connector:o,field:c,value:Number(n)}}))};return{create:async({data:e,model:t,select:r})=>{ro++;let n=ro;const o=getModelName(t);if("id"in e){Lr.warn(`[${s.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you. The id will be ignored.`);const t=new Error,r=t.stack?.split("\n").filter(((e,t)=>1!==t)).join("\n").replace("Error:","Create method with `id` being called at:");console.log(r),e.id=void 0}debugLog({method:"create"},`${formatTransactionId(n)} ${formatStep(1,4)}`,`${formatMethod("create")} ${formatAction("Unsafe Input")}:`,{model:o,data:e});const a=await transformInput(e,t,"create");debugLog({method:"create"},`${formatTransactionId(n)} ${formatStep(2,4)}`,`${formatMethod("create")} ${formatAction("Parsed Input")}:`,{model:o,data:a});const d=await i.create({data:a,model:o});debugLog({method:"create"},`${formatTransactionId(n)} ${formatStep(3,4)}`,`${formatMethod("create")} ${formatAction("DB Result")}:`,{model:o,res:d});const c=await transformOutput(d,t,r);return debugLog({method:"create"},`${formatTransactionId(n)} ${formatStep(4,4)}`,`${formatMethod("create")} ${formatAction("Parsed Result")}:`,{model:o,data:c}),c},update:async({model:e,where:t,update:r})=>{ro++;let s=ro;const n=getModelName(e),o=transformWhereClause({model:e,where:t});debugLog({method:"update"},`${formatTransactionId(s)} ${formatStep(1,4)}`,`${formatMethod("update")} ${formatAction("Unsafe Input")}:`,{model:n,data:r});const a=await transformInput(r,e,"update");debugLog({method:"update"},`${formatTransactionId(s)} ${formatStep(2,4)}`,`${formatMethod("update")} ${formatAction("Parsed Input")}:`,{model:n,data:a});const d=await i.update({model:n,where:o,update:a});debugLog({method:"update"},`${formatTransactionId(s)} ${formatStep(3,4)}`,`${formatMethod("update")} ${formatAction("DB Result")}:`,{model:n,data:d});const c=await transformOutput(d,e);return debugLog({method:"update"},`${formatTransactionId(s)} ${formatStep(4,4)}`,`${formatMethod("update")} ${formatAction("Parsed Result")}:`,{model:n,data:c}),c},updateMany:async({model:e,where:t,update:r})=>{ro++;let s=ro;const n=getModelName(e),o=transformWhereClause({model:e,where:t});debugLog({method:"updateMany"},`${formatTransactionId(s)} ${formatStep(1,4)}`,`${formatMethod("updateMany")} ${formatAction("Unsafe Input")}:`,{model:n,data:r});const a=await transformInput(r,e,"update");debugLog({method:"updateMany"},`${formatTransactionId(s)} ${formatStep(2,4)}`,`${formatMethod("updateMany")} ${formatAction("Parsed Input")}:`,{model:n,data:a});const d=await i.updateMany({model:n,where:o,update:a});return debugLog({method:"updateMany"},`${formatTransactionId(s)} ${formatStep(3,4)}`,`${formatMethod("updateMany")} ${formatAction("DB Result")}:`,{model:n,data:d}),debugLog({method:"updateMany"},`${formatTransactionId(s)} ${formatStep(4,4)}`,`${formatMethod("updateMany")} ${formatAction("Parsed Result")}:`,{model:n,data:d}),d},findOne:async({model:e,where:t,select:r})=>{ro++;let s=ro;const n=getModelName(e),o=transformWhereClause({model:e,where:t});debugLog({method:"findOne"},`${formatTransactionId(s)} ${formatStep(1,3)}`,`${formatMethod("findOne")}:`,{model:n,where:o,select:r});const a=await i.findOne({model:n,where:o,select:r});debugLog({method:"findOne"},`${formatTransactionId(s)} ${formatStep(2,3)}`,`${formatMethod("findOne")} ${formatAction("DB Result")}:`,{model:n,data:a});const d=await transformOutput(a,e,r);return debugLog({method:"findOne"},`${formatTransactionId(s)} ${formatStep(3,3)}`,`${formatMethod("findOne")} ${formatAction("Parsed Result")}:`,{model:n,data:d}),d},findMany:async({model:e,where:t,limit:s,sortBy:n,offset:o})=>{ro++;let a=ro;const d=s??r.advanced?.database?.defaultFindManyLimit??100,c=getModelName(e),u=transformWhereClause({model:e,where:t});debugLog({method:"findMany"},`${formatTransactionId(a)} ${formatStep(1,3)}`,`${formatMethod("findMany")}:`,{model:c,where:u,limit:d,sortBy:n,offset:o});const l=await i.findMany({model:c,where:u,limit:d,sortBy:n,offset:o});debugLog({method:"findMany"},`${formatTransactionId(a)} ${formatStep(2,3)}`,`${formatMethod("findMany")} ${formatAction("DB Result")}:`,{model:c,data:l});const p=await Promise.all(l.map((async t=>await transformOutput(t,e))));return debugLog({method:"findMany"},`${formatTransactionId(a)} ${formatStep(3,3)}`,`${formatMethod("findMany")} ${formatAction("Parsed Result")}:`,{model:c,data:p}),p},delete:async({model:e,where:t})=>{ro++;let r=ro;const s=getModelName(e),n=transformWhereClause({model:e,where:t});debugLog({method:"delete"},`${formatTransactionId(r)} ${formatStep(1,2)}`,`${formatMethod("delete")}:`,{model:s,where:n}),await i.delete({model:s,where:n}),debugLog({method:"delete"},`${formatTransactionId(r)} ${formatStep(2,2)}`,`${formatMethod("delete")} ${formatAction("DB Result")}:`,{model:s})},deleteMany:async({model:e,where:t})=>{ro++;let r=ro;const s=getModelName(e),n=transformWhereClause({model:e,where:t});debugLog({method:"deleteMany"},`${formatTransactionId(r)} ${formatStep(1,2)}`,`${formatMethod("deleteMany")} ${formatAction("DeleteMany")}:`,{model:s,where:n});const o=await i.deleteMany({model:s,where:n});return debugLog({method:"deleteMany"},`${formatTransactionId(r)} ${formatStep(2,2)}`,`${formatMethod("deleteMany")} ${formatAction("DB Result")}:`,{model:s,data:o}),o},count:async({model:e,where:t})=>{ro++;let r=ro;const s=getModelName(e),n=transformWhereClause({model:e,where:t});debugLog({method:"count"},`${formatTransactionId(r)} ${formatStep(1,2)}`,`${formatMethod("count")}:`,{model:s,where:n});const o=await i.count({model:s,where:n});return debugLog({method:"count"},`${formatTransactionId(r)} ${formatStep(2,2)}`,`${formatMethod("count")}:`,{model:s,data:o}),o},createSchema:i.createSchema?async(e,t)=>{const s=getAuthTables(r);return r.secondaryStorage&&!r.session?.storeSessionInDatabase&&delete s.session,!r.rateLimit||"database"!==r.rateLimit.storage||void 0!==r.rateLimit.enabled&&!0!==r.rateLimit.enabled||(s.ratelimit={modelName:r.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:r.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:r.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:r.rateLimit.fields?.lastRequest??"lastRequest"}}}),i.createSchema({file:t,tables:s})}:void 0,options:{adapterConfig:s,...i.options??{}},id:s.adapterId,...s.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){to=[]},printDebugLogs(){const e="─".repeat(80);let t=to.reverse().map((e=>(e[0]=`\n${e[0]}`,[...e,"\n"]))).reduce(((e,t)=>[...t,...e]),[`\n${e}`]);console.log(...t)}}}:{}}};function formatTransactionId(e){return`${oo.magenta}#${e}${so}`}function formatStep(e,t){return`${ao.black}${oo.yellow}[${e}/${t}]${so}`}function formatMethod(e){return`${no}${e}${so}`}function formatAction(e){return`${io}(${e})${so}`}function getDatabaseType(e){if(!e)return null;if("dialect"in e)return getDatabaseType(e.dialect);if("createDriver"in e){if(e instanceof SqliteDialect)return"sqlite";if(e instanceof MysqlDialect)return"mysql";if(e instanceof PostgresDialect)return"postgres";if(e instanceof MssqlDialect)return"mssql"}return"aggregate"in e?"sqlite":"getConnection"in e?"mysql":"connect"in e?"postgres":null}const createKyselyAdapter=async e=>{const t=e.database;if(!t)return{kysely:null,databaseType:null};if("db"in t)return{kysely:t.db,databaseType:t.type};if("dialect"in t)return{kysely:new Kysely({dialect:t.dialect}),databaseType:t.type};let r;const s=getDatabaseType(t);return"createDriver"in t&&(r=t),"aggregate"in t&&(r=new SqliteDialect({database:t})),"getConnection"in t&&(r=new MysqlDialect(t)),"connect"in t&&(r=new PostgresDialect({pool:t})),{kysely:r?new Kysely({dialect:r}):null,databaseType:s}},kyselyAdapter=(e,t)=>createAdapter({config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:t?.usePlural,debugLogs:t?.debugLogs,supportsBooleans:!("sqlite"===t?.type||"mssql"===t?.type||!t?.type),supportsDates:!("sqlite"===t?.type||"mssql"===t?.type||!t?.type),supportsJSON:!1},adapter:({getFieldName:r,schema:s})=>{const withReturning=async(s,n,i,o)=>{let a;if("mysql"===t?.type){await n.execute();const t=s.id?"id":o.length>0&&o[0].field?o[0].field:"id";if(!s.id&&0===o.length)return a=await e.selectFrom(i).selectAll().orderBy(r({model:i,field:t}),"desc").limit(1).executeTakeFirst(),a;const d=s[t]||o[0].value;return a=await e.selectFrom(i).selectAll().orderBy(r({model:i,field:t}),"desc").where(r({model:i,field:t}),"=",d).limit(1).executeTakeFirst(),a}return"mssql"===t?.type?(a=await n.outputAll("inserted").executeTakeFirst(),a):(a=await n.returningAll().executeTakeFirst(),a)};function convertWhereClause(e,n){if(!n)return{and:null,or:null};const i={and:[],or:[]};return n.forEach((n=>{let{field:o,value:a,operator:d="=",connector:c="AND"}=n;const u=r({model:e,field:o});a=function(e,r,n){if("id"===n)return e;const{type:i="sqlite"}=t||{};let o=s[r]?.fields[n];return o||(o=Object.values(s).find((e=>e.modelName===r))),"boolean"!==o.type||"sqlite"!==i&&"mssql"!==i||null==e?"date"===o.type&&e&&e instanceof Date&&"sqlite"===i?e.toISOString():e:e?1:0}(a,e,o);const expr=e=>"in"===d.toLowerCase()?e(u,"in",Array.isArray(a)?a:[a]):"contains"===d?e(u,"like",`%${a}%`):"starts_with"===d?e(u,"like",`${a}%`):"ends_with"===d?e(u,"like",`%${a}`):e(u,"eq"===d?"=":"ne"===d?"<>":"gt"===d?">":"gte"===d?">=":"lt"===d?"<":"lte"===d?"<=":d,a);"OR"===c?i.or.push(expr):i.and.push(expr)})),{and:i.and.length?i.and:null,or:i.or.length?i.or:null}}return{async create({data:t,model:r}){const s=e.insertInto(r).values(t);return await withReturning(t,s,r,[])},async findOne({model:t,where:r,select:s}){const{and:n,or:i}=convertWhereClause(t,r);let o=e.selectFrom(t).selectAll();n&&(o=o.where((e=>e.and(n.map((t=>t(e))))))),i&&(o=o.where((e=>e.or(i.map((t=>t(e)))))));const a=await o.executeTakeFirst();return a||null},async findMany({model:s,where:n,limit:i,offset:o,sortBy:a}){const{and:d,or:c}=convertWhereClause(s,n);let u=e.selectFrom(s);d&&(u=u.where((e=>e.and(d.map((t=>t(e))))))),c&&(u=u.where((e=>e.or(c.map((t=>t(e))))))),"mssql"===t?.type?o||(u=u.top(i||100)):u=u.limit(i||100),a&&(u=u.orderBy(r({model:s,field:a.field}),a.direction)),o&&("mssql"===t?.type?(a||(u=u.orderBy(r({model:s,field:"id"}))),u=u.offset(o).fetch(i||100)):u=u.offset(o));const l=await u.selectAll().execute();return l||[]},async update({model:t,where:r,update:s}){const{and:n,or:i}=convertWhereClause(t,r);let o=e.updateTable(t).set(s);return n&&(o=o.where((e=>e.and(n.map((t=>t(e))))))),i&&(o=o.where((e=>e.or(i.map((t=>t(e))))))),await withReturning(s,o,t,r)},async updateMany({model:t,where:r,update:s}){const{and:n,or:i}=convertWhereClause(t,r);let o=e.updateTable(t).set(s);n&&(o=o.where((e=>e.and(n.map((t=>t(e))))))),i&&(o=o.where((e=>e.or(i.map((t=>t(e)))))));return(await o.execute()).length},async count({model:t,where:r}){const{and:s,or:n}=convertWhereClause(t,r);let i=e.selectFrom(t).select(e.fn.count("id").as("count"));s&&(i=i.where((e=>e.and(s.map((t=>t(e))))))),n&&(i=i.where((e=>e.or(n.map((t=>t(e)))))));return(await i.execute())[0].count},async delete({model:t,where:r}){const{and:s,or:n}=convertWhereClause(t,r);let i=e.deleteFrom(t);s&&(i=i.where((e=>e.and(s.map((t=>t(e))))))),n&&(i=i.where((e=>e.or(n.map((t=>t(e))))))),await i.execute()},async deleteMany({model:t,where:r}){const{and:s,or:n}=convertWhereClause(t,r);let i=e.deleteFrom(t);return s&&(i=i.where((e=>e.and(s.map((t=>t(e))))))),n&&(i=i.where((e=>e.or(n.map((t=>t(e))))))),(await i.execute()).length},options:t}}});const createInternalAdapter=(e,t)=>{const r=t.options,s=r.secondaryStorage,n=r.session?.expiresIn||604800,{createWithHooks:i,updateWithHooks:o,updateManyWithHooks:a}=function(e,t){const r=t.hooks;return{createWithHooks:async function(t,s,n,i){let o=t;for(const e of r||[]){const t=e[s]?.create?.before;if(t){const e=await t(o,i);if(!1===e)return null;"object"==typeof e&&"data"in e&&(o={...o,...e.data})}}const a=n?await n.fn(o):null,d=!n||n.executeMainFn?await e.create({model:s,data:o}):a;for(const e of r||[]){const t=e[s]?.create?.after;t&&await t(d,i)}return d},updateWithHooks:async function(t,s,n,i,o){let a=t;for(const e of r||[]){const r=e[n]?.update?.before;if(r){const e=await r(t,o);if(!1===e)return null;a="object"==typeof e?e.data:e}}const d=i?await i.fn(a):null,c=!i||i.executeMainFn?await e.update({model:n,update:a,where:s}):d;for(const e of r||[]){const t=e[n]?.update?.after;t&&await t(c,o)}return c},updateManyWithHooks:async function(t,s,n,i,o){let a=t;for(const e of r||[]){const r=e[n]?.update?.before;if(r){const e=await r(t,o);if(!1===e)return null;a="object"==typeof e?e.data:e}}const d=i?await i.fn(a):null,c=!i||i.executeMainFn?await e.updateMany({model:n,update:a,where:s}):d;for(const e of r||[]){const t=e[n]?.update?.after;t&&await t(c,o)}return c}}}(e,t);return{createOAuthUser:async(e,t,r)=>{const s=await i({createdAt:new Date,updatedAt:new Date,...e},"user",void 0,r);return{user:s,account:await i({...t,userId:s.id||e.id,createdAt:new Date,updatedAt:new Date},"account",void 0,r)}},createUser:async(e,t)=>await i({createdAt:new Date,updatedAt:new Date,emailVerified:!1,...e,email:e.email?.toLowerCase()},"user",void 0,t),createAccount:async(e,t)=>await i({createdAt:new Date,updatedAt:new Date,...e},"account",void 0,t),listSessions:async r=>{if(s){const e=await s.get(`active-sessions-${r}`);if(!e)return[];const n=safeJSONParse(e)||[],i=Date.now(),o=n.filter((e=>e.expiresAt>i)),a=[];for(const e of o){const r=await s.get(e.token);if(r){const e=JSON.parse(r),s=parseSessionOutput(t.options,{...e.session,expiresAt:new Date(e.session.expiresAt)});a.push(s)}}return a}return await e.findMany({model:"session",where:[{field:"userId",value:r}]})},listUsers:async(t,r,s,n)=>await e.findMany({model:"user",limit:t,offset:r,sortBy:s,where:n}),countTotalUsers:async t=>{const r=await e.count({model:"user",where:t});return"string"==typeof r?parseInt(r):r},deleteUser:async t=>{s&&await s.delete(`active-sessions-${t}`),s&&!r.session?.storeSessionInDatabase||await e.deleteMany({model:"session",where:[{field:"userId",value:t}]}),await e.deleteMany({model:"account",where:[{field:"userId",value:t}]}),await e.delete({model:"user",where:[{field:"id",value:t}]})},createSession:async(e,o,a,d,c,u)=>{const l=o&&"headers"in o?o.headers:o,{id:p,...h}=d||{},m={ipAddress:o&&getIp(o,t.options)||"",userAgent:l?.get("user-agent")||"",...h,expiresAt:getDate(a?86400:n,"sec"),userId:e,token:generateId(32),createdAt:new Date,updatedAt:new Date,...u?h:{}};return await i(m,"session",s?{fn:async t=>{const r=await s.get(`active-sessions-${e}`);let i=[];const o=Date.now();return r&&(i=safeJSONParse(r)||[],i=i.filter((e=>e.expiresAt>o))),i.push({token:m.token,expiresAt:o+1e3*n}),await s.set(`active-sessions-${e}`,JSON.stringify(i),n),t},executeMainFn:r.session?.storeSessionInDatabase}:void 0,c)},findSession:async n=>{if(s){const e=await s.get(n);if(!e&&!r.session?.storeSessionInDatabase)return null;if(e){const r=JSON.parse(e);return{session:parseSessionOutput(t.options,{...r.session,expiresAt:new Date(r.session.expiresAt),createdAt:new Date(r.session.createdAt),updatedAt:new Date(r.session.updatedAt)}),user:parseUserOutput(t.options,{...r.user,createdAt:new Date(r.user.createdAt),updatedAt:new Date(r.user.updatedAt)})}}}const i=await e.findOne({model:"session",where:[{value:n,field:"token"}]});if(!i)return null;const o=await e.findOne({model:"user",where:[{value:i.userId,field:"id"}]});if(!o)return null;return{session:parseSessionOutput(t.options,i),user:parseUserOutput(t.options,o)}},findSessions:async t=>{if(s){const e=[];for(const r of t){const t=await s.get(r);if(t){const r=JSON.parse(t),s={session:{...r.session,expiresAt:new Date(r.session.expiresAt)},user:{...r.user,createdAt:new Date(r.user.createdAt),updatedAt:new Date(r.user.updatedAt)}};e.push(s)}}return e}const r=await e.findMany({model:"session",where:[{field:"token",value:t,operator:"in"}]}),n=r.map((e=>e.userId));if(!n.length)return[];const i=await e.findMany({model:"user",where:[{field:"id",value:n,operator:"in"}]});return r.map((e=>{const t=i.find((t=>t.id===e.userId));return t?{session:e,user:t}:null}))},updateSession:async(e,t,n)=>await o(t,[{field:"token",value:e}],"session",s?{async fn(t){const r=await s.get(e);let n=null;if(r){return n={...JSON.parse(r).session,...t},n}return null},executeMainFn:r.session?.storeSessionInDatabase}:void 0,n),deleteSession:async n=>{s&&(await s.delete(n),!r.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)||await e.delete({model:"session",where:[{field:"token",value:n}]})},deleteAccounts:async t=>{await e.deleteMany({model:"account",where:[{field:"userId",value:t}]})},deleteAccount:async t=>{await e.delete({model:"account",where:[{field:"id",value:t}]})},deleteSessions:async n=>{if(s){if("string"==typeof n){const e=await s.get(`active-sessions-${n}`),t=e?safeJSONParse(e):[];if(!t)return;for(const e of t)await s.delete(e.token)}else for(const e of n){await s.get(e)&&await s.delete(e)}if(!r.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)return}await e.deleteMany({model:"session",where:[{field:Array.isArray(n)?"token":"userId",value:n,operator:Array.isArray(n)?"in":void 0}]})},findOAuthUser:async(t,r,s)=>{const n=await e.findOne({model:"account",where:[{value:r,field:"accountId"},{value:s,field:"providerId"}]});if(n){const t=await e.findOne({model:"user",where:[{value:n.userId,field:"id"}]});return t?{user:t,accounts:[n]}:null}{const r=await e.findOne({model:"user",where:[{value:t.toLowerCase(),field:"email"}]});if(r){return{user:r,accounts:await e.findMany({model:"account",where:[{value:r.id,field:"userId"}]})||[]}}return null}},findUserByEmail:async(t,r)=>{const s=await e.findOne({model:"user",where:[{value:t.toLowerCase(),field:"email"}]});if(!s)return null;if(r?.includeAccounts){return{user:s,accounts:await e.findMany({model:"account",where:[{value:s.id,field:"userId"}]})}}return{user:s,accounts:[]}},findUserById:async t=>await e.findOne({model:"user",where:[{field:"id",value:t}]}),linkAccount:async(e,t)=>await i({...e,createdAt:new Date,updatedAt:new Date},"account",void 0,t),updateUser:async(e,t,r)=>await o(t,[{field:"id",value:e}],"user",void 0,r),updateUserByEmail:async(e,t,r)=>await o(t,[{field:"email",value:e.toLowerCase()}],"user",void 0,r),updatePassword:async(e,t,r)=>{await a({password:t},[{field:"userId",value:e},{field:"providerId",value:"credential"}],"account",void 0,r)},findAccounts:async t=>await e.findMany({model:"account",where:[{field:"userId",value:t}]}),findAccount:async t=>await e.findOne({model:"account",where:[{field:"accountId",value:t}]}),findAccountByUserId:async t=>await e.findMany({model:"account",where:[{field:"userId",value:t}]}),updateAccount:async(e,t,r)=>await o(t,[{field:"id",value:e}],"account",void 0,r),createVerificationValue:async(e,t)=>await i({createdAt:new Date,updatedAt:new Date,...e},"verification",void 0,t),findVerificationValue:async t=>{const s=await e.findMany({model:"verification",where:[{field:"identifier",value:t}],sortBy:{field:"createdAt",direction:"desc"},limit:1});r.verification?.disableCleanup||await e.deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]});return s[0]},deleteVerificationValue:async t=>{await e.delete({model:"verification",where:[{field:"id",value:t}]})},deleteVerificationByIdentifier:async t=>{await e.delete({model:"verification",where:[{field:"identifier",value:t}]})},updateVerificationValue:async(e,t,r)=>await o(t,[{field:"id",value:e}],"verification",void 0,r)}};async function getAdapter(e){if(!e.database){const r=getAuthTables(e),s=Object.keys(r).reduce(((e,t)=>(e[t]=[],e)),{});return Lr.warn("No database configuration provided. Using memory adapter in development"),(t=s,createAdapter({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:!1,customTransformInput:e=>e.options.advanced?.database?.useNumberId&&"id"===e.field&&"create"===e.action?t[e.model].length+1:e.data},adapter:({getFieldName:e,options:r})=>{function convertWhereClause(e,t){return t.filter((t=>e.every((e=>{let{field:r,value:s,operator:n}=e;if("in"===n){if(!Array.isArray(s))throw new Error("Value must be an array");return s.includes(t[r])}return"contains"===n?t[r].includes(s):"starts_with"===n?t[r].startsWith(s):"ends_with"===n?t[r].endsWith(s):t[r]===s}))))}return{create:async({model:e,data:s})=>(r.advanced?.database?.useNumberId&&(s.id=t[e].length+1),t[e].push(s),s),findOne:async({model:e,where:r})=>convertWhereClause(r,t[e])[0]||null,findMany:async({model:r,where:s,sortBy:n,limit:i,offset:o})=>{let a=t[r];return s&&(a=convertWhereClause(s,a)),n&&(a=a.sort(((t,s)=>{const i=e({model:r,field:n.field});return"asc"===n.direction?t[i]>s[i]?1:-1:t[i]<s[i]?1:-1}))),void 0!==o&&(a=a.slice(o)),void 0!==i&&(a=a.slice(0,i)),a},count:async({model:e})=>t[e].length,update:async({model:e,where:r,update:s})=>{const n=convertWhereClause(r,t[e]);return n.forEach((e=>{Object.assign(e,s)})),n[0]||null},delete:async({model:e,where:r})=>{const s=t[e],n=convertWhereClause(r,s);t[e]=s.filter((e=>!n.includes(e)))},deleteMany:async({model:e,where:r})=>{const s=t[e],n=convertWhereClause(r,s);let i=0;return t[e]=s.filter((e=>n.includes(e)?(i++,!1):!n.includes(e))),i},updateMany({model:e,where:r,update:s}){const n=convertWhereClause(r,t[e]);return n.forEach((e=>{Object.assign(e,s)})),n[0]||null}}}}))(e)}var t;if("function"==typeof e.database)return e.database(e);const{kysely:s,databaseType:n}=await createKyselyAdapter(e);if(!s)throw new r("Failed to initialize database adapter");return kyselyAdapter(s,{type:n||"sqlite"})(e)}const co={postgres:{string:["character varying","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamp","date"]},mysql:{string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"]},mssql:{string:["text","varchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime","date"]}};function matchType(e,t,r){if("string[]"===t||"number[]"===t)return e.toLowerCase().includes("json");const s=co[r];return(Array.isArray(t)?s.string.map((e=>e.toLowerCase())):s[t].map((e=>e.toLowerCase()))).includes(e.toLowerCase())}async function getMigrations(e){const t=function(e){const t=getAuthTables(e);let r={};for(const e in t){const s=t[e],n=s.fields;let i={};Object.entries(n).forEach((([e,r])=>{if(i[r.fieldName||e]=r,r.references){const s=t[r.references.model];s&&(i[r.fieldName||e].references={model:s.modelName,field:r.references.field})}})),r[s.modelName]?r[s.modelName].fields={...r[s.modelName].fields,...i}:r[s.modelName]={fields:i,order:s.order||1/0}}return r}(e),r=createLogger(e.logger);let{kysely:s,databaseType:n}=await createKyselyAdapter(e);n||(r.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),n="sqlite"),s||(r.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),p.exit(1));const i=await s.introspection.getTables(),o=[],a=[];for(const[e,s]of Object.entries(t)){const t=i.find((t=>t.name===e));if(!t){const t=o.findIndex((t=>t.table===e)),r={table:e,fields:s.fields,order:s.order||1/0},n=o.findIndex((e=>(e.order||1/0)>r.order));-1===n?-1===t?o.push(r):o[t].fields={...o[t].fields,...s.fields}:o.splice(n,0,r);continue}let d={};for(const[i,o]of Object.entries(s.fields)){const s=t.columns.find((e=>e.name===i));s?matchType(s.dataType,o.type,n)||r.warn(`Field ${i} in table ${e} has a different type in the database. Expected ${o.type} but got ${s.dataType}.`):d[i]=o}Object.keys(d).length>0&&a.push({table:e,fields:d,order:s.order||1/0})}const d=[];function getType(t,r){const s=t.type,i={string:{sqlite:"text",postgres:"text",mysql:t.unique?"varchar(255)":t.references?"varchar(36)":"text",mssql:t.unique||t.sortable?"varchar(255)":t.references?"varchar(36)":"text"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:t.bigint?"bigint":"integer",postgres:t.bigint?"bigint":"integer",mysql:t.bigint?"bigint":"integer",mssql:t.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamp",mysql:"datetime",mssql:"datetime"},id:{postgres:e.advanced?.database?.useNumberId?"serial":"text",mysql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:e.advanced?.database?.useNumberId?"integer":"text"}};return"id"===r||"id"===t.references?.field?i.id[n]:"sqlite"!==n||"string[]"!==s&&"number[]"!==s?"string[]"===s||"number[]"===s?"jsonb":Array.isArray(s)?"text":i[s][n||"sqlite"]:"text"}if(a.length)for(const e of a)for(const[t,r]of Object.entries(e.fields)){const n=getType(r,t),i=s.schema.alterTable(e.table).addColumn(t,n,(e=>(e=!1!==r.required?e.notNull():e,r.references&&(e=e.references(`${r.references.model}.${r.references.field}`)),r.unique&&(e=e.unique()),e)));d.push(i)}if(o.length)for(const t of o){let r=s.schema.createTable(t.table).addColumn("id",e.advanced?.database?.useNumberId?"postgres"===n?"serial":"integer":"mysql"===n||"mssql"===n?"varchar(36)":"text",(t=>e.advanced?.database?.useNumberId?"postgres"===n?t.primaryKey().notNull():t.autoIncrement().primaryKey().notNull():t.primaryKey().notNull()));for(const[e,s]of Object.entries(t.fields)){const t=getType(s,e);r=r.addColumn(e,t,(e=>(e=!1!==s.required?e.notNull():e,s.references&&(e=e.references(`${s.references.model}.${s.references.field}`)),s.unique&&(e=e.unique()),e)))}d.push(r)}return{toBeCreated:o,toBeAdded:a,runMigrations:async function(){for(const e of d)await e.execute()},compileMigrations:async function(){return d.map((e=>e.compile().sql)).join(";\n\n")+";"}}}async function checkPassword(e,t){const r=await t.context.internalAdapter.findAccounts(e),s=r?.find((e=>"credential"===e.providerId)),n=s?.password;if(!s||!n||!t.body.password)throw new O("BAD_REQUEST",{message:"No password credential found"});if(!await t.context.password.verify({hash:n,password:t.body.password}))throw new O("BAD_REQUEST",{message:"Invalid password"});return!0}const uo="better-auth-secret-123456789",init=async e=>{const s=await getAdapter(e),n=e.plugins||[],i=function(e){const t=[];e.advanced;return t}(e),o=createLogger(e.logger),a=h(e.baseURL,e.basePath),d=e.secret||m.BETTER_AUTH_SECRET||m.AUTH_SECRET||uo;d===uo&&t&&o.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.");const c=function(e){const t=createCookieGetter(e),r=t("session_token",{maxAge:e.session?.expiresIn||createTime(7,"d").toSeconds()}),s=t("session_data",{maxAge:e.session?.cookieCache?.maxAge||300}),n=t("dont_remember");return{sessionToken:{name:r.name,options:r.attributes},sessionData:{name:s.name,options:s.attributes},dontRememberToken:{name:n.name,options:n.attributes}}}(e={...e,secret:d,baseURL:a?new URL(a).origin:"",basePath:e.basePath||"/api/auth",plugins:n.concat(i)}),l=getAuthTables(e),p=Object.keys(e.socialProviders||{}).map((t=>{const r=e.socialProviders?.[t];if(!r||!1===r.enabled)return null;r.clientId||o.warn(`Social provider ${t} is missing clientId or clientSecret`);const s=qr[t](r);return s.disableImplicitSignUp=r.disableImplicitSignUp,s})).filter((e=>null!==e)),f={appName:e.appName||"Better Auth",socialProviders:p,options:e,tables:l,trustedOrigins:getTrustedOrigins(e),baseURL:a||"",sessionConfig:{updateAge:void 0!==e.session?.updateAge?e.session.updateAge:86400,expiresIn:e.session?.expiresIn||604800,freshAge:void 0===e.session?.freshAge?86400:e.session.freshAge},secret:d,rateLimit:{...e.rateLimit,enabled:e.rateLimit?.enabled??t,window:e.rateLimit?.window||10,max:e.rateLimit?.max||100,storage:e.rateLimit?.storage||(e.secondaryStorage?"secondary-storage":"memory")},authCookies:c,logger:o,generateId:({model:t,size:r})=>"function"==typeof e.advanced?.generateId?e.advanced.generateId({model:t,size:r}):"function"==typeof e?.advanced?.database?.generateId?e.advanced.database.generateId({model:t,size:r}):generateId(r),session:null,secondaryStorage:e.secondaryStorage,password:{hash:e.emailAndPassword?.password?.hash||hashPassword,verify:e.emailAndPassword?.password?.verify||verifyPassword,config:{minPasswordLength:e.emailAndPassword?.minPasswordLength||8,maxPasswordLength:e.emailAndPassword?.maxPasswordLength||128},checkPassword:checkPassword},setNewSession(e){this.newSession=e},newSession:null,adapter:s,internalAdapter:createInternalAdapter(s,{options:e,hooks:e.databaseHooks?[e.databaseHooks]:[]}),createAuthCookie:createCookieGetter(e),async runMigrations(){if(!e.database||"updateMany"in e.database)throw new r("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");const{runMigrations:t}=await getMigrations(e);await t()}};let{context:y}=function(e){let t=e.options;const r=t.plugins||[];let s=e;const n=[];for(const i of r)if(i.init){const r=i.init(e);if("object"==typeof r){if(r.options){const{databaseHooks:e,...s}=r.options;e&&n.push(e),t=u(t,s)}r.context&&(s={...s,...r.context})}}return n.push(t.databaseHooks),s.internalAdapter=createInternalAdapter(e.adapter,{options:t,hooks:n.filter((e=>void 0!==e)),generateId:e.generateId}),s.options=t,{context:s}}(f);return y};function getTrustedOrigins(e){const t=h(e.baseURL,e.basePath);if(!t)return[];const r=[new URL(t).origin];e.trustedOrigins&&Array.isArray(e.trustedOrigins)&&r.push(...e.trustedOrigins);const s=m.BETTER_AUTH_TRUSTED_ORIGINS;return s&&r.push(...s.split(",")),r}const betterAuth=e=>{const t=init(e),{api:s}=getEndpoints(t,e),n=e.plugins?.reduce(((e,t)=>t.$ERROR_CODES?{...e,...t.$ERROR_CODES}:e),{});return{handler:async s=>{const n=await t,i=n.options.basePath||"/api/auth";if(!n.options.baseURL){const e=h(void 0,i,s);if(!e)throw new r("Could not get base URL from request. Please provide a valid base URL.");n.baseURL=e,n.options.baseURL=d(n.baseURL)||void 0}n.trustedOrigins=[...e.trustedOrigins?Array.isArray(e.trustedOrigins)?e.trustedOrigins:await e.trustedOrigins(s):[],n.options.baseURL];const{handler:o}=((e,t)=>{const{api:r,middlewares:s}=getEndpoints(e,t),n=new URL(e.baseURL).pathname;return createRouter(r,{routerContext:e,openapi:{disabled:!0},basePath:n,routerMiddleware:[{path:"/**",middleware:Fr},...s],async onRequest(t){const r=e.options.disabledPaths||[],s=new URL(t.url).pathname.replace(n,"");if(r.includes(s))return new Response("Not Found",{status:404});for(const r of e.options.plugins||[])if(r.onRequest){const s=await r.onRequest(t,e);if(s&&"response"in s)return s.response}return onRequestRateLimit(t,e)},async onResponse(t){for(const r of e.options.plugins||[])if(r.onResponse){const s=await r.onResponse(t,e);if(s)return s.response}return t},onError(r){if(r instanceof O&&"FOUND"===r.status)return;if(t.onAPIError?.throw)throw r;if(t.onAPIError?.onError)return void t.onAPIError.onError(r,e);const s=t.logger?.level,n="error"===s||"warn"===s||"debug"===s?Lr:void 0;if(!0!==t.logger?.disabled){if(r&&"object"==typeof r&&"message"in r&&"string"==typeof r.message&&(r.message.includes("no column")||r.message.includes("column")||r.message.includes("relation")||r.message.includes("table")||r.message.includes("does not exist")))return void e.logger?.error(r.message);r instanceof O?("INTERNAL_SERVER_ERROR"===r.status&&e.logger.error(r.status,r),n?.error(r.message)):e.logger?.error(r&&"object"==typeof r&&"name"in r?r.name:"",r)}}})})(n,e);return o(s)},api:s,options:e,$context:t,$Infer:{},$ERROR_CODES:{...n,...Jr}}},drizzleAdapter=(e,t)=>createAdapter({config:{adapterId:"drizzle",adapterName:"Drizzle Adapter",usePlural:t.usePlural??!1,debugLogs:t.debugLogs??!1},adapter:({getFieldName:s,debugLog:n})=>{function getSchema(s){const n=t.schema||e._.fullSchema;if(!n)throw new r("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");const i=n[s];if(!i)throw new r(`[# Drizzle Adapter]: The model "${s}" was not found in the schema object. Please pass the schema directly to the adapter options.`);return i}const withReturning=async(s,n,i,o)=>{if("mysql"!==t.provider){return(await n.returning())[0]}await n.execute();const a=getSchema(s),d=n.config?.values;if(o?.length){const t=convertWhereClause(o,s);return(await e.select().from(a).where(...t))[0]}if(d&&d[0]?.id?.value){let t=d[0]?.id?.value;if(!t){t=(await e.select({id:w`LAST_INSERT_ID()`}).from(a).orderBy(y(a.id)).limit(1))[0].id}return(await e.select().from(a).where(v(a.id,t)).limit(1).execute())[0]}if(i.id){return(await e.select().from(a).where(v(a.id,i.id)).limit(1).execute())[0]}if(!("id"in a))throw new r(`The model "${s}" does not have an "id" field. Please use the "id" field as your primary key.`);return(await e.select().from(a).orderBy(y(a.id)).limit(1).execute())[0]};function convertWhereClause(e,t){const n=getSchema(t);if(!e)return[];if(1===e.length){const i=e[0];if(!i)return[];const o=s({model:t,field:i.field});if(!n[o])throw new r(`The field "${i.field}" does not exist in the schema for the model "${t}". Please update your schema.`);if("in"===i.operator){if(!Array.isArray(i.value))throw new r(`The value for the field "${i.field}" must be an array when using the "in" operator.`);return[b(n[o],i.value)]}return"contains"===i.operator?[N(n[o],`%${i.value}%`)]:"starts_with"===i.operator?[N(n[o],`${i.value}%`)]:"ends_with"===i.operator?[N(n[o],`%${i.value}`)]:"lt"===i.operator?[_(n[o],i.value)]:"lte"===i.operator?[x(n[o],i.value)]:[v(n[o],i.value)]}const i=e.filter((e=>"AND"===e.connector||!e.connector)),o=e.filter((e=>"OR"===e.connector)),a=T(...i.map((e=>{const i=s({model:t,field:e.field});if("in"===e.operator){if(!Array.isArray(e.value))throw new r(`The value for the field "${e.field}" must be an array when using the "in" operator.`);return b(n[i],e.value)}return v(n[i],e.value)}))),d=k(...o.map((e=>{const r=s({model:t,field:e.field});return v(n[r],e.value)}))),c=[];return i.length&&c.push(a),o.length&&c.push(d),c}return{async create({model:t,data:s}){const n=getSchema(t);!function(e,t,s){if(!e)throw new r("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");for(const n in s)if(!e[n])throw new r(`The field "${n}" does not exist in the "${t}" schema. Please update your drizzle schema or re-generate using "npx @better-auth/cli generate".`)}(n,t,s);const i=e.insert(n).values(s);return await withReturning(t,i,s)},async findOne({model:t,where:r}){const s=getSchema(t),n=convertWhereClause(r,t),i=await e.select().from(s).where(...n);return i.length?i[0]:null},async findMany({model:t,where:r,sortBy:n,limit:i,offset:o}){const a=getSchema(t),d=r?convertWhereClause(r,t):[],c="desc"===n?.direction?y:g,u=e.select().from(a).limit(i||100).offset(o||0);return n?.field&&u.orderBy(c(a[s({model:t,field:n?.field})])),await u.where(...d)},async count({model:t,where:r}){const s=getSchema(t),n=r?convertWhereClause(r,t):[];return(await e.select({count:f()}).from(s).where(...n))[0].count},async update({model:t,where:r,update:s}){const n=getSchema(t),i=convertWhereClause(r,t),o=e.update(n).set(s).where(...i);return await withReturning(t,o,s,r)},async updateMany({model:t,where:r,update:s}){const n=getSchema(t),i=convertWhereClause(r,t),o=e.update(n).set(s).where(...i);return await o},async delete({model:t,where:r}){const s=getSchema(t),n=convertWhereClause(r,t),i=e.delete(s).where(...n);return await i},async deleteMany({model:t,where:r}){const s=getSchema(t),n=convertWhereClause(r,t),i=e.delete(s).where(...n);return await i},options:t}}}),lo={FAILED_TO_CREATE_USER:"Failed to create user",USER_ALREADY_EXISTS:"User already exists",YOU_CANNOT_BAN_YOURSELF:"You cannot ban yourself",YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE:"You are not allowed to change users role",YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS:"You are not allowed to create users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS:"You are not allowed to list users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS:"You are not allowed to list users sessions",YOU_ARE_NOT_ALLOWED_TO_BAN_USERS:"You are not allowed to ban users",YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS:"You are not allowed to impersonate users",YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS:"You are not allowed to revoke users sessions",YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS:"You are not allowed to delete users",YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD:"You are not allowed to set users password",BANNED_USER:"You have been banned from this application"};function parseRoles(e){return Array.isArray(e)?e.join(","):e}const admin=e=>{const t={defaultRole:e?.defaultRole??"user",adminRoles:e?.adminRoles??["admin"],bannedUserMessage:e?.bannedUserMessage??"You have been banned from this application. Please contact support if you believe this is an error.",...e},r=Zr((async e=>{const t=await getSessionFromCtx(e);if(!t)throw new O("UNAUTHORIZED");return{session:t}}));return{id:"admin",init:r=>({options:{databaseHooks:{user:{create:{before:async t=>({data:{role:e?.defaultRole??"user",...t}})}},session:{create:{async before(e){const s=await r.internalAdapter.findUserById(e.userId);if(s.banned){if(s.banExpires&&s.banExpires.getTime()<Date.now())return void await r.internalAdapter.updateUser(e.userId,{banned:!1,banReason:null,banExpires:null});throw new O("FORBIDDEN",{message:t.bannedUserMessage,code:"BANNED_USER"})}}}}}}}),hooks:{after:[{matcher:e=>"/list-sessions"===e.path,handler:Zr((async e=>{const t=await(async e=>{const t=e.context.returned;return t?t instanceof Response?200!==t.status?null:await t.clone().json():t instanceof O?null:t:null})(e);if(!t)return;const r=t.filter((e=>!e.impersonatedBy));return e.json(r)}))}]},endpoints:{setRole:Vr("/admin/set-role",{method:"POST",body:nr.object({userId:nr.coerce.string({description:"The user id"}),role:nr.union([nr.string({description:"The role to set. `admin` or `user` by default"}),nr.array(nr.string({description:"The roles to set. `admin` or `user` by default"}))])}),use:[r],metadata:{openapi:{operationId:"setRole",summary:"Set the role of a user",description:"Set the role of a user",responses:{200:{description:"User role updated",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},(async e=>{if(!A({userId:e.context.session.user.id,role:e.context.session.user.role,options:t,permissions:{user:["set-role"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE});const r=await e.context.internalAdapter.updateUser(e.body.userId,{role:parseRoles(e.body.role)},e);return e.json({user:r})})),createUser:Vr("/admin/create-user",{method:"POST",body:nr.object({email:nr.string({description:"The email of the user"}),password:nr.string({description:"The password of the user"}),name:nr.string({description:"The name of the user"}),role:nr.union([nr.string({description:"The role of the user"}),nr.array(nr.string({description:"The roles of user"}))]).optional(),data:nr.optional(nr.record(nr.any(),{description:"Extra fields for the user. Including custom additional fields."}))}),metadata:{openapi:{operationId:"createUser",summary:"Create a new user",description:"Create a new user",responses:{200:{description:"User created",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},(async r=>{const s=await getSessionFromCtx(r);if(!s&&(r.request||r.headers))throw r.error("UNAUTHORIZED");if(s){if(!A({userId:s.user.id,role:s.user.role,options:t,permissions:{user:["create"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS})}if(await r.context.internalAdapter.findUserByEmail(r.body.email))throw new O("BAD_REQUEST",{message:lo.USER_ALREADY_EXISTS});const n=await r.context.internalAdapter.createUser({email:r.body.email,name:r.body.name,role:(r.body.role&&parseRoles(r.body.role))??e?.defaultRole??"user",...r.body.data});if(!n)throw new O("INTERNAL_SERVER_ERROR",{message:lo.FAILED_TO_CREATE_USER});const i=await r.context.password.hash(r.body.password);return await r.context.internalAdapter.linkAccount({accountId:n.id,providerId:"credential",password:i,userId:n.id},r),r.json({user:n})})),listUsers:Vr("/admin/list-users",{method:"GET",use:[r],query:nr.object({searchValue:nr.string({description:"The value to search for"}).optional(),searchField:nr.enum(["email","name"],{description:"The field to search in, defaults to email. Can be `email` or `name`"}).optional(),searchOperator:nr.enum(["contains","starts_with","ends_with"],{description:"The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`"}).optional(),limit:nr.string({description:"The number of users to return"}).or(nr.number()).optional(),offset:nr.string({description:"The offset to start from"}).or(nr.number()).optional(),sortBy:nr.string({description:"The field to sort by"}).optional(),sortDirection:nr.enum(["asc","desc"],{description:"The direction to sort by"}).optional(),filterField:nr.string({description:"The field to filter by"}).optional(),filterValue:nr.string({description:"The value to filter by"}).or(nr.number()).or(nr.boolean()).optional(),filterOperator:nr.enum(["eq","ne","lt","lte","gt","gte"],{description:"The operator to use for the filter"}).optional()}),metadata:{openapi:{operationId:"listUsers",summary:"List users",description:"List users",responses:{200:{description:"List of users",content:{"application/json":{schema:{type:"object",properties:{users:{type:"array",items:{$ref:"#/components/schemas/User"}},total:{type:"number"},limit:{type:"number"},offset:{type:"number"}},required:["users","total"]}}}}}}}},(async e=>{const r=e.context.session;if(!A({userId:e.context.session.user.id,role:r.user.role,options:t,permissions:{user:["list"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS});const s=[];e.query?.searchValue&&s.push({field:e.query.searchField||"email",operator:e.query.searchOperator||"contains",value:e.query.searchValue}),e.query?.filterValue&&s.push({field:e.query.filterField||"email",operator:e.query.filterOperator||"eq",value:e.query.filterValue});try{const t=await e.context.internalAdapter.listUsers(Number(e.query?.limit)||void 0,Number(e.query?.offset)||void 0,e.query?.sortBy?{field:e.query.sortBy,direction:e.query.sortDirection||"asc"}:void 0,s.length?s:void 0),r=await e.context.internalAdapter.countTotalUsers(s.length?s:void 0);return e.json({users:t,total:r,limit:Number(e.query?.limit)||void 0,offset:Number(e.query?.offset)||void 0})}catch(t){return e.json({users:[],total:0})}})),listUserSessions:Vr("/admin/list-user-sessions",{method:"POST",use:[r],body:nr.object({userId:nr.coerce.string({description:"The user id"})}),metadata:{openapi:{operationId:"listUserSessions",summary:"List user sessions",description:"List user sessions",responses:{200:{description:"List of user sessions",content:{"application/json":{schema:{type:"object",properties:{sessions:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}}}},(async e=>{const r=e.context.session;if(!A({userId:e.context.session.user.id,role:r.user.role,options:t,permissions:{session:["list"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS});return{sessions:await e.context.internalAdapter.listSessions(e.body.userId)}})),unbanUser:Vr("/admin/unban-user",{method:"POST",body:nr.object({userId:nr.coerce.string({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"unbanUser",summary:"Unban a user",description:"Unban a user",responses:{200:{description:"User unbanned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},(async e=>{const r=e.context.session;if(!A({userId:e.context.session.user.id,role:r.user.role,options:t,permissions:{user:["ban"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});const s=await e.context.internalAdapter.updateUser(e.body.userId,{banned:!1,banExpires:null,banReason:null});return e.json({user:s})})),banUser:Vr("/admin/ban-user",{method:"POST",body:nr.object({userId:nr.coerce.string({description:"The user id"}),banReason:nr.string({description:"The reason for the ban"}).optional(),banExpiresIn:nr.number({description:"The number of seconds until the ban expires"}).optional()}),use:[r],metadata:{openapi:{operationId:"banUser",summary:"Ban a user",description:"Ban a user",responses:{200:{description:"User banned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},(async r=>{const s=r.context.session;if(!A({userId:r.context.session.user.id,role:s.user.role,options:t,permissions:{user:["ban"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});if(r.body.userId===r.context.session.user.id)throw new O("BAD_REQUEST",{message:lo.YOU_CANNOT_BAN_YOURSELF});const n=await r.context.internalAdapter.updateUser(r.body.userId,{banned:!0,banReason:r.body.banReason||e?.defaultBanReason||"No reason",banExpires:r.body.banExpiresIn?getDate(r.body.banExpiresIn,"sec"):e?.defaultBanExpiresIn?getDate(e.defaultBanExpiresIn,"sec"):void 0},r);return await r.context.internalAdapter.deleteSessions(r.body.userId),r.json({user:n})})),impersonateUser:Vr("/admin/impersonate-user",{method:"POST",body:nr.object({userId:nr.coerce.string({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"impersonateUser",summary:"Impersonate a user",description:"Impersonate a user",responses:{200:{description:"Impersonation session created",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},(async r=>{if(!A({userId:r.context.session.user.id,role:r.context.session.user.role,options:t,permissions:{user:["impersonate"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS});const s=await r.context.internalAdapter.findUserById(r.body.userId);if(!s)throw new O("NOT_FOUND",{message:"User not found"});const n=await r.context.internalAdapter.createSession(s.id,void 0,!0,{impersonatedBy:r.context.session.user.id,expiresAt:getDate(e?.impersonationSessionDuration?e.impersonationSessionDuration:3600,"sec")},r,!0);if(!n)throw new O("INTERNAL_SERVER_ERROR",{message:lo.FAILED_TO_CREATE_USER});const i=r.context.authCookies;deleteSessionCookie(r);const o=await r.getSignedCookie(r.context.authCookies.dontRememberToken.name,r.context.secret);return await r.setSignedCookie("admin_session",`${r.context.session.session.token}:${o||""}`,r.context.secret,i.sessionToken.options),await setSessionCookie(r,{session:n,user:s},!0),r.json({session:n,user:s})})),stopImpersonating:Vr("/admin/stop-impersonating",{method:"POST"},(async e=>{const t=await getSessionFromCtx(e);if(!t)throw new O("UNAUTHORIZED");if(!t.session.impersonatedBy)throw new O("BAD_REQUEST",{message:"You are not impersonating anyone"});const r=await e.context.internalAdapter.findUserById(t.session.impersonatedBy);if(!r)throw new O("INTERNAL_SERVER_ERROR",{message:"Failed to find user"});const s=await e.getSignedCookie("admin_session",e.context.secret);if(!s)throw new O("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});const[n,i]=s?.split(":"),o=await e.context.internalAdapter.findSession(n);if(!o||o.session.userId!==r.id)throw new O("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});return await e.context.internalAdapter.deleteSession(t.session.token),await setSessionCookie(e,o,!!i),e.json(o)})),revokeUserSession:Vr("/admin/revoke-user-session",{method:"POST",body:nr.object({sessionToken:nr.string({description:"The session token"})}),use:[r],metadata:{openapi:{operationId:"revokeUserSession",summary:"Revoke a user session",description:"Revoke a user session",responses:{200:{description:"Session revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},(async e=>{const r=e.context.session;if(!A({userId:e.context.session.user.id,role:r.user.role,options:t,permissions:{session:["revoke"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await e.context.internalAdapter.deleteSession(e.body.sessionToken),e.json({success:!0})})),revokeUserSessions:Vr("/admin/revoke-user-sessions",{method:"POST",body:nr.object({userId:nr.coerce.string({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"revokeUserSessions",summary:"Revoke all user sessions",description:"Revoke all user sessions",responses:{200:{description:"Sessions revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},(async e=>{const r=e.context.session;if(!A({userId:e.context.session.user.id,role:r.user.role,options:t,permissions:{session:["revoke"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await e.context.internalAdapter.deleteSessions(e.body.userId),e.json({success:!0})})),removeUser:Vr("/admin/remove-user",{method:"POST",body:nr.object({userId:nr.coerce.string({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"removeUser",summary:"Remove a user",description:"Delete a user and all their sessions and accounts. Cannot be undone.",responses:{200:{description:"User removed",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},(async e=>{const r=e.context.session;if(!A({userId:e.context.session.user.id,role:r.user.role,options:t,permissions:{user:["delete"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS});return await e.context.internalAdapter.deleteUser(e.body.userId),e.json({success:!0})})),setUserPassword:Vr("/admin/set-user-password",{method:"POST",body:nr.object({newPassword:nr.string({description:"The new password"}),userId:nr.coerce.string({description:"The user id"})}),use:[r],metadata:{openapi:{operationId:"setUserPassword",summary:"Set a user's password",description:"Set a user's password",responses:{200:{description:"Password set",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},(async e=>{if(!A({userId:e.context.session.user.id,role:e.context.session.user.role,options:t,permissions:{user:["set-password"]}}))throw new O("FORBIDDEN",{message:lo.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD});const r=await e.context.password.hash(e.body.newPassword);return await e.context.internalAdapter.updatePassword(e.body.userId,r),e.json({status:!0})})),userHasPermission:Vr("/admin/has-permission",{method:"POST",body:nr.object({userId:nr.coerce.string().optional(),role:nr.string().optional()}).and(nr.union([nr.object({permission:nr.record(nr.string(),nr.array(nr.string())),permissions:nr.undefined()}),nr.object({permission:nr.undefined(),permissions:nr.record(nr.string(),nr.array(nr.string()))})])),metadata:{openapi:{description:"Check if the user has permission",requestBody:{content:{"application/json":{schema:{type:"object",properties:{permission:{type:"object",description:"The permission to check",deprecated:!0},permissions:{type:"object",description:"The permission to check"}},required:["permissions"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{error:{type:"string"},success:{type:"boolean"}},required:["success"]}}}}}},$Infer:{body:{}}}},(async t=>{if(!t.body?.permission&&!t.body?.permissions)throw new O("BAD_REQUEST",{message:"invalid permission check. no permission(s) were passed."});const r=await getSessionFromCtx(t);if(!r&&(t.request||t.headers)&&!t.body.userId&&!t.body.role)throw new O("UNAUTHORIZED");const s=r?.user||await t.context.internalAdapter.findUserById(t.body.userId)||(t.body.role?{id:"",role:t.body.role}:null);if(!s)throw new O("BAD_REQUEST",{message:"user not found"});const n=A({userId:s.id,role:s.role,options:e,permissions:t.body.permissions??t.body.permission});return t.json({error:null,success:n})}))},$ERROR_CODES:lo,schema:mergeSchema(po,t.schema)}},po={user:{fields:{role:{type:"string",required:!1,input:!1},banned:{type:"boolean",defaultValue:!1,required:!1,input:!1},banReason:{type:"string",required:!1,input:!1},banExpires:{type:"date",required:!1,input:!1}}},session:{fields:{impersonatedBy:{type:"string",required:!1}}}},reactStartCookies=()=>({id:"react-start-cookies",hooks:{after:[{matcher:e=>!0,handler:Zr((async e=>{const t=e.context.responseHeaders;if(!("_flag"in e)||"router"!==e._flag)if(t instanceof Headers){const e=t?.get("set-cookie");if(!e)return;const r=function(e){const t=new Map;return e.split(", ").forEach((e=>{const r=e.split(";").map((e=>e.trim())),[s,...n]=r,[i,...o]=s.split("="),a=o.join("=");if(!i||void 0===a)return;const d={value:a};n.forEach((e=>{const[t,...r]=e.split("="),s=r.join("="),n=t.trim().toLowerCase();switch(n){case"max-age":d["max-age"]=s?parseInt(s.trim(),10):void 0;break;case"expires":d.expires=s?new Date(s.trim()):void 0;break;case"domain":d.domain=s?s.trim():void 0;break;case"path":d.path=s?s.trim():void 0;break;case"secure":d.secure=!0;break;case"httponly":d.httponly=!0;break;case"samesite":d.samesite=s?s.trim().toLowerCase():void 0;break;default:d[n]=!s||s.trim()}})),t.set(i,d)})),t}(e),{setCookie:s}=await import("./server.mjs").then((function(e){return e.s}));r.forEach(((e,t)=>{if(!t)return;const r={sameSite:e.samesite,secure:e.secure,maxAge:e["max-age"],httpOnly:e.httponly,domain:e.domain,path:e.path};try{s(t,decodeURIComponent(e.value),r)}catch(e){}}))}else;}))}]}});var ho=Object.defineProperty,mo=Object.defineProperties,fo=Object.getOwnPropertyDescriptors,yo=Object.getOwnPropertySymbols,go=Object.prototype.hasOwnProperty,wo=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?ho(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))go.call(t,r)&&__defNormalProp(e,r,t[r]);if(yo)for(var r of yo(t))wo.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__async=(e,t,r)=>new Promise(((s,n)=>{var fulfilled=e=>{try{step(r.next(e))}catch(e){n(e)}},rejected=e=>{try{step(r.throw(e))}catch(e){n(e)}},step=e=>e.done?s(e.value):Promise.resolve(e.value).then(fulfilled,rejected);step((r=r.apply(e,t)).next())})),vo=class{constructor(e){this.resend=e}create(e){return __async(this,arguments,(function*(e,t={}){return yield this.resend.post("/api-keys",e,t)}))}list(){return __async(this,null,(function*(){return yield this.resend.get("/api-keys")}))}remove(e){return __async(this,null,(function*(){return yield this.resend.delete(`/api-keys/${e}`)}))}},bo=class{constructor(e){this.resend=e}create(e){return __async(this,arguments,(function*(e,t={}){return yield this.resend.post("/audiences",e,t)}))}list(){return __async(this,null,(function*(){return yield this.resend.get("/audiences")}))}get(e){return __async(this,null,(function*(){return yield this.resend.get(`/audiences/${e}`)}))}remove(e){return __async(this,null,(function*(){return yield this.resend.delete(`/audiences/${e}`)}))}};function parseEmailToApiOptions(e){return{attachments:e.attachments,bcc:e.bcc,cc:e.cc,from:e.from,headers:e.headers,html:e.html,reply_to:e.replyTo,scheduled_at:e.scheduledAt,subject:e.subject,tags:e.tags,text:e.text,to:e.to}}var No=class{constructor(e){this.resend=e}send(e){return __async(this,arguments,(function*(e,t={}){return this.create(e,t)}))}create(e){return __async(this,arguments,(function*(e,t={}){const r=[];for(const t of e){if(t.react){if(!this.renderAsync)try{const{renderAsync:e}=yield import("./index3.mjs");this.renderAsync=e}catch(e){throw new Error("Failed to render React component. Make sure to install `@react-email/render`")}t.html=yield this.renderAsync(t.react),t.react=void 0}r.push(parseEmailToApiOptions(t))}return yield this.resend.post("/emails/batch",r,t)}))}},_o=class{constructor(e){this.resend=e}create(e){return __async(this,arguments,(function*(e,t={}){if(e.react){if(!this.renderAsync)try{const{renderAsync:e}=yield import("./index3.mjs");this.renderAsync=e}catch(e){throw new Error("Failed to render React component. Make sure to install `@react-email/render`")}e.html=yield this.renderAsync(e.react)}return yield this.resend.post("/broadcasts",{name:e.name,audience_id:e.audienceId,preview_text:e.previewText,from:e.from,html:e.html,reply_to:e.replyTo,subject:e.subject,text:e.text},t)}))}send(e,t){return __async(this,null,(function*(){return yield this.resend.post(`/broadcasts/${e}/send`,{scheduled_at:null==t?void 0:t.scheduledAt})}))}list(){return __async(this,null,(function*(){return yield this.resend.get("/broadcasts")}))}get(e){return __async(this,null,(function*(){return yield this.resend.get(`/broadcasts/${e}`)}))}remove(e){return __async(this,null,(function*(){return yield this.resend.delete(`/broadcasts/${e}`)}))}update(e,t){return __async(this,null,(function*(){return yield this.resend.patch(`/broadcasts/${e}`,{name:t.name,audience_id:t.audienceId,from:t.from,html:t.html,text:t.text,subject:t.subject,reply_to:t.replyTo,preview_text:t.previewText})}))}},xo=class{constructor(e){this.resend=e}create(e){return __async(this,arguments,(function*(e,t={}){return yield this.resend.post(`/audiences/${e.audienceId}/contacts`,{unsubscribed:e.unsubscribed,email:e.email,first_name:e.firstName,last_name:e.lastName},t)}))}list(e){return __async(this,null,(function*(){return yield this.resend.get(`/audiences/${e.audienceId}/contacts`)}))}get(e){return __async(this,null,(function*(){if(!e.id&&!e.email)return{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}};return yield this.resend.get(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`)}))}update(e){return __async(this,null,(function*(){if(!e.id&&!e.email)return{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}};return yield this.resend.patch(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`,{unsubscribed:e.unsubscribed,first_name:e.firstName,last_name:e.lastName})}))}remove(e){return __async(this,null,(function*(){if(!e.id&&!e.email)return{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}};return yield this.resend.delete(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`)}))}};var To=class{constructor(e){this.resend=e}create(e){return __async(this,arguments,(function*(e,t={}){var r;return yield this.resend.post("/domains",(r=e,{name:r.name,region:r.region,custom_return_path:r.customReturnPath}),t)}))}list(){return __async(this,null,(function*(){return yield this.resend.get("/domains")}))}get(e){return __async(this,null,(function*(){return yield this.resend.get(`/domains/${e}`)}))}update(e){return __async(this,null,(function*(){return yield this.resend.patch(`/domains/${e.id}`,{click_tracking:e.clickTracking,open_tracking:e.openTracking,tls:e.tls})}))}remove(e){return __async(this,null,(function*(){return yield this.resend.delete(`/domains/${e}`)}))}verify(e){return __async(this,null,(function*(){return yield this.resend.post(`/domains/${e}/verify`)}))}},ko=class{constructor(e){this.resend=e}send(e){return __async(this,arguments,(function*(e,t={}){return this.create(e,t)}))}create(e){return __async(this,arguments,(function*(e,t={}){if(e.react){if(!this.renderAsync)try{const{renderAsync:e}=yield import("./index3.mjs");this.renderAsync=e}catch(e){throw new Error("Failed to render React component. Make sure to install `@react-email/render`")}e.html=yield this.renderAsync(e.react)}return yield this.resend.post("/emails",parseEmailToApiOptions(e),t)}))}get(e){return __async(this,null,(function*(){return yield this.resend.get(`/emails/${e}`)}))}update(e){return __async(this,null,(function*(){return yield this.resend.patch(`/emails/${e.id}`,{scheduled_at:e.scheduledAt})}))}cancel(e){return __async(this,null,(function*(){return yield this.resend.post(`/emails/${e}/cancel`)}))}},Ao="https://api.resend.com",Eo="resend-node:4.4.0",Io=void 0!==p&&p.env&&p.env.RESEND_BASE_URL||Ao,So=void 0!==p&&p.env&&p.env.RESEND_USER_AGENT||Eo,Oo=class{constructor(e){if(this.key=e,this.apiKeys=new vo(this),this.audiences=new bo(this),this.batch=new No(this),this.broadcasts=new _o(this),this.contacts=new xo(this),this.domains=new To(this),this.emails=new ko(this),!e&&(void 0!==p&&p.env&&(this.key=p.env.RESEND_API_KEY),!this.key))throw new Error('Missing API key. Pass it to the constructor `new Resend("re_123")`');this.headers=new Headers({Authorization:`Bearer ${this.key}`,"User-Agent":So,"Content-Type":"application/json"})}fetchRequest(e){return __async(this,arguments,(function*(e,t={}){try{const n=yield fetch(`${Io}${e}`,t);if(!n.ok)try{const e=yield n.text();return{data:null,error:JSON.parse(e)}}catch(e){if(e instanceof SyntaxError)return{data:null,error:{name:"application_error",message:"Internal server error. We are unable to process your request right now, please try again later."}};const t={message:n.statusText,name:"application_error"};return e instanceof Error?{data:null,error:(r=__spreadValues({},t),s={message:e.message},mo(r,fo(s)))}:{data:null,error:t}}return{data:yield n.json(),error:null}}catch(e){return{data:null,error:{name:"application_error",message:"Unable to fetch data. The request could not be resolved."}}}var r,s}))}post(e,t){return __async(this,arguments,(function*(e,t,r={}){r.idempotencyKey&&this.headers.set("Idempotency-Key",r.idempotencyKey);const s=__spreadValues({method:"POST",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,s)}))}get(e){return __async(this,arguments,(function*(e,t={}){const r=__spreadValues({method:"GET",headers:this.headers},t);return this.fetchRequest(e,r)}))}put(e,t){return __async(this,arguments,(function*(e,t,r={}){const s=__spreadValues({method:"PUT",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,s)}))}patch(e,t){return __async(this,arguments,(function*(e,t,r={}){const s=__spreadValues({method:"PATCH",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,s)}))}delete(e,t){return __async(this,null,(function*(){const r={method:"DELETE",headers:this.headers,body:JSON.stringify(t)};return this.fetchRequest(e,r)}))}};export{O as A,Oo as R,admin as a,betterAuth as b,drizzleAdapter as d,reactStartCookies as r};
//# sourceMappingURL=index.mjs.map
