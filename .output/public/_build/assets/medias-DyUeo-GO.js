import{m as c,n as d,am as x,Y as q,q as N,s as C,j as e,ag as L,t as i}from"./client-0TpWmm9u.js";import{u as U}from"./useSuspenseQuery-BxnlANRH.js";import{P as h}from"./plus-Cg62IB_I.js";import{L as f}from"./label-CmjesrgN.js";import{u as Q}from"./use-image-preview-DNlebQzt.js";import{d as D,U as T}from"./index-CSD92ssp.js";import{T as _}from"./trash-CVkehG-l.js";const z=d("app_lib_api_companies_mutations_update-company-medias_ts--updateCompanyMedia_createServerFn_handler","/_server"),K=c({method:"POST"}).handler(z),O=d("app_lib_api_companies_mutations_update-company-medias_ts--updateCompanyLogo_createServerFn_handler","/_server");c({method:"POST"}).handler(O);const R=d("app_lib_api_companies_mutations_update-company-medias_ts--updateCompanyGallery_createServerFn_handler","/_server");c({method:"POST"}).handler(R);const B=d("app_lib_api_companies_mutations_delete-company-media_ts--deleteCompanyLogo_createServerFn_handler","/_server");c({method:"POST"}).handler(B);const E=d("app_lib_api_companies_mutations_delete-company-media_ts--deleteCompanyMedia_createServerFn_handler","/_server"),G=c({method:"POST"}).handler(E),Z=function(){const m=x.useParams(),n=x.useRouteContext(),w=x.useNavigate(),{data:a}=U(q(m.slug)),{imagePreviews:o,readImage:S,setImagePreviews:b}=Q(),{mutate:I,isPending:F}=N({mutationFn:C(K)}),{mutate:v,isPending:p}=N({mutationFn:C(G)});function g(s,r,l){const t=s.target.files?.[0];t&&S({type:r,file:t,index:l})}function P({companyId:s,publicId:r}){v({data:{companyId:s,publicId:r,type:"logo"}},{onSuccess:()=>{n.queryClient.invalidateQueries({queryKey:["user","companies"]}),n.queryClient.invalidateQueries({queryKey:["company",m.slug]}),b(l=>({...l,logo:void 0})),i.success("Logo supprimé avec succès")}})}function j({companyId:s,publicId:r,index:l}){v({data:{companyId:s,publicId:r,type:"gallery",index:l}},{onSuccess:()=>{n.queryClient.invalidateQueries({queryKey:["user","companies"]}),n.queryClient.invalidateQueries({queryKey:["company",m.slug]}),b(t=>({...t,gallery:t.gallery.filter((u,y)=>y!==l)})),i.success("Image supprimée avec succès")}})}function M(s){s.preventDefault();const r=new FormData(s.target),l=D(r,{files:["logo","gallery"],arrays:["gallery","gallery_public_id"]}),t=L(T,l,{abortPipeEarly:!0});if(!t.success){i.error(e.jsx("div",{children:t.issues.map((u,y)=>e.jsx("p",{children:u.message},y))}));return}I({data:r},{onSuccess:()=>{n.queryClient.invalidateQueries({queryKey:["user","companies"]}),n.queryClient.invalidateQueries({queryKey:["company",m.slug]}),i.success("Images mises à jour avec succès"),w({to:"/compte/entreprises"})},onError:u=>{console.error(u),i.error("Une erreur est survenue lors de la mise à jour des images")}})}return e.jsx("div",{className:"container py-6",children:e.jsxs("form",{onSubmit:M,className:"flex flex-col gap-4 items-center",children:[e.jsx("input",{type:"hidden",name:"companyId",value:a.id}),e.jsxs("div",{className:"flex flex-col gap-2 justify-center",children:[e.jsxs("fieldset",{className:"border rounded-sm border-gray-300 p-4 w-max",children:[e.jsx("legend",{className:"text-xs font-medium  bg-white px-2",children:"Logo"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(f,{className:"relative flex flex-col gap-1 outline-none group",children:[e.jsx("span",{className:"text-xs font-medium",children:"Logo (max. 3MB)"}),e.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[o.logo||a.logo?.secureUrl?e.jsx("img",{src:o.logo||a.logo?.secureUrl,alt:"Logo",className:"w-full h-full object-cover"}):e.jsx(h,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"logo",onChange:s=>g(s,"logo"),accept:"image/*"}),e.jsx("input",{type:"hidden",name:"logo_public_id",value:a.logo?.publicId})]})]}),e.jsx("button",{type:"button",className:"text-xs font-medium text-white bg-primary p-2 rounded-sm w-max",onClick:()=>P({companyId:a.id,publicId:a.logo?.publicId||""}),children:p?"...":e.jsx(_,{className:"size-5"})})]})]}),e.jsxs("fieldset",{className:"border rounded-sm border-gray-300 p-4",children:[e.jsx("legend",{className:"text-xs font-medium  bg-white px-2",children:"Galerie"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(f,{className:"relative flex flex-col gap-1 outline-none group",children:[e.jsx("span",{className:"text-xs font-medium",children:"Image 1 (max. 2MB)"}),e.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[o.gallery[0]||a.gallery?.[0]?.secureUrl?e.jsx("img",{src:o.gallery[0]||a.gallery?.[0].secureUrl,alt:"gallery 1",className:"w-full h-full object-cover"}):e.jsx(h,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery[0]",onChange:s=>g(s,"gallery",0),accept:"image/*"}),e.jsx("input",{type:"hidden",name:"gallery_public_id[0]",value:a.gallery?.[0]?.publicId})]})]}),e.jsx("button",{type:"button",className:"text-xs font-medium text-white bg-primary p-2 rounded-sm w-max",onClick:()=>j({companyId:a.id,publicId:a.gallery?.[0]?.publicId||"",index:0}),children:p?"...":e.jsx(_,{className:"size-5"})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(f,{className:"relative flex flex-col gap-1 outline-none group",children:[e.jsx("span",{className:"text-xs font-medium",children:"Image 2 (max. 2MB)"}),e.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[o.gallery[1]||a.gallery?.[1]?.secureUrl?e.jsx("img",{src:o.gallery[1]||a.gallery?.[1].secureUrl,alt:"gallery 2",className:"w-full h-full object-cover"}):e.jsx(h,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery[1]",onChange:s=>g(s,"gallery",1),accept:"image/*"}),e.jsx("input",{type:"hidden",name:"gallery_public_id[1]",value:a.gallery?.[1]?.publicId})]})]}),e.jsx("button",{type:"button",className:"text-xs font-medium text-white bg-primary p-2 rounded-sm w-max",onClick:()=>j({companyId:a.id,publicId:a.gallery?.[1]?.publicId||"",index:1}),children:p?"...":e.jsx(_,{className:"size-5"})})]})]})]})]}),e.jsx("button",{type:"submit",className:"text-xs font-medium text-white bg-primary px-4 py-2 rounded-sm w-max",children:F?"En cours...":"Mettre à jour"})]})})};export{Z as component};
