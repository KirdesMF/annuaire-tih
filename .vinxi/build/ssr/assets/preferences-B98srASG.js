import{jsxs as t,jsx as e}from"react/jsx-runtime";import{useMutation as p}from"@tanstack/react-query";import{Separator as i,RadioGroup as u,Avatar as l}from"radix-ui";import{useState as w}from"react";import{toast as y}from"sonner";import{I as d}from"./input-DBDjV_JP.js";import{L as m}from"./label-DH_rTUQU.js";import{D as _,a as S,b as U,c as F}from"./dialog-D12vissF.js";import{createServerFn as x}from"@tanstack/start-client-core";import{k as f,v as K,w as Q,n as h}from"./ssr-Bxxdisao.js";import*as a from"valibot";import"./close--xrcrNXd.js";import"@tanstack/react-router";import"drizzle-orm/pg-core";import"better-auth/react";import"better-auth/client/plugins";import"zustand";import"@tanstack/router-core";import"@tanstack/start-server-core";import"cmdk";import"clsx";import"tailwind-merge";import"@tanstack/react-query-devtools";import"drizzle-orm";import"nanoid";import"@tanstack/react-router-with-query";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";const B=f("app_lib_api_users_mutations_delete-user_ts--deleteUser_createServerFn_handler","/_server"),H=x({method:"POST"}).validator(s=>s).handler(B),J=a.object({email:a.string()}),W=f("app_lib_api_users_mutations_update-user-email_ts--updateUserEmailFn_createServerFn_handler","/_server"),X=x({method:"POST"}).validator(s=>a.parse(J,{email:s.get("email")})).handler(W),Y=a.object({name:a.optional(a.string())}),Z=f("app_lib_api_users_mutations_update-user-infos_ts--updateUserInfos_createServerFn_handler","/_server"),$=x({method:"POST"}).validator(s=>a.parse(Y,{name:s.get("name"),image:s.get("image")})).handler(Z),ee=a.object({password:a.string(),newPassword:a.string()}),te=f("app_lib_api_users_mutations_update-user-password_ts--updateUserPasswordFn_createServerFn_handler","/_server"),se=x({method:"POST"}).validator(s=>a.parse(ee,{password:s.get("password"),newPassword:s.get("newPassword")})).handler(te);function re({user:s}){if(!s)return null;const o=s.name?.split(" ").map(g=>g[0]).join("");return s.image?t(l.Root,{className:"size-16 rounded-full",children:[e(l.Image,{src:s.image,alt:s.name,className:"size-full rounded-full"}),e(l.Fallback,{className:"size-full leading-1",children:o})]}):e(l.Root,{className:"size-16 rounded-full border border-gray-200 flex",children:e(l.Fallback,{className:"size-full leading-1 text-2xl grid place-items-center text-blue-500",children:o})})}const Ie=function(){const o=K.useRouteContext(),[g,b]=w(!1),[k,c]=w(!1),{theme:P,onThemeLight:D,onThemeDark:M,onThemeSystem:T,setTheme:C}=Q(),{mutate:I,isPending:N}=p({mutationFn:h(H)}),{mutate:R,isPending:v}=p({mutationFn:h($)}),{mutate:j,isPending:V}=p({mutationFn:h(se)}),{mutate:z,isPending:O}=p({mutationFn:h(X)});function E(){I({data:{userId:o.user.id}})}function q(r){r.preventDefault();const n=new FormData(r.currentTarget);R({data:n},{onSuccess:async()=>{await o.queryClient.invalidateQueries({queryKey:["user","session"],refetchType:"all"}),y.success("Nom et prénom modifié avec succès")}})}function A(r){r.preventDefault();const n=new FormData(r.currentTarget);j({data:n},{onSuccess:()=>{c(!1),y.success("Mot de passe modifié avec succès")}})}function L(r){r.preventDefault();const n=new FormData(r.currentTarget);z({data:n},{onSuccess:()=>{y.success("Email modifié avec succès")}})}function G(r){const n={light:D,dark:M,system:T};C(r),n[r]()}return t("div",{className:"container px-4 py-6",children:[t("header",{children:[e("h1",{className:"text-2xl font-bold",children:"Préférences utilisateur"}),e("p",{children:"Modifiez vos préférences utilisateur pour personnaliser votre expérience sur le site."})]}),e(i.Root,{className:"my-8 h-px bg-gray-300"}),t("div",{className:"grid gap-8",children:[t("article",{className:"border border-gray-300 p-4 rounded-sm flex justify-between",children:[t("div",{className:"flex flex-col gap-2",children:[e("h2",{className:"text-xl font-bold",children:"Avatar"}),e("p",{className:"text-sm text-pretty",children:"Votre avatar est votre image de profil. Vous pouvez le modifier en cliquant sur l'avatar."})]}),e("div",{className:"flex justify-center px-4",children:e(re,{user:o.user})})]}),e("article",{className:"border border-gray-300 p-4 rounded-sm",children:t("form",{onSubmit:q,children:[t("div",{className:"flex flex-col gap-2 py-4",children:[e("h2",{className:"text-xl font-bold",children:"Nom et prénom"}),e("p",{className:"text-sm text-pretty",children:"Votre nom et prénom sont utilisés pour identifier votre compte. Vous pouvez le modifier en cliquant sur le bouton ci-dessous."}),t(m,{children:[e("span",{className:"sr-only",children:"Nom et prénom"}),e(d,{name:"name",defaultValue:o.user.name,className:"max-w-1/3 text-sm"})]})]}),e(i.Root,{className:"my-4 -mx-4 h-px bg-gray-300"}),e("div",{className:"flex gap-2 justify-end",children:e("button",{type:"submit",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs",disabled:v,children:v?"Modification en cours...":"Modifier mon nom et prénom"})})]})}),e("article",{className:"border border-gray-300 p-4 rounded-sm",children:t("form",{onSubmit:L,children:[t("div",{className:"flex flex-col gap-2",children:[e("h2",{className:"text-xl font-bold",children:"Email"}),e("p",{className:"text-sm text-pretty",children:"Un email de confirmation vous sera envoyé afin de vérifier votre identité"}),t(m,{children:[e("span",{className:"sr-only",children:"Email"}),e(d,{name:"email",defaultValue:o.user.email,className:"max-w-1/3 text-sm"})]})]}),e(i.Root,{className:"my-4 -mx-4 h-px bg-gray-300"}),e("div",{className:"flex gap-2 justify-end",children:e("button",{type:"submit",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs",children:O?"Modification en cours...":"Modifier mon email"})})]})}),t("article",{className:"border border-gray-300 p-4 rounded-sm",children:[t("div",{className:"flex flex-col gap-2",children:[e("h2",{className:"text-xl font-bold",children:"Mot de passe"}),e("p",{className:"text-sm text-pretty",children:"Votre mot de passe est utilisé pour accéder à votre compte. Vous pouvez le modifier en cliquant sur le bouton ci-dessous."}),t(m,{children:[e("span",{className:"sr-only",children:"Mot de passe"}),e(d,{type:"password",name:"password",defaultValue:"password",className:"max-w-1/3 text-sm"})]})]}),e(i.Root,{className:"my-4 -mx-4 h-px bg-gray-300"}),t("div",{className:"flex gap-2 justify-end",children:[e("button",{type:"button",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs",onClick:()=>c(!0),children:"Modifier mon mot de passe"}),e(_,{open:k,onOpenChange:c,children:t(S,{children:[e(U,{children:"Modifier mon mot de passe"}),e(i.Root,{className:"my-4 -mx-4 h-px bg-gray-300"}),e(F,{className:"mb-6",children:"Veuillez entrer votre mot de passe actuel et votre nouveau mot de passe."}),t("form",{onSubmit:A,children:[t("div",{className:"flex flex-col gap-4 mb-4",children:[t(m,{className:"flex flex-col gap-2",children:[e("span",{className:"text-sm",children:"Mot de passe actuel"}),e(d,{type:"password",name:"password",className:"text-sm"})]}),t(m,{className:"flex flex-col gap-2",children:[e("span",{className:"text-sm",children:"Nouveau mot de passe"}),e(d,{type:"password",name:"newPassword",className:"text-sm"})]})]}),t("div",{className:"flex gap-2 justify-end",children:[e("button",{type:"button",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs",onClick:()=>c(!1),children:"Annuler"}),e("button",{type:"submit",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs",children:V?"Modification en cours...":"Modifier mon mot de passe"})]})]})]})})]})]}),e("article",{className:"border border-gray-300 p-4 rounded-sm",children:t("div",{className:"flex flex-col gap-2",children:[e("h2",{className:"text-xl font-bold",children:"Thème"}),e("p",{className:"text-sm text-pretty",children:"Vous pouvez modifier le thème de votre site en selectionnant une option ci-dessous."}),t(u.Root,{defaultValue:P??"system",onValueChange:r=>G(r),className:"flex gap-2",children:[e(u.Item,{value:"light",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs cursor-pointer dark:bg-gray-900 dark:text-white dark:border dark:border-gray-700",children:"Light"}),e(u.Item,{value:"dark",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs cursor-pointer dark:bg-gray-900 dark:text-white dark:border dark:border-gray-700",children:"Dark"}),e(u.Item,{value:"system",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs cursor-pointer dark:bg-gray-900 dark:text-white dark:border dark:border-gray-700",children:"System"})]})]})}),e(i.Root,{className:"my-8 h-px bg-gray-300"}),t("article",{className:"border border-red-500 rounded-sm flex flex-col gap-6",children:[t("div",{className:"flex flex-col gap-2 p-4",children:[e("h2",{className:"text-lg font-bold",children:"Supprimer mon compte"}),e("p",{children:"Supprimer votre compte utilisateur et toutes vos données associées. Cette action est irréversible."})]}),t("div",{className:"flex justify-end p-4 border-t border-red-500",children:[e("button",{type:"button",className:"bg-red-500 text-white px-4 py-2 rounded-sm text-sm",onClick:()=>b(!0),children:"Supprimer mon compte"}),e(_,{open:g,onOpenChange:b,children:t(S,{children:[e(U,{children:"Supprimer mon compte"}),e(i.Root,{className:"my-4 -mx-4 h-px bg-gray-300"}),e(F,{className:"mb-6",children:"Si vous souhaitez supprimer votre compte, veuillez cliquer sur le bouton ci-dessous."}),t("div",{className:"flex justify-end gap-2 px-2",children:[e("button",{type:"button",className:"bg-gray-500 text-white px-4 py-2 rounded-sm text-xs",onClick:()=>b(!1),children:"Annuler"}),e("button",{type:"button",className:"bg-red-500 text-white px-4 py-2 rounded-sm text-xs",disabled:N,onClick:E,children:N?"Suppression en cours...":"Supprimer mon compte"})]})]})})]})]})]})]})};export{Ie as component};
