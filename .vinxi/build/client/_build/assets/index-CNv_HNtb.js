import{a9 as w,l as L,q,s as F,r as u,aa as v,j as e,ab as M,ac as Q,ad as A,ae as B,af as c,Z as O,t as m,ag as G}from"./client-0TpWmm9u.js";import{u as H}from"./useSuspenseQuery-BxnlANRH.js";import{I as n}from"./input-B2F8Q8w2.js";import{L as a}from"./label-CmjesrgN.js";import{C as T}from"./close-BuE9jvDt.js";import{d as K,C as Z}from"./index-CSD92ssp.js";import{C as $}from"./chevron-down-DpxYYdqQ.js";import{E as J,P as U,G as W,F as X,I as Y,C as ee}from"./globe-nPYG3DDN.js";import{P as h}from"./plus-Cg62IB_I.js";import{u as se}from"./use-image-preview-DNlebQzt.js";import{c as ae}from"./create-company-BvDV2e-_.js";import{R as d}from"./index-Dt2I4tfU.js";const ge=function(){const g=w.useRouteContext(),f=w.useNavigate(),{data:j}=H(L),{mutate:C,isPending:y}=q({mutationFn:F(ae)}),N=u.useRef(null),t=v(s=>s.preview),k=v(s=>s.setPreview),[x,b]=u.useState(new Set(t?.categories)),[_,z]=u.useState(0),{imagePreviews:i,readImage:I}=se();function E(s){b(l=>l.size>=3?(m.error("Vous ne pouvez pas sélectionner plus de 3 catégories"),l):new Set(l).add(s))}function S(s){b(l=>{const r=new Set(l);return r.delete(s),r})}function P(s){z(s.target.value.length)}function p(s,l,r){const o=s.target.files?.[0];o&&I({type:l,file:o,index:r})}function R(){const s=new FormData(N.current),l=K(s,{files:["logo","gallery"],arrays:["categories","gallery"],booleans:["rqth"]}),r=G(Z,l,{abortPipeEarly:!0});if(!r.success){m.error(e.jsx("div",{children:r.issues.map((o,D)=>e.jsx("p",{children:o.message},D))}));return}k(r.output),f({to:"/compte/entreprises/create/preview"})}function V(s){s.preventDefault();const l=new FormData(s.target);C({data:l},{onSuccess:()=>{g.queryClient.invalidateQueries({queryKey:["user","companies"]}),m.success("Entreprise créée avec succès"),f({to:"/compte/entreprises"})},onError:r=>{console.error(r),m.error(r.message)}})}return e.jsx("div",{className:"container px-4 py-6",children:e.jsxs("div",{className:"max-w-xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Référencez votre entreprise"}),e.jsxs("form",{className:"flex flex-col gap-3",ref:N,onSubmit:V,children:[e.jsx("input",{type:"hidden",name:"user_id",value:g.user.id}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Nom de l'entreprise *"}),e.jsx(n,{type:"text",name:"name",placeholder:"Ex: mon entreprise",className:"placeholder:text-xs",defaultValue:t?.name})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Siret *"}),e.jsx(n,{type:"text",name:"siret",placeholder:"Ex: 12345678901234",className:"placeholder:text-xs",defaultValue:t?.siret})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Catégories * (max. 3)"}),e.jsxs(M,{children:[e.jsxs(Q,{className:"h-9 cursor-pointer border rounded-sm border-gray-300 px-2 py-1 text-xs flex items-center justify-between gap-2",children:[e.jsx("span",{className:"rounded-sm text-xs flex items-center gap-2 text-gray-400",children:"Ajouter une catégorie"}),e.jsx($,{className:"size-5 text-gray-500"})]}),e.jsx(A,{children:e.jsx(B,{className:"bg-white w-(--radix-popper-anchor-width)",sideOffset:5,children:e.jsxs(c,{className:"border rounded-sm border-gray-300",children:[e.jsx(c.Input,{placeholder:"Rechercher une catégorie",className:"w-full h-10 px-2 outline-none placeholder:text-sm placeholder:font-light"}),e.jsx(c.Separator,{className:"h-px bg-gray-300"}),e.jsx(c.List,{className:"max-h-60 overflow-y-auto",children:j.map(s=>e.jsx(c.Item,{value:s.name,disabled:x.has(s.id),className:"cursor-pointer py-1.5 px-2 aria-selected:bg-gray-100 text-sm font-light aria-disabled:opacity-20",onSelect:()=>E(s.id),children:s.name},s.id))})]})})})]})]}),x.size?e.jsx("ul",{className:"flex flex-wrap gap-2",children:Array.from(x.values()).map((s,l)=>{const r=j.find(o=>o.id===s);return r?e.jsxs("li",{className:"bg-gray-400 text-white px-2 py-1 rounded-sm text-xs flex items-center gap-2",children:[e.jsx("input",{type:"hidden",name:`categories[${l}]`,value:r.id}),e.jsx("span",{className:"max-w-[30ch] truncate",children:r.name}),e.jsx("button",{type:"button",className:"text-white inline-grid place-items-center cursor-pointer",onClick:()=>S(r.id),children:e.jsx(T,{className:"size-3 text-white"})})]},r.id):null})}):null,e.jsx(d,{className:"h-px bg-gray-300 my-4"}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Description"}),e.jsx("textarea",{name:"description",className:"border rounded-sm p-2 border-gray-300 resize-none placeholder:text-xs",rows:4,placeholder:"Entrer une description de mon entreprise...",onChange:P,defaultValue:t?.description})]}),e.jsxs("span",{className:"text-xs text-gray-500 justify-self-end",children:[_,"/1500"]})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Entrepreneur"}),e.jsx(n,{type:"text",name:"business_owner",placeholder:"Ex: Nom Prénom",className:"placeholder:text-xs",defaultValue:t?.business_owner})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Perimètre d'intervention"}),e.jsx(n,{type:"text",name:"service_area",placeholder:"Ex: Paris, Lyon, Marseille",className:"placeholder:text-xs",defaultValue:t?.service_area})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Sous-domaine"}),e.jsx(n,{type:"text",name:"subdomain",placeholder:"Ex: monentreprise",className:"placeholder:text-xs",defaultValue:t?.subdomain})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(J,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"email",name:"email",placeholder:"Ex: contact@monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:t?.email})]})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Numéro de téléphone"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(U,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"tel",name:"phone",placeholder:"Ex: 06 06 06 06 06",className:"placeholder:text-xs outline-none w-full",defaultValue:t?.phone})]})]}),e.jsxs(a,{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Site web"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(W,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"website",placeholder:"Ex: https://www.monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:t?.website})]})]}),e.jsx(d,{className:"h-px bg-gray-300 my-4"}),e.jsxs("fieldset",{className:"flex flex-col gap-4",children:[e.jsx("legend",{className:"text-xs font-medium mb-2",children:"Réseaux sociaux"}),e.jsxs(a,{children:[e.jsx("span",{className:"sr-only",children:"Linkedin"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(O,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.linkedin",placeholder:"Ex: https://www.linkedin.com/company/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t?.social_media.linkedin})]})]}),e.jsxs(a,{children:[e.jsx("span",{className:"sr-only",children:"Facebook"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(X,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.facebook",placeholder:"Ex: https://www.facebook.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t?.social_media.facebook})]})]}),e.jsxs(a,{children:[e.jsx("span",{className:"sr-only",children:"Instagram"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(Y,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.instagram",placeholder:"Ex: https://www.instagram.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t?.social_media.instagram})]})]}),e.jsxs(a,{children:[e.jsx("span",{className:"sr-only",children:"Calendly"}),e.jsxs("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e.jsx(ee,{className:"size-5 text-gray-500"}),e.jsx("input",{type:"text",name:"social_media.calendly",placeholder:"Ex: https://calendly.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t?.social_media.calendly})]})]})]}),e.jsx(d,{className:"h-px bg-gray-300 my-4"}),e.jsxs("div",{className:"grid gap-8",children:[e.jsxs("fieldset",{className:"flex gap-4",children:[e.jsx("legend",{className:"text-xs font-medium mb-2",children:"Mode de travail"}),e.jsxs(a,{className:"flex items-center gap-1",children:[e.jsx(n,{type:"radio",name:"work_mode",value:"not_specified",defaultChecked:t?.work_mode==="not_specified"||!t?.work_mode,className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Non spécifié"})]}),e.jsxs(a,{className:"flex items-center gap-1",children:[e.jsx(n,{type:"radio",name:"work_mode",value:"remote",defaultChecked:t?.work_mode==="remote",className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"À distance"})]}),e.jsxs(a,{className:"flex items-center gap-1",children:[e.jsx(n,{type:"radio",name:"work_mode",value:"onsite",defaultChecked:t?.work_mode==="onsite",className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Sur site"})]}),e.jsxs(a,{className:"flex items-center gap-1",children:[e.jsx(n,{type:"radio",name:"work_mode",value:"hybrid",defaultChecked:t?.work_mode==="hybrid",className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Hybride"})]})]}),e.jsxs("fieldset",{className:"flex gap-2",children:[e.jsx("legend",{className:"text-xs font-medium mb-2",children:"RQTH"}),e.jsxs(a,{className:"flex items-center gap-1",children:[e.jsx(n,{type:"radio",name:"rqth",value:"true",defaultChecked:t?.rqth,className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Oui"})]}),e.jsxs(a,{className:"flex items-center gap-1",children:[e.jsx(n,{type:"radio",name:"rqth",value:"false",defaultChecked:!t?.rqth,className:"size-4 accent-gray-600"}),e.jsx("span",{className:"text-xs",children:"Non"})]})]})]}),e.jsx(d,{className:"h-px bg-gray-300 my-4"}),e.jsxs("fieldset",{className:"border rounded-sm border-gray-300 p-4",children:[e.jsx("legend",{className:"text-xs font-medium  bg-white px-2",children:"Images"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(a,{className:"relative flex flex-col gap-1 outline-none group",children:[e.jsx("span",{className:"text-xs font-medium",children:"Logo (max. 3MB)"}),e.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[i.logo?e.jsx("img",{src:i.logo,alt:"Logo",className:"w-full h-full object-cover"}):e.jsx(h,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"logo",onChange:s=>p(s,"logo"),accept:"image/*"})]})]}),e.jsxs(a,{className:"relative flex flex-col gap-1 outline-none group",children:[e.jsx("span",{className:"text-xs font-medium",children:"Image 1 (max. 2MB)"}),e.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[i.gallery[0]?e.jsx("img",{src:i.gallery[0],alt:"gallery 1",className:"w-full h-full object-cover"}):e.jsx(h,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery",onChange:s=>p(s,"gallery",0),accept:"image/*"})]})]}),e.jsxs(a,{className:"relative flex flex-col gap-1 outline-none group",children:[e.jsx("span",{className:"text-xs font-medium",children:"Image 2 (max. 2MB)"}),e.jsxs("div",{className:"w-35 h-40 bg-gray-100 border border-gray-300 rounded-sm grid place-items-center group-focus-within:border-gray-500",children:[i.gallery[1]?e.jsx("img",{src:i.gallery[1],alt:"gallery 2",className:"w-full h-full object-cover"}):e.jsx(h,{className:"size-8 rounded-full bg-gray-400 p-1 text-white"}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0",name:"gallery",onChange:s=>p(s,"gallery",1),accept:"image/*"})]})]})]})]}),e.jsx(d,{className:"h-px bg-gray-300 my-4"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",className:"bg-gray-800 text-white px-3 py-2 rounded-sm font-light text-xs disabled:opacity-50",onClick:R,children:"Prévisualiser"}),e.jsx("button",{type:"submit",className:"bg-gray-800 text-white px-3 py-2 rounded-sm font-light text-xs",disabled:y,children:y?"Création en cours...":"Créer un compte"})]})]})]})})};export{ge as component};
