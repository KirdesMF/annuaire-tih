import{jsx as e,jsxs as a}from"react/jsx-runtime";import{useSuspenseQueries as R,useMutation as V}from"@tanstack/react-query";import{I as l}from"./input-DBDjV_JP.js";import{L as r}from"./label-DH_rTUQU.js";import{Command as o}from"cmdk";import{useRef as P,useState as y}from"react";import{C as j}from"./close--xrcrNXd.js";import{K as p,c as q,y as L,n as D,M as F,L as M}from"./ssr-Bxxdisao.js";import{toast as u}from"sonner";import{Popover as c,Separator as d}from"radix-ui";import{C as Q}from"./chevron-down-CM3ht1vz.js";import{E as K,P as O,G as A,F as G,I as H,C as T}from"./globe-BUymkEPS.js";import{u as B}from"./update-company-infos-bKDWJV6w.js";import"@tanstack/react-router";import"drizzle-orm/pg-core";import"better-auth/react";import"better-auth/client/plugins";import"zustand";import"@tanstack/router-core";import"@tanstack/start-client-core";import"@tanstack/start-server-core";import"clsx";import"tailwind-merge";import"@tanstack/react-query-devtools";import"valibot";import"drizzle-orm";import"nanoid";import"@tanstack/react-router-with-query";import"tiny-invariant";import"node:stream";import"isbot";import"react-dom/server";import"./company.schema-5gxzbh_J.js";import"decode-formdata";const Ee=function(){const x=p.useRouteContext(),h=p.useParams(),b=p.useNavigate(),w=P(null),[f,t]=R({queries:[q,L(h.slug)]}),{mutate:v,isPending:g}=V({mutationFn:D(B)}),[m,N]=y(new Set(t.data?.categories.map(s=>s?.id??""))),[C,k]=y(t.data?.description?.length??0);F(s=>s.setPreview);function _(s){N(i=>i.size>=3?(u.error("Vous ne pouvez pas sélectionner plus de 3 catégories"),i):new Set(i).add(s))}function S(s){N(i=>{const n=new Set(i);return n.delete(s),n})}function z(s){k(s.target.value.length)}function E(s){s.preventDefault();const i=new FormData(s.target);v({data:i},{onSuccess:()=>{x.queryClient.invalidateQueries({queryKey:["user","companies"]}),x.queryClient.invalidateQueries({queryKey:["company",h.slug]}),u.success("Entreprise mise à jour avec succès"),b({to:"/compte/entreprises"})},onError:n=>{u.error(n.message)}})}return e("div",{className:"container py-6",children:a("div",{className:"max-w-xl mx-auto",children:[e("h1",{className:"text-2xl font-bold mb-4",children:"Référencez votre entreprise"}),a("form",{className:"flex flex-col gap-3",ref:w,onSubmit:E,children:[e("input",{type:"hidden",name:"companyId",value:t.data?.id}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Nom de l'entreprise *"}),e(l,{type:"text",name:"name",placeholder:"Ex: mon entreprise",className:"placeholder:text-xs",defaultValue:t.data?.name})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Siret *"}),e(l,{type:"text",name:"siret",placeholder:"Ex: 12345678901234",className:"placeholder:text-xs",defaultValue:t.data?.siret})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Catégories * (max. 3)"}),a(c.Root,{children:[a(c.Trigger,{className:"h-9 cursor-pointer border rounded-sm border-gray-300 px-2 py-1 text-xs flex items-center justify-between gap-2",children:[e("span",{className:"rounded-sm text-xs flex items-center gap-2 text-gray-400",children:"Ajouter une catégorie"}),e(Q,{className:"size-5 text-gray-500"})]}),e(c.Portal,{children:e(c.Content,{className:"bg-white w-(--radix-popper-anchor-width)",sideOffset:5,children:a(o,{className:"border rounded-sm border-gray-300",children:[e(o.Input,{placeholder:"Rechercher une catégorie",className:"w-full h-10 px-2 outline-none placeholder:text-sm placeholder:font-light"}),e(o.Separator,{className:"h-px bg-gray-300"}),e(o.List,{className:"max-h-60 overflow-y-auto",children:f.data?.map(s=>e(o.Item,{value:s.name,disabled:m.has(s.id),className:"cursor-pointer py-1.5 px-2 aria-selected:bg-gray-100 text-sm font-light aria-disabled:opacity-20",onSelect:()=>_(s.id),children:s.name},s.id))})]})})})]})]}),m.size?e("ul",{className:"flex flex-wrap gap-2",children:Array.from(m.values()).map((s,i)=>{const n=f.data?.find(I=>I.id===s);return n?a("li",{className:"bg-gray-400 text-white px-2 py-1 rounded-sm text-xs flex items-center gap-2",children:[e("input",{type:"hidden",name:`categories[${i}]`,value:n.id}),e("span",{className:"max-w-[30ch] truncate",children:n.name}),e("button",{type:"button",className:"text-white inline-grid place-items-center cursor-pointer",onClick:()=>S(n.id),children:e(j,{className:"size-3 text-white"})})]},n.id):null})}):null,e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("div",{className:"grid gap-1",children:[a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Description"}),e("textarea",{name:"description",className:"border rounded-sm p-2 border-gray-300 resize-none placeholder:text-xs",rows:4,placeholder:"Entrer une description de mon entreprise...",onChange:z,defaultValue:t.data?.description??""})]}),a("span",{className:"text-xs text-gray-500 justify-self-end",children:[C,"/1500"]})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Entrepreneur"}),e(l,{type:"text",name:"business_owner",placeholder:"Ex: Nom Prénom",className:"placeholder:text-xs",defaultValue:t.data?.business_owner??""})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Perimètre d'intervention"}),e(l,{type:"text",name:"service_area",placeholder:"Ex: Paris, Lyon, Marseille",className:"placeholder:text-xs",defaultValue:t.data?.service_area??""})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Sous-domaine"}),e(l,{type:"text",name:"subdomain",placeholder:"Ex: monentreprise",className:"placeholder:text-xs",defaultValue:t.data?.subdomain??""})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Email"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(K,{className:"size-5 text-gray-500"}),e("input",{type:"email",name:"email",placeholder:"Ex: contact@monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.email??""})]})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Numéro de téléphone"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(O,{className:"size-5 text-gray-500"}),e("input",{type:"tel",name:"phone",placeholder:"Ex: 06 06 06 06 06",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.phone??""})]})]}),a(r,{className:"flex flex-col gap-1",children:[e("span",{className:"text-xs font-medium",children:"Site web"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(A,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"website",placeholder:"Ex: https://www.monentreprise.com",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.website??""})]})]}),e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("fieldset",{className:"flex flex-col gap-4",children:[e("legend",{className:"text-xs font-medium mb-2",children:"Réseaux sociaux"}),a(r,{children:[e("span",{className:"sr-only",children:"Linkedin"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(M,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.linkedin",placeholder:"Ex: https://www.linkedin.com/company/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.linkedin??""})]})]}),a(r,{children:[e("span",{className:"sr-only",children:"Facebook"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(G,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.facebook",placeholder:"Ex: https://www.facebook.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.facebook??""})]})]}),a(r,{children:[e("span",{className:"sr-only",children:"Instagram"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(H,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.instagram",placeholder:"Ex: https://www.instagram.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.instagram??""})]})]}),a(r,{children:[e("span",{className:"sr-only",children:"Calendly"}),a("div",{className:"flex items-center gap-2 border rounded-sm border-gray-300 h-9 px-2 focus-within:border-gray-500",children:[e(T,{className:"size-5 text-gray-500"}),e("input",{type:"text",name:"social_media.calendly",placeholder:"Ex: https://calendly.com/monentreprise",className:"placeholder:text-xs outline-none w-full",defaultValue:t.data?.social_media.calendly??""})]})]})]}),e(d.Root,{className:"h-px bg-gray-300 my-4"}),a("div",{className:"grid gap-8",children:[a("fieldset",{className:"flex gap-4",children:[e("legend",{className:"text-xs font-medium mb-2",children:"Mode de travail"}),a(r,{className:"flex items-center gap-1",children:[e(l,{type:"radio",name:"work_mode",value:"not_specified",defaultChecked:t.data?.work_mode==="not_specified",className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Non spécifié"})]}),a(r,{className:"flex items-center gap-1",children:[e(l,{type:"radio",name:"work_mode",value:"remote",defaultChecked:t.data?.work_mode==="remote",className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"À distance"})]}),a(r,{className:"flex items-center gap-1",children:[e(l,{type:"radio",name:"work_mode",value:"onsite",defaultChecked:t.data?.work_mode==="onsite",className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Sur site"})]}),a(r,{className:"flex items-center gap-1",children:[e(l,{type:"radio",name:"work_mode",value:"hybrid",defaultChecked:t.data?.work_mode==="hybrid",className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Hybride"})]})]}),a("fieldset",{className:"flex gap-2",children:[e("legend",{className:"text-xs font-medium mb-2",children:"RQTH"}),a(r,{className:"flex items-center gap-1",children:[e(l,{type:"radio",name:"rqth",value:"true",defaultChecked:t.data?.rqth,className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Oui"})]}),a(r,{className:"flex items-center gap-1",children:[e(l,{type:"radio",name:"rqth",value:"false",defaultChecked:!t.data?.rqth,className:"size-4 accent-gray-600"}),e("span",{className:"text-xs",children:"Non"})]})]})]}),e(d.Root,{className:"h-px bg-gray-300 my-4"}),e("div",{className:"flex gap-2 justify-end",children:e("button",{type:"submit",className:"bg-gray-800 text-white px-3 py-2 rounded-sm font-light text-xs",disabled:g,children:g?"Mise à jour en cours...":"Mettre à jour"})})]})]})})};export{Ee as component};
