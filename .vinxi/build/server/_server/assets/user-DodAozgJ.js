import{c as d,d as m}from"./index-8Htcofqc.js";import{c as i}from"./categories-BGVwlHfX.js";import{c as e,a}from"./company-categories-Dsd3WCXy.js";import{a as _}from"./auth.server-CEln8Kin.js";import{eq as n,desc as l,inArray as g}from"drizzle-orm";import{redirect as u}from"@tanstack/react-router";import{createServerFn as f}from"@tanstack/start-client-core";import{getWebRequest as h}from"@tanstack/start-server-core";import"tiny-invariant";import"drizzle-orm/postgres-js";import"postgres";import"dotenv";import"drizzle-orm/pg-core";import"better-auth";import"better-auth/adapters/drizzle";import"better-auth/plugins";import"better-auth/react-start";const y=d("app_lib_api_user_ts--getUserCompanies_createServerFn_handler","/_server",(r,o)=>b.__executeServer(r,o)),b=f({method:"GET"}).handler(y,async()=>{const r=h();if(!r)return;const o=await _.api.getSession({headers:r.headers});if(!o)throw u({to:"/login"});const s=await m.select({id:e.id,name:e.name,description:e.description,status:e.status,siret:e.siret,business_owner:e.business_owner,website:e.website,service_area:e.service_area,subdomain:e.subdomain,email:e.email,phone:e.phone,work_mode:e.work_mode,rqth:e.rqth,logo:e.logo,gallery:e.gallery}).from(e).where(n(e.user_id,o.user.id)).orderBy(l(e.created_at)),p=await m.select({company_id:a.company_id,category_id:i.id,category_name:i.name}).from(a).leftJoin(i,n(i.id,a.category_id)).where(g(a.company_id,s.map(t=>t.id)));return s.map(t=>({...t,categories:p.filter(c=>c.company_id===t.id)}))});export{y as getUserCompanies_createServerFn_handler};
